{"version":3,"sources":["images sync /^/.//.*/.png$","images/egg/egg-0.png","images/egg/egg-1.png","images/egg/egg-2.png","images/egg/egg-3.png","images/egg/egg-4.png","images/heart/heart-0.png","images/heart/heart-1.png","images/heart/heart-2.png","images/heart/heart-3.png","utils.ts","main.tsx","classes/Entity.ts","classes/Fruit.ts","creature-inspector.ts","GameImage.ts","classes/Egg.ts","classes/Creature.ts","classes/Graph.ts","components/InputCheckbox.tsx","components/InputRange.tsx","graph-viewer.tsx","Mouse.ts","components/ControlPanel.tsx","keyboard.tsx","Game.tsx","confetti.tsx","components/Warning.tsx","components/InputText.tsx","components/StartMenu.tsx","components/Titlescreen.tsx","components/Board.tsx","components/CreatureInspector.tsx","components/GraphViewer.tsx","components/PauseScreen.tsx","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","Vector","x","y","this","vec2","targetVec","amount","lerp","Math","sqrt","pow","atan2","targetVector","distance","distanceFrom","angle","angleBetween","PolarVector","radius","dist","randFloat","ang","offset","add","convertToCartesian","magnitude","direction","cos","sin","getElem","elem","document","getElementById","randInt","min","max","floor","random","randItem","arr","length","start","target","roundNum","num","dpp","power","round","Number","EPSILON","standardDeviation","data","n","mean","reduce","a","b","variance","val","Colour","colour","_hex","_rgb","hexDigits","split","toLowerCase","substring","getRGB","getHex","r","g","rgb","i","digit1","indexOf","digit2","hex","col","slice","gray","cells","cellRows","Array","createCell","cellObj","createElement","className","createCellRow","cellRow","style","height","Game","cellSize","StartGame","board","classList","remove","setProperty","cellBorderSize","boardWidth","boardSize","width","boardHeight","appendChild","push","j","cell","createBoard","Entity","position","attributes","cellNumber","velocity","age","lifespan","element","entries","attribute","instantiate","createEntity","updatePosition","calculateCell","size","die","left","top","index","splice","cellX","cellY","maxCellNumber","includes","cellIndex","undefined","console","log","searchRadius","surroundingCells","abs","entities","newEntities","filter","entity","concat","entityType","count","prototype","isPrototypeOf","createFruit","tps","randomPositionInCell","Fruit","updateInspector","rerenderInspector","backgroundColor","gameImages","GameImage","name","numFrames","ticksPerFrame","frame","init","updateBackgroundImage","backgroundSize","src","require","default","backgroundImage","Egg","creatureAttributes","generation","shakeAmount","ticks","transform","Creature","copy","stats","inspectorIsOpen","inspectorCreature","closeInspector","creatureGeneInfo","speed","display","weight","positivelyAffectsLifespan","vision","reproductiveRate","calculateLifespan","attributeInfo","attributeVal","generateGene","attributeName","getRandomName","nouns","chosenAdjectives","potentialAdjectives","idx","adjectiveList","previousValue","currentValue","newVal","hasNoun","createCreature","REPRODUCTION_TIME","INCUBATION_TIME","moveSpeed","birthTime","isMoving","targetPosition","reproductiveUrge","partner","reproductionStage","lastReproductionTime","fruitEaten","calculateMoveSpeed","reduction","innerHTML","lifebar","querySelector","life","color","updateLifebar","updateReproductionBar","hasReachedTargetPosition","reachTargetPosition","moveToTargetPosition","imagePos","randomOffset","particleAttempts","visionInCells","surroundingEntities","entitiesInVision","getEntitiesInVision","closestFruit","distanceToNearestFruit","MAX_SAFE_INTEGER","closestPartner","distanceToClosestPartner","entityIsFruit","wantsToReproduce","distanceToCreature","distanceToFruit","handleReproduction","eatFruit","findRandomPosition","fruit","entitiesToCheck","canSeeEntity","targetCell","angleToTarget","nextPosition","end","ray","drawRay","relativeTargetVec","dot","reproduce","then","layEgg","Promise","setTimeout","childAttributes","generateChildGenes","eggAttributes","eggPos","geneName","gene","mutateGene","initialGeneVal","mutateAmount","settings","creatureMutationRate","sign","Graph","options","time","minY","maxY","xAxisMeasurements","timeUnit","calculateTimeUnit","calculateMinY","calculateMaxY","plotData","createAxes","createLabels","type","dataPoint","pos","point","bottom","previousPos","line","rect","triangle","shouldExtrapolate","relativeIndex","remainder","floorVal","ceilVal","ceil","average","getData","plotSimpleData","plotDetailedData","stepSize","drawPoint","drawLine","value","shouldDrawPoint","averageColour","stdevColour","desaturate","darken","outerColour","previousAveragePos","previousMinPos","previousMaxPos","previousStdevMinPos","previousStdevMaxPos","entry","draw","stdevMinPos","stdevMaxPos","rectWidth","rectPos","drawRect","topTrianglePos","drawTrangle","bottomTrianglePos","measurement","toString","createAxisMeasurement","xLabel","yLabel","dependentVariable","InputCheckbox","text","defaultValue","func","inputRef","useRef","useState","setVal","htmlName","ref","onChange","inputVal","current","checked","defaultChecked","htmlFor","InputRange","step","button","hasExtremeMode","onInput","onClick","graphViewerIsVisible","graphSettingData","description","graphOptions","selectedGraphOptions","setupGraphs","createGraphOptions","settingsContainer","elems","setting","baseClickEvent","requirement","drawGraphs","isSelected","isChecked","ReactDOM","render","createSettings","setupSettings","optionsContainer","optionElems","option","hasInserted","graphContainer","graphSettings","dataPoints","geneSamples","sample","genePool","graph","mouse","hoverBox","closestCreature","updateMouse","creatures","distanceToClosestCreature","creature","removePreviousHighlight","highlight","newHoverBox","parent","createHoverBox","updateControlPanel","createCreatures","changeGameSize","dimension","previousWidth","children","previousHeight","newCellAmount","forEach","row","cellRemoveAmount","removeCount","startIndex","redrawBoard","changeTimewarp","timewarp","expandControlPanel","collapseControlPanel","ControlPanel","changeGameWidthRef","changeGameHeightRef","React","updateState","forceUpdate","useCallback","useEffect","body","changeDarkMode","hasStarted","inputWidth","inputHeight","isNaN","alert","boardIsVisible","contains","updateTransform","translate","zoom","translateBoard","dir","zoomBoard","renderListeners","defaultGameSettings","fruitSpawnRate","initialCreatures","initialFruit","equilibrium","isPaused","runTick","querySelectorAll","tick","FRUIT_SPAWN_RATE","rand","allGenes","geneVals","minVal","maxVal","creatureCount","fruitCount","sampleGenes","createRenderListener","removeRenderListener","hasRenderListener","confettis","Confetti","createInstance","getRandomPosition","getRandomVelocity","xVel","yVel","confetti","WIDTH_RANGE","HEIGHT_RANGE","rotation","confettiIndex","handleConfettis","Warning","InputText","limit","warningMessage","openStartMenu","newGameSettings","JSON","parse","stringify","startClickEvent","StartMenu","openSourceCode","window","open","focus","Titlescreen","createConfettis","Board","CreatureInspector","setCreature","newCreature","setInspectorRerenderFunction","geneInfo","fillWidth","fillOpacity","opacity","GraphViewer","PauseScreen","hideMask","showMask","StrictMode","onload","onmousemove","event","mouseScreenX","clientX","mouseScreenY","clientY","boardBounds","getBoundingClientRect","boardPosX","boardPosY","onclick","composedPath","onkeydown","key","activeElement"],"mappings":"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","file":"static/js/main.ff46e1db.chunk.js","sourcesContent":["var map = {\n\t\"./egg/egg-0.png\": 18,\n\t\"./egg/egg-1.png\": 19,\n\t\"./egg/egg-2.png\": 20,\n\t\"./egg/egg-3.png\": 21,\n\t\"./egg/egg-4.png\": 22,\n\t\"./heart/heart-0.png\": 23,\n\t\"./heart/heart-1.png\": 24,\n\t\"./heart/heart-2.png\": 25,\n\t\"./heart/heart-3.png\": 26\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 17;","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAEBJREFUKFOFT1sKACAIm/c/9MJyphTlh+heoqEXYzXBOQAguXizCe9WyXSGSAnpvgkOsoo84Stww/OEEvVi+3AAKPcaB3YCGM0AAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE1JREFUKFNtj0sSACAIQvHa7j03jRX2bdGU4EMN5+H8msr1AEBy6Ga9vK5drM5pEoHujoioQFHSUOhrnh71NaSQ88iQjQ9ljxBZKx4bNv3HHQfqLQCjAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE5JREFUKFNdj9EWACAEQ+e7PftuHTJRD53Y3Eawj1cpbPcDgLtfXSTb75piT5aJhBwlYVLC0GhVhZl1qvhqGSY+aDQU/QYkhUHXFt/KqR3dtSMH1GudvAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFBJREFUKFNdT0kSACAIwnd71m/baGFZhyYhFgXzxBmFcD8ARMTmRQq+10u28nyiQ0npoKpw9232W38xlVPZqTKz7pBYdumIV0mSEezFFceGC34GKQfwUlcMAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFFJREFUKFNtT0EOACAI0m/rWb9ti6Jyq4MrIBCVfmo/lfC5iEhVLV4V8B0k3V0ioonogK90mMLMXGYfawh3DHKQPYF3B2In4iXNrEWwESu2hgOIACwH4GvOyAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADxJREFUKFOFTlsKACAI2+5/6GLWYJGg+CF7SgxD8asWIMC8CzPQBckwC7IiU+S+tQfOKpOPwKIkP0H36AZOTA4J8eyzugAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADhJREFUKFNjZCAAGIlWcJiB4b8tAwMjjIZpBJsAEkQ3CaQYJAa3AlkRTBJFAcwkZEkMBdgcTNAXALJPCgmBiBW0AAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACpJREFUKFNjZCAAGKmroJeB4X8xAwOKqXAOSBJmHbIiFNV4TcDlWIK+AADFugYJ3JGn6wAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGOmsIISB4f8aBgYUa+ngBgDt+AIJegq8GAAAAABJRU5ErkJggg==\"","/**\n * Represents a generic object with an x and y value.\n * @constructor\n * @param {number} x - The x component of the object.\n * @param {number} y - The y component of the object.\n */\nexport class Vector {\n   x: number;\n   y: number;\n\n   constructor(x: number, y: number) {\n      this.x = x;\n      this.y = y;\n   };\n\n   add(vec2: Vector): Vector {\n      return new Vector(\n         this.x + vec2.x,\n         this.y + vec2.y\n      );\n   };\n\n   dot(vec2: Vector): number {\n      return this.x * vec2.x + this.y * vec2.y;\n   }\n\n   lerp(targetVec: Vector, amount: number): Vector {\n      return new Vector(\n         lerp(this.x, targetVec.x, amount),\n         lerp(this.y, targetVec.y, amount)\n      );\n   };\n\n   distanceFrom(vec2: Vector): number {\n      const distance = Math.sqrt(Math.pow(this.x - vec2.x, 2) + Math.pow(this.y - vec2.y, 2));\n      return distance;\n   };\n\n   angleBetween(vec2: Vector): number {\n      const angle = Math.atan2(vec2.y - this.y, vec2.x - this.x);\n      return angle;\n   }\n\n   convertToPolar(vec2?: Vector): PolarVector {\n      const targetVector = vec2 || new Vector(0, 0);\n\n      const distance = this.distanceFrom(targetVector);\n      const angle = this.angleBetween(targetVector);\n      return new PolarVector(distance, angle);\n   }\n\n   randomOffset(radius: number): Vector {\n      const dist = randFloat(0, radius);\n      const ang = randFloat(0, 360);\n      const offset = new PolarVector(dist, ang);\n      return this.add(offset.convertToCartesian());\n   }\n\n   copy(): Vector {\n      return new Vector(this.x, this.y);\n   }\n}\n\nexport class PolarVector {\n   magnitude: number;\n   direction: number;\n\n   constructor(magnitude: number, direction: number) {\n      this.magnitude = magnitude;\n      this.direction = direction;\n   }\n\n   convertToCartesian(): Vector {\n      const x = Math.cos(this.direction) * this.magnitude;\n      const y = Math.sin(this.direction) * this.magnitude;\n      return new Vector(x, y);\n   }\n}\n\nexport function getElem(id: string): HTMLElement {\n   const elem = document.getElementById(id);\n   if (!elem) throw new Error(`ungaming: tried to find element with an id of '${id}' but could not find any.'`);\n   return elem;\n}\n\nexport function getSuffix(num: number): string {\n   return num === 1 ? \"\" : \"s\";\n}\n\n/**\n * Returns a random integer between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randInt(min: number, max: number): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.floor(Math.random() * (max - min)) + min;\n}\n\n/**\n * Returns a random float between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randFloat(min: number, max: number): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.random() * (max - min) + min;\n}\n\nexport function randItem(arr: Array<unknown>): unknown {\n   const randIndex = randInt(0, arr.length);\n   return arr[randIndex];\n}\n\nexport function lerp(start: number, target: number, amount: number): number {\n   return (1 - amount) * start + amount * target;\n}\n\nexport function randomGaussianBell(): number {\n   // Box Muller method from https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n   let u = 0, v = 0;\n   while(u === 0) u = Math.random(); //Converting [0,1) to (0,1)\n   while(v === 0) v = Math.random();\n   let num = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );\n   num = num / 10.0 + 0.5; // Translate to 0 -> 1\n   if (num > 1 || num < 0) return randomGaussianBell() // resample between 0 and 1\n   return num;\n }\n\nexport function createHoverBox(text: string, position: Vector, parent: HTMLElement): HTMLElement {\n   const hoverBox = document.createElement(\"div\");\n   hoverBox.className = \"hover-box\";\n   hoverBox.style.left = position.x + \"px\";\n   hoverBox.style.top = position.y + \"px\";\n   hoverBox.innerHTML = text;\n   parent.appendChild(hoverBox);\n\n   return hoverBox;\n}\n\nexport function roundNum(num: number, dpp: number): number {\n   const power = Math.pow(10, dpp)\n   return Math.round((num + Number.EPSILON) * power) / power;\n}\n\nexport function drawRay(start: Vector, end: Vector) {\n   const dist = start.distanceFrom(end);\n   const ang = start.angleBetween(end);\n\n   const ray = document.createElement(\"div\");\n   getElem(\"board\").appendChild(ray);\n   ray.className = \"ray\";\n   ray.style.transform = `rotate(${ang}rad)`;\n   ray.style.width = dist + \"px\";\n   ray.style.left = start.x + \"px\";\n   ray.style.top = start.y + \"px\";\n}\n\nexport function standardDeviation(data: ReadonlyArray<number>): number {\n   const n = data.length;\n   const mean = data.reduce((a, b) => a + b) / n;\n   const sqrDeviations = data.map(val => Math.pow(val - mean, 2));\n   const variance = sqrDeviations.reduce((a, b) => a + b) / n;\n   return Math.sqrt(variance);\n}\n\nexport class Colour {\n   private _hex!: string;\n   public get hex(): string {\n      return \"#\" + this._hex;\n   }\n\n   private _rgb: [number, number, number];\n   public get rgb(): string {\n      const [ r, g, b ] = this._rgb;\n      return `rgb(${r}, ${g}, ${b})`;\n   }\n\n   private hexDigits = \"0123456789abcdef\".split(\"\");\n\n   constructor(colour: string | [number, number, number] ) {\n      if (typeof colour === \"string\") {\n         this._hex = colour.toLowerCase();\n         if (this._hex.length === 7) {\n            this._hex = this._hex.substring(1, 7);\n         }\n   \n         this._rgb = this.getRGB();\n      } else {\n         this._rgb = colour;\n\n         this._hex = this.getHex();\n      }\n   }\n\n   private getRGB(): [number, number, number] {\n      const rgb: [number, number, number] = [0, 0, 0];\n      for (let i = 0; i < 3; i++) {\n         const digit1 = this.hexDigits.indexOf(this._hex[i * 2]);\n         const digit2 = this.hexDigits.indexOf(this._hex[i * 2 + 1]);\n         rgb[i] = digit1 * 16 + digit2;\n      }\n      return rgb;\n   }\n   private getHex(): string {\n      let hex = \"\";\n      for (let i = 0; i < 3; i++) {\n         const col = this._rgb[i];\n         const digit2 = col % 16;\n         const digit1 = (col-digit2) / 16;\n         hex += this.hexDigits[digit1] + this.hexDigits[digit2];\n      }\n      return hex;\n   }\n\n   darken(amount: number): Colour {\n      // 1 = fully darkened, 0.5 = half darkened\n      // Rounds down\n      const rgb = this._rgb.map(colour => Math.round(colour * (1 - amount))) as [number, number, number];\n      return new Colour(rgb);\n   }\n\n   // https://stackoverflow.com/questions/13348129/using-native-javascript-to-desaturate-a-colour/13355255\n   desaturate(amount: number): Colour {\n      const col = this._rgb.slice();\n      const gray = col[0] * 0.3086 + col[1] * 0.6094 + col[2] * 0.0820;\n\n      col[0] = Math.round(lerp(col[0], gray, amount));\n      col[1] = Math.round(lerp(col[1], gray, amount));\n      col[2] = Math.round(lerp(col[2], gray, amount));\n\n      return new Colour([col[0], col[1], col[2]]);\n   }\n}","import Entity from \"./classes/Entity\";\nimport Game from \"./Game\";\nimport { getElem } from \"./utils\";\n\nexport type Cell = Array<Entity>;\nexport const cells: Array<Cell> = [];\n\nconst cellRows: Array<HTMLElement> = new Array<HTMLElement>();\n\nconst createCell = (): HTMLElement => {\n   const cellObj = document.createElement(\"div\");\n   cellObj.className = \"cell\";\n   return cellObj;\n}\nconst createCellRow = (): HTMLElement => {\n   const cellRow = document.createElement(\"div\");\n   cellRow.style.height = `${Game.cellSize}px`;\n   cellRow.className = \"cell-row\";\n   return cellRow;\n}\n\nexport function redrawBoard(): void {\n   const previousWidth = cellRows[0].children.length;\n   const previousHeight = cellRows.length;\n\n   const width = Game.boardSize.width, height = Game.boardSize.height;\n\n   // Resize the board\n   const board = getElem(\"board\");\n   const boardWidth = width * Game.cellSize;\n   board.style.width = `${boardWidth}px`;\n   const boardHeight = height * Game.cellSize;\n   board.style.height = `${boardHeight}px`;\n\n   if (previousWidth !== width) {\n      if (width > previousWidth) {\n         // Create more cells in each row\n\n         const newCellAmount = width - previousWidth;\n         for (let i = 0; i < newCellAmount; i++) {\n            cellRows.forEach((row, j) => {\n               const cellIndex = (previousWidth + i) * (j + 1) + j;\n               \n               const cellObj = createCell();\n               row.appendChild(cellObj);\n               if ((previousWidth + i + j) % 2 === 0) {\n                  cellObj.classList.add(\"cell-1\");\n               } else {\n                  cellObj.classList.add(\"cell-2\");\n               }\n               \n               const cell: Cell = new Array<Entity>();\n               cells.splice(cellIndex, 0, cell);\n            });\n         }\n      } else {\n         // Remove cells from each row\n\n         const cellRemoveAmount = previousWidth - width;\n         for (let i = 0; i < cellRemoveAmount; i++) {\n            for (let j = 0; j < previousWidth; j++) {\n               const cellIndex = (previousWidth - i - 1) * (j + 1);\n               const cell = cells[cellIndex];\n               for (const entity of cell) {\n                  entity.die();\n               }\n               cells.splice(cellIndex, 1);\n   \n               const cellObj = cellRows[j].children[previousWidth - i - 1];\n               cellObj.remove();\n            }\n         }\n      }\n   }\n\n   if (previousHeight !== height) {\n      if (height > previousHeight) {\n         // Create rows\n\n         const newCellAmount = height - previousHeight;\n         for (let i = 0; i < newCellAmount; i++) {\n            const row = createCellRow();\n            board.appendChild(row);\n            cellRows.push(row);\n\n            for (let j = 0; j < width; j++) {\n               const cellIndex = width * (height + i - 1) + j;\n\n               const cellObj = createCell();\n               row.appendChild(cellObj);\n               if ((previousHeight + i + j) % 2 === 0) {\n                  cellObj.classList.add(\"cell-1\");\n               } else {\n                  cellObj.classList.add(\"cell-2\");\n               }\n\n               const cell: Cell = new Array<Entity>();\n               cells.splice(cellIndex, 0, cell);\n            }\n         }\n      } else {\n         // Remove rows\n\n         const removeCount = previousHeight - height;\n         for (let i = 0; i < removeCount; i++) {\n            const rowElem = cellRows[previousHeight - i - 1];\n            rowElem.remove();\n            cellRows.splice(previousHeight - i - 1, 1);\n\n            const startIndex = width * (previousHeight - i - 1) - 1;\n            for (let j = 0; j < width; j++) {\n               const cell = cells[startIndex + j];\n               for (const entity of cell) {\n                  entity.die();\n               }\n            }\n\n            cells.splice(startIndex, width);\n         }\n      }\n   }\n}\n\nconst createBoard = (): void => {\n   const board = getElem(\"board\");\n   board.classList.remove(\"hidden\");\n\n   board.style.setProperty(\"--cell-size\", `${Game.cellSize}px`);\n   board.style.setProperty(\"--cell-border-size\", `${Game.cellBorderSize}px`);\n\n   const boardWidth = Game.boardSize.width * Game.cellSize;\n   board.style.width = `${boardWidth}px`;\n   const boardHeight = Game.boardSize.height * Game.cellSize;\n   board.style.height = `${boardHeight}px`;\n\n   for (let i = 0; i < Game.boardSize.height; i++) {\n      const cellRow = createCellRow();\n      board.appendChild(cellRow);\n      cellRows.push(cellRow);\n\n      for (let j = 0; j < Game.boardSize.width; j++) {\n         const cellObj = createCell();\n         cellRow.appendChild(cellObj);\n\n         // Colour the cells in a checkerboard pattern\n         if ((i + j) % 2 === 0) {\n            cellObj.classList.add(\"cell-1\");\n         } else {\n            cellObj.classList.add(\"cell-2\");\n         }\n   \n         const cell: Cell = new Array<Entity>();\n         cells.push(cell);\n      }\n   }\n}\n\nconst hideTitleScreen = () => {\n   getElem(\"title-options-container\").classList.add(\"hidden\");\n}\n\nexport function StartGame(): void {\n   createBoard();\n   \n   Game.start();\n\n   hideTitleScreen();\n}","import Game from \"../Game\";\nimport { Cell, cells } from \"../main\";\nimport { getElem, randFloat, Vector } from \"../utils\";\n\nexport interface EntityAttributes {\n   [key: string]: number | string | Vector | undefined;\n   lifespan: number;\n   readonly size: number;\n}\n\nabstract class Entity {\n   [key: string]: any;\n\n   cellNumber: number;\n   position: Vector;\n   velocity: Vector;\n\n   age: number;\n   lifespan!: number;\n\n   element: HTMLElement;\n\n   constructor(position: Vector, attributes: EntityAttributes) {\n      this.position = position;\n      // By default all entities has no velocity.\n      this.velocity = new Vector(0, 0);\n      \n      this.age = 0;\n\n      // Set all attributes\n      for (const attribute of Object.entries(attributes)) {\n         this[attribute[0]] = attribute[1];\n      }\n\n      this.element = this.instantiate();\n      this.createEntity();\n\n      this.updatePosition();\n\n      // Add the entity to the cells array\n      this.cellNumber = this.calculateCell();\n   };\n\n   // Used in derived classes to create the actual visual thing\n   abstract instantiate(): HTMLElement;\n\n   static count(entityType: any): number {\n      let count = 0;\n      for (const cell of cells) {\n         for (const entity of cell) {\n            if (entityType.prototype.isPrototypeOf(entity)) count++;\n         }\n      }\n      return count;\n   }\n\n   createEntity(): HTMLElement {\n      getElem(\"board\").appendChild(this.element);\n\n      let width: number, height: number;\n\n      if (typeof this.size === \"number\") {\n         // Number\n         width = this.size;\n         height = this.size;\n      } else {\n         // Vector\n         width = this.size.x;\n         height = this.size.y;\n      }\n\n      this.element.style.width = width + \"px\";\n      this.element.style.height = height + \"px\";\n\n      return this.element;\n   };\n\n   tick(): void {\n      if (this.age++ >= this.lifespan) {\n         this.die();\n         return;\n      }\n\n      // Move\n      this.position = this.position.add(this.velocity);\n\n      this.calculateCell();\n      this.updatePosition();\n   };\n   updatePosition(): void {\n      this.element.style.left = `${this.position.x}px`;\n      this.element.style.top = `${this.position.y}px`;\n   };\n   die(): void {\n      this.element.remove();\n\n      // Remove all instances of this entity from the cells object\n      for (const cell of cells) {\n         const index = cell.indexOf(this);\n         if (index !== -1) {\n            cell.splice(index, 1);\n         }\n      }\n   };\n\n   /**\n    * Calculate which cell the entity is currently in.\n    */\n   calculateCell(): number {\n      const cellX = Math.floor(this.position.x / Game.cellSize);\n      const cellY = Math.floor(this.position.y / Game.cellSize);\n\n      const minCellNumber = 0;\n      const maxCellNumber = Game.boardSize.width * Game.boardSize.height - 1;\n\n      let cellNumber = cellY * Game.boardSize.width + cellX;\n      // Clamp the cell number at the minimum and maximum values.\n      cellNumber = Math.min(Math.max(cellNumber, minCellNumber), maxCellNumber);\n\n      this.cellNumber = cellNumber;\n\n      // Remove any previous instances of the entity from the cells object\n      for (let i = 0; i < cells.length; i++) {\n         const cell = cells[i];\n\n         if (cell.includes(this)) {\n            const cellIndex = cell.indexOf(this);\n            cell.splice(cellIndex, 1);\n         }\n      }\n\n      if (cells[cellNumber] === undefined) {\n         console.log(cells);\n         console.log(cellNumber);\n      }\n      cells[cellNumber].push(this);\n\n      return cellNumber;\n   };\n\n   /**\n    * Get cells near to the entity\n    * @param {number} searchRadius - The radius of cells for which to search\n    */\n   getSurroundingCells(searchRadius: number): ReadonlyArray<Cell> {\n      let surroundingCells = new Array<Cell>();\n\n      // The number of cells in one row of the world\n      const offset = Game.boardSize.width;\n      // Get the cell offset number for all surrounding cells in a square of width searchRadius * 2 + 1\n      // e.g.\n      //     X X X\n      //     X X X\n      //     X X X\n      // Where X signifies a cell to check, and the centermost X Is the location of the creature.\n      for (let i = 0; i < searchRadius * 2 + 1; i++) {\n         for (let j = 0; j < searchRadius * 2 + 1; j++) {\n            const cellYOffset = (i - searchRadius) * offset;\n            const cellXOffset = j - searchRadius;\n            const cellOffset = cellYOffset + cellXOffset;\n\n            const cellNumber = cellOffset + this.cellNumber;\n\n            // Filter out cell numbers which are out of bounds\n            const horizontalDistanceToCell = Math.abs((this.cellNumber % Game.boardSize.width) - (cellNumber % Game.boardSize.width));\n            if (horizontalDistanceToCell > 1) continue;\n\n            const maxCellNumber = Game.boardSize.width * Game.boardSize.height - 1;\n            if (cellNumber < 0 || cellNumber > maxCellNumber) continue;\n\n            surroundingCells.push(cells[cellNumber]);\n         }\n      }\n\n      return surroundingCells;\n   }\n\n   getEntitiesInCells(cells: ReadonlyArray<Cell>): ReadonlyArray<Entity> {\n      let entities = new Array<Entity>();\n      for (const cell of cells) {\n         const newEntities = cell.filter(entity => !(entity === this));\n         entities = entities.concat(newEntities);\n      }\n      return entities;\n   };\n\n   static randomPositionInCell(cellNumber: number) {\n      const cellX = cellNumber % Game.boardSize.width;\n      const cellY = Math.floor(cellNumber / Game.boardSize.width);\n\n      const x = randFloat(0, Game.cellSize);\n      const y = randFloat(0, Game.cellSize);\n\n      return new Vector(cellX * Game.cellSize + x, cellY * Game.cellSize + y);\n   }\n\n   isCollidingWithEntity(entity: Entity): boolean {\n      const distance = this.position.distanceFrom(entity.position);\n\n      if (typeof this.size === \"number\") {\n         return distance - this.size/2 <= 0;\n      } else {\n         // TODO: Inaccurate for entites with a different width and height, problem for future self\n         if (typeof entity.size === \"number\") {\n            return distance - this.size.x/2 - entity.size/2 <= 0;\n         } else {\n            return distance - this.size.x/2 - entity.size.x/2 <= 0;\n         }\n      }\n   }\n}\n\nexport default Entity;","import Game from \"../Game\";\nimport { randItem } from \"../utils\";\nimport Entity, { EntityAttributes } from \"./Entity\";\n\nexport function createFruit(cellNumber: number): void {\n   const attributes: EntityAttributes = {\n      lifespan: 10 * Game.tps,\n      size: 8\n   };\n\n   const position = Entity.randomPositionInCell(cellNumber);\n\n   new Fruit(position, attributes);\n}\n\nclass Fruit extends Entity {\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"fruit\";\n\n      const FRUIT_COLOURS: ReadonlyArray<string> = [\"red\", \"green\", \"pink\"];\n\n      const colour = randItem(FRUIT_COLOURS as unknown[]) as string;\n      element.style.backgroundColor = colour;\n\n      return element;\n   }\n}\n\nexport default Fruit;","import Creature from './classes/Creature';\r\n\r\nexport let inspectorIsOpen: boolean = false;\r\nexport let inspectorCreature: Creature | null = null;\r\n\r\nexport let updateInspector: Function;\r\nexport function setUpdateFunction(func: (creature: Creature | null) => void): void {\r\n    updateInspector = func;\r\n}\r\n\r\nexport let rerenderInspector: Function;\r\nexport function setInspectorRerenderFunction(func: () => void): void {\r\n    rerenderInspector = func;\r\n}\r\n\r\nexport function openInspector(creature: Creature): void {\r\n    inspectorIsOpen = true;\r\n    inspectorCreature = creature;\r\n    updateInspector(creature);\r\n}\r\n\r\nexport function closeInspector(): void {\r\n    inspectorIsOpen = false;\r\n    inspectorCreature = null;\r\n    updateInspector(null);\r\n}","import { getElem, Vector} from './utils';\r\n\r\nexport const gameImages: Array<GameImage> = new Array<GameImage>();\r\n\r\nclass GameImage {\r\n    name: string;\r\n    position: Vector;\r\n\r\n    element!: HTMLElement;\r\n    width: number;\r\n    height: number;\r\n\r\n    numFrames: number;\r\n    frame: number = 0;\r\n    ticksPerFrame: number;\r\n\r\n    constructor(name: string, numFrames: number, ticksPerFrame: number, width: number, height: number, position: Vector) {\r\n        this.name = name;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.numFrames = numFrames;\r\n        this.ticksPerFrame = ticksPerFrame;\r\n        this.position = position;\r\n\r\n        this.init();\r\n        this.updateBackgroundImage();\r\n\r\n        gameImages.push(this);\r\n    }\r\n    init(): void {\r\n        this.element = document.createElement(\"div\");\r\n        this.element.className = \"game-image\";\r\n        this.element.style.width = this.width + \"px\";\r\n        this.element.style.height = this.height + \"px\";\r\n        getElem(\"board\").appendChild(this.element);\r\n\r\n        this.element.style.backgroundSize = `${this.width}px ${this.height}px`;\r\n        this.element.style.top = this.position.y + \"px\";\r\n        this.element.style.left = this.position.x + \"px\";\r\n    }\r\n\r\n    updateBackgroundImage() {\r\n        const frame = Math.floor(this.frame);\r\n        const src = require(`./images/${this.name}/${this.name}-${frame}.png`).default;\r\n        this.element.style.backgroundImage = `url(${src})`;\r\n    }\r\n\r\n    tick(): void {\r\n        this.frame += 1 / this.ticksPerFrame;\r\n        if (this.frame >= this.numFrames) {\r\n            this.die();\r\n            return;\r\n        }\r\n        this.updateBackgroundImage();\r\n    }\r\n\r\n    die(): void {\r\n        this.element.remove();\r\n\r\n        gameImages.splice(gameImages.indexOf(this), 1);\r\n    }\r\n}\r\n\r\nexport default GameImage;","import Game from \"../Game\";\r\nimport GameImage from \"../GameImage\";\r\nimport { Vector } from \"../utils\";\r\nimport Creature, { CreatureAttributes } from \"./Creature\";\r\nimport Entity, { EntityAttributes } from \"./Entity\";\r\n\r\nclass Egg extends Entity {\r\n   generation: number;\r\n\r\n   constructor(position: Vector, attributes: EntityAttributes, creatureAttributes: CreatureAttributes, generation: number) {\r\n      super(position, attributes);\r\n\r\n      this.generation = generation;\r\n      this.creatureAttributes = creatureAttributes;\r\n   }\r\n\r\n   instantiate(): HTMLElement {\r\n      const ticksPerFrame = Math.floor(this.lifespan / 5);\r\n      const element = new GameImage(\"egg\", 5, ticksPerFrame, this.size, this.size, this.position).element;\r\n\r\n      return element;\r\n   }\r\n\r\n   tick(): void {\r\n      super.tick();\r\n\r\n      const shakeAmount = Math.sin(Game.ticks * Game.tps) * 1.25;\r\n      this.element.style.transform = `translate(-50%, -50%) rotate(${shakeAmount}deg)`;\r\n   }\r\n\r\n   die(): void {\r\n      super.die();\r\n\r\n      const creature = new Creature(this.position.copy(), this.creatureAttributes);\r\n      creature.stats.generation = this.generation;   \r\n   }\r\n}\r\n\r\nexport default Egg;","import Game from \"../Game\";\nimport { Cell, cells } from \"../main\";\nimport { drawRay, PolarVector, randFloat, randInt, randItem, Vector } from \"../utils\";\nimport Entity, { EntityAttributes } from \"./Entity\";\nimport Fruit from \"./Fruit\";\nimport Egg from './Egg';\nimport GameImage from \"../GameImage\";\nimport { closeInspector, inspectorCreature } from \"../creature-inspector\";\n\nexport interface CreatureAttributes extends EntityAttributes {\n   name: string;\n   speed: number;\n   vision: number;\n   reproductiveRate: number;\n}\n\ninterface GeneInfo {\n   display: string;\n   colour: string;\n   min: number;\n   max: number;\n   /*** How strongly an attribute is factored into deciding a creature's lifespan  */\n   weight: number;\n   positivelyAffectsLifespan?: boolean;\n}\n\nexport const creatureGeneInfo: { [key: string]: GeneInfo } = {\n   speed: {\n      display: \"speed\",\n      colour: \"#eeff00\",\n      min: 3,\n      max: 10,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // Size of the creature in px\n   size: {\n      display: \"size\",\n      colour: \"#ff8f00\",\n      min: 10,\n      max: 30,\n      weight: 1,\n      positivelyAffectsLifespan: true\n   },\n   // Vision of the creature in px\n   vision: {\n      display: \"vision\",\n      colour: \"#5400ff\",\n      min: 25,\n      max: 75,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // How quickly the creature gains reproductive urge\n   reproductiveRate: {\n      display: \"reproductive rate\",\n      colour: \"#ff00e0\",\n      min: 0.5,\n      max: 2,\n      weight: 1\n   }\n};\n\nconst calculateLifespan = (attributes: CreatureAttributes): number => {\n   // Base number of seconds that a creature will live.\n   const BASE_LIFESPAN: number = 10;\n\n   let lifespan: number = BASE_LIFESPAN * Game.tps;\n\n   for (const attributeInfo of Object.entries(creatureGeneInfo)) {\n      if (!attributeInfo[1].positivelyAffectsLifespan) continue;\n\n      const attributeVal = attributes[attributeInfo[0]] as number;\n\n      if (attributeInfo[1].positivelyAffectsLifespan) {\n         lifespan *= Math.pow(attributeVal / ((attributeInfo[1].min + attributeInfo[1].max) / 2), attributeInfo[1].weight);\n      } else {\n         lifespan *= Math.pow(((attributeInfo[1].min + attributeInfo[1].max) / 2) / attributeVal, attributeInfo[1].weight);\n      }\n   }\n\n   return lifespan;\n}\n\n// Generate a random gene in a specified range.\nconst generateGene = (attributeName: keyof CreatureAttributes): number => {\n   const attribute: GeneInfo = creatureGeneInfo[attributeName];\n   return randFloat(attribute.min, attribute.max);\n}\n\nconst getRandomName = (): string => {\n   const firstNames = [\"Glorb\", \"James\", \"Obama\", \"Gnark\"];\n   const adjectives = [\"Feeble\", \"Crippled\", \"Schizophrenic\"];\n   const nouns = [\"Amoeba\"];\n\n   let chosenAdjectives = [];\n   let potentialAdjectives = adjectives.slice();\n   while (true) {\n      if (potentialAdjectives.length === 0) break;\n      if (Math.random() <= 0.4) {\n         const idx = randInt(0, potentialAdjectives.length);\n         chosenAdjectives.push(potentialAdjectives[idx]);\n         potentialAdjectives.splice(idx, 1);\n      }\n      else break;\n   }\n   const adjectiveList = chosenAdjectives.reduce((previousValue, currentValue, i) => {\n      let newVal = previousValue;\n      if (i > 0 && chosenAdjectives.length - i > 1) newVal += \", \";\n      else if (chosenAdjectives.length > 1 && chosenAdjectives.length - i === 1) newVal += \" and \";\n      return newVal + currentValue;\n   }, \"\");\n\n   const hasNoun = Math.random() <= 0.3;\n\n   let name = randItem(firstNames);\n   if (hasNoun && chosenAdjectives.length > 0) {\n      name += \" the \" + adjectiveList + \" \" + randItem(nouns);\n   } else if (chosenAdjectives.length > 0) {\n      name += \" the \" + adjectiveList;\n   } else if (hasNoun) {\n      name += \" the \" + randItem(nouns);\n   }\n\n   return name as string;\n}\n\nexport function createCreature(): void {\n   const attributes: CreatureAttributes = {\n      name: getRandomName(),\n      size: generateGene(\"size\"),\n      speed: generateGene(\"speed\"),\n      vision: generateGene(\"vision\"),\n      reproductiveRate: generateGene(\"reproductiveRate\"),\n      lifespan: 0\n   };\n   attributes.lifespan = calculateLifespan(attributes);\n\n   // Get a random position for the creature\n   const x = randFloat(0, Game.boardSize.width * Game.cellSize);\n   const y = randFloat(0, Game.boardSize.height * Game.cellSize);\n   const position = new Vector(x, y);\n\n   new Creature(position, attributes);\n}\n\nconst REPRODUCTION_TIME = 2000;\nconst INCUBATION_TIME = 5000;\nconst ABSTINENCE_TIME = 4000;\n\ninterface CreatureStats {\n   fruitEaten: number;\n   generation: number;\n}\n\nclass Creature extends Entity {\n   speed: number;\n   moveSpeed: number;\n   vision: number;\n   reproductiveRate: number;\n\n   birthTime: number;\n\n   isMoving: boolean;\n   targetPosition: Vector | null = null;\n   reproductiveUrge: number = 0;\n   partner: Creature | null = null;\n   reproductionStage: number = 0;\n   lastReproductionTime: number = -REPRODUCTION_TIME - INCUBATION_TIME - ABSTINENCE_TIME;\n\n   stats: CreatureStats = {\n      fruitEaten: 0,\n      generation: 1\n   }\n\n   constructor(position: Vector, attributes: CreatureAttributes) {\n      super(position, attributes);\n\n      this.speed = attributes.speed;\n      this.vision = attributes.vision;\n      this.reproductiveRate = attributes.reproductiveRate;\n\n      this.isMoving = false;\n      this.birthTime = Game.ticks;\n\n      this.moveSpeed = this.calculateMoveSpeed();\n   }\n\n   calculateMoveSpeed(): number {\n      const SPEED_REDUCTION_MULTIPLIER = 1.1;\n      const MAX_REDUCTION = 3;\n      const reduction = creatureGeneInfo.size.max / creatureGeneInfo.size.min / MAX_REDUCTION;\n      return this.speed /  Math.pow(this.size / creatureGeneInfo.size.min / reduction, SPEED_REDUCTION_MULTIPLIER);\n   }\n\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"creature\";\n\n      element.innerHTML = `\n      <div class=\"shadow\"></div>\n\n      <div class=\"life\">\n         <div class=\"life-bar\"></div>\n\n         </div>\n      <div class=\"reproduction\">\n         <div class=\"reproduction-bar\"></div>\n      </div>\n      `;\n      \n      element.style.setProperty(\"--vision-size\", `${this.vision}px`);\n      element.style.setProperty(\"--creature-size\", `${this.size}px`);\n\n      return element;\n   };\n\n   get life(): number {\n      return (this.lifespan - this.age) / this.lifespan * 100;\n   }\n\n   updateLifebar(): void {\n      const lifebar = this.element.querySelector(\".life-bar\") as HTMLElement;\n      \n      lifebar.style.width = `${this.life}%`;\n      // Colour the lifebar a shade of red corresponding to how much life the creature has left\n      const color = 155 + this.life;\n      lifebar.style.backgroundColor = `rgb(${color}, 0, 0)`;\n   };\n\n   updateReproductionBar(): void {\n      const reproductionBar = this.element.querySelector(\".reproduction-bar\") as HTMLElement;\n      \n      reproductionBar.style.width = `${this.reproductiveUrge}%`;\n   };\n\n   get wantsToReproduce(): boolean {\n      return this.reproductiveUrge > this.life && this.reproductionStage < 2;\n   }\n\n   tick(): void {\n      super.tick();\n\n      // Base amount of reproductive urge gained per second\n      if (this.reproductionStage === 0 && (Game.ticks - this.lastReproductionTime) * 1000 / Game.tps > REPRODUCTION_TIME + INCUBATION_TIME + ABSTINENCE_TIME) {\n         this.element.classList.remove(\"abstaining\");\n         const BASE_REPRODUCTIVE_RATE = 3;\n         this.reproductiveUrge += BASE_REPRODUCTIVE_RATE * this.reproductiveRate / Game.tps;\n         this.reproductiveUrge = Math.min(100, this.reproductiveUrge);\n      } else if (this.reproductionStage >= 2) {\n         // Stop aging if the creature is reproducing\n         this.age -= 1;\n      }\n\n      this.updateLifebar();\n      this.updateReproductionBar();\n\n      // If the creature has a target position, move to it\n      if (this.targetPosition !== null) {\n         if (this.hasReachedTargetPosition()) {\n            // If it has reached its target, stop moving\n            this.reachTargetPosition();\n         } else {\n            // Otherwise continue moving\n            this.moveToTargetPosition();\n         }\n      }\n\n      switch (this.reproductionStage) {\n         case 1: {\n            /*** Average amount of particles which spawn each second */\n            const particleAmount = 3;\n            if (Math.random() <= particleAmount / Game.tps) {\n               const imagePos = this.position.randomOffset(30);\n               new GameImage(\"heart\", 4, 2, 16, 16, imagePos);\n            }\n            break;\n         }\n         case 2: {\n            if (Math.random() <= 3 / Game.tps) {\n               const particleAttempts = randInt(4, 11);\n               const chance = 0.7;\n               for (let i = 0; i < particleAttempts; i++) {\n                  if (Math.random() <= chance) {\n                     const imagePos = this.position.randomOffset(40);\n                     const size = randInt(12, 24);\n                     new GameImage(\"heart\", 4, 3, size, size, imagePos);\n                  }\n               }\n            }\n            if (Math.random() < 6 / Game.tps) {\n               const imagePos = this.position.randomOffset(20);\n               const size = randInt(12, 18);\n               new GameImage(\"heart\", 4, 3, size, size, imagePos);\n            }\n            break;\n         }\n      }\n\n      const visionInCells = Math.floor(((this.size as number)/2 + this.vision) / Game.cellSize) + 1;\n      const surroundingCells = super.getSurroundingCells(visionInCells);\n\n      let surroundingEntities = super.getEntitiesInCells(surroundingCells);\n\n      // Filter out entites which the creature cannot see\n      const entitiesInVision = this.getEntitiesInVision(surroundingEntities);\n\n      // Search through all nearby entities for any that are of use\n      let closestFruit: Fruit | null = null;\n      let distanceToNearestFruit = Number.MAX_SAFE_INTEGER;\n      let closestPartner: Creature | null = null;\n      let distanceToClosestPartner = Number.MAX_SAFE_INTEGER;\n      for (const entity of entitiesInVision) {\n         const entityIsCreature: boolean = entity instanceof Creature;\n         const entityIsFruit: boolean = entity instanceof Fruit;\n\n         if (entityIsCreature && this.wantsToReproduce && entity.wantsToReproduce && (entity.partner === null || entity.partner === this)) {\n            // If it wants to, look for any available partners\n            const distanceToCreature = this.position.distanceFrom(entity.position);\n            if (distanceToCreature < distanceToClosestPartner) {\n               closestPartner = entity as Creature;\n               distanceToClosestPartner = distanceToCreature;\n            }\n         }\n         else if (entityIsFruit) {\n            const distanceToFruit = this.position.distanceFrom(entity.position);\n            if (distanceToFruit < distanceToNearestFruit) {\n               closestFruit = entity;\n               distanceToNearestFruit = distanceToFruit;\n            }\n         }\n\n         if (super.isCollidingWithEntity(entity)) {\n            if (entity === this.partner && this.wantsToReproduce) {\n               this.handleReproduction();\n            } else if (entityIsFruit) {\n               this.eatFruit(entity);\n            }\n         }\n      }\n\n      // If there are any available partners, move to them\n      if (closestPartner !== null && this.reproductionStage < 2) {\n         this.targetPosition = closestPartner.position;\n         this.partner = closestPartner;\n         this.reproductionStage = 1;\n         return;\n      } else if (this.reproductionStage === 1) {\n         this.reproductionStage = 0;\n      } else if (this.reproductionStage >= 2) return;\n\n      // Otherwise if there is a nearby fruit, go to it\n      if (closestFruit !== null) {\n         this.targetPosition = closestFruit.position;\n         return;\n      }\n\n      // Otherwise, try to move to a random surrounding position\n      if (!this.isMoving) {\n         // Chance for the creature to move each second\n         const MOVE_CHANCE = 0.95;\n         if (Math.random() < MOVE_CHANCE / Game.tps) {\n            this.targetPosition = this.findRandomPosition(surroundingCells);\n         }\n      }\n   };\n\n   eatFruit(fruit: Fruit): void {\n      this.stats.fruitEaten++;\n\n      // Number of seconds of life it gives\n      const FEED_AMOUNT = 10;\n      this.age -= FEED_AMOUNT * Game.tps;\n      // Stop the creature's age from going below 0\n      this.age = Math.max(this.age, 0);\n\n      fruit.die();\n   };\n\n   getEntitiesInVision(entitiesToCheck: ReadonlyArray<Entity>): ReadonlyArray<Entity> {\n      return entitiesToCheck.filter(entity => this.canSeeEntity(entity));\n   };\n\n   canSeeEntity(entity: Entity): boolean {\n      return this.position.distanceFrom(entity.position) <= this.vision + (this.size as number)/2;\n   };\n\n   findRandomPosition(surroundingCells: ReadonlyArray<Cell>): Vector {\n      // Pick a random surrounding cell\n      const targetCell: Cell = randItem(surroundingCells as Array<unknown>) as Cell;\n\n      const cellNumber = cells.indexOf(targetCell);\n\n      return Entity.randomPositionInCell(cellNumber);\n   };\n\n   moveToTargetPosition(): void {\n      this.isMoving = true;\n\n      // Convert from cartesian to polar coordinates\n      const angleToTarget = this.position.angleBetween(this.targetPosition!);\n      const nextPosition = new PolarVector(this.moveSpeed, angleToTarget);\n\n      if (this === inspectorCreature) {\n         drawRay(this.position, this.targetPosition as Vector);\n      }\n\n      this.velocity = nextPosition.convertToCartesian();\n   };\n\n   hasReachedTargetPosition(): boolean {\n      // Use black magic to figure out if the creature is facing towards the target position\n\n      const relativeTargetVec = new Vector(this.position.x - this.targetPosition!.x, this.position.y - this.targetPosition!.y);\n\n      const dotProduct = this.velocity.dot(relativeTargetVec);\n      return dotProduct > 0;\n   };\n\n    reachTargetPosition(): void {\n      this.isMoving = false;\n\n      this.velocity = new Vector(0, 0);\n\n      this.targetPosition = null;\n   };\n\n   handleReproduction(): void {\n      this.reproduce()\n      .then(() => this.layEgg());\n   };\n\n   reproduce(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 2;\n         this.targetPosition = null;\n         this.velocity = new Vector(0, 0);\n         this.isMoving = false;\n         this.reproductiveUrge = 0;\n         this.element.classList.add(\"abstaining\");\n         this.lastReproductionTime = Game.ticks;\n         \n         setTimeout(() => {\n            resolve();\n         }, REPRODUCTION_TIME);\n      });\n   }\n\n   layEgg(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 0;\n         // Ensure that only 1 egg is created\n         if ((this.partner as Creature).reproductionStage !== 0) {\n\n            const childAttributes = this.generateChildGenes(this.partner as Creature);\n   \n            const eggAttributes = {\n               size: 20,\n               lifespan: INCUBATION_TIME / 1000 * Game.tps\n            };\n            const eggPos = this.position.randomOffset(10);\n            new Egg(eggPos, eggAttributes, childAttributes, this.stats.generation + 1);\n         }\n\n         this.partner = null;\n\n         setTimeout(() => {\n            resolve();\n         }, INCUBATION_TIME);\n      });\n   }\n\n   generateChildGenes(partner: Creature): CreatureAttributes {\n      let attributes: { [key: string]: number | string } = {\n         name: getRandomName()\n      };\n\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         // Pick a random allele\n         let gene = Math.random() <= 0.5 ? this[geneName] : partner[geneName];\n         attributes[geneName] = gene;\n\n         // Chance to mutate the gene\n         if (Math.random() <= 0.3) {\n            gene = this.mutateGene(geneName, gene);\n         }\n      }\n\n      attributes.lifespan = calculateLifespan(attributes as CreatureAttributes);\n\n      return attributes as CreatureAttributes;\n   }\n\n   mutateGene(name: string, initialGeneVal: number): number {\n      const gene = creatureGeneInfo[name];\n\n      // const minMutateAmount = (gene.min + gene.max) / 150;\n\n      // min mutate amount * math.random() (maybe go higher )\n      let mutateAmount = (gene.min + gene.max) / 300;\n\n      mutateAmount *= randFloat(0.1, 1) * Game.settings.creatureMutationRate;\n      \n      // let mutateAmount = minMutateAmount;\n      // if (dir === 1) {\n      //    const lerpAmount = randFloat(0.01, 0.05);\n      //    mutateAmount += lerp(initialGeneVal, gene.max, lerpAmount) - initialGeneVal;\n      // } else {\n      //    mutateAmount *= -1;\n      //    const lerpAmount = randFloat(0.01, 0.05);\n      //    mutateAmount -= initialGeneVal - lerp(initialGeneVal, gene.min, lerpAmount);\n      // }\n\n      const dir = Math.sign(Math.random() - 0.5);\n      mutateAmount *= dir;\n\n      mutateAmount *= Game.settings.creatureMutationRate;\n\n      return initialGeneVal + mutateAmount;\n   }\n\n   die(): void {\n      if (this === inspectorCreature) {\n         closeInspector();\n      }\n\n      super.die();\n   }\n}\n\nexport default Creature;","import Game, { GeneSampleEntry } from '../Game';\r\nimport { GraphOptions } from '../graph-viewer';\r\nimport { Colour, lerp, roundNum, Vector } from \"../utils\";\r\n\r\ntype timeUnits = \"seconds\" | \"minutes\";\r\n\r\nexport interface GraphSettings {\r\n   readonly shouldExtrapolate: boolean;\r\n}\r\n\r\nexport type GraphData = Array<GeneSampleEntry | null> | Array<number | null>;\r\nexport type GraphType = \"simple\" | \"detailed\";\r\nclass Graph {\r\n   data: GraphData;\r\n\r\n   element: HTMLElement;\r\n   width: number;\r\n   height: number;\r\n   time = Game.ticks;\r\n   settings: GraphSettings;\r\n   options: GraphOptions;\r\n\r\n   minY: number;\r\n   maxY: number;\r\n   \r\n   xAxisMeasurements = 10;\r\n   timeUnit: timeUnits = this.calculateTimeUnit(this.time);\r\n\r\n   constructor(width: number, height: number, data: GraphData, settings: GraphSettings, options: GraphOptions) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.data = data;\r\n      this.settings = settings;\r\n      this.options = options;\r\n\r\n      this.minY = this.calculateMinY();\r\n      this.maxY = this.calculateMaxY();\r\n\r\n      this.element = this.instantiate();\r\n      \r\n      this.plotData();\r\n      this.createAxes();\r\n      this.createLabels();\r\n   }\r\n   instantiate(): HTMLElement {\r\n      const element = document.createElement(\"div\");\r\n      element.className = \"graph\";\r\n\r\n      element.style.width = this.width + \"px\";\r\n      element.style.height = this.height + \"px\";\r\n\r\n      return element;\r\n   }\r\n\r\n   calculateMinY(): number {\r\n      if (this.options.min) return this.options.min;\r\n      return 0;\r\n   }\r\n   calculateMaxY(): number {\r\n      if (this.options.max) return this.options.max;\r\n\r\n      let maxY = 0;\r\n      if (this.options.type === \"simple\") {\r\n         for (const dataPoint of (this.data as Array<number | null>)) {\r\n            if (dataPoint !== null && dataPoint > maxY) maxY = dataPoint;\r\n         }\r\n      } else if (this.options.type === \"detailed\") {\r\n         for (const dataPoint of (this.data as Array<GeneSampleEntry | null>)) {\r\n            if (dataPoint !== null && dataPoint.max > maxY) maxY = dataPoint.max;\r\n         }\r\n      }\r\n      return maxY;\r\n   }\r\n\r\n   calculateTimeUnit(time: number): timeUnits {\r\n      const seconds = time / 20;\r\n      if (seconds / this.xAxisMeasurements > 60) {\r\n         return \"minutes\";\r\n      } else {\r\n         return \"seconds\";\r\n      }\r\n   }\r\n\r\n   drawPoint(pos: Vector, colour: string): void {\r\n      const point = document.createElement(\"div\");\r\n      point.className = \"point\";\r\n      point.style.backgroundColor = colour;\r\n      this.element.appendChild(point);\r\n      \r\n      point.style.left = pos.x + \"px\";\r\n      point.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   drawLine(previousPos: Vector, pos: Vector, colour: string): void {\r\n      const line = document.createElement(\"div\");\r\n      line.className = \"line\";\r\n      this.element.appendChild(line);\r\n      \r\n      line.style.left = previousPos.x + \"px\";\r\n      line.style.bottom = previousPos.y + \"px\";\r\n      line.style.backgroundColor = colour;\r\n      \r\n      const dist = previousPos.distanceFrom(pos);\r\n      const ang = -previousPos.angleBetween(pos);\r\n      line.style.width = dist + \"px\";\r\n      line.style.transform = `rotate(${ang}rad)`;\r\n   }\r\n\r\n   drawRect(pos: Vector, width: number, height: number, colour: string): void {\r\n      const rect = document.createElement(\"div\");\r\n      rect.className = \"rect\";\r\n      this.element.appendChild(rect);\r\n\r\n      rect.style.width = width + \"px\";\r\n      rect.style.height = height + \"px\";\r\n      rect.style.backgroundColor = colour;\r\n\r\n      rect.style.left = pos.x + \"px\";\r\n      rect.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   drawTrangle(pos: Vector, width: number, height: number, colour: string, type: \"top-left\" | \"top-right\" | \"bottom-right\" | \"bottom-left\"): void {\r\n      const triangle = document.createElement(\"div\");\r\n      triangle.className = `triangle ${type}`;\r\n      this.element.appendChild(triangle);\r\n\r\n      // triangle.style.width = width + \"px\";\r\n      // triangle.style.height = height + \"px\";\r\n      triangle.style.setProperty(\"--width\", height / 2 + \"px\");\r\n      triangle.style.setProperty(\"--height\", width / 2 + \"px\");\r\n      triangle.style.setProperty(\"--colour\", colour);\r\n      // triangle.style.backgroundColor = colour;\r\n\r\n      triangle.style.left = pos.x + \"px\";\r\n      triangle.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   getData(): GraphData {\r\n      const EXTRAPOLATION_AMOUNT = 75;\r\n      if (!this.settings.shouldExtrapolate || this.data.length <= EXTRAPOLATION_AMOUNT) {\r\n         return this.data;\r\n      }\r\n\r\n      let data!: GraphData;\r\n      if (this.options.type === \"simple\") {\r\n         data = new Array<number | null>();\r\n      } else if (this.options.type === \"detailed\") {\r\n         data = new Array<GeneSampleEntry | null>();\r\n      }\r\n\r\n      for (let i = 0; i < EXTRAPOLATION_AMOUNT; i++) {\r\n         const relativeIndex = this.data.length * i/EXTRAPOLATION_AMOUNT;\r\n\r\n         if (this.options.type === \"simple\") {\r\n            let dataPoint: number | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as number | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as number | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as number | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = lerp(floorVal as number, ceilVal as number, remainder);\r\n               }\r\n            }\r\n            (data as Array<number | null>).push(dataPoint);\r\n         } else if (this.options.type === \"detailed\") {\r\n            let dataPoint: GeneSampleEntry | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as GeneSampleEntry | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as GeneSampleEntry | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as GeneSampleEntry | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = {\r\n                     average: lerp(floorVal!.average, ceilVal!.average, remainder),\r\n                     min: lerp(floorVal!.min, ceilVal!.min, remainder),\r\n                     max: lerp(floorVal!.max, ceilVal!.max, remainder),\r\n                     standardDeviation: lerp(floorVal!.standardDeviation, ceilVal!.standardDeviation, remainder)\r\n                  }\r\n               }\r\n            }\r\n            (data as Array<GeneSampleEntry | null>).push(dataPoint);\r\n         }\r\n      }\r\n      return data;\r\n   }\r\n\r\n   plotData(): void {\r\n      const data = this.getData();\r\n\r\n      if (this.options.type === \"simple\") {\r\n         this.plotSimpleData(data as Array<number | null>);\r\n      } else if (this.options.type === \"detailed\") {\r\n         this.plotDetailedData(data as Array<GeneSampleEntry | null>);\r\n      }\r\n   }\r\n\r\n   plotSimpleData(data: Array<number | null>): void {\r\n      let previousPos: Vector | null = null;\r\n      for (let i = 0; i < data.length; i++) {\r\n         const dataPoint = data[i];\r\n         if (dataPoint === null) {\r\n            previousPos = null;\r\n            continue;\r\n         }\r\n         const stepSize = this.width / (data.length-1);\r\n         \r\n         const pos = new Vector(\r\n            stepSize * i,\r\n            this.height * (dataPoint - this.minY)/(this.maxY - this.minY)\r\n         );\r\n\r\n         this.drawPoint(pos, this.options.colour);\r\n         if (i > 0 && previousPos !== null) {\r\n            this.drawLine(previousPos, pos, this.options.colour);\r\n         }\r\n\r\n         previousPos = pos;\r\n      }\r\n   }\r\n\r\n   draw(colour: string, stepSize: number, i: number, value: number, previousPos: Vector | null, shouldDrawPoint: boolean): Vector | null {\r\n      const pos = new Vector(\r\n         stepSize * i,\r\n         this.height * (value - this.minY)/(this.maxY - this.minY)\r\n      );\r\n\r\n      if (shouldDrawPoint) this.drawPoint(pos, colour);\r\n      if (i > 0 && previousPos !== null) {\r\n         this.drawLine(previousPos, pos, colour);\r\n      }\r\n      return pos;\r\n   }\r\n\r\n   plotDetailedData(data: Array<GeneSampleEntry | null>): void {\r\n      const averageColour = new Colour(this.options.colour);\r\n\r\n      let stdevColour = averageColour.desaturate(0.3);\r\n      stdevColour = stdevColour.darken(0.2);\r\n\r\n      let outerColour = averageColour.desaturate(0.7);\r\n      outerColour = outerColour.darken(0.2);\r\n\r\n      const n = data.length;\r\n\r\n      let previousAveragePos: Vector | null = null;\r\n      let previousMinPos: Vector | null = null;\r\n      let previousMaxPos: Vector | null = null;\r\n      let previousStdevMinPos: Vector | null = null;\r\n      let previousStdevMaxPos: Vector | null = null;\r\n      for (let i = 0; i < n; i++) {\r\n         const entry = data[i];\r\n         if (entry === null) {\r\n            continue;\r\n         }\r\n\r\n         const stepSize = this.width / (n-1);\r\n\r\n         previousAveragePos = this.draw(this.options.colour, stepSize, i, entry.average, previousAveragePos, true);\r\n\r\n         previousMinPos = this.draw(outerColour.hex, stepSize, i, entry.min, previousMinPos, false);\r\n         previousMaxPos = this.draw(outerColour.hex, stepSize, i, entry.max, previousMaxPos, false);\r\n\r\n         const stdevMinPos = this.draw(stdevColour.hex, stepSize, i, entry.average - entry.standardDeviation, previousStdevMinPos, false);\r\n         const stdevMaxPos = this.draw(stdevColour.hex, stepSize, i, entry.average + entry.standardDeviation, previousStdevMaxPos, false);\r\n         if (i > 0 && stdevMinPos !== null && stdevMaxPos !== null && previousStdevMinPos !== null && previousStdevMaxPos !== null) {\r\n            const rectWidth = stdevMinPos.x - previousStdevMinPos.x;\r\n            const height = Math.min(previousStdevMaxPos.y, stdevMaxPos.y) - Math.max(previousStdevMinPos.y, stdevMinPos.y);\r\n            const rectPos = new Vector(\r\n               previousStdevMinPos.x,\r\n               Math.max(previousStdevMinPos.y, stdevMinPos.y)\r\n            );\r\n            this.drawRect(rectPos, rectWidth, height, stdevColour.hex);\r\n\r\n            const topTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMaxPos.y, previousStdevMaxPos.y));\r\n            if (previousStdevMaxPos.y > stdevMaxPos.y) {\r\n               this.drawTrangle(topTrianglePos, rectWidth, previousStdevMaxPos.y - stdevMaxPos.y, stdevColour.hex, \"bottom-left\");\r\n            } else {\r\n               this.drawTrangle(topTrianglePos, rectWidth, stdevMaxPos.y - previousStdevMaxPos.y, stdevColour.hex, \"bottom-right\");\r\n            }\r\n            \r\n            const bottomTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMinPos.y, previousStdevMinPos.y));\r\n            if (previousStdevMinPos.y > stdevMinPos.y) {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, previousStdevMinPos.y - stdevMinPos.y, stdevColour.hex, \"top-right\");\r\n            } else {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, stdevMinPos.y - previousStdevMinPos.y, stdevColour.hex, \"top-left\");\r\n            }\r\n         }\r\n         \r\n         previousStdevMaxPos = stdevMaxPos;\r\n         previousStdevMinPos = stdevMinPos;\r\n      }\r\n   }\r\n\r\n   createAxisMeasurement(val: number): HTMLElement {\r\n      const measurement = document.createElement(\"div\");\r\n      measurement.className = \"measurement\";\r\n      this.element.appendChild(measurement);\r\n      const dpp = 1;\r\n      measurement.innerHTML = roundNum(val, dpp).toString();\r\n\r\n      return measurement;\r\n   }\r\n\r\n   createAxes(): void {\r\n      \r\n      // Time\r\n      for (let i = 0; i < this.xAxisMeasurements; i++) {\r\n         let val = this.time / this.xAxisMeasurements * i / Game.tps;\r\n         if (this.timeUnit === \"minutes\") val /= 60;\r\n         \r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"x\");\r\n         measurement.style.left = this.width / this.xAxisMeasurements * i * (this.xAxisMeasurements+1)/this.xAxisMeasurements + \"px\";\r\n      }\r\n      \r\n      const Y_AXIS_MEASUREMENTS = 7;\r\n      for (let i = 0; i < Y_AXIS_MEASUREMENTS; i++) {\r\n         const val = this.minY + i * (this.maxY - this.minY)/(Y_AXIS_MEASUREMENTS-1);\r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"y\");\r\n         measurement.style.bottom = this.height / (Y_AXIS_MEASUREMENTS-1) * i + \"px\";\r\n      }\r\n   }\r\n\r\n   createLabels(): void {\r\n      const xLabel = document.createElement(\"div\");\r\n      xLabel.className = \"label x-label\";\r\n      this.element.appendChild(xLabel);\r\n      if (this.timeUnit === \"seconds\") {\r\n         xLabel.innerHTML = \"Seconds\";\r\n      } else if (this.timeUnit === \"minutes\") {\r\n         xLabel.innerHTML = \"Minutes\";\r\n      }\r\n\r\n      const yLabel = document.createElement(\"div\");\r\n      yLabel.className = \"label y-label\";\r\n      this.element.appendChild(yLabel);\r\n      const val = this.options.dependentVariable;\r\n      yLabel.innerHTML = val;\r\n   }\r\n}\r\n\r\nexport default Graph;","import { useRef, useState } from 'react';\r\n\r\ninterface InputCheckboxProps {\r\n   name: string;\r\n   text: string;\r\n   defaultValue: boolean;\r\n   func: (inputVal: boolean, elem?: HTMLElement) => void;\r\n}\r\n\r\nconst InputCheckbox = ({ name, text, defaultValue, func }: InputCheckboxProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = !!Number((inputRef.current! as HTMLInputElement).checked);\r\n\r\n      func(inputVal, inputRef.current!);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const htmlName = \"_INPUT_\" + name;\r\n\r\n   const className = `input-checkbox ${val ? \"selected\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <input ref={inputRef} onChange={onInputChange} type=\"checkbox\" id={htmlName} defaultChecked={defaultValue} />\r\n         <label htmlFor={htmlName}>{text}</label>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputCheckbox;\r\n","import React, { useRef, useState } from 'react';\r\n\r\ninterface InputRangeProps {\r\n   text: string;\r\n   min: number;\r\n   max: number;\r\n   defaultValue: number;\r\n   step: number;\r\n   func?: (inputVal: number) => unknown;\r\n   button?: string;\r\n   /*** If present, any values above or equal to its value will enable \"extreme mode\" (purely visual) */\r\n   hasExtremeMode?: boolean;\r\n}\r\n\r\nconst InputRange = ({ text, min, max, defaultValue, step, func, button, hasExtremeMode }: InputRangeProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = Number((inputRef.current! as HTMLInputElement).value);\r\n\r\n      if (func && button === undefined) func(inputVal);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const extremeModeIsEnabled = hasExtremeMode ? val >= max : false;\r\n   const className = `input-range  ${extremeModeIsEnabled ? \"extreme\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <div className=\"formatter\">\r\n            <div className=\"text\">{text}</div>\r\n\r\n            <div>\r\n               <div className=\"value\">{val}</div>\r\n               <div className=\"bar-container\">\r\n                  <div className=\"min\">{min}</div>\r\n                  <input ref={inputRef} onInput={onInputChange} type=\"range\" min={min} max={max} step={step} defaultValue={defaultValue} />\r\n                  <div className=\"max\">{max}</div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n\r\n         {button ?\r\n         <button onClick={() => {if (func) func(val)}}>{button}</button>\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputRange;\r\n","import ReactDOM from 'react-dom';\r\nimport { creatureGeneInfo } from './classes/Creature';\r\nimport Graph, { GraphData, GraphSettings, GraphType } from './classes/Graph';\r\nimport InputCheckbox from './components/InputCheckbox';\r\nimport InputRange from './components/InputRange';\r\nimport { geneSamples } from './Game';\r\nimport { hideMask, showMask } from './index';\r\nimport { getElem } from './utils';\r\n\r\nexport let graphViewerIsVisible: boolean = false;\r\n\r\ntype settingType = \"checkbox\" | \"range\";\r\ninterface Setting {\r\n   text: string;\r\n   type: settingType;\r\n   description?: string;\r\n   isChecked?: boolean;\r\n   value?: number;\r\n   min?: number;\r\n   max?: number;\r\n   step?: number;\r\n   defaultValue: boolean | number;\r\n   requirement?: string;\r\n   elem?: JSX.Element;\r\n}\r\nexport const graphSettingData: ReadonlyArray<Setting> = [\r\n   {\r\n      text: \"Extrapolate values\",\r\n      type: \"checkbox\",\r\n      description: \"Reduces the amount of nodes rendered, will significantly reduce lag in extreme scenarios.\",\r\n      defaultValue: false\r\n   },\r\n   // {\r\n   //    text: \"Max number of points\",\r\n   //    type: \"range\",\r\n   //    description: \"The highest number of points, after which values will be extrapolated.\",\r\n   //    defaultValue: 50,\r\n   //    min: 50,\r\n   //    max: 100,\r\n   //    step: 5,\r\n   //    requirement: \"Extrapolate values\"\r\n   // },\r\n   {\r\n      text: \"Automatically update\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show points\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show lines\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   }\r\n];\r\n\r\nconst createSettings = (): void => {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const settingsContainer = graphViewer.querySelector(\".settings-container\");\r\n\r\n   const elems: Array<JSX.Element> = graphSettingData.map((setting, i) => {\r\n      const baseClickEvent = (): void => {\r\n         // Check for any settings which require this one\r\n         for (const settingCheck of graphSettingData) {\r\n            if (settingCheck.requirement === setting.text) {\r\n\r\n            }\r\n         }\r\n\r\n         drawGraphs();\r\n      }\r\n\r\n      let elem: JSX.Element;\r\n      const name = `graph-setting-${i}`;\r\n      switch (setting.type) {\r\n         case \"checkbox\": {\r\n            const clickEvent = (isSelected: boolean): void => {\r\n               setting.isChecked = isSelected;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputCheckbox key={i} name={name} text={setting.text} defaultValue={setting.defaultValue as boolean} func={clickEvent} />\r\n            break;   \r\n         }\r\n         case \"range\": {\r\n            const clickEvent = (newVal: number): void => {\r\n               setting.value = newVal;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputRange key={i} text={setting.text} defaultValue={setting.defaultValue as number} min={setting.min!} max={setting.max!} step={setting.step!} func={clickEvent} />\r\n            break;\r\n         }\r\n      }\r\n      setting.elem = elem;\r\n      return elem!;\r\n   });\r\n\r\n   ReactDOM.render(elems, settingsContainer);\r\n}\r\n\r\nconst setupSettings = (): void => {\r\n   for (const setting of graphSettingData) {\r\n      if (setting.type === \"checkbox\") {\r\n         setting.isChecked = setting.defaultValue as boolean;\r\n      }\r\n   }\r\n}\r\n\r\nexport interface GraphOptions {\r\n   display: string;\r\n   id: string;\r\n   colour: string;\r\n   dependentVariable: string;\r\n   type: GraphType;\r\n   min?: number;\r\n   max?: number;\r\n}\r\nlet graphOptions: Array<GraphOptions> = [\r\n   {\r\n      display: \"Number of creatures\",\r\n      id: \"creatures\",\r\n      colour: \"#26ff1f\",\r\n      dependentVariable: \"Creatures\",\r\n      type: \"simple\"\r\n   },\r\n   {\r\n      display: \"Number of fruit\",\r\n      id: \"fruit\",\r\n      colour: \"#19c6ff\",\r\n      dependentVariable: \"Fruit\",\r\n      type: \"simple\"\r\n   }\r\n];\r\nconst createGraphOptions = (): void => {\r\n   for (const [ geneName, gene ] of Object.entries(creatureGeneInfo)) {\r\n      graphOptions.push({\r\n         display: `Creature ${gene.display}`,\r\n         id: geneName,\r\n         colour: gene.colour,\r\n         dependentVariable: gene.display,\r\n         min: gene.min,\r\n         max: gene.max,\r\n         type: \"detailed\"\r\n      });\r\n   }\r\n}\r\n\r\nlet selectedGraphOptions: Array<GraphOptions> = new Array<GraphOptions>();\r\nexport function setupGraphs(): void {\r\n   createGraphOptions();\r\n   createSettings();\r\n   setupSettings();\r\n\r\n   const graphViewer = getElem(\"graph-viewer\");\r\n   const optionsContainer = graphViewer.querySelector(\".options-container\");\r\n\r\n   const optionElems = <>{\r\n      graphOptions.map((option, i) => {\r\n         const clickEvent = (isSelected: boolean) => {\r\n            if (isSelected) {\r\n               let hasInserted = false;\r\n               for (let j = 0; j < selectedGraphOptions.length; j++) {\r\n                  const n = graphOptions.indexOf(selectedGraphOptions[j]);\r\n                  if (n > i) {\r\n                     selectedGraphOptions.splice(j, 0, option)\r\n                     hasInserted = true;\r\n                     break;\r\n                  }\r\n               }\r\n               if (!hasInserted) {\r\n                  selectedGraphOptions.push(option);\r\n               }\r\n            } else {\r\n               const idx = selectedGraphOptions.indexOf(option);\r\n               selectedGraphOptions.splice(idx, 1);\r\n            }\r\n\r\n            drawGraphs();\r\n         };\r\n\r\n         return <InputCheckbox key={i} name={option.id} text={option.display} defaultValue={false} func={clickEvent} />\r\n      })\r\n   }</>;\r\n\r\n   ReactDOM.render(optionElems, optionsContainer);\r\n}\r\n\r\nexport function closeGraphViewer(): void {\r\n   hideMask();\r\n   getElem(\"graph-viewer\").classList.add(\"hidden\");\r\n   graphViewerIsVisible = false;\r\n}\r\n\r\nexport function openGraphViewer(): void {\r\n   showMask();\r\n   getElem(\"graph-viewer\").classList.remove(\"hidden\");\r\n   graphViewerIsVisible = true;\r\n}\r\n\r\nexport function drawGraphs(): void {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const graphContainer = graphViewer.querySelector(\".graph-container\") as HTMLElement;\r\n\r\n   // If no options are selected, display text and leave\r\n   if (selectedGraphOptions.length === 0) {\r\n      graphContainer.innerHTML = \"<p>Your graph will appear here once you choose an option.</p>\";\r\n      return;\r\n   }\r\n\r\n   // Remove any previous graphs\r\n   graphContainer.innerHTML = \"\";\r\n   \r\n   const graphSettings: GraphSettings = {\r\n      shouldExtrapolate: graphSettingData[0].isChecked!\r\n   };\r\n\r\n   for (const graphOptions of selectedGraphOptions) {\r\n      let dataPoints: GraphData;\r\n      if (graphOptions.type === \"simple\") {\r\n         dataPoints = geneSamples.map(sample => sample[graphOptions.id]);\r\n      } else if (graphOptions.type === \"detailed\") {\r\n         dataPoints = geneSamples.map(sample => sample.genePool !== null ? sample.genePool[graphOptions.id] : null);\r\n      }\r\n\r\n      const aspectRatio = 5/3;\r\n      const width = 350;\r\n\r\n      const graph = new Graph(width, width/aspectRatio, dataPoints!, graphSettings, graphOptions);\r\n      graphContainer.appendChild(graph.element);\r\n   }\r\n}","import Creature from \"./classes/Creature\";\r\nimport { cells } from \"./main\";\r\nimport { createHoverBox, getElem, Vector } from \"./utils\";\r\nimport { closeInspector, openInspector } from \"./creature-inspector\";\r\nimport { closeGraphViewer, graphViewerIsVisible, openGraphViewer } from \"./graph-viewer\";\r\n\r\nconst MIN_HOVER_DIST: number = 30;\r\nlet hoverBox: HTMLElement | null = null;\r\nlet mouse: Vector;\r\nlet closestCreature: Creature | null = null;\r\n\r\nconst highlight = (creature: Creature): void => {\r\n    creature.element.classList.add(\"highlighted\");\r\n}\r\n\r\nconst removePreviousHighlight = (): void => {\r\n    document.querySelector(\".creature.highlighted\")?.classList.remove(\"highlighted\");\r\n}\r\n\r\nexport function handleMouse(event: MouseEvent): void {\r\n    const mouseScreenX = event.clientX;\r\n    const mouseScreenY = event.clientY;\r\n\r\n    const board = getElem(\"board\");\r\n    const boardBounds = board.getBoundingClientRect();\r\n    const boardPosX = boardBounds.x;\r\n    const boardPosY = boardBounds.y;\r\n\r\n    mouse = new Vector(mouseScreenX - boardPosX, mouseScreenY - boardPosY);\r\n    if (mouse.x < 0 || mouse.x > boardBounds.width || mouse.y < 0 || mouse.y > boardBounds.height) return;\r\n\r\n    updateMouse();\r\n}\r\n\r\nexport function updateMouse(): void {\r\n    if (!mouse) return;\r\n\r\n    const board = getElem(\"board\");\r\n\r\n    let creatures: Array<Creature> = new Array<Creature>();\r\n    for (const cell of cells) {\r\n        creatures = creatures.concat(cell.filter(entity => entity instanceof Creature) as Array<Creature>);\r\n    }\r\n\r\n    closestCreature = null;\r\n    let distanceToClosestCreature = MIN_HOVER_DIST;\r\n    for (const creature of creatures) {\r\n        const dist = mouse.distanceFrom(creature.position) - (creature.size as number)/2;\r\n\r\n        if (dist < distanceToClosestCreature) {\r\n            closestCreature = creature;\r\n            distanceToClosestCreature = dist;\r\n        }\r\n    }\r\n\r\n    removePreviousHighlight();\r\n\r\n    if (closestCreature !== null) {\r\n        highlight(closestCreature);\r\n        const newHoverBox = createHoverBox(closestCreature.name, new Vector(closestCreature.position.x, closestCreature.position.y + 20 + closestCreature.size/2), board);\r\n        // Remove previous hover box if possible\r\n        if (hoverBox !== null && hoverBox !== newHoverBox) {\r\n            hoverBox.remove();\r\n        }\r\n        hoverBox = newHoverBox;\r\n\r\n        board.classList.add(\"highlight\");\r\n    } else {\r\n        board.classList.remove(\"highlight\");\r\n        hoverBox?.remove();\r\n        hoverBox = null;\r\n    }\r\n}\r\n\r\nexport function mouseClick(): void {\r\n    const e = window.event;\r\n    const targetElem = e?.target as HTMLElement;\r\n\r\n    if (targetElem.id === \"open-graph-viewer-button\") {\r\n        openGraphViewer();\r\n    } else if (graphViewerIsVisible) {\r\n        if (e?.composedPath().includes(getElem(\"graph-viewer\"))) return;\r\n        \r\n        closeGraphViewer();\r\n    } else {\r\n        if (closestCreature !== null) {\r\n            openInspector(closestCreature);\r\n        } else {\r\n            closeInspector();\r\n        }\r\n    }\r\n}","import React, { useEffect, useRef } from 'react';\nimport Creature, { createCreature } from '../classes/Creature';\nimport Entity from '../classes/Entity';\nimport Fruit from '../classes/Fruit';\nimport \"../css/control-panel.css\";\nimport Game from '../Game';\nimport { redrawBoard } from '../main';\nimport { getElem, roundNum } from '../utils';\nimport InputCheckbox from './InputCheckbox';\nimport InputRange from './InputRange';\n\nexport let updateControlPanel: Function;\n\nconst createCreatures = (amount: number): void => {\n   for (let i = 0; i < amount; i++) createCreature();\n}\n\nconst changeDarkMode = (newVal: boolean): void => {\n   if (newVal) {\n      document.body.classList.add(\"dark-mode\");\n   } else {\n      document.body.classList.remove(\"dark-mode\");\n   }\n}\n\nconst updateGameSize = (inputWidth: number, inputHeight: number): void => {\n   if (isNaN(inputWidth)) {\n      alert(\"The board width must be a number!\");\n      return;\n   }\n   if (isNaN(inputHeight)) {\n      alert(\"The board height must be a number!\");\n      return;\n   }\n   if (inputWidth <= 0) {\n      alert(\"The board width must be a number above 0!\");\n      return;\n   }\n   if (inputHeight <= 0) {\n      alert(\"The board height must be a number above 0!\");\n      return;\n   }\n   if (inputWidth % 1 !== 0) {\n      alert(\"The board width must be an integer!\");\n      return;\n   }\n   if (inputHeight % 1 !== 0) {\n      alert(\"The board height must be an integer!\");\n      return;\n   }\n\n   changeGameSize(\"width\", inputWidth);\n   changeGameSize(\"height\", inputHeight); \n}\nconst changeGameSize = (dimension: keyof typeof Game.boardSize, newVal: number): void => {\n   Game.boardSize[dimension] = newVal;\n   \n   redrawBoard();\n}\n\nconst changeTimewarp = (newVal: number) => {\n   Game.timewarp = newVal;\n}\n\nconst expandControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.remove(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.add(\"hidden\");\n}\nconst collapseControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.add(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.remove(\"hidden\");\n}\n\nconst ControlPanel = () => {\n   const changeGameWidthRef = useRef(null);\n   const changeGameHeightRef = useRef(null);\n\n   const [, updateState] = React.useState({});\n   const forceUpdate = React.useCallback(() => updateState({}), []);\n\n   useEffect(() => {\n      updateControlPanel = forceUpdate;\n   }, [forceUpdate]);\n\n   return (\n      <>\n         <div id=\"expand-icon\" className=\"hidden\" onClick={expandControlPanel}>\n            <div className=\"formatter\">\n               <div className=\"vertical-bar\"></div>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n            <div className=\"text\">Control Panel</div>\n         </div>\n         <div id=\"control-panel\" className=\"menu\">\n            <div className=\"collapse-icon\" onClick={collapseControlPanel}>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n\n            <h1 className=\"heading\">Control Panel</h1>\n\n            <h2 className=\"subheading\">Settings</h2>\n\n            <InputCheckbox name=\"dark-mode\" text=\"Dark Mode\" defaultValue={true} func={(newVal: boolean) => changeDarkMode(newVal)} />\n\n            { Game.hasStarted ? ( <>\n               <button id=\"open-graph-viewer-button\">View Graphs</button>\n\n               <h2 className=\"subheading\">Overview</h2>\n\n               <p>Creatures: {Entity.count(Creature)}</p> \n               <p>Fruit: {Entity.count(Fruit)}</p>\n               <p>Time elapsed: {roundNum(Game.ticks / 20, 1)} seconds <i>({Game.ticks} ticks)</i></p>\n               \n               <h2 className=\"subheading\">Creatures</h2>\n               \n               <InputRange button=\"Create\" text=\"Create creatures\" min={1} max={10} defaultValue={1} step={1} func={createCreatures} />\n\n               <h2 className=\"subheading\">World</h2>\n               \n               <p>Width: <input ref={changeGameWidthRef} defaultValue=\"10\" type=\"text\" /></p>\n               <p>Height: <input ref={changeGameHeightRef} defaultValue=\"10\" type=\"text\" /></p>\n               <button onClick={() => updateGameSize(Number((changeGameWidthRef.current! as HTMLInputElement).value), Number((changeGameHeightRef.current! as HTMLInputElement).value))}>Update Board Size</button>\n               \n               <InputRange text=\"Timewarp\" min={1} max={10} defaultValue={1} step={1} func={changeTimewarp} hasExtremeMode={true} />\n            </> ) : \"\"}\n         </div>\n      </>\n   );\n}\n\nexport default ControlPanel;\n","import Game from \"./Game\";\r\nimport { getElem } from \"./utils\";\r\n\r\nconst boardIsVisible = (): boolean => {\r\n   return !getElem(\"board\")!.classList.contains(\"hidden\");\r\n}\r\n\r\nexport function updateTransform(): void {\r\n   const board = getElem(\"board\");\r\n\r\n   board.style.top = `calc(50% + ${Game.transform.translate.y}%)`;\r\n   board.style.left = `calc(50% + ${Game.transform.translate.x}%)`;\r\n   board.style.transform = `translate(-50%, -50%) scale(${Game.transform.zoom}, ${Game.transform.zoom})`;\r\n}\r\n\r\ntype translateDirection = \"up\" | \"right\" | \"down\" | \"left\";\r\nconst translateBoard = (dir: translateDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n\r\n   const TRANSLATE_AMOUNT = 5;\r\n\r\n   const translate = Game.transform.translate;\r\n   switch (dir) {\r\n      case \"up\": {\r\n         translate.y += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"right\": {\r\n         translate.x -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"down\": {\r\n         translate.y -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"left\": {\r\n         translate.x += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\ntype zoomDirection = \"in\" | \"out\";\r\nconst zoomBoard = (dir: zoomDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n   \r\n   const ZOOM_AMOUNT = 0.15;\r\n\r\n   switch (dir) {\r\n      case \"in\": {\r\n         Game.transform.zoom *= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n      case \"out\": {\r\n         Game.transform.zoom /= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\nconst pauseGame = (): void => {\r\n   Game.isPaused = true;\r\n   getElem(\"pause-screen\").classList.remove(\"hidden\");\r\n}\r\nconst unpauseGame = (): void => {\r\n   Game.isPaused = false;\r\n   getElem(\"pause-screen\").classList.add(\"hidden\");\r\n}\r\n\r\nexport function keyPress(): void {\r\n   const e = window.event as KeyboardEvent;\r\n   const key = e.key;\r\n\r\n   // Don't do anything if there is an element in focus\r\n   if (document.activeElement !== document.body) return;\r\n\r\n   switch (key) {\r\n      case \"ArrowUp\": {\r\n         translateBoard(\"up\");\r\n         break;\r\n      }\r\n      case \"ArrowRight\": {\r\n         translateBoard(\"right\");\r\n         break;\r\n      }\r\n      case \"ArrowDown\": {\r\n         translateBoard(\"down\");\r\n         break;\r\n      }\r\n      case \"ArrowLeft\": {\r\n         translateBoard(\"left\");\r\n         break;\r\n      }\r\n      case \"-\":\r\n      case \"_\": {\r\n         zoomBoard(\"out\");\r\n         break;\r\n      }\r\n      case \"+\":\r\n      case \"=\": {\r\n         zoomBoard(\"in\");\r\n         break;\r\n      }\r\n      case \" \": {\r\n         Game.isPaused ? unpauseGame() : pauseGame();\r\n      }\r\n   }\r\n}","import Fruit, { createFruit } from \"./classes/Fruit\";\nimport { cells } from \"./main\";\nimport { gameImages } from \"./GameImage\";\nimport { updateMouse } from \"./Mouse\";\nimport { inspectorIsOpen, rerenderInspector } from \"./creature-inspector\";\nimport { updateControlPanel } from \"./components/ControlPanel\";\nimport Creature, { createCreature, creatureGeneInfo } from \"./classes/Creature\";\nimport Entity from \"./classes/Entity\";\nimport { standardDeviation, Vector } from \"./utils\";\nimport { drawGraphs, graphSettingData } from \"./graph-viewer\";\nimport { updateTransform } from \"./keyboard\";\n\nconst renderListeners: Array<Function> = [];\n\nexport const geneSamples: Array<GeneSample> = new Array<GeneSample>();\n\nexport interface GeneSampleEntry {\n   average: number;\n   min: number;\n   max: number;\n   standardDeviation: number;\n}\ninterface GenePool {\n   [key: keyof typeof creatureGeneInfo]: GeneSampleEntry;\n}\ninterface GeneSample {\n   [key: string]: any;\n   creatures: number | null;\n   fruit: number | null;\n   genePool: GenePool | null;\n}\n\nconst sampleGenes = (creatures: ReadonlyArray<Creature>) => {\n   let genePool: GenePool | null = {};\n   if (creatures.length === 0) {\n      genePool = null;\n   } else {\n      let allGenes: { [ key: keyof typeof creatureGeneInfo ]: Array<number> } = {};\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         allGenes[geneName] = new Array<number>();\n      }\n      \n      for (const creature of creatures) {\n         for (const geneName of Object.keys(allGenes)) {\n            allGenes[geneName].push(creature[geneName]);\n         }\n      }\n      \n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         const geneVals = allGenes[geneName];\n         \n         const n = geneVals.length;\n         let minVal = Number.MAX_SAFE_INTEGER;\n         let maxVal = 0;\n         let average = 0;\n         for (let i = 0; i < n; i++) {\n            const val = geneVals[i];\n            if (val < minVal) minVal = val;\n            if (val > maxVal) maxVal = val;\n            average += val;\n         }\n         average /= n;\n         \n         genePool[geneName] = {\n            average: average,\n            min: minVal,\n            max: maxVal,\n            standardDeviation: standardDeviation(geneVals)\n         };\n      }\n   }\n\n   let creatureCount: number | null = Entity.count(Creature);\n   if (creatureCount === 0) creatureCount = null;\n   const fruitCount: number | null = Entity.count(Fruit);\n   geneSamples.push({\n      creatures: creatureCount,\n      fruit: fruitCount,\n      genePool: genePool\n   });\n\n   if (graphSettingData[1].isChecked) {\n      drawGraphs();\n   }\n};\n\ninterface GameType {\n   hasStarted: boolean;\n   isPaused: boolean;\n   ticks: number;\n   readonly tps: number;\n   timewarp: number;\n   runTick: Function;\n   start: Function;\n   createRenderListener: Function;\n   removeRenderListener: Function;\n   hasRenderListener: Function;\n   boardSize: {\n      width: number;\n      height: number;\n   },\n   transform: {\n      zoom: number;\n      translate: Vector;\n   },\n   readonly cellBorderSize: number;\n   readonly cellSize: number;\n   settings: GameSettings;\n}\nexport interface GameSettings {\n   fruitSpawnRate: number;\n   creatureMutationRate: number;\n   initialCreatures: number;\n   initialFruit: number;\n   equilibrium: number;\n}\n\nexport const defaultGameSettings: GameSettings = {\n   fruitSpawnRate: 1,\n   creatureMutationRate: 1,\n   initialCreatures: 10,\n   initialFruit: 50,\n   equilibrium: 20\n}\nconst Game: GameType = {\n   hasStarted: false,\n   isPaused: false,\n   // The number of ticks that have elapsed since the load of the web page\n   ticks: 0,\n   // Effectively changes the number of rerenders each second. Affects everything from confetti to creatures.\n   tps: 20,\n   timewarp: 1,\n   // Runs every {tps} seconds.\n   runTick: function(): void {\n      if (this.isPaused) {\n         setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n         return;\n      }\n\n      // Call all external render listeners\n      for (const func of renderListeners) func();\n\n      if (this.hasStarted) {\n         this.ticks++;\n\n         // Remove all rays\n         document.querySelectorAll(\".ray\").forEach(ray => ray.remove());\n\n         let creatures = new Array<Creature>();\n   \n         // Call all entities' tick functions\n         for (const cell of cells) {\n            for (const entity of cell) {\n               if (entity instanceof Creature) creatures.push(entity);\n               entity.tick();\n            }\n         }\n   \n         for (const gameImage of gameImages) gameImage.tick();\n   \n         // Number of fruits which spawn in a cell each second\n         const FRUIT_SPAWN_RATE = 0.05 * this.settings.fruitSpawnRate;\n         for (let cellNumber = 0; cellNumber < cells.length; cellNumber++) {\n            const rand = Math.random();\n            for (let i = 0; rand <= FRUIT_SPAWN_RATE / this.tps - i; i++) {\n               createFruit(cellNumber);\n            }\n         }\n   \n         updateControlPanel();\n         updateMouse();\n   \n         if (inspectorIsOpen) rerenderInspector();\n\n         // Seconds between gene samples\n         const GENE_SAMPLE_INTERVAL = 10;\n         if (this.ticks / this.tps % GENE_SAMPLE_INTERVAL === 0) {\n            sampleGenes(creatures);\n         }\n      }\n\n      // if (this.ticks % 50 === 0) {\n      //    setTimeout(() => this.runTick(), 10);\n      // } else {\n\n      //    this.runTick();\n      // }\n      setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n   },\n   start(): void {\n      this.hasStarted = true;\n\n      this.transform.zoom = 25 / Math.pow(this.boardSize.width + this.boardSize.height, 1.1);\n      updateTransform();\n   \n      for (let i = 0; i < this.settings.initialCreatures; i++) {\n         createCreature();\n      }\n      for (let i = 0; i < this.settings.initialFruit; i++) {\n         const cellNumber = Math.floor(Math.random() * this.boardSize.width * this.boardSize.height);\n         createFruit(cellNumber);\n      }\n   },\n   createRenderListener(func: Function): void {\n      renderListeners.push(func);\n   },\n   removeRenderListener(func: Function): void {\n      const functionIndex = renderListeners.indexOf(func);\n      if (functionIndex === -1) throw new Error(`No matching function could be found! Name: ${func.name}`);\n      renderListeners.push(func);\n   },\n   hasRenderListener(func: Function): boolean {\n      const functionIndex = renderListeners.indexOf(func);\n      return functionIndex >= 0;\n   },\n   boardSize: {\n      width: 15,\n      height: 15\n   },\n   transform: {\n      zoom: 1,\n      translate: new Vector(0, 0)\n   },\n   // Size of the border between cells in px\n   cellBorderSize: 2,\n   // Width and height of cells in px\n   cellSize: 60,\n   settings: defaultGameSettings\n};\n\nexport default Game;","import Game from \"./Game\";\nimport { randFloat, randItem, Vector } from \"./utils\";\n\nconst confettis: Array<Confetti> = [];\n\nclass Confetti {\n   element: HTMLElement;\n   position: Vector;\n   velocity: Vector;\n\n   constructor() {\n      this.element = this.createInstance();\n      this.position = this.getRandomPosition();\n      this.velocity = this.getRandomVelocity();\n   };\n   getRandomPosition(): Vector {\n      // Between 100 and 0, percentage of the screen that the x position could start at\n      const X_RANGE = 90;\n      // Between 100 and 0, percentage of the screen that the y position could start at\n      const Y_RANGE = 90;\n      // Shifts the potential y positions up and down. Negative is a shift down\n      const Y_OFFSET = -10;\n\n      const x = randFloat(0, X_RANGE) + (100 - X_RANGE) / 2;\n      const y = randFloat(0, Y_RANGE) + (100 - Y_RANGE) / 2 - Y_OFFSET;\n      return new Vector(x, y);\n   };\n   getRandomVelocity(): Vector {\n      const xVel = randFloat(-2, 2);\n      const yVel = randFloat(-12, -5);\n      return new Vector(xVel, yVel);\n   };\n   createInstance(): HTMLElement {\n      const confetti = document.createElement(\"div\");\n      confetti.className = \"confetti\";\n      document.body.appendChild(confetti);\n\n      // Give it a random size\n      const WIDTH_RANGE = [3, 7];\n      const HEIGHT_RANGE = [5, 12];\n      const width = randFloat(WIDTH_RANGE[0], WIDTH_RANGE[1]);\n      const height = randFloat(HEIGHT_RANGE[0], HEIGHT_RANGE[1]);\n      confetti.style.width = `${width}px`;\n      confetti.style.height = `${height}px`;\n      \n      // Apply a random rotation\n      const rotation = Math.random() * 180;\n      confetti.style.transform = `rotate(${rotation}deg)`;\n\n      const potentialColours: Array<string> = [\"red\", \"pink\", \"orange\", \"green\", \"blue\"];\n      const colour: string = randItem(potentialColours) as string;\n      confetti.style.backgroundColor = colour;\n\n      return confetti;\n   };\n   updatePosition(): void {\n      this.element.style.left = `${this.position.x}%`;\n      this.element.style.top = `${this.position.y}%`;\n   };\n   tick() {\n      for (let i = 0; i < 7; i++) {\n         // Apply velocity\n         this.position = this.position.lerp(this.position.add(this.velocity), 1 / Game.tps);\n         // Gravityyyyy\n         this.velocity.y += 0.05;\n      }\n\n      // If the confetti is out of bounds, stab it\n      if (this.position.y > 100 || this.position.x < 0 || this.position.x > 100) {\n         this.die();\n      }\n\n      this.updatePosition();\n   };\n   die() {\n      this.element.remove();\n\n      const confettiIndex = confettis.indexOf(this);\n      confettis.splice(confettiIndex, 1);\n   }\n}\n\nconst handleConfettis = () => {\n   for (const confetti of confettis) confetti.tick();\n}\n\nexport function createConfettis(n: number) {\n   for (let i = 0; i < n; i++) {\n      confettis.push(new Confetti());\n   }\n\n   if (!Game.hasRenderListener(handleConfettis)) Game.createRenderListener(handleConfettis);\n}","import React from 'react';\r\n\r\ninterface WarningProps {\r\n   text: string;\r\n}\r\n\r\nconst Warning = ({ text }: WarningProps) => {\r\n   return (\r\n      <div className=\"warning\">\r\n         <h3>Warning</h3>\r\n         <p>{text}</p>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default Warning;\r\n","import React, { useRef, useState } from 'react';\r\nimport Warning from './Warning';\r\n\r\ninterface InputTextProps {\r\n   text: string;\r\n   defaultValue: number;\r\n   limit?: number;\r\n   func?: (newVal: number) => void;\r\n}\r\n\r\nconst InputText = ({ text, defaultValue, func, limit }: InputTextProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState<any>(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = Number((inputRef.current! as HTMLInputElement).value);\r\n\r\n      if (func) func(inputVal);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   let warningMessage = null;\r\n   if (isNaN(val)) {\r\n      warningMessage = \"The input must be a valid number.\";\r\n   } else if (val === 0) {\r\n      warningMessage = \"You must have an input value.\";\r\n   } else if (val % 1 !== 0) {\r\n      warningMessage = \"The input must be an integer.\";\r\n   } else if (limit && val > limit) {\r\n      warningMessage = `The input cannot be greater than ${limit}.`;\r\n   }\r\n   \r\n   return (\r\n      <div className=\"input-text\">\r\n         <span className=\"text\">{text}:</span>\r\n         <input ref={inputRef} onInput={onInputChange} type=\"text\" defaultValue={defaultValue} />\r\n\r\n         {warningMessage !== null ? \r\n            <Warning text={warningMessage} />\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputText;\r\n","import '../css/start-menu.css';\r\nimport { getElem } from '../utils';\r\nimport { StartGame } from \"../main\";\r\nimport InputRange from './InputRange';\r\nimport InputText from './InputText';\r\nimport Game, { defaultGameSettings, GameSettings } from '../Game';\r\n\r\nexport function openStartMenu(): void {\r\n   getElem(\"start-menu\").classList.remove(\"hidden\");\r\n}\r\n\r\nconst closeStartMenu = (): void => {\r\n   getElem(\"start-menu\").remove();\r\n\r\n   StartGame();\r\n}\r\n\r\nlet newGameSettings: GameSettings = JSON.parse(JSON.stringify(defaultGameSettings));\r\n\r\nconst startClickEvent = () => {\r\n   Game.settings = newGameSettings;\r\n   closeStartMenu();\r\n};\r\n\r\nconst StartMenu = () => {\r\n   return (\r\n      <div id=\"start-menu\" className=\"menu hidden\">\r\n         <div className=\"content\">\r\n            <h1 className=\"heading\">Settings</h1>\r\n         \r\n            <h2 className=\"subheading\">Board Size</h2>\r\n            <p>Adjust the size of the environment.</p>\r\n            <InputText func={newVal => Game.boardSize.width = newVal} text=\"Width\" defaultValue={15} limit={100} />\r\n            <InputText func={newVal => Game.boardSize.height = newVal} text=\"Height\" defaultValue={15} limit={100} />\r\n\r\n            <h2 className=\"subheading\">Initial Population</h2>\r\n            <InputRange func={newVal => newGameSettings.initialCreatures = newVal} text=\"Creatures\" min={0} max={100} step={1} defaultValue={10} />\r\n            <InputRange func={newVal => newGameSettings.initialCreatures = newVal} text=\"Fruit\" min={0} max={500} step={5} defaultValue={50} />\r\n\r\n            <h2 className=\"subheading\">Modifiers</h2>\r\n            <InputRange func={newVal => newGameSettings.fruitSpawnRate = newVal} text=\"Fruit spawn rate\" min={0.5} max={5} step={0.5} defaultValue={1} hasExtremeMode={true} />\r\n            <InputRange func={newVal => newGameSettings.creatureMutationRate = newVal} text=\"Creature mutation rate\" min={0.5} max={3} step={0.1} defaultValue={1} hasExtremeMode={true} />\r\n\r\n            <h2 className=\"subheading\">Other Stuff</h2>\r\n            <p>I couldn't figure out where to put these so now this is here.</p>\r\n            <InputRange func={newVal => newGameSettings.equilibrium = newVal} text=\"Desired equilibrium\" min={0} max={100} step={5} defaultValue={20} />\r\n\r\n            <button onClick={startClickEvent}>Start</button>\r\n         </div>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default StartMenu;\r\n","import React from \"react\";\nimport { createConfettis } from \"../confetti\";\nimport \"../css/titlescreen.css\";\nimport { openStartMenu } from \"./StartMenu\";\n\nconst openSourceCode = () => {\n   const githubURL = \"https://github.com/eggpoison/creature-simulator\";\n   window.open(githubURL, '_blank')?.focus();\n}\n\nconst Titlescreen = () => {\n   return (\n      <div id=\"titlescreen\">\n         <h1>Creature Simulator</h1>\n         <div id=\"title-options-container\">\n            <button onClick={openStartMenu}>Start</button>\n            <button onClick={() => createConfettis(50)}>Confetti!</button>\n            <button>About</button>\n            <button onClick={openSourceCode} id=\"source-code-button\">Source Code</button>\n         </div>\n      </div>\n   );\n}\n\nexport default Titlescreen;","const Board = () => {\n   return (\n      <div id=\"board\" className=\"hidden\"></div>\n   );\n}\n\nexport default Board;","import React, { useEffect, useState } from 'react'\r\nimport Creature, { creatureGeneInfo } from '../classes/Creature';\r\nimport { setInspectorRerenderFunction, setUpdateFunction } from '../creature-inspector';\r\nimport '../css/creature-inspector.css';\r\nimport Game from '../Game';\r\nimport { roundNum } from '../utils';\r\n\r\nconst CreatureInspector = () => {\r\n    const [creature, setCreature] = useState<Creature | null>(null);\r\n\r\n    const [, updateState] = React.useState({});\r\n    const forceUpdate = React.useCallback(() => updateState({}), []);\r\n\r\n    useEffect(() => {\r\n        setUpdateFunction((newCreature: Creature | null) => {\r\n            setCreature(newCreature);\r\n        });\r\n        setInspectorRerenderFunction(() => forceUpdate());\r\n    }, [forceUpdate]);\r\n\r\n    const geneInfo: JSX.Element = creature === null ? <></> : <> {\r\n        Object.entries(creatureGeneInfo).map((geneInfo, i) => {\r\n            const gene = geneInfo[1], geneName = geneInfo[0];\r\n            const val = creature[geneName];\r\n            const fillWidth = (val - gene.min) / (gene.max - gene.min) * 100;\r\n            const fillOpacity = 0.5 + (val - gene.min) / (gene.max - gene.min) / 2;\r\n            \r\n            return <div key={i} className=\"gene\">\r\n                <div className=\"label\">{gene.display}</div>\r\n                <div className=\"slider\">\r\n                    <div style={{ width: fillWidth + \"%\", opacity: fillOpacity, backgroundColor: gene.colour }} className=\"slider-fill\"></div>\r\n                    <div className=\"min\">{gene.min}</div>\r\n                    <div className=\"val\">{val}</div>\r\n                    <div className=\"max\">{gene.max}</div>\r\n                </div>\r\n            </div>\r\n        })\r\n    } </>\r\n\r\n    return creature === null ? <></> : (\r\n        <div id=\"creature-inspector\">\r\n            <h1>Creature Inspector</h1>\r\n\r\n            <h2>General</h2>\r\n            <div className=\"panel\">\r\n                <p>Name: {creature.name}</p>\r\n                <p>Age: {Game.ticks - creature.birthTime} ticks ({roundNum((Game.ticks - creature.birthTime) / Game.tps, 1)} seconds)</p>\r\n            </div>\r\n\r\n            <h2>Stats</h2>\r\n            <div className=\"panel\">\r\n                <p>Generation: {creature.stats.generation}</p>\r\n                <p>Fruit eaten: {creature.stats.fruitEaten}</p>\r\n            </div>\r\n\r\n            <h2>Genes</h2>\r\n            <div className=\"panel\">\r\n                {geneInfo}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CreatureInspector;\r\n","import React from 'react';\r\nimport '../css/graph-viewer.css';\r\nimport '../css/graphs.css';\r\n\r\nconst GraphViewer = () => {\r\n   return (\r\n      <div id=\"graph-viewer\" className=\"menu hidden\">\r\n         <h1 className=\"heading\">View Graphs</h1>\r\n\r\n         <div className=\"formatter\">\r\n            <div className=\"options\">\r\n               <h2 className=\"subheading\">Graph Options</h2>\r\n               <p>Select which graphs should be shown.</p>\r\n\r\n               <div className=\"options-container\"></div>\r\n            </div>\r\n            <div className=\"settings\">\r\n               <h2 className=\"subheading\">Settings</h2>\r\n               <p>Control how the graphs look.</p>\r\n\r\n               <div className=\"settings-container\"></div>\r\n            </div>\r\n         </div>\r\n         <div className=\"graph-container\">\r\n            <p>Your graph will appear here once you choose an option.</p>\r\n         </div>\r\n      </div>\r\n   );\r\n}\r\n\r\nexport default GraphViewer;\r\n","const PauseScreen = () => {\r\n   return (\r\n      <div id=\"pause-screen\" className=\"hidden\">\r\n         <hgroup>\r\n            <h1>Paused!</h1>\r\n            <h2>Press <span>&lt;space&gt;</span> to unpause.</h2>\r\n         </hgroup>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default PauseScreen;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Titlescreen from './components/Titlescreen';\nimport Game from './Game';\nimport './css/index.css';\nimport './css/menus.css';\nimport './css/board.css';\nimport Board from './components/Board';\nimport ControlPanel from './components/ControlPanel';\nimport CreatureInspector from './components/CreatureInspector';\nimport { handleMouse, mouseClick } from './Mouse';\nimport GraphViewer from './components/GraphViewer';\nimport PauseScreen from './components/PauseScreen';\nimport StartMenu from './components/StartMenu';\nimport { getElem } from './utils';\nimport { setupGraphs } from './graph-viewer';\nimport { keyPress } from './keyboard';\nimport './css/pause-screen.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Titlescreen />\n    <ControlPanel />\n    <Board />\n    <CreatureInspector />\n    <GraphViewer />\n    <PauseScreen />\n    <StartMenu />\n    <div id=\"mask\" className=\"hidden\"></div>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\nexport function hideMask(): void {\n  getElem(\"mask\").classList.add(\"hidden\");\n}\n\nexport function showMask(): void {\n  getElem(\"mask\").classList.remove(\"hidden\");\n}\n\nconst setup = (): void => {\n  setupGraphs();\n\n  // Start the game loop\n  Game.runTick();\n};\n\nwindow.onload = setup;\n\ndocument.onmousemove = handleMouse;\ndocument.onclick = mouseClick;\ndocument.onkeydown = keyPress;"],"sourceRoot":""}