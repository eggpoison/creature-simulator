(this["webpackJsonpcreature-simulator"]=this["webpackJsonpcreature-simulator"]||[]).push([[0],Array(20).concat([function(e,t,i){var n={"./egg/egg-0.png":21,"./egg/egg-1.png":22,"./egg/egg-2.png":23,"./egg/egg-3.png":24,"./egg/egg-4.png":25,"./heart/heart-0.png":26,"./heart/heart-1.png":27,"./heart/heart-2.png":28,"./heart/heart-3.png":29,"./smoke/smoke-0.png":30,"./smoke/smoke-1.png":31,"./smoke/smoke-2.png":32,"./smoke/smoke-3.png":33,"./smoke/smoke-4.png":34};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=r,e.exports=a,a.id=20},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAEBJREFUKFOFT1sKACAIm/c/9MJyphTlh+heoqEXYzXBOQAguXizCe9WyXSGSAnpvgkOsoo84Stww/OEEvVi+3AAKPcaB3YCGM0AAAAASUVORK5CYII="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE1JREFUKFNtj0sSACAIQvHa7j03jRX2bdGU4EMN5+H8msr1AEBy6Ga9vK5drM5pEoHujoioQFHSUOhrnh71NaSQ88iQjQ9ljxBZKx4bNv3HHQfqLQCjAAAAAElFTkSuQmCC"},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE5JREFUKFNdj9EWACAEQ+e7PftuHTJRD53Y3Eawj1cpbPcDgLtfXSTb75piT5aJhBwlYVLC0GhVhZl1qvhqGSY+aDQU/QYkhUHXFt/KqR3dtSMH1GudvAAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFBJREFUKFNdT0kSACAIwnd71m/baGFZhyYhFgXzxBmFcD8ARMTmRQq+10u28nyiQ0npoKpw9232W38xlVPZqTKz7pBYdumIV0mSEezFFceGC34GKQfwUlcMAAAAAElFTkSuQmCC"},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFFJREFUKFNtT0EOACAI0m/rWb9ti6Jyq4MrIBCVfmo/lfC5iEhVLV4V8B0k3V0ioonogK90mMLMXGYfawh3DHKQPYF3B2In4iXNrEWwESu2hgOIACwH4GvOyAAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADxJREFUKFOFTlsKACAI2+5/6GLWYJGg+CF7SgxD8asWIMC8CzPQBckwC7IiU+S+tQfOKpOPwKIkP0H36AZOTA4J8eyzugAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADhJREFUKFNjZCAAGIlWcJiB4b8tAwMjjIZpBJsAEkQ3CaQYJAa3AlkRTBJFAcwkZEkMBdgcTNAXALJPCgmBiBW0AAAAAElFTkSuQmCC"},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACpJREFUKFNjZCAAGKmroJeB4X8xAwOKqXAOSBJmHbIiFNV4TcDlWIK+AADFugYJ3JGn6wAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGOmsIISB4f8aBgYUa+ngBgDt+AIJegq8GAAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADRJREFUKFNjZCAAGNHl/////5+RkREuDmagCyJrQjEBm0K4AmRJZDaGG2DGwxQRbwUu3wIAPA4cCXVv7EcAAAAASUVORK5CYII="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACxJREFUKFNjZCAAGIlW8P////+MjIwYGjAEYAphNIoCbKYQ7waYY9FNIWgCAPvjFAmHkFgYAAAAAElFTkSuQmCC"},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACZJREFUKFNjZCAAGKmr4P////9BJjIyMsJNJs8KkEkwU8gzAdlnAJGpCAmOYY4DAAAAAElFTkSuQmCC"},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACRJREFUKFNjZCAAGKmv4P////8ZGRnhJqNYgS4Jsp4GbkD3FQAlyAgJTFh8HgAAAABJRU5ErkJggg=="},function(e,t,i){"use strict";i.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGAdAwf////8zMjLCraaDGwDLqwQJfZ00UQAAAABJRU5ErkJggg=="},function(e,t,i){},,function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";i.r(t),i.d(t,"hideMask",(function(){return ft})),i.d(t,"showMask",(function(){return vt}));var n=i(1),a=i.n(n),r=i(11),s=i.n(r),o=i(2),c=i(4),l=i(5),h=i(10),u=i.n(h),d=i(12),f=i(9),v=i(8),m=i(3),p=function(){function e(t,i){Object(c.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=i}return Object(l.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lerp",value:function(t,i){return new e(j(this.x,t.x,i),j(this.y,t.y,i))}},{key:"distanceFrom",value:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}},{key:"angleBetween",value:function(e){return Math.atan2(e.y-this.y,e.x-this.x)}},{key:"convertToPolar",value:function(t){var i=t||new e(0,0),n=this.distanceFrom(i),a=this.angleBetween(i);return new g(n,a)}},{key:"randomOffset",value:function(e){var t=A(0,e),i=A(0,360),n=new g(t,i);return this.add(n.convertToCartesian())}},{key:"copy",value:function(){return new e(this.x,this.y)}}],[{key:"randomUnitVector",value:function(){var t=2*Math.random()*Math.PI;return new e(Math.cos(t),Math.sin(t))}}]),e}(),g=function(){function e(t,i){Object(c.a)(this,e),this.magnitude=void 0,this.direction=void 0,this.magnitude=t,this.direction=i}return Object(l.a)(e,[{key:"convertToCartesian",value:function(){var e=Math.cos(this.direction)*this.magnitude,t=Math.sin(this.direction)*this.magnitude;return new p(e,t)}}],[{key:"randomUnitVector",value:function(){return new e(1,A(0,360))}}]),e}();function b(e){var t=document.getElementById(e);if(!t)throw new Error("ungaming: tried to find element with an id of '".concat(e,"' but could not find any.'"));return t}function y(e,t,i){if(e>=t)throw new Error("Min of '".concat(e,"' is greater than max of '").concat(t,"'"));return Math.floor(Math.random()*(t-e+(i?1:0)))+e}function A(e,t){if(e>=t)throw new Error("Min of '".concat(e,"' is greater than max of '").concat(t,"'"));return Math.random()*(t-e)+e}function x(e){return e[y(0,e.length)]}function j(e,t,i){return(1-i)*e+i*t}function O(e,t){var i=Math.pow(10,t);return Math.round((e+Number.EPSILON)*i)/i}function w(e){var t=e.length,i=e.reduce((function(e,t){return e+t}))/t,n=e.map((function(e){return Math.pow(e-i,2)})).reduce((function(e,t){return e+t}))/t;return Math.sqrt(n)}var k=function(){function e(t){Object(c.a)(this,e),this._hex=void 0,this._rgb=void 0,"string"===typeof t?(this._hex=t.toLowerCase(),7===this._hex.length&&(this._hex=this._hex.substring(1,7)),this._rgb=this.getRGB()):(this._rgb=t,this._hex=e.getHex(this._rgb))}return Object(l.a)(e,[{key:"hex",get:function(){return"#"+this._hex}},{key:"rgb",get:function(){var e=Object(m.a)(this._rgb,3),t=e[0],i=e[1],n=e[2];return"rgb(".concat(t,", ").concat(i,", ").concat(n,")")}},{key:"getRGB",value:function(){for(var e="0123456789abcdef".split(""),t=[0,0,0],i=0;i<3;i++){var n=e.indexOf(this._hex[2*i]),a=e.indexOf(this._hex[2*i+1]);t[i]=16*n+a}return t}},{key:"darken",value:function(t){return new e(this._rgb.map((function(e){return Math.round(e*(1-t))})))}},{key:"desaturate",value:function(t){var i=this._rgb.slice(),n=.3086*i[0]+.6094*i[1]+.082*i[2];return i[0]=Math.round(j(i[0],n,t)),i[1]=Math.round(j(i[1],n,t)),i[2]=Math.round(j(i[2],n,t)),new e([i[0],i[1],i[2]])}}],[{key:"getHex",value:function(e){for(var t="0123456789abcdef".split(""),i="",n=0;n<3;n++){var a=e[n],r=a%16;i+=t[(a-r)/16]+t[r]}return i}},{key:"grayscale",value:function(t){var i=Math.floor(255*t);return e.getHex([i,i,i])}}]),e}();function S(e,t,i){return Math.max(Math.min(e,i),t)}var N=function(){function e(t,i){Object(c.a)(this,e),this.position=void 0,this.velocity=void 0,this.age=void 0,this.lifespan=void 0,this.element=void 0,this.position=t,this.velocity=new p(0,0),this.age=0;for(var n=0,a=Object.entries(i);n<a.length;n++){var r=Object(m.a)(a[n],2),s=r[0],o=r[1];this[s]=o}this.element=this.instantiate(),this.createEntity(),this.updatePosition(),Xe.board.createEntity(this)}return Object(l.a)(e,[{key:"createEntity",value:function(){var e,t;return b("board").appendChild(this.element),"number"===typeof this.size?(e=this.size,t=this.size):(e=this.size.x,t=this.size.y),this.element.style.width=e+"px",this.element.style.height=t+"px",this.element}},{key:"tick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.age+=e,this.age>=this.lifespan?this.die():(this.position=this.position.add(this.velocity),Xe.board.updateEntity(this),this.updatePosition())}},{key:"updatePosition",value:function(){this.element.style.left="".concat(this.position.x,"px"),this.element.style.top="".concat(this.position.y,"px")}},{key:"die",value:function(){Xe.board.deleteEntity(this),this.element.remove()}},{key:"isCollidingWithEntity",value:function(e){var t=this.position.distanceFrom(e.position);return"number"===typeof this.size?t-this.size/2<=0:"number"===typeof e.size?t-this.size.x/2-e.size/2<=0:t-this.size.x/2-e.size.x/2<=0}}],[{key:"count",value:function(e){for(var t=0,i=new Array,n=0;n<Xe.board.height;n++)for(var a=0;a<Xe.board.width;a++){var r,s=Xe.board.cells[n][a],c=Object(o.a)(s);try{for(c.s();!(r=c.n()).done;){var l=r.value;e.prototype.isPrototypeOf(l)&&!i.includes(l)&&(i.push(l),t++)}}catch(h){c.e(h)}finally{c.f()}}return t}}]),e}();function C(e){var t,i={lifespan:10*Xe.tps,size:8};t=e?Xe.board.randomPositionInCell(e):Xe.board.randomPosition();var n=Xe.board.getFruitColour(t);null!==n&&new z(t,i,n)}var M,T,z=function(e){Object(f.a)(i,e);var t=Object(v.a)(i);function i(e,n,a){var r;return Object(c.a)(this,i),(r=t.call(this,e,n)).element.style.backgroundColor=a,r}return Object(l.a)(i,[{key:"instantiate",value:function(){var e=document.createElement("div");return e.className="fruit",e}}]),i}(N),E=z,R=new Array,F=function(){function e(t,i,n,a,r,s){Object(c.a)(this,e),this.name=void 0,this.position=void 0,this.element=void 0,this.width=void 0,this.height=void 0,this.numFrames=void 0,this.frame=0,this.ticksPerFrame=void 0,this.name=t,this.width=a,this.height=r,this.numFrames=i,this.ticksPerFrame=n,this.position=s,this.init(),this.updateBackgroundImage(),R.push(this)}return Object(l.a)(e,[{key:"init",value:function(){this.element=document.createElement("div"),this.element.className="game-image",this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",b("board").appendChild(this.element),this.element.style.backgroundSize="".concat(this.width,"px ").concat(this.height,"px"),this.element.style.top=this.position.y+"px",this.element.style.left=this.position.x+"px"}},{key:"updateBackgroundImage",value:function(){var e=Math.floor(this.frame),t=i(20)("./".concat(this.name,"/").concat(this.name,"-").concat(e,".png")).default;this.element.style.backgroundImage="url(".concat(t,")")}},{key:"tick",value:function(){this.frame+=1/this.ticksPerFrame,this.frame>=this.numFrames?this.die():this.updateBackgroundImage()}},{key:"die",value:function(){this.element.remove(),R.splice(R.indexOf(this),1)}}]),e}(),L=!1,P=null;function I(){L=!1,P=null,M(null)}var V=i(7),U=i(6),D=function(e){Object(f.a)(i,e);var t=Object(v.a)(i);function i(e,n,a,r){var s;return Object(c.a)(this,i),(s=t.call(this,e,n)).generation=void 0,s.generation=r,s.creatureAttributes=a,s}return Object(l.a)(i,[{key:"instantiate",value:function(){var e=Math.floor(this.lifespan/5);return new F("egg",5,e,this.size,this.size,this.position).element}},{key:"tick",value:function(){Object(V.a)(Object(U.a)(i.prototype),"tick",this).call(this);var e=1.25*Math.sin(Xe.ticks*Xe.tps);this.element.style.transform="translate(-50%, -50%) rotate(".concat(e,"deg)")}},{key:"die",value:function(){Object(V.a)(Object(U.a)(i.prototype),"die",this).call(this),new H(this.position.copy(),this.creatureAttributes).stats.generation=this.generation}}]),i}(N),G={speed:{display:"speed",colour:"#eeff00",min:3,max:10,weight:1,positivelyAffectsLifespan:!1},size:{display:"size",colour:"#ff8f00",min:10,max:30,weight:1,positivelyAffectsLifespan:!0},vision:{display:"vision",colour:"#5400ff",min:25,max:75,weight:1,positivelyAffectsLifespan:!1},reproductiveRate:{display:"reproductive rate",colour:"#ff00e0",min:.5,max:2,weight:1}},B=function(e){for(var t=10*Xe.tps,i=0,n=Object.entries(G);i<n.length;i++){var a=n[i];if(a[1].positivelyAffectsLifespan){var r=e[a[0]];a[1].positivelyAffectsLifespan?t*=Math.pow(r/((a[1].min+a[1].max)/2),a[1].weight):t*=Math.pow((a[1].min+a[1].max)/2/r,a[1].weight)}}return t/=Math.pow(e.reproductiveRate,.7)},J=function(e){var t=G[e];return A(t.min,t.max)};function Y(){var e={size:J("size"),speed:J("speed"),vision:J("vision"),reproductiveRate:J("reproductiveRate"),lifespan:0};e.lifespan=B(e);var t=Xe.board.randomPosition();new q(t,e)}var K,Q=2e3,q=function(e){Object(f.a)(i,e);var t=Object(v.a)(i);function i(e,n){var a;return Object(c.a)(this,i),(a=t.call(this,e,n)).speed=void 0,a.moveSpeed=void 0,a.vision=void 0,a.reproductiveRate=void 0,a.name=void 0,a.birthTileType=void 0,a.birthTime=void 0,a.seed=y(-100,100,!0),a.isMoving=void 0,a.targetPosition=null,a.reproductiveUrge=0,a.partner=null,a.reproductionStage=0,a.lastReproductionTime=-2e3-Xe.settings.eggIncubationTime-4e3,a.stats={fruitEaten:0,generation:1},a.speed=n.speed,a.vision=n.vision,a.reproductiveRate=n.reproductiveRate,a.birthTileType=Xe.board.getTileType(e),a.birthTime=Xe.ticks,a.isMoving=!1,a.moveSpeed=a.calculateMoveSpeed(),a.name=a.getName(),a}return Object(l.a)(i,[{key:"getName",value:function(){for(var e=["Amoeba"],t=[],i=["Feeble","Crippled","Schizophrenic","Weak"].slice();0!==i.length&&Math.random()<=.5;){var n=y(0,i.length);t.push(i[n]),i.splice(n,1)}var a=t.reduce((function(e,i,n){var a=e;return n>0&&t.length-n>1?a+=", ":t.length>1&&t.length-n===1&&(a+=" and "),a+i}),""),r=Math.random()<=.3,s=x(["Glorb","James","Obama","Gnark","Norbert"]);return r&&t.length>0?s+=" the "+a+" "+x(e):t.length>0?s+=" the "+a:r&&(s+=" the "+x(e)),s}},{key:"calculateMoveSpeed",value:function(){var e=G.size.max/G.size.min/3;return this.speed/Math.pow(this.size/G.size.min/e,1.1)}},{key:"instantiate",value:function(){var e=document.createElement("div");if(e.className="creature","regular"===Xe.settings.creatureColour)e.style.backgroundColor="green";else if("gene-based"===Xe.settings.creatureColour){var t=255*(this.speed-G.speed.min)/(G.speed.max/G.speed.min),i=255*(this.size-G.size.min)/(G.size.max/G.size.min),n=255*(this.reproductiveRate-G.reproductiveRate.min)/(G.reproductiveRate.max/G.reproductiveRate.min);e.style.backgroundColor="rgb(".concat(t,", ").concat(i,", ").concat(n,")")}else if("rgb"===Xe.settings.creatureColour){e.classList.add("rgb");var a=y(0,2e3,!0);e.style.animationDelay=a+"ms"}return e.innerHTML='\n      <div class="shadow"></div>\n\n      <div class="life">\n         <div class="life-bar"></div>\n\n         </div>\n      <div class="reproduction">\n         <div class="reproduction-bar"></div>\n      </div>\n      ',e.style.setProperty("--vision-size","".concat(this.vision,"px")),e.style.setProperty("--creature-size","".concat(this.size,"px")),e}},{key:"life",get:function(){return(this.lifespan-this.age)/this.lifespan*100}},{key:"updateLifebar",value:function(){var e=this.element.querySelector(".life-bar");e.style.width="".concat(this.life,"%");var t=155+this.life;e.style.backgroundColor="rgb(".concat(t,", 0, 0)")}},{key:"updateReproductionBar",value:function(){this.element.querySelector(".reproduction-bar").style.width="".concat(this.reproductiveUrge,"%")}},{key:"wantsToReproduce",get:function(){return this.reproductiveUrge>this.life&&this.reproductionStage<2}},{key:"tick",value:function(){var e,t=Xe.board.getTileType(this.position),n=1;if((null===(e=t.effects)||void 0===e?void 0:e.metabolismMultiplier)&&(n*=t.effects.metabolismMultiplier),Object(V.a)(Object(U.a)(i.prototype),"tick",this).call(this,n),0===this.reproductionStage&&1e3*(Xe.ticks-this.lastReproductionTime)/Xe.tps>Q+Xe.settings.eggIncubationTime+4e3){this.element.classList.remove("abstaining");this.reproductiveUrge+=2*this.reproductiveRate/Xe.tps,this.reproductiveUrge=Math.min(100,this.reproductiveUrge)}else this.reproductionStage>=2&&(this.age-=1);switch(this.updateLifebar(),this.updateReproductionBar(),null!==this.targetPosition&&(this.hasReachedTargetPosition()?this.reachTargetPosition():this.moveToTargetPosition(t)),this.reproductionStage){case 1:if(Math.random()<=3/Xe.tps){var a=this.position.randomOffset(30);new F("heart",4,2,16,16,a)}break;case 2:if(Math.random()<=3/Xe.tps)for(var r=y(4,11),s=0;s<r;s++)if(Math.random()<=.7){var c=this.position.randomOffset(40),l=y(12,24);new F("heart",4,3,l,l,c)}if(Math.random()<6/Xe.tps){var h=this.position.randomOffset(20),u=y(12,18);new F("heart",4,3,u,u,h)}}for(var d=Xe.board.getNearby(this.position,this.vision);;){var f=d.indexOf(this);if(-1===f)break;d.splice(f,1)}var v,m=null,p=Number.MAX_SAFE_INTEGER,g=null,b=Number.MAX_SAFE_INTEGER,A=Object(o.a)(d);try{for(A.s();!(v=A.n()).done;){var x=v.value,j=x instanceof E;if(x instanceof i&&this.wantsToReproduce&&x.wantsToReproduce&&(null===x.partner||x.partner===this)){var O=this.position.distanceFrom(x.position);O<b&&(g=x,b=O)}else if(j){if(!(Xe.board.getTileType(x.position)!==this.birthTileType&&Math.random()>=Xe.settings.tilePreference)){var w=this.position.distanceFrom(x.position);w<p&&(m=x,p=w)}}Object(V.a)(Object(U.a)(i.prototype),"isCollidingWithEntity",this).call(this,x)&&(x===this.partner&&this.wantsToReproduce?this.handleReproduction():j&&this.eatFruit(x))}}catch(S){A.e(S)}finally{A.f()}if(null!==g&&this.reproductionStage<2)return this.targetPosition=g.position,this.partner=g,void(this.reproductionStage=1);if(1===this.reproductionStage)this.reproductionStage=0;else if(this.reproductionStage>=2)return;if(null===m){if(!this.isMoving){if(Math.random()<.95/Xe.tps){var k=Xe.board.randomNearbyPosition(this.position,this.vision,this.birthTileType);this.targetPosition=k}}}else this.targetPosition=m.position}},{key:"eatFruit",value:function(e){this.stats.fruitEaten++;this.age-=10*Xe.tps,this.age=Math.max(this.age,0),e.die()}},{key:"damage",value:function(e){this.age+=e}},{key:"moveToTargetPosition",value:function(e){var t;this.isMoving=!0,this===P&&function(e,t){var i=e.distanceFrom(t),n=e.angleBetween(t),a=document.createElement("div");b("board").appendChild(a),a.className="ray",a.style.transform="rotate(".concat(n,"rad)"),a.style.width=i+"px",a.style.left=e.x+"px",a.style.top=e.y+"px"}(this.position,this.targetPosition);var i=this.moveSpeed;(null===(t=e.effects)||void 0===t?void 0:t.speedMultiplier)&&(i*=e.effects.speedMultiplier);var n=this.position.angleBetween(this.targetPosition),a=new g(i,n);this.velocity=a.convertToCartesian()}},{key:"hasReachedTargetPosition",value:function(){var e=new p(this.position.x-this.targetPosition.x,this.position.y-this.targetPosition.y);return this.velocity.dot(e)>0}},{key:"reachTargetPosition",value:function(){this.isMoving=!1,this.velocity=new p(0,0),this.targetPosition=null}},{key:"handleReproduction",value:function(){var e=this;this.reproduce().then((function(){return e.layEgg()}))}},{key:"reproduce",value:function(){var e=this;return new Promise((function(t){e.reproductionStage=2,e.targetPosition=null,e.velocity=new p(0,0),e.isMoving=!1,e.reproductiveUrge=0,e.element.classList.add("abstaining"),e.lastReproductionTime=Xe.ticks,setTimeout((function(){t()}),Q)}))}},{key:"layEgg",value:function(){var e=this;return new Promise((function(t){if(e.reproductionStage=0,0!==e.partner.reproductionStage){var i=e.generateChildGenes(e.partner),n={size:20,lifespan:Xe.settings.eggIncubationTime*Xe.tps},a=e.position.randomOffset(10);new D(a,n,i,e.stats.generation+1)}e.partner=null,setTimeout((function(){t()}),1e3*Xe.settings.eggIncubationTime)}))}},{key:"generateChildGenes",value:function(e){for(var t={},i=0,n=Object.keys(G);i<n.length;i++){var a=n[i],r=Math.random()<=.5?this[a]:e[a];t[a]=r,Math.random()<=.3&&(r=this.mutateGene(a,r))}return t.lifespan=B(t),t}},{key:"mutateGene",value:function(e,t){var i=G[e],n=(i.min+i.max)/300;return n*=A(.1,1)*Xe.settings.creatureMutationRate,n*=Math.sign(Math.random()-.5),t+(n*=Xe.settings.creatureMutationRate)}},{key:"die",value:function(){this===P&&I(),Object(V.a)(Object(U.a)(i.prototype),"die",this).call(this)}}]),i}(N),H=q,X=(i(35),i(0)),_=function(e){var t=e.name,i=e.text,a=e.defaultValue,r=e.func,s=Object(n.useRef)(null),o=Object(n.useState)(a),c=Object(m.a)(o,2),l=c[0],h=c[1],u="_INPUT_"+t,d="input-checkbox ".concat(l?"selected":"");return Object(X.jsxs)("div",{className:d,children:[Object(X.jsx)("input",{ref:s,onChange:function(){var e=!!Number(s.current.checked);r&&r(e,s.current),h(e)},type:"checkbox",id:u,defaultChecked:a}),Object(X.jsx)("label",{htmlFor:u,children:i})]})},W=function(e){var t=e.text,i=e.min,a=e.max,r=e.defaultValue,s=e.step,o=e.func,c=e.button,l=e.hasExtremeMode,h=e.prefix,u=e.description,d=Object(n.useRef)(null),f=Object(n.useState)(r),v=Object(m.a)(f,2),p=v[0],g=v[1],b="input-range  ".concat(!!l&&p>=a?"extreme":"");return Object(X.jsxs)("div",{className:b,children:[Object(X.jsxs)("div",{className:"formatter",children:[Object(X.jsx)("div",{className:"text",children:t}),Object(X.jsxs)("div",{children:[Object(X.jsxs)("div",{className:"value",children:[p,h]}),Object(X.jsxs)("div",{className:"bar-container",children:[Object(X.jsx)("div",{className:"min",children:i}),Object(X.jsx)("input",{ref:d,onInput:function(){var e=Number(d.current.value);o&&void 0===c&&o(e),g(e)},type:"range",min:i,max:a,step:s,defaultValue:r}),Object(X.jsx)("div",{className:"max",children:a})]})]})]}),u?Object(X.jsx)("div",{className:"description",children:u}):"",c?Object(X.jsx)("button",{onClick:function(){o&&o(p)},children:c}):""]})},Z=function(e){for(var t=0;t<e;t++)Y()},$=function(e){for(var t=0;t<e;t++)C()},ee=function(e){Xe.timewarp=e},te=function(){b("control-panel").classList.remove("hidden"),b("expand-icon").classList.add("hidden")},ie=function(){b("control-panel").classList.add("hidden"),b("expand-icon").classList.remove("hidden")},ne=function(){for(var e=0,t=0,i=0;i<Xe.boardSize.height;i++)for(var n=0;n<Xe.boardSize.width;n++){var a,r=Xe.board.cells[i][n],s=Object(o.a)(r);try{for(s.s();!(a=s.n()).done;){var c=a.value;c instanceof H?e++%2===0&&c.die():c instanceof E&&t++%2===0&&c.die()}}catch(l){s.e(l)}finally{s.f()}}document.body.classList.remove("flash"),setTimeout((function(){document.body.classList.add("flash")}),5)},ae=function(){var e=a.a.useState({}),t=Object(m.a)(e,2)[1],i=a.a.useCallback((function(){return t({})}),[]);return Object(n.useEffect)((function(){K=i}),[i]),Object(X.jsxs)(X.Fragment,{children:[Object(X.jsxs)("div",{id:"expand-icon",className:"hidden",onClick:te,children:[Object(X.jsxs)("div",{className:"formatter",children:[Object(X.jsx)("div",{className:"vertical-bar"}),Object(X.jsx)("div",{className:"horizontal-bar"})]}),Object(X.jsx)("div",{className:"text",children:"Control Panel"})]}),Object(X.jsxs)("div",{id:"control-panel",className:"menu",children:[Object(X.jsx)("div",{className:"collapse-icon",onClick:ie,children:Object(X.jsx)("div",{className:"horizontal-bar"})}),Object(X.jsx)("h1",{className:"heading",children:"Control Panel"}),Object(X.jsx)("h2",{className:"subheading",children:"Settings"}),Object(X.jsx)(_,{name:"dark-mode",text:"Dark Mode",defaultValue:!0,func:function(e){return function(e){e?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")}(e)}}),Object(X.jsx)(_,{name:"show-debug-output",text:"Show Debug Output",defaultValue:!1,func:function(e){return function(e){Xe.settings.showDebugOutput=e}(e)}}),Xe.hasStarted?Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)("button",{id:"open-graph-viewer-button",children:"View Graphs"}),Object(X.jsx)("h2",{className:"subheading",children:"Overview"}),Object(X.jsxs)("p",{children:["Creatures: ",N.count(H)]}),Object(X.jsxs)("p",{children:["Fruit: ",N.count(E)]}),Object(X.jsxs)("p",{children:["Time elapsed: ",O(Xe.ticks/20,1)," seconds ",Object(X.jsxs)("i",{children:["(",Xe.ticks," ticks)"]})]}),Object(X.jsx)("h2",{className:"subheading",children:"Population Control"}),Object(X.jsx)(W,{button:"Create",text:"Create creatures",min:1,max:10,defaultValue:1,step:1,func:Z}),Object(X.jsx)(W,{button:"Create",text:"Create fruit",min:5,max:100,defaultValue:5,step:5,func:$}),Object(X.jsx)("button",{onClick:ne,children:"Snap"}),Object(X.jsx)("h2",{className:"subheading",children:"World"}),Object(X.jsx)(W,{text:"Timewarp",min:1,max:10,defaultValue:1,step:1,func:ee,hasExtremeMode:!0})]}):""]})]})},re=function(){function e(t,i,n,a,r){Object(c.a)(this,e),this.data=void 0,this.element=void 0,this.width=void 0,this.height=void 0,this.time=Xe.ticks,this.settings=void 0,this.options=void 0,this.minY=void 0,this.maxY=void 0,this.xAxisMeasurements=10,this.timeUnit=this.calculateTimeUnit(this.time),this.width=t,this.height=i,this.data=n,this.settings=a,this.options=r,this.minY=this.calculateMinY(),this.maxY=this.calculateMaxY(),this.element=this.instantiate(),this.createTitle(),this.plotData(),this.createAxes(),this.createLabels()}return Object(l.a)(e,[{key:"instantiate",value:function(){var e=document.createElement("div");return e.className="graph",e.style.width=this.width+"px",e.style.height=this.height+"px",e}},{key:"calculateMinY",value:function(){return this.options.min?this.options.min:0}},{key:"calculateMaxY",value:function(){if(this.options.max)return this.options.max;var e=0;if("simple"===this.options.type){var t,i=Object(o.a)(this.data);try{for(i.s();!(t=i.n()).done;){var n=t.value;null!==n&&n>e&&(e=n)}}catch(c){i.e(c)}finally{i.f()}}else if("detailed"===this.options.type){var a,r=Object(o.a)(this.data);try{for(r.s();!(a=r.n()).done;){var s=a.value;null!==s&&s.max>e&&(e=s.max)}}catch(c){r.e(c)}finally{r.f()}}return e}},{key:"calculateTimeUnit",value:function(e){return e/20/this.xAxisMeasurements>60?"minutes":"seconds"}},{key:"drawPoint",value:function(e,t){if(this.settings.shouldShowPoints){var i=document.createElement("div");i.className="point",i.style.backgroundColor=t,this.element.appendChild(i),i.style.left=e.x+"px",i.style.bottom=e.y+"px"}}},{key:"drawLine",value:function(e,t,i){if(this.settings.shouldShowLines){var n=document.createElement("div");n.className="line",this.element.appendChild(n),n.style.left=e.x+"px",n.style.bottom=e.y+"px",n.style.backgroundColor=i;var a=e.distanceFrom(t),r=-e.angleBetween(t);n.style.width=a+"px",n.style.transform="rotate(".concat(r,"rad)")}}},{key:"drawRect",value:function(e,t,i,n){var a=document.createElement("div");a.className="rect",this.element.appendChild(a),a.style.width=t+"px",a.style.height=i+"px",a.style.backgroundColor=n,a.style.left=e.x+"px",a.style.bottom=e.y+"px"}},{key:"drawTrangle",value:function(e,t,i,n,a){var r=document.createElement("div");r.className="triangle ".concat(a),this.element.appendChild(r),r.style.setProperty("--width",i/2+"px"),r.style.setProperty("--height",t/2+"px"),r.style.setProperty("--colour",n),r.style.left=e.x+"px",r.style.bottom=e.y+"px"}},{key:"getData",value:function(){var e;if(!this.settings.shouldExtrapolate||this.data.length<=75)return this.data;("simple"===this.options.type||"detailed"===this.options.type)&&(e=new Array);for(var t=0;t<75;t++){var i=this.data.length*t/75;if("simple"===this.options.type){var n=void 0,a=i%1;if(0===a)n=this.data[i];else{var r=this.data[Math.floor(i)],s=this.data[Math.ceil(i)];n=null===r&&null===s?null:null===r&&null!==s?s:null!==r&&null===s?r:j(r,s,a)}e.push(n)}else if("detailed"===this.options.type){var o=void 0,c=i%1;if(0===c)o=this.data[i];else{var l=this.data[Math.floor(i)],h=this.data[Math.ceil(i)];o=null===l&&null===h?null:null===l&&null!==h?h:null!==l&&null===h?l:{average:j(l.average,h.average,c),min:j(l.min,h.min,c),max:j(l.max,h.max,c),standardDeviation:j(l.standardDeviation,h.standardDeviation,c)}}e.push(o)}}return e}},{key:"plotData",value:function(){var e=this.getData();"simple"===this.options.type?this.plotSimpleData(e):"detailed"===this.options.type&&this.plotDetailedData(e)}},{key:"plotSimpleData",value:function(e){for(var t=null,i=0;i<e.length;i++){var n=e[i];if(null!==n){var a=this.width/(e.length-1),r=new p(a*i,this.height*(n-this.minY)/(this.maxY-this.minY));this.drawPoint(r,this.options.colour),i>0&&null!==t&&this.drawLine(t,r,this.options.colour),t=r}else t=null}}},{key:"draw",value:function(e,t,i,n,a,r){var s=new p(t*i,this.height*(n-this.minY)/(this.maxY-this.minY));return r&&this.drawPoint(s,e),i>0&&null!==a&&this.drawLine(a,s,e),s}},{key:"plotDetailedData",value:function(e){var t=new k(this.options.colour),i=t.desaturate(.3);i=i.darken(.2);var n=t.desaturate(.7);n=n.darken(.2);for(var a=e.length,r=null,s=null,o=null,c=null,l=null,h=0;h<a;h++){var u=e[h];if(null!==u){var d=this.width/(a-1);r=this.draw(this.options.colour,d,h,u.average,r,!0),s=this.draw(n.hex,d,h,u.min,s,!1),o=this.draw(n.hex,d,h,u.max,o,!1);var f=this.draw(i.hex,d,h,u.average-u.standardDeviation,c,!1),v=this.draw(i.hex,d,h,u.average+u.standardDeviation,l,!1);if(h>0&&null!==f&&null!==v&&null!==c&&null!==l){var m=f.x-c.x,g=Math.min(l.y,v.y)-Math.max(c.y,f.y),b=new p(c.x,Math.max(c.y,f.y));this.drawRect(b,m,g,i.hex);var y=new p(l.x,Math.min(v.y,l.y));l.y>v.y?this.drawTrangle(y,m,l.y-v.y,i.hex,"bottom-left"):this.drawTrangle(y,m,v.y-l.y,i.hex,"bottom-right");var A=new p(l.x,Math.min(f.y,c.y));c.y>f.y?this.drawTrangle(A,m,c.y-f.y,i.hex,"top-right"):this.drawTrangle(A,m,f.y-c.y,i.hex,"top-left")}l=v,c=f}}}},{key:"createAxisMeasurement",value:function(e){var t=document.createElement("div");t.className="measurement",this.element.appendChild(t);return t.innerHTML=O(e,1).toString(),t}},{key:"createAxes",value:function(){for(var e=0;e<this.xAxisMeasurements;e++){var t=this.time/this.xAxisMeasurements*e/Xe.tps;"minutes"===this.timeUnit&&(t/=60);var i=this.createAxisMeasurement(t);i.classList.add("x"),i.style.left=this.width/this.xAxisMeasurements*e*(this.xAxisMeasurements+1)/this.xAxisMeasurements+"px"}for(var n=0;n<7;n++){var a=this.minY+n*(this.maxY-this.minY)/6,r=this.createAxisMeasurement(a);r.classList.add("y"),r.style.bottom=this.height/6*n+"px"}}},{key:"createLabels",value:function(){var e=document.createElement("div");e.className="label x-label",this.element.appendChild(e),"seconds"===this.timeUnit?e.innerHTML="Seconds":"minutes"===this.timeUnit&&(e.innerHTML="Minutes");var t=document.createElement("div");t.className="label y-label",this.element.appendChild(t);var i=this.options.dependentVariable;t.innerHTML=i}},{key:"createTitle",value:function(){var e=document.createElement("div");e.className="title",this.element.appendChild(e);var t="".concat(this.options.dependentVariable," over time");e.innerHTML=t}}]),e}(),se=!1,oe=[{text:"Extrapolate values",type:"checkbox",description:"Reduces the amount of nodes rendered, will significantly reduce lag in extreme scenarios.",defaultValue:!1},{text:"Automatically update",type:"checkbox",defaultValue:!0},{text:"Show points",type:"checkbox",defaultValue:!0},{text:"Show lines",type:"checkbox",defaultValue:!0}],ce=[{display:"Number of creatures",id:"creatures",colour:"#26ff1f",dependentVariable:"Creatures",type:"simple"},{display:"Number of fruit",id:"fruit",colour:"#19c6ff",dependentVariable:"Fruit",type:"simple"},{display:"Fruit multiplier",id:"fruitMultiplier",colour:"#31ff2e",dependentVariable:"Multiplier",type:"simple"}],le=new Array;function he(){!function(){for(var e=0,t=Object.entries(G);e<t.length;e++){var i=Object(m.a)(t[e],2),n=i[0],a=i[1];ce.push({display:"Creature ".concat(a.display),id:n,colour:a.colour,dependentVariable:a.display,min:a.min,max:a.max,type:"detailed"})}}(),function(){var e=b("graph-viewer").querySelector(".settings-container"),t=oe.map((function(e,t){var i,n=function(){var t,i=Object(o.a)(oe);try{for(i.s();!(t=i.n()).done;)t.value.requirement,e.text}catch(n){i.e(n)}finally{i.f()}ue()},a="graph-setting-".concat(t);switch(e.type){case"checkbox":i=Object(X.jsx)(_,{name:a,text:e.text,defaultValue:e.defaultValue,func:function(t){e.isChecked=t,n()}},t);break;case"range":i=Object(X.jsx)(W,{text:e.text,defaultValue:e.defaultValue,min:e.min,max:e.max,step:e.step,func:function(t){e.value=t,n()}},t)}return e.elem=i,i}));s.a.render(t,e)}(),function(){var e,t=Object(o.a)(oe);try{for(t.s();!(e=t.n()).done;){var i=e.value;"checkbox"===i.type&&(i.isChecked=i.defaultValue)}}catch(n){t.e(n)}finally{t.f()}}();var e=b("graph-viewer").querySelector(".options-container"),t=Object(X.jsx)(X.Fragment,{children:ce.map((function(e,t){return Object(X.jsx)(_,{name:e.id,text:e.display,defaultValue:!1,func:function(i){if(e.isSelected=i,i){for(var n=!1,a=0;a<le.length;a++){if(ce.indexOf(le[a])>t){le.splice(a,0,e),n=!0;break}}n||le.push(e)}else{var r=le.indexOf(e);le.splice(r,1)}ue()}},t)}))});s.a.render(t,e)}function ue(){var e=b("graph-viewer").querySelector(".graph-container");if(0!==le.length){e.innerHTML="";var t,i={shouldExtrapolate:oe[0].isChecked,shouldShowPoints:oe[2].isChecked,shouldShowLines:oe[3].isChecked},n=Object(o.a)(le);try{var a=function(){var n=t.value,a=void 0;"simple"===n.type?a=Ke.map((function(e){return e[n.id]})):"detailed"===n.type&&(a=Ke.map((function(e){return null!==e.genePool?e.genePool[n.id]:null})));var r=new re(350,210,a,i,n);e.appendChild(r.element)};for(n.s();!(t=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}}else e.innerHTML="<p>Your graph will appear here once you choose an option.</p>"}var de=function(){return!b("board").classList.contains("hidden")};function fe(){var e=b("board");e.style.top="calc(50% + ".concat(Xe.transform.translate.y,"%)"),e.style.left="calc(50% + ".concat(Xe.transform.translate.x,"%)"),e.style.transform="translate(-50%, -50%) scale(".concat(Xe.transform.zoom,", ").concat(Xe.transform.zoom,")")}var ve=function(e){if(de()){var t=Xe.transform.translate;switch(e){case"up":t.y+=5;break;case"right":t.x-=5;break;case"down":t.y-=5;break;case"left":t.x+=5}fe()}},me=function(e){if(de()){switch(e){case"in":Xe.transform.zoom*=1.15;break;case"out":Xe.transform.zoom/=1.15}fe()}};var pe=function(e,t,i,n,a,r){var s=j(e,t,a),o=j(i,n,a);return j(s,o,r)},ge=function(e){return e*e*e*(e*(6*e-15)+10)};function be(e,t,i){for(var n=new Array,a=0;a<=t/i+1;a++){for(var r=new Array,s=0;s<=e/i+1;s++)r.push(g.randomUnitVector());n.push(r)}for(var o=new Array,c=0;c<t;c++){for(var l=new Array,h=0;h<e;h++){for(var u=h/i,d=c/i,f=new p(u,d),v=Math.floor(u),m=v+1,b=Math.floor(d),y=b+1,A=[[b,v],[b,m],[y,v],[y,m]],x=new Array,j=0;j<4;j++){var O=A[j],w=n[O[0]][O[1]],k=new p(O[1],O[0]),S=f.convertToPolar(k),N=w.convertToCartesian().dot(S.convertToCartesian());x.push(N)}var C=ge(u%1),M=ge(d%1),T=pe(x[0],x[1],x[2],x[3],C,M);T=Math.min(Math.max(T,-.5),.5),l.push(T+.5)}o.push(l)}return o}function ye(e,t,i,n,a,r){for(var s=new Array,c=0;c<n;c++){var l=1/Math.pow(a,c)*i,h=Math.pow(r,c),u=be(e,t,l);if(0===c)s=u;else for(var d=0;d<t;d++)for(var f=0;f<e;f++)s[d][f]+=u[d][f]*h}var v,m=1,p=Object(o.a)(s);try{for(p.s();!(v=p.n()).done;){var g,b=v.value,y=Object(o.a)(b);try{for(y.s();!(g=y.n()).done;){var A=g.value;A>m&&(m=A)}}catch(O){y.e(O)}finally{y.f()}}}catch(O){p.e(O)}finally{p.f()}if(m>1)for(var x=0;x<t;x++)for(var j=0;j<e;j++)s[x][j]/=m;return s}var Ae,xe={presets:[{name:"Countryside",noise:["height"],terrainLayers:[{height:1,type:"grass"}]},{name:"Biomes",noise:["height","temperature"],terrainLayers:[{height:.2,type:"bog"},{height:[.8,1],type:"mountain"},{temperature:.3,type:"tundra"},{temperature:.7,type:"grass"},{temperature:1,type:"desert"}]},{name:"Archipelago",noise:["height","temperature"],terrainLayers:[{height:.1,type:"deepWater"},{height:.3,type:"water"},{temperature:.3,type:"tundra"},{temperature:.7,type:"grass"},{temperature:1,type:"desert"}]},{name:"Hell",noise:["height"],terrainLayers:[{height:.35,type:"lava"},{height:.8,type:"magma"},{height:1,type:"mountain"}]},{name:"Russia",noise:["height"],terrainLayers:[{height:.1,type:"deepWater"},{height:.3,type:"water"},{height:.7,type:"tundra"},{height:1,type:"mountain"}]},{name:"Swamp",noise:["height"],terrainLayers:[{height:.3,type:"deepWater"},{height:.4,type:"water"},{height:1,type:"bog"}]},{name:"Vomit",noise:["height"],terrainLayers:[{height:.2,type:"grass"},{height:.3,type:"tundra"},{height:.4,type:"mountain"},{height:.5,type:"desert"},{height:.6,type:"magma"},{height:.7,type:"bog"},{height:.8,type:"water"},{height:.9,type:"deepWater"},{height:1,type:"lava"}]}],tiles:{grass:{name:"Grass",colour:["#23ee2d"],fruitColour:["#009124"],isLiquid:!1},tundra:{name:"Tundra",colour:["#b8c6db"],fruitColour:["#0066ff"],isLiquid:!1,effects:{speedMultiplier:.7,metabolismMultiplier:.6}},mountain:{name:"Mountain",colour:["#fff"],fruitColour:["#cf13bf"],isLiquid:!1},desert:{name:"Desert",colour:["yellow"],fruitColour:["#666"],isLiquid:!1,effects:{speedMultiplier:1.4,metabolismMultiplier:1.3}},magma:{name:"Magma",colour:["orange"],fruitColour:["red"],isLiquid:!1},bog:{name:"Bog",colour:["#46911a","#509121","#457819"],fruitColour:["#2d3d20","#000"],isLiquid:!1,effects:{speedMultiplier:.4,metabolismMultiplier:.3}},water:{name:"Water",colour:["blue"],isLiquid:!0},deepWater:{name:"Deep water",colour:["darkblue"],isLiquid:!0},lava:{name:"Lava",colour:["red"],isLiquid:!0,thumbnailFunc:function(e,t,i,n){if(null!==e.offsetParent&&e.classList.contains("lava")){var a=e.getBoundingClientRect(),r=a.x,s=a.y,o=function(){var e=y(10,20,!0),n=r+e/2+A(0,t-e/2),a=s+e/2+A(0,i-e/2),o=new p(n,a),c=new F("smoke",5,3,e,e,o).element;c.style.zIndex="4",document.body.appendChild(c);var l=A(.6,1);c.style.filter="brightness(".concat(l,")")};if(Math.random()<.05)for(var c=y(1,5,!0),l=0;l<c;l++)o();else Math.random()<.2&&o()}else Xe.removeRenderListener(n)},tickFunc:function(e,t){var i=function(i,n){var a=new p(e*Xe.cellSize+A(0,Xe.cellSize),t*Xe.cellSize+A(0,Xe.cellSize));new F("smoke",5,2,i,i,a).element.style.filter="brightness(".concat(n,")")};if(i(y(16,25,!0),A(.5,1)),Math.random()<.02)for(var n=y(3,5),a=0;a<n;a++){i(y(25,40,!0),1)}},walkFunc:function(e){if((Xe.ticks+e.seed)%Xe.tps===0){e.damage(e.lifespan/10);for(var t=y(2,5,!0),i=0;i<t;i++){var n=y(20,35,!0),a=e.position.randomOffset(30),r=y(3,5,!0),s=new F("smoke",5,r,n,n,a),o=y(5,10,!0)/10;s.element.style.filter="brightness(".concat(o,")")}}}}}},je=function(){function e(t,i,n){Object(c.a)(this,e),this.width=void 0,this.height=void 0,this.tileSize=void 0,this.canvas=void 0,this.tiles=void 0,this.width=t,this.height=i,this.tileSize=n,this.canvas=this.instantiate()}return Object(l.a)(e,[{key:"instantiate",value:function(){var e=document.createElement("canvas");return e.setAttribute("width",this.width*this.tileSize+"px"),e.setAttribute("height",this.height*this.tileSize+"px"),b("board-preview-container").appendChild(e),e}},{key:"changeSize",value:function(e,t,i){this.width=e,this.height=t,i&&(this.canvas.setAttribute("width",this.width*this.tileSize+"px"),this.canvas.setAttribute("height",this.height*this.tileSize+"px"))}},{key:"getTiles",value:function(){return this.tiles}},{key:"getTileType",value:function(e,t,i){var n,a=function(e,t,i){if("number"===typeof i[e]){if(t>i[e])return!1}else if(Array.isArray(i[e])){var n=i[e];if(t<n[0]||t>n[1])return!1}return!0},r=Object(o.a)(e.terrainLayers);try{for(r.s();!(n=r.n()).done;){var s=n.value,c=null===t||a("height",t,s),l=null===i||a("temperature",i,s);if(c&&l)return xe.tiles[s.type]}}catch(h){r.e(h)}finally{r.f()}throw console.log("No tile type found, showing info"),console.log("Height:",t,"Temperature:",i),console.log("Terrain layers:",e.terrainLayers),new Error("Unable to find an appropriate tile type!")}},{key:"generateNoise",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;this.tiles=new Array;for(var s=0;s<this.height;s++)this.tiles[s]=new Array(this.width);var c,l={},h=Object(o.a)(e.noise);try{for(h.s();!(c=h.n()).done;){var u=c.value;"height"===u?l.height=ye(this.width,this.height,t,n,a,r):"temperature"===u&&(l.temperature=ye(this.width,this.height,t,n,a,r))}}catch(k){h.e(k)}finally{h.f()}if(i){this.clearCanvas();for(var d=this.canvas.getContext("2d"),f=0;f<this.height;f++)for(var v=0;v<this.width;v++){var m=l.height?l.height[f][v]:null,p=l.temperature?l.temperature[f][v]:null,g=this.getTileType(e,m,p);this.tiles[f][v]=g;var b=x(g.colour);d.beginPath(),d.fillStyle=b,d.rect(v*this.tileSize,f*this.tileSize,this.tileSize,this.tileSize),d.fill()}this.drawGridLines()}else for(var y=0;y<this.height;y++)for(var A=0;A<this.width;A++){var j=l.height?l.height[y][A]+.5:null,O=l.temperature?l.temperature[y][A]+.5:null,w=this.getTileType(e,j,O);this.tiles[y][A]=w}}},{key:"generateTestOctaveNoise",value:function(e,t,i,n){var a=ye(this.width,this.height,e,t,i,n);this.drawTestNoise(a)}},{key:"generateTestNoise",value:function(e){var t=be(this.width,this.height,e);this.drawTestNoise(t)}},{key:"drawTestNoise",value:function(e){this.clearCanvas();for(var t=this.canvas.getContext("2d"),i=0;i<this.height;i++)for(var n=0;n<this.width;n++){var a=e[i][n];t.beginPath();var r="#"+k.grayscale(a);t.fillStyle=r,t.rect(n*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize),t.fill()}}},{key:"drawGridLines",value:function(){for(var e=this.canvas.getContext("2d"),t=1;t<this.height;t++)e.moveTo(0,t*this.tileSize),e.lineTo(this.width*this.tileSize,t*this.tileSize);for(var i=1;i<this.width;i++)e.moveTo(i*this.tileSize,0),e.lineTo(i*this.tileSize,this.height*this.tileSize);e.strokeStyle="#000",e.stroke()}},{key:"clearCanvas",value:function(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}(),Oe=function(e){var t=e.options,i=e.name,a=e.text,r=e.defaultValue,s=e.func,o=Object(n.useRef)(null),c=Object(n.useState)(r),l=Object(m.a)(c,2),h=l[0],u=l[1],d="_INPUT_"+i;return Object(X.jsxs)("div",{className:"input-select",children:[Object(X.jsx)("label",{htmlFor:d,children:a}),Object(X.jsx)("select",{ref:o,value:h,onChange:function(e){var t=e.target.value;u(t),s&&s(t)},children:t.map((function(e,t){return Object(X.jsx)("option",{children:e},t)}))})]})},we=function(e){var t=e.text;return Object(X.jsxs)("div",{className:"warning",children:[Object(X.jsx)("h3",{children:"Warning"}),Object(X.jsx)("p",{children:t})]})},ke=function(e){var t=e.text,i=e.defaultValue,a=e.func,r=e.minVal,s=e.maxVal,o=e.allowDecimals,c=Object(n.useRef)(null),l=Object(n.useState)(i.toString()),h=Object(m.a)(l,2),u=h[0],d=h[1];Object(n.useEffect)((function(){d(i.toString())}),[i]);var f=null,v=Number(u);return isNaN(v)?f="The input must be a valid number.":v%1===0||o?r&&v<r?f="The input cannot be less than ".concat(r,"."):s&&v>s&&(f="The input cannot be greater than ".concat(s,".")):f="The input must be an integer.",Object(X.jsxs)("div",{className:"input-text",children:[t?Object(X.jsxs)("span",{className:"text",children:[t,":"]}):"",Object(X.jsx)("input",{ref:c,onInput:function(){var e=c.current.value,t=Number(e);a&&a(t),d(e)},type:"text",value:u}),null!==f?Object(X.jsx)(we,{text:f}):""]})},Se=function(e){var t=e.text,i=e.minValLimit,a=e.maxValLimit,r=e.minVal,s=e.maxVal,o=e.func,c=Object(n.useRef)(null),l=Object(n.useRef)(null),h=parseFloat(r),u=parseFloat(s),d=null;isNaN(h)||isNaN(u)?d="The input must be a valid number.":h<i?d="The minimum value cannot be less than ".concat(i,"."):h>a?d="The maximum value cannot be greater than ".concat(a,"."):h>=u&&(d="The minimum value must be less than maximum.");return Object(X.jsxs)("div",{className:"input-text-range",children:[Object(X.jsx)("div",{className:"text",children:t}),Object(X.jsx)("div",{className:"input-container",children:Object(X.jsx)("input",{onChange:function(){var e=c.current.value;o&&o([e,s])},ref:c,type:"text",value:r})}),"to",Object(X.jsx)("div",{className:"input-container",children:Object(X.jsx)("input",{onChange:function(){var e=l.current.value;o&&o([r,e])},ref:l,type:"text",value:s})}),null!==d?Object(X.jsx)(we,{text:d}):""]})},Ne=(i(37),xe.presets[0]),Ce=5,Me=1,Te=1,ze=.5,Ee=function(){Ae.changeSize(Xe.boardSize.width,Xe.boardSize.height,!0),Ae.generateNoise(Ne,Ce,!0)};var Re,Fe=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Xe.boardSize[e]=t,Ae.changeSize(Xe.boardSize.width,Xe.boardSize.height,i),Ae.generateNoise(Ne,Ce,i)},Le=function(e){var t=e.text,i=e.obj,n=e.size,a=e.isSelected,r=e.clickEvent,s="size";return a&&(s+=" selected"),Object(X.jsx)("div",{onClick:function(){r&&i&&r(i),Array.isArray(n)&&(Fe("width",n[0],!0),Fe("height",n[1],!0))},className:s,children:t})},Pe=function(){var e,t,i=Object(n.useState)([{text:"Small",size:[15,15],isSelected:!0},{text:"Medium",size:[30,30]},{text:"Large",size:[50,50]},{text:"Custom",size:"custom"}]),a=Object(m.a)(i,2),r=a[0],s=a[1],c=Object(o.a)(r);try{for(c.s();!(t=c.n()).done;){var l=t.value;l.isSelected&&(e=l.size)}}catch(v){c.e(v)}finally{c.f()}var h=function(e){var t,i=r.slice(),n=Object(o.a)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value;a===e?a.isSelected=!0:a.isSelected&&(a.isSelected=!1)}}catch(v){n.e(v)}finally{n.f()}s(i)},u=Array.isArray(e)?e[0]:15,d=Array.isArray(e)?e[1]:15,f="size-container";return"custom"===e&&(f+=" custom"),Object(X.jsxs)("div",{className:f,children:[Object(X.jsx)("div",{className:"formatter",children:r.map((function(e,t){return Object(X.jsx)(Le,{obj:e,text:e.text,size:e.size,isSelected:e.isSelected,clickEvent:h},t)}))}),Object(X.jsx)(ke,{func:function(e){return Fe("width",e)},text:"Width",defaultValue:u,maxVal:100}),Object(X.jsx)(ke,{func:function(e){return Fe("height",e)},text:"Height",defaultValue:d,maxVal:100})]})},Ie=function(e){var t=e.width,i=e.height,a=e.tile,r=e.tileName,s=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=s.current;if(e.style.width=t+"px",e.style.height=i+"px",a.thumbnailFunc){Xe.createRenderListener((function n(){a.thumbnailFunc(e,t,i,n)}))}var n=e.getContext("2d");if(1===a.colour.length)n.fillStyle=a.colour[0],n.rect(0,0,t,i),n.fill();else for(var r=t/8,o=i/8,c=0;c<8;c++)for(var l=0;l<8;l++){var h=x(a.colour);n.beginPath(),n.fillStyle=h,n.rect(l*r,c*o,r,o),n.fill()}}),[i,a,a.colour,t]),Object(X.jsx)("canvas",{width:t,height:i,className:"thumbnail ".concat(r),ref:s})},Ve=function(e){var t,i=e.layer,a=e.type,r=e.changeLevelFunc,s=e.toggleLevelFunc,o=Object(n.useState)("undefined"!==typeof i[a]),c=Object(m.a)(o,2),l=c[0],h=c[1];if("undefined"===typeof i[a])t=["0","1"];else if(Array.isArray(i[a])){var u=i[a];t=[u[0].toString(),u[1].toString()]}else t=["0",i[a].toString()];var d,f=Object(n.useState)(t),v=Object(m.a)(f,2),p=v[0],g=v[1];d="height"===a?"Height: ":"Temperature: ";var b=function(e,t){s(e,t)},y="layer-noise-type";return l&&(y+=" enabled"),Object(X.jsxs)("div",{className:y,children:[Object(X.jsx)("input",{type:"checkbox",checked:l,onChange:function(){var e="height"===a?"temperature":"height";if(i.hasOwnProperty(e)){var t=!l;b(a,t),h(t),t||g(["0","1"])}else{var n=window.event;null===n||void 0===n||n.preventDefault()}}}),Object(X.jsx)(Se,{func:function(e){var t=Object(m.a)(e,2),n=t[0],s=t[1];return function(e,t){var n=parseFloat(t[0]),a=parseFloat(t[1]);isNaN(n)||isNaN(a)||r(i,e,l?[n,a]:null),g(t)}(a,[n,s])},text:d,minValLimit:0,maxValLimit:1,minVal:p[0],maxVal:p[1]})]})},Ue=function(e){var t=e.layer,i=e.id,n=e.changeTypeFunc,a=e.changeLevelFunc,r=e.toggleLevelFunc,s=e.removeFunc,o=e.hasRemoveButton,c=xe.tiles[t.type],l=c.name,h=function(e,i){r(t,e,i)},u=Object.values(xe.tiles).map((function(e){return e.name}));return Object(X.jsxs)("div",{className:"terrain-layer",children:[Object(X.jsx)("div",{className:"formatter"}),Object(X.jsx)(Ie,{width:64,height:64,tile:c,tileName:t.type}),Object(X.jsxs)("div",{children:[Object(X.jsxs)("p",{children:["Type:",Object(X.jsx)("select",{value:l,onChange:function(e){for(var i=e.target.value,a=0,r=Object.entries(xe.tiles);a<r.length;a++){var s=Object(m.a)(r[a],2),o=s[0];s[1].name===i&&(t.type=o,n(t,o))}},children:u.map((function(e,t){return Object(X.jsx)("option",{children:e},t)}))})]}),Object(X.jsx)(Ve,{layer:t,type:"height",changeLevelFunc:a,toggleLevelFunc:h}),Object(X.jsx)(Ve,{layer:t,type:"temperature",changeLevelFunc:a,toggleLevelFunc:h})]}),o?Object(X.jsx)("div",{onClick:function(){return s(i)},className:"remove-button",children:"x"}):""]})},De={type:"grass",height:[0,1]},Ge=function(e){var t=Object(n.useState)(e.terrain),i=Object(m.a)(t,2),a=i[0],r=i[1];Re=function(){var e={name:"",noise:["height","temperature"],terrainLayers:a};Ne=Object.assign({},e),Ae.changeSize(Xe.boardSize.width,Xe.boardSize.height,!0),Ae.generateNoise(Ne,Ce,!0,Me,Te,ze)};var s=function(e,t){var i,n=a.slice(),s=Object(o.a)(n);try{for(s.s();!(i=s.n()).done;){var c=i.value;c===e&&(c.type=t)}}catch(l){s.e(l)}finally{s.f()}r(n)},c=function(e,t,i){var n,s=a.slice(),c=Object(o.a)(s);try{for(c.s();!(n=c.n()).done;){var l=n.value;l===e&&(null!==i?l[t]=i:delete l[t])}}catch(h){c.e(h)}finally{c.f()}r(s)},l=function(e,t,i,n){var s,c=a.slice(),l=Object(o.a)(c);try{for(l.s();!(s=l.n()).done;){var h=s.value;h===e&&(i?h[t]=[0,1]:delete h[t])}}catch(u){l.e(u)}finally{l.f()}r(c)},h=function(e){for(var t=new Array,i=0;i<a.length;i++)i!==e&&t.push(a[i]);r(t)};return Object(X.jsxs)("div",{id:"advanced-terrain-generator",children:[Object(X.jsx)("button",{onClick:function(){var e=Object.assign({},De),t=a.concat([e]);r(t)},children:"Create new layer"}),a.map((function(e,t){return Object(X.jsx)(Ue,{layer:e,id:t,changeTypeFunc:s,changeLevelFunc:c,toggleLevelFunc:l,removeFunc:h,hasRemoveButton:a.length>1},t)}))]})},Be=function(){var e=Object(n.useState)(!1),t=Object(m.a)(e,2),i=t[0],a=t[1];Object(n.useEffect)((function(){(Ae=new je(Xe.boardSize.width,Xe.boardSize.height,16)).generateNoise(xe.presets[0],Ce,!0)}),[]);var r=xe.presets.map((function(e){return e.name})),s=Ne.terrainLayers;return Object(X.jsxs)("div",{id:"terrain-generator",children:[Object(X.jsx)("h2",{className:"subheading",children:"World Size"}),Object(X.jsx)(Pe,{}),Object(X.jsx)("h2",{className:"subheading",children:"Terrain Generation"}),Object(X.jsx)(_,{func:function(e){a(e)},name:"show-terrain-generator-checkbox",text:"Advanced terrain generation",defaultValue:!1}),i?Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)(ke,{func:function(e){return Ce=e},text:"Scale",defaultValue:5,minVal:2,maxVal:20}),Object(X.jsx)(W,{func:function(e){return Me=e},text:"Octaves",defaultValue:1,min:1,max:5,step:1,description:"The number of perlin noise layers."}),Object(X.jsx)(W,{func:function(e){return Te=e},text:"Lacunarity",defaultValue:1.5,min:1,max:5,step:.5,description:"How quickly scale increases between layers."}),Object(X.jsx)(W,{func:function(e){return ze=e},text:"Persistance",defaultValue:.5,min:0,max:1,step:.05,description:"How quickly weight diminishes across layers."}),Object(X.jsx)(Ge,{terrain:s}),Object(X.jsx)("button",{onClick:function(){return Re()},children:"Regenerate"})]}):Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)(Oe,{options:r,name:"terrain-preset-options",text:"Presets:",defaultValue:xe.presets[0].name,func:function(e){var t,i=Object(o.a)(xe.presets);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(n.name===e){Ne=n,Ae.changeSize(Xe.boardSize.width,Xe.boardSize.height,!0),Ae.generateNoise(n,Ce,!0);break}}}catch(a){i.e(a)}finally{i.f()}}}),Object(X.jsx)("button",{onClick:Ee,children:"Regenerate"})]}),Object(X.jsx)("div",{id:"board-preview-container"})]})},Je=function(){function e(t,i,n){Object(c.a)(this,e),this.width=void 0,this.height=void 0,this.cellSize=void 0,this.cells=void 0,this.landTileIndexes=new Array,this.tiles=void 0,this.width=t,this.height=i,this.cellSize=n,this.cells=new Array;for(var a=0;a<i;a++){this.cells.push(new Array);for(var r=0;r<t;r++)this.cells[a].push(new Array)}this.tiles=this.generateTiles()}return Object(l.a)(e,[{key:"createCell",value:function(){var e=document.createElement("div");return e.className="cell",e}},{key:"createCellRow",value:function(){var e=document.createElement("div");return e.style.height="".concat(this.cellSize,"px"),e.className="cell-row",e}},{key:"generateTiles",value:function(){var e=Ae.getTiles(),t=b("board");t.classList.remove("hidden");t.style.setProperty("--cell-size","".concat(this.cellSize,"px")),t.style.setProperty("--cell-border-size","".concat(2,"px"));var i=this.width*this.cellSize;t.style.width="".concat(i,"px");var n=this.height*this.cellSize;t.style.height="".concat(n,"px");for(var a=new Array,r=0;r<this.height;r++){var s=this.createCellRow();t.appendChild(s),a.push(s);for(var o=0;o<this.width;o++){var c=e[r][o];c.isLiquid||this.landTileIndexes.push(r*this.width+o);var l=this.createCell(),h=x(c.colour);l.style.backgroundColor=h,s.appendChild(l)}}return e}},{key:"createEntity",value:function(e){var t=this.getCells(e.position,e.size/2);this.insertEntity(e,t)}},{key:"deleteEntity",value:function(e){var t=this.getEntityReferences(e);this.removeEntity(e,t)}},{key:"updateEntity",value:function(e){var t=this.getEntityReferences(e),i=this.getCells(e.position,e.size/2);i!==t&&(0!==t.length&&this.removeEntity(e,t),this.insertEntity(e,i)),e instanceof H&&this.runWalkFunc(e)}},{key:"getNearby",value:function(e,t){for(var i=Math.max(Math.floor((e.x-t)/this.cellSize),0),n=Math.min(Math.floor((e.x+t)/this.cellSize),this.width-1),a=Math.max(Math.floor((e.y-t)/this.cellSize),0),r=Math.min(Math.floor((e.y+t)/this.cellSize),this.height-1),s=new Array,c=a;c<=r;c++)for(var l=i;l<=n;l++){var h,u=Object(o.a)(this.cells[c][l]);try{for(u.s();!(h=u.n()).done;){var d=h.value,f=e.distanceFrom(d.position);!s.includes(d)&&f-d.size/2<=t&&s.push(d)}}catch(v){u.e(v)}finally{u.f()}}return s}},{key:"randomPosition",value:function(){if(0===this.landTileIndexes.length){var e=A(0,this.width*this.cellSize),t=A(0,this.height*this.cellSize);return new p(e,t)}var i=x(this.landTileIndexes),n=i%this.width,a=Math.floor(i/this.width),r=A(0,this.cellSize),s=A(0,this.cellSize);return new p(n*this.cellSize+r,a*this.cellSize+s)}},{key:"getFruitColour",value:function(e){if(0===this.landTileIndexes.length)return null;var t=Math.floor(e.x/this.cellSize),i=Math.floor(e.y/this.cellSize),n=this.tiles[i][t];return n.isLiquid&&console.warn("Tried to find the fruit colour of a liquid!"),x(n.fruitColour)}},{key:"getTileType",value:function(e){var t=S(Math.floor(e.x/this.cellSize),0,this.width-1),i=S(Math.floor(e.y/this.cellSize),0,this.height-1);return this.tiles[i][t]}},{key:"randomPositionInCell",value:function(e){var t=e%this.width,i=Math.floor(e/this.width),n=A(0,this.cellSize),a=A(0,this.cellSize);return new p(t*this.cellSize+n,i*this.cellSize+a)}},{key:"randomNearbyPosition",value:function(e,t,i){for(var n=null;null===n;){var a=e.randomOffset(t);if(this.positionIsInBoard(a)){if(this.getTileType(a)!==i&&Math.random()>=Xe.settings.tilePreference)continue;n=a}}return n}},{key:"census",value:function(){var e=this;return new Promise((function(t){for(var i=new Array,n=new Array,a=0;a<e.height;a++)for(var r=0;r<e.width;r++){var s,c=e.cells[a][r],l=Object(o.a)(c);try{for(l.s();!(s=l.n()).done;){var h=s.value;h instanceof H&&!i.includes(h)?i.push(h):h instanceof E&&!n.includes(h)&&n.push(h)}}catch(u){l.e(u)}finally{l.f()}}t({creatures:i,fruit:n})}))}},{key:"tick",value:function(){for(var e=new Array,t=0;t<this.height;t++)for(var i=0;i<this.width;i++){var n,a=this.cells[t][i],r=Object(o.a)(a);try{for(r.s();!(n=r.n()).done;){var s=n.value;e.includes(s)||(s.tick(),e.push(s))}}catch(f){r.e(f)}finally{r.f()}}for(var c=this.width*this.height/100,l=0;l<c;l++){var h=y(0,this.width),u=y(0,this.height),d=this.tiles[u][h];d.tickFunc&&d.tickFunc(h,u)}}},{key:"runWalkFunc",value:function(e){var t=S(Math.floor(e.position.x/this.cellSize),0,this.width-1),i=S(Math.floor(e.position.y/this.cellSize),0,this.height-1),n=this.tiles[i][t];n.walkFunc&&n.walkFunc(e)}},{key:"insertEntity",value:function(e,t){var i,n=Object(o.a)(t);try{for(n.s();!(i=n.n()).done;){i.value.push(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"removeEntity",value:function(e,t){var i,n=Object(o.a)(t);try{for(n.s();!(i=n.n()).done;)for(var a=i.value;;){var r=a.indexOf(e);if(-1===r)break;a.splice(r,1)}}catch(s){n.e(s)}finally{n.f()}}},{key:"getEntityReferences",value:function(e){for(var t=S(Math.floor(e.position.x/this.cellSize),0,this.width-1),i=S(Math.floor(e.position.y/this.cellSize),0,this.height-1),n=Math.max(t-2,0),a=Math.min(t+2,this.width-1),r=Math.max(i-2,0),s=Math.min(i+2,this.height-1),o=[],c=new Array,l=r;l<=s;l++)for(var h=n;h<=a;h++){var u=this.cells[l][h];u.includes(e)&&(o.push([h,l]),c.push(u))}return c}},{key:"getCells",value:function(e,t){var i=Math.floor(e.x/this.cellSize),n=Math.floor(e.y/this.cellSize),a=(e.x+this.cellSize)%this.cellSize,r=(e.y+this.cellSize)%this.cellSize,s=[[i,n]];a-t<0&&s.push([i-1,n]),a+t>this.cellSize&&s.push([i+1,n]),r-t<0&&s.push([i,n-1]),r+t>this.cellSize&&s.push([i,n+1]),a-t<0&&r-t<0&&s.push([i-1,n-1]),a+t>this.cellSize&&r-t<0&&s.push([i-1,n-1]),a-t<0&&r+t<this.cellSize&&s.push([i-1,n-1]),a+t>this.cellSize&&r+t<this.cellSize&&s.push([i-1,n-1]);for(var o=s.length-1;o>=0;o--){var c=s[o];(c[0]<0||c[0]>=this.width||c[1]<0||c[1]>=this.height)&&s.splice(o,1)}for(var l=new Array,h=0,u=s;h<u.length;h++){var d=u[h];l.push(this.cells[d[1]][d[0]])}return l}},{key:"positionIsInBoard",value:function(e){return e.x>=0&&e.x<=this.width*this.cellSize&&e.y>=0&&e.y<=this.height*this.cellSize}}]),e}(),Ye=[],Ke=new Array,Qe=function(e,t){var i={};if(0===e.length)i=null;else{for(var n={},a=0,r=Object.keys(G);a<r.length;a++){n[r[a]]=new Array}var s,c=Object(o.a)(e);try{for(c.s();!(s=c.n()).done;)for(var l=s.value,h=0,u=Object.keys(n);h<u.length;h++){var d=u[h];n[d].push(l[d])}}catch(S){c.e(S)}finally{c.f()}for(var f=0,v=Object.keys(G);f<v.length;f++){for(var m=v[f],p=n[m],g=p.length,b=Number.MAX_SAFE_INTEGER,y=0,A=0,x=0;x<g;x++){var j=p[x];j<b&&(b=j),j>y&&(y=j),A+=j}A/=g,i[m]={average:A,min:b,max:y,standardDeviation:w(p)}}}var O=N.count(H);0===O&&(O=null);var k=N.count(E);Ke.push({creatures:O,fruit:k,fruitMultiplier:He.fruitMultiplier,genePool:i}),oe[1].isChecked&&ue()},qe={fruitSpawnRate:1,creatureMutationRate:1,eggIncubationTime:5,initialCreatures:10,initialFruit:50,equilibrium:20,tilePreference:.2,creatureColour:"regular",showDebugOutput:!1},He={hasStarted:!1,isPaused:!1,ticks:0,tps:20,timewarp:1,fruitMultiplier:1,previousTime:Date.now(),previousTicks:0,runTick:function(){var e=Object(d.a)(u.a.mark((function e(){var t,i,n,a,r,s,c,l,h,d,f,v,m,p,g=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPaused){e.next=3;break}return setTimeout((function(){return g.runTick()}),1e3/this.tps/this.timewarp),e.abrupt("return");case 3:this.previousTicks++,t=Object(o.a)(Ye);try{for(t.s();!(i=t.n()).done;)(0,i.value)()}catch(u){t.e(u)}finally{t.f()}n=Object(o.a)(R);try{for(n.s();!(a=n.n()).done;)a.value.tick()}catch(u){n.e(u)}finally{n.f()}if(!this.hasStarted){e.next=27;break}if(this.ticks++,this.board.tick(),document.querySelectorAll(".ray").forEach((function(e){return e.remove()})),5,this.ticks%(5*this.tps)!==0){e.next=23;break}return e.next=16,He.board.census();case 16:r=e.sent,s=r.creatures.length,this.fruitMultiplier=0===s?1:this.settings.equilibrium/s,c=r.fruit.length/this.board.landTileIndexes.length,10,c>10&&console.log("MAX!"),Qe(r.creatures,r.fruit);case 23:for(l=.05*this.settings.fruitSpawnRate*this.fruitMultiplier,h=0;h<this.board.landTileIndexes.length;h++)for(d=this.board.landTileIndexes[h],f=Math.random(),v=0;f<=l/this.tps-v;v++)C(d);K(),L&&T();case 27:m=Date.now(),p=m-this.previousTime,m-this.previousTime>=1e3&&(this.settings.showDebugOutput&&console.log(this.previousTicks+" ticks ("+O(this.previousTicks/this.tps,1)+" seconds(s)) in "+p+"ms"),this.previousTicks=0,this.previousTime=m),setTimeout((function(){return g.runTick()}),1e3/this.tps/this.timewarp);case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),start:function(){b("title-options-container").classList.add("hidden"),this.board=new Je(this.boardSize.width,this.boardSize.height,this.cellSize),this.hasStarted=!0,this.transform.zoom=25/Math.pow(this.boardSize.width+this.boardSize.height,1.1),fe();for(var e=0;e<this.settings.initialCreatures;e++)Y();for(var t=0;t<this.settings.initialFruit;t++)C()},createRenderListener:function(e){Ye.push(e)},removeRenderListener:function(e){var t=Ye.indexOf(e);if(-1===t)throw new Error("No matching function could be found! Name: ".concat(e.name));Ye.splice(t,1)},hasRenderListener:function(e){return Ye.indexOf(e)>=0},boardSize:{width:15,height:15},transform:{zoom:1,translate:new p(0,0)},cellSize:60,settings:qe,board:null},Xe=He,_e=[],We=function(){function e(){Object(c.a)(this,e),this.element=void 0,this.position=void 0,this.velocity=void 0,this.element=this.createInstance(),this.position=this.getRandomPosition(),this.velocity=this.getRandomVelocity()}return Object(l.a)(e,[{key:"getRandomPosition",value:function(){var e=A(0,90)+5,t=A(0,90)+5- -10;return new p(e,t)}},{key:"getRandomVelocity",value:function(){var e=A(-2,2),t=A(-12,-5);return new p(e,t)}},{key:"createInstance",value:function(){var e=document.createElement("div");e.className="confetti",document.body.appendChild(e);var t=[3,7],i=[5,12],n=A(t[0],t[1]),a=A(i[0],i[1]);e.style.width="".concat(n,"px"),e.style.height="".concat(a,"px");var r=180*Math.random();e.style.transform="rotate(".concat(r,"deg)");var s=x(["red","pink","orange","green","blue"]);return e.style.backgroundColor=s,e}},{key:"updatePosition",value:function(){this.element.style.left="".concat(this.position.x,"%"),this.element.style.top="".concat(this.position.y,"%")}},{key:"tick",value:function(){for(var e=0;e<7;e++)this.position=this.position.lerp(this.position.add(this.velocity),1/Xe.tps),this.velocity.y+=.05;(this.position.y>100||this.position.x<0||this.position.x>100)&&this.die(),this.updatePosition()}},{key:"die",value:function(){this.element.remove();var e=_e.indexOf(this);_e.splice(e,1)}}]),e}(),Ze=function(){var e,t=Object(o.a)(_e);try{for(t.s();!(e=t.n()).done;){e.value.tick()}}catch(i){t.e(i)}finally{t.f()}};i(38),i(39);function $e(){b("start-menu").classList.remove("hidden")}var et,tt=JSON.parse(JSON.stringify(qe)),it=function(){Xe.settings=tt,b("start-menu").remove(),Xe.start()},nt=function(){var e,t,i=Object(n.useState)([{text:"Regular",className:"regular",isSelected:!0},{text:"Gene-based",className:"gene-based"},{text:"RGB",className:"rgb"}]),a=Object(m.a)(i,2),r=a[0],s=a[1],c=Object(o.a)(r);try{for(c.s();!(t=c.n()).done;){var l=t.value;if(l.isSelected){e=l;break}}}catch(h){c.e(h)}finally{c.f()}return Object(X.jsxs)("div",{className:"colour-options",children:[Object(X.jsx)("div",{className:"formatter",children:r.map((function(e,t){var i="option".concat(e.isSelected?" selected":"");return Object(X.jsx)("div",{onClick:function(){return function(e){tt.creatureColour=e.className;var t,i=r.slice(),n=Object(o.a)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.text===e.text?a.isSelected=!0:a.isSelected&&(a.isSelected=!1)}}catch(h){n.e(h)}finally{n.f()}s(i)}(e)},className:i,children:e.text},t)}))}),Object(X.jsx)("div",{className:"preview-caption",children:"Preview"}),Object(X.jsx)("div",{className:"creature-preview-container",children:Object(X.jsx)("div",{className:"creature-preview "+e.className})})]})};!function(e){e[e.TerrainGeneration=1]="TerrainGeneration",e[e.Options=2]="Options",e[e.StartGame=3]="StartGame"}(et||(et={}));var at=function(){var e=Object(n.useState)(1),t=Object(m.a)(e,2),i=t[0],a=t[1];return Object(X.jsx)("div",{id:"start-menu",className:"menu hidden",children:Object(X.jsxs)("div",{className:"content",children:[Object(X.jsx)("h1",{className:"heading",children:"Settings"}),i===et.TerrainGeneration?Object(X.jsx)(Be,{}):"",i===et.Options?Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)("h2",{className:"subheading",children:"Initial Population"}),Object(X.jsx)(W,{func:function(e){return tt.initialCreatures=e},text:"Creatures",min:0,max:250,step:5,defaultValue:10}),Object(X.jsx)(W,{func:function(e){return tt.initialFruit=e},text:"Fruit",min:0,max:500,step:5,defaultValue:50}),Object(X.jsx)("h2",{className:"subheading",children:"Creature Colour"}),Object(X.jsx)(nt,{}),Object(X.jsx)("h2",{className:"subheading",children:"Modifiers"}),Object(X.jsx)(W,{func:function(e){return tt.fruitSpawnRate=e},text:"Fruit spawn rate",min:.5,max:5,step:.5,defaultValue:1,hasExtremeMode:!0,prefix:"x"}),Object(X.jsx)(W,{func:function(e){return tt.creatureMutationRate=e},text:"Creature mutation rate",min:.5,max:3,step:.1,defaultValue:1,hasExtremeMode:!0,prefix:"x"}),Object(X.jsx)(W,{func:function(e){return tt.eggIncubationTime=e},text:"Egg incubation time",min:0,max:15,step:1,defaultValue:5,hasExtremeMode:!0,prefix:" seconds"}),Object(X.jsx)("h2",{className:"subheading",children:"Other Stuff"}),Object(X.jsx)(W,{func:function(e){return tt.equilibrium=e},text:"Desired equilibrium",min:0,max:250,step:5,defaultValue:20,prefix:" creatures",description:"How many creatures you want to have."}),Object(X.jsx)(W,{text:"Tile preference",min:0,defaultValue:qe.tilePreference,max:1,step:.1,description:"How strongly creatures should prefer the biome they were born in."})]}):"",Object(X.jsx)("button",{className:"next-button",onClick:function(){var e=i+1;e===et.StartGame?it():a(e)},children:"> Next <"})]})})},rt=function(){var e;null===(e=window.open("https://github.com/eggpoison/creature-simulator","_blank"))||void 0===e||e.focus()},st=function(){return Object(X.jsxs)("div",{id:"titlescreen",children:[Object(X.jsx)("h1",{children:"Creature Simulator"}),Object(X.jsxs)("div",{id:"title-options-container",children:[Object(X.jsx)("button",{onClick:$e,children:"Start"}),Object(X.jsx)("button",{onClick:function(){return function(e){for(var t=0;t<e;t++)_e.push(new We);Xe.hasRenderListener(Ze)||Xe.createRenderListener(Ze)}(50)},children:"Confetti!"}),Object(X.jsx)("button",{children:"About"}),Object(X.jsx)("button",{onClick:rt,id:"source-code-button",children:"Source Code"})]})]})},ot=(i(40),i(41),i(42),function(){return Object(X.jsx)("div",{id:"board",className:"hidden"})}),ct=(i(43),function(){var e=Object(n.useState)(null),t=Object(m.a)(e,2),i=t[0],r=t[1],s=a.a.useState({}),o=Object(m.a)(s,2)[1],c=a.a.useCallback((function(){return o({})}),[]);Object(n.useEffect)((function(){M=function(e){r(e)},function(e){T=e}((function(){return c()}))}),[c]);var l=null===i?Object(X.jsx)(X.Fragment,{}):Object(X.jsxs)(X.Fragment,{children:[" ",Object.entries(G).map((function(e,t){var n=e[1],a=e[0],r=i[a],s=(r-n.min)/(n.max-n.min)*100,o=.5+(r-n.min)/(n.max-n.min)/2;return Object(X.jsxs)("div",{className:"gene",children:[Object(X.jsx)("div",{className:"label",children:n.display}),Object(X.jsxs)("div",{className:"slider",children:[Object(X.jsx)("div",{style:{width:s+"%",opacity:o,backgroundColor:n.colour},className:"slider-fill"}),Object(X.jsx)("div",{className:"min",children:n.min}),Object(X.jsx)("div",{className:"val",children:r}),Object(X.jsx)("div",{className:"max",children:n.max})]})]},t)}))," "]});return null===i?Object(X.jsx)(X.Fragment,{}):Object(X.jsxs)("div",{id:"creature-inspector",children:[Object(X.jsx)("h1",{children:"Creature Inspector"}),Object(X.jsx)("h2",{children:"General"}),Object(X.jsxs)("div",{className:"panel",children:[Object(X.jsxs)("p",{children:["Name: ",i.name]}),Object(X.jsxs)("p",{children:["Age: ",Xe.ticks-i.birthTime," ticks (",O((Xe.ticks-i.birthTime)/Xe.tps,1)," seconds)"]})]}),Object(X.jsx)("h2",{children:"Stats"}),Object(X.jsxs)("div",{className:"panel",children:[Object(X.jsxs)("p",{children:["Generation: ",i.stats.generation]}),Object(X.jsxs)("p",{children:["Fruit eaten: ",i.stats.fruitEaten]})]}),Object(X.jsx)("h2",{children:"Genes"}),Object(X.jsx)("div",{className:"panel",children:l})]})}),lt=null,ht=null;i(44),i(45);var ut=function(){return Object(X.jsxs)("div",{id:"graph-viewer",className:"menu hidden",children:[Object(X.jsx)("h1",{className:"heading",children:"View Graphs"}),Object(X.jsxs)("div",{className:"formatter",children:[Object(X.jsxs)("div",{className:"options",children:[Object(X.jsx)("h2",{className:"subheading",children:"Graph Options"}),Object(X.jsx)("p",{children:"Select which graphs should be shown."}),Object(X.jsx)("div",{className:"options-container"})]}),Object(X.jsxs)("div",{className:"settings",children:[Object(X.jsx)("h2",{className:"subheading",children:"Settings"}),Object(X.jsx)("p",{children:"Control how the graphs look."}),Object(X.jsx)("div",{className:"settings-container"})]})]}),Object(X.jsx)("div",{className:"graph-container",children:Object(X.jsx)("p",{children:"Your graph will appear here once you choose an option."})})]})},dt=function(){return Object(X.jsx)("div",{id:"pause-screen",className:"hidden",children:Object(X.jsxs)("hgroup",{children:[Object(X.jsx)("h1",{children:"Paused!"}),Object(X.jsxs)("h2",{children:["Press ",Object(X.jsx)("span",{children:"<space>"})," to unpause."]})]})})};i(46);function ft(){b("mask").classList.add("hidden")}function vt(){b("mask").classList.remove("hidden")}s.a.render(Object(X.jsxs)(a.a.StrictMode,{children:[Object(X.jsx)(st,{}),Object(X.jsx)(ae,{}),Object(X.jsx)(ot,{}),Object(X.jsx)(ct,{}),Object(X.jsx)(ut,{}),Object(X.jsx)(dt,{}),Object(X.jsx)(at,{}),Object(X.jsx)("div",{id:"mask",className:"hidden"})]}),document.getElementById("root"));window.onload=function(){he(),Xe.runTick()},document.onmousemove=function(e){var t=b("board");if(e.composedPath().includes(t)){var i=t.getBoundingClientRect();!function(e,t){var i=900/534,n=new p(e*i,t*i);ht=null;var a,r=50,s=Object(o.a)(Xe.board.cells);try{for(s.s();!(a=s.n()).done;){var c,l=a.value,h=Object(o.a)(l);try{for(h.s();!(c=h.n()).done;){var u=c.value;if(u instanceof H){var d=n.distanceFrom(u.position);d<r&&(ht=u,r=d)}}}catch(g){h.e(g)}finally{h.f()}}}catch(g){s.e(g)}finally{s.f()}!function(){var e;null===(e=document.querySelector(".creature.highlighted"))||void 0===e||e.classList.remove("highlighted")}();var f=b("board");if(null!==ht){ht.element.classList.add("highlighted");var v=function(e,t,i){var n=document.createElement("div");return n.className="hover-box",n.style.left=t.x+"px",n.style.top=t.y+"px",n.innerHTML=e,i.appendChild(n),n}(ht.name,new p(ht.position.x,ht.position.y+20+ht.size/2),f);null!==lt&&lt!==v&&lt.remove(),lt=v,f.classList.add("highlight")}else{var m;f.classList.remove("highlight"),null===(m=lt)||void 0===m||m.remove(),lt=null}}(e.clientX-i.x,e.clientY-i.y)}},document.onclick=function(){var e,t=window.event;if("open-graph-viewer-button"===(null===t||void 0===t?void 0:t.target).id)vt(),b("graph-viewer").classList.remove("hidden"),se=!0;else if(se){if(null===t||void 0===t?void 0:t.composedPath().includes(b("graph-viewer")))return;ft(),b("graph-viewer").classList.add("hidden"),se=!1}else null!==ht?(L=!0,P=e=ht,M(e)):I()},document.onkeydown=function(){var e=window.event.key;if(document.activeElement===document.body)switch(e){case"ArrowUp":ve("up");break;case"ArrowRight":ve("right");break;case"ArrowDown":ve("down");break;case"ArrowLeft":ve("left");break;case"-":case"_":me("out");break;case"+":case"=":me("in");break;case" ":Xe.isPaused?(Xe.isPaused=!1,b("pause-screen").classList.add("hidden")):(Xe.isPaused=!0,b("pause-screen").classList.remove("hidden"))}}}]),[[47,1,2]]]);
//# sourceMappingURL=main.7bd3835a.chunk.js.map