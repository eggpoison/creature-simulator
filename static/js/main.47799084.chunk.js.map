{"version":3,"sources":["images sync /^/.//.*/.png$","images/egg/egg-0.png","images/egg/egg-1.png","images/egg/egg-2.png","images/egg/egg-3.png","images/egg/egg-4.png","images/heart/heart-0.png","images/heart/heart-1.png","images/heart/heart-2.png","images/heart/heart-3.png","images/smoke/smoke-0.png","images/smoke/smoke-1.png","images/smoke/smoke-2.png","images/smoke/smoke-3.png","images/smoke/smoke-4.png","utils.ts","classes/Entity.ts","classes/Fruit.ts","creature-inspector.ts","classes/GameImage.ts","classes/Egg.ts","classes/Creature.ts","components/ControlPanel.tsx","components/InputCheckbox.tsx","components/InputRange.tsx","classes/Graph.ts","graph-viewer.tsx","keyboard.tsx","perlin-noise.ts","classes/BoardGenerator.ts","components/TerrainGenerator.tsx","components/InputSelect.tsx","components/Warning.tsx","components/InputText.tsx","components/InputTextRange.tsx","classes/Board.ts","Game.tsx","confetti.tsx","components/StartMenu.tsx","components/Titlescreen.tsx","components/Board.tsx","components/CreatureInspector.tsx","mouse.ts","components/GraphViewer.tsx","components/PauseScreen.tsx","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","Vector","x","y","this","vec2","targetVec","amount","lerp","Math","sqrt","pow","atan2","targetVector","distance","distanceFrom","angle","angleBetween","PolarVector","radius","dist","randFloat","ang","offset","add","convertToCartesian","theta","random","PI","cos","sin","magnitude","direction","getElem","elem","document","getElementById","randInt","min","max","isInclusive","floor","randItem","arr","length","start","target","roundNum","num","dpp","power","round","Number","EPSILON","standardDeviation","data","n","mean","reduce","a","b","variance","val","Colour","colour","_hex","_rgb","toLowerCase","substring","getRGB","getHex","r","g","hexDigits","split","rgb","i","digit1","indexOf","digit2","col","slice","gray","hex","b16","clamp","lowerBound","upperBound","Entity","position","genes","velocity","age","lifespan","element","entries","geneName","gene","instantiate","createEntity","updatePosition","Game","board","width","height","appendChild","size","style","ageAmount","die","updateEntity","left","top","deleteEntity","remove","entity","entityType","count","entities","Array","cell","cells","prototype","isPrototypeOf","includes","push","createFruit","cellNumber","attributes","tps","randomPositionInCell","randomPosition","getFruitColour","Fruit","updateInspector","rerenderInspector","backgroundColor","createElement","className","gameImages","GameImage","name","numFrames","ticksPerFrame","frame","init","updateBackgroundImage","backgroundSize","src","require","default","backgroundImage","splice","inspectorIsOpen","inspectorCreature","closeInspector","Egg","creatureAttributes","generation","shakeAmount","ticks","transform","Creature","copy","stats","creatureGeneInfo","speed","display","weight","positivelyAffectsLifespan","vision","reproductiveRate","calculateLifespan","attributeInfo","attributeVal","generateGene","attributeName","attribute","createCreature","updateControlPanel","REPRODUCTION_TIME","moveSpeed","birthTileType","birthTime","seed","isMoving","targetPosition","reproductiveUrge","partner","reproductionStage","lastReproductionTime","settings","eggIncubationTime","fruitEaten","getTileType","calculateMoveSpeed","getName","nouns","chosenAdjectives","potentialAdjectives","idx","adjectiveList","previousValue","currentValue","newVal","hasNoun","reduction","creatureColour","classList","delay","animationDelay","innerHTML","setProperty","lifebar","querySelector","life","color","currentTile","effects","metabolismMultiplier","updateLifebar","updateReproductionBar","hasReachedTargetPosition","reachTargetPosition","moveToTargetPosition","imagePos","randomOffset","particleAttempts","entitiesInVision","getNearby","selfIdx","closestFruit","distanceToNearestFruit","MAX_SAFE_INTEGER","closestPartner","distanceToClosestPartner","entityIsFruit","wantsToReproduce","distanceToCreature","tilePreference","distanceToFruit","handleReproduction","eatFruit","randomNearbyPosition","fruit","end","ray","drawRay","speedMultiplier","angleToTarget","nextPosition","relativeTargetVec","dot","reproduce","then","layEgg","Promise","setTimeout","childAttributes","generateChildGenes","eggAttributes","eggPos","mutateGene","initialGeneVal","mutateAmount","creatureMutationRate","sign","InputCheckbox","text","defaultValue","func","inputRef","useRef","useState","setVal","htmlName","ref","onChange","inputVal","current","checked","type","defaultChecked","htmlFor","InputRange","step","button","hasExtremeMode","prefix","description","onInput","value","undefined","onClick","createCreatures","createFruits","changeTimewarp","timewarp","expandControlPanel","collapseControlPanel","snap","creatureSnapCount","fruitSnapCount","boardSize","body","ControlPanel","React","updateState","forceUpdate","useCallback","useEffect","changeDarkMode","showDebugOutput","changeDebugOutputMode","hasStarted","Graph","options","time","minY","maxY","xAxisMeasurements","timeUnit","calculateTimeUnit","calculateMinY","calculateMaxY","createTitle","plotData","createAxes","createLabels","dataPoint","pos","point","bottom","previousPos","line","rect","triangle","shouldExtrapolate","relativeIndex","remainder","floorVal","ceilVal","ceil","average","getData","plotSimpleData","plotDetailedData","stepSize","drawPoint","drawLine","shouldDrawPoint","averageColour","stdevColour","desaturate","darken","outerColour","previousAveragePos","previousMinPos","previousMaxPos","previousStdevMinPos","previousStdevMaxPos","entry","draw","stdevMinPos","stdevMaxPos","rectWidth","rectPos","drawRect","topTrianglePos","drawTrangle","bottomTrianglePos","measurement","toString","createAxisMeasurement","xLabel","yLabel","dependentVariable","title","graphViewerIsVisible","graphSettingData","graphOptions","selectedGraphOptions","setupGraphs","createGraphOptions","settingsContainer","elems","setting","baseClickEvent","requirement","drawGraphs","isSelected","isChecked","ReactDOM","render","createSettings","setupSettings","optionsContainer","optionElems","option","hasInserted","j","graphContainer","graphSettings","dataPoints","geneSamples","sample","genePool","graph","boardIsVisible","contains","updateTransform","translate","zoom","translateBoard","dir","zoomBoard","interpolate","dot0","dot1","dot2","dot3","localX","localY","fade","t","getPerlinNoise","scale","grid","row","randomUnitVector","noise","sampleX","sampleY","samplePoint","x0","x1","y0","y1","cornerCoords","dotProducts","coords","corner","cornerPos","offsetVector","convertToPolar","u","v","getOctavePerlinNoise","startingScale","octaves","lacunarity","persistance","totalNoise","weightMultiplier","maxWeight","boardGenerator","terrainInfo","presets","terrainLayers","temperature","tiles","grass","fruitColour","isLiquid","tundra","mountain","desert","magma","bog","water","deepWater","lava","thumbnailFunc","thumbnail","renderFunc","offsetParent","thumbnailPos","getBoundingClientRect","thumbnailX","thumbnailY","createSmoke","smoke","zIndex","brightness","filter","smokeAmount","removeRenderListener","tickFunc","cellSize","walkFunc","creature","damage","BoardGenerator","tileSize","canvas","setAttribute","newWidth","newHeight","showChanges","terrain","testLevel","terrainType","isArray","limitArr","heightCheck","temperatureCheck","console","log","noiseType","clearCanvas","ctx","getContext","tileType","beginPath","fillStyle","fill","drawGridLines","drawTestNoise","grayscale","moveTo","lineTo","strokeStyle","stroke","clearRect","InputSelect","selectElemRef","event","Warning","InputText","minVal","maxVal","allowDecimals","warningMessage","numVal","isNaN","inputText","InputTextRange","minValLimit","maxValLimit","minValRef","maxValRef","minValNum","parseFloat","maxValNum","currentTerrain","generatePreview","changeSize","generateNoise","updateCurrentTerrain","changeBoardSize","dimension","Size","obj","clickEvent","SizeSelect","selectedSize","sizes","setSize","newSizesArray","currentSize","containerClassName","LayerThumbnail","tile","tileName","canvasRef","createRenderListener","w","h","LayerNoiseType","defaultVal","layer","changeLevelFunc","toggleLevelFunc","enabled","setEnabled","layerArr","toggleLayerLevel","newEnabled","otherType","hasOwnProperty","window","preventDefault","changeLayerLevel","Layer","changeFunc","changeTypeFunc","removeFunc","hasRemoveFunction","hasRemoveButton","layerName","tileNames","values","layerID","defaultTerrainLayer","AdvancedTerrainGenerator","props","layers","setLayers","newTerrain","assign","changeLayerType","newType","newLayerArray","currentLayer","isEnabled","removeLayer","newArr","newLayer","newLayersArray","concat","TerrainGenerator","visible","setVisible","presetNames","preset","isVisible","newPresetName","currentPreset","Board","landTileIndexes","generateTiles","cellObj","cellRow","tileTypes","getTiles","boardWidth","boardHeight","cellRows","createCellRow","createCell","cellNumbers","getCells","insertEntity","getEntityReferences","removeEntity","previousCellNumbers","runWalkFunc","minX","maxX","nearbyEntities","distanceFromEntity","tileIndex","xo","yo","warn","cellX","cellY","nearbyPosition","positionIsInBoard","creatures","tickedEntities","tick","tileTickAmount","xCell","yCell","cellNumbs","renderListeners","sampleGenes","allGenes","geneVals","creatureCount","fruitCount","fruitMultiplier","defaultGameSettings","fruitSpawnRate","initialCreatures","initialFruit","equilibrium","isPaused","previousTime","Date","now","previousTicks","runTick","querySelectorAll","forEach","census","fruitDensity","FRUIT_SPAWN_RATE","rand","dt","functionIndex","hasRenderListener","confettis","Confetti","createInstance","getRandomPosition","getRandomVelocity","xVel","yVel","confetti","WIDTH_RANGE","HEIGHT_RANGE","rotation","confettiIndex","handleConfettis","openStartMenu","Stages","newGameSettings","JSON","parse","stringify","startClickEvent","CreatureColourSelect","selectedOption","setOptions","newOptionsArray","currentOption","StartMenu","stage","setStage","TerrainGeneration","Options","nextStage","StartGame","openSourceCode","open","focus","Titlescreen","createConfettis","CreatureInspector","setCreature","newCreature","setInspectorRerenderFunction","geneInfo","fillWidth","fillOpacity","opacity","hoverBox","closestCreature","GraphViewer","PauseScreen","hideMask","showMask","StrictMode","onload","onmousemove","composedPath","boardBounds","mouseX","mouseY","mult","mousePos","distanceToClosestCreature","removePreviousHighlight","newHoverBox","parent","createHoverBox","updateMouse","clientX","clientY","onclick","onkeydown","key","activeElement"],"mappings":"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","file":"static/js/main.47799084.chunk.js","sourcesContent":["var map = {\n\t\"./egg/egg-0.png\": 21,\n\t\"./egg/egg-1.png\": 22,\n\t\"./egg/egg-2.png\": 23,\n\t\"./egg/egg-3.png\": 24,\n\t\"./egg/egg-4.png\": 25,\n\t\"./heart/heart-0.png\": 26,\n\t\"./heart/heart-1.png\": 27,\n\t\"./heart/heart-2.png\": 28,\n\t\"./heart/heart-3.png\": 29,\n\t\"./smoke/smoke-0.png\": 30,\n\t\"./smoke/smoke-1.png\": 31,\n\t\"./smoke/smoke-2.png\": 32,\n\t\"./smoke/smoke-3.png\": 33,\n\t\"./smoke/smoke-4.png\": 34\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 20;","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAEBJREFUKFOFT1sKACAIm/c/9MJyphTlh+heoqEXYzXBOQAguXizCe9WyXSGSAnpvgkOsoo84Stww/OEEvVi+3AAKPcaB3YCGM0AAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE1JREFUKFNtj0sSACAIQvHa7j03jRX2bdGU4EMN5+H8msr1AEBy6Ga9vK5drM5pEoHujoioQFHSUOhrnh71NaSQ88iQjQ9ljxBZKx4bNv3HHQfqLQCjAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE5JREFUKFNdj9EWACAEQ+e7PftuHTJRD53Y3Eawj1cpbPcDgLtfXSTb75piT5aJhBwlYVLC0GhVhZl1qvhqGSY+aDQU/QYkhUHXFt/KqR3dtSMH1GudvAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFBJREFUKFNdT0kSACAIwnd71m/baGFZhyYhFgXzxBmFcD8ARMTmRQq+10u28nyiQ0npoKpw9232W38xlVPZqTKz7pBYdumIV0mSEezFFceGC34GKQfwUlcMAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFFJREFUKFNtT0EOACAI0m/rWb9ti6Jyq4MrIBCVfmo/lfC5iEhVLV4V8B0k3V0ioonogK90mMLMXGYfawh3DHKQPYF3B2In4iXNrEWwESu2hgOIACwH4GvOyAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADxJREFUKFOFTlsKACAI2+5/6GLWYJGg+CF7SgxD8asWIMC8CzPQBckwC7IiU+S+tQfOKpOPwKIkP0H36AZOTA4J8eyzugAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADhJREFUKFNjZCAAGIlWcJiB4b8tAwMjjIZpBJsAEkQ3CaQYJAa3AlkRTBJFAcwkZEkMBdgcTNAXALJPCgmBiBW0AAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACpJREFUKFNjZCAAGKmroJeB4X8xAwOKqXAOSBJmHbIiFNV4TcDlWIK+AADFugYJ3JGn6wAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGOmsIISB4f8aBgYUa+ngBgDt+AIJegq8GAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADRJREFUKFNjZCAAGNHl/////5+RkREuDmagCyJrQjEBm0K4AmRJZDaGG2DGwxQRbwUu3wIAPA4cCXVv7EcAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACxJREFUKFNjZCAAGIlW8P////+MjIwYGjAEYAphNIoCbKYQ7waYY9FNIWgCAPvjFAmHkFgYAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACZJREFUKFNjZCAAGKmr4P////9BJjIyMsJNJs8KkEkwU8gzAdlnAJGpCAmOYY4DAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACRJREFUKFNjZCAAGKmv4P////8ZGRnhJqNYgS4Jsp4GbkD3FQAlyAgJTFh8HgAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGAdAwf////8zMjLCraaDGwDLqwQJfZ00UQAAAABJRU5ErkJggg==\"","/**\n * Represents a generic object with an x and y value.\n * @constructor\n * @param {number} x - The x component of the object.\n * @param {number} y - The y component of the object.\n */\nexport class Vector {\n   x: number;\n   y: number;\n\n   constructor(x: number, y: number) {\n      this.x = x;\n      this.y = y;\n   };\n\n   static randomUnitVector(): Vector {\n      const theta = Math.random() * 2 * Math.PI;\n      return new Vector(Math.cos(theta), Math.sin(theta));\n   }\n\n   add(vec2: Vector): Vector {\n      return new Vector(\n         this.x + vec2.x,\n         this.y + vec2.y\n      );\n   };\n\n   dot(vec2: Vector): number {\n      return this.x * vec2.x + this.y * vec2.y;\n   }\n\n   lerp(targetVec: Vector, amount: number): Vector {\n      return new Vector(\n         lerp(this.x, targetVec.x, amount),\n         lerp(this.y, targetVec.y, amount)\n      );\n   };\n\n   distanceFrom(vec2: Vector): number {\n      const distance = Math.sqrt(Math.pow(this.x - vec2.x, 2) + Math.pow(this.y - vec2.y, 2));\n      return distance;\n   };\n\n   angleBetween(vec2: Vector): number {\n      const angle = Math.atan2(vec2.y - this.y, vec2.x - this.x);\n      return angle;\n   }\n\n   convertToPolar(vec2?: Vector): PolarVector {\n      const targetVector = vec2 || new Vector(0, 0);\n\n      const distance = this.distanceFrom(targetVector);\n      const angle = this.angleBetween(targetVector);\n      return new PolarVector(distance, angle);\n   }\n\n   randomOffset(radius: number): Vector {\n      const dist = randFloat(0, radius);\n      const ang = randFloat(0, 360);\n      const offset = new PolarVector(dist, ang);\n      return this.add(offset.convertToCartesian());\n   }\n\n   copy(): Vector {\n      return new Vector(this.x, this.y);\n   }\n}\n\nexport class PolarVector {\n   magnitude: number;\n   direction: number;\n\n   constructor(magnitude: number, direction: number) {\n      this.magnitude = magnitude;\n      this.direction = direction;\n   }\n\n   convertToCartesian(): Vector {\n      const x = Math.cos(this.direction) * this.magnitude;\n      const y = Math.sin(this.direction) * this.magnitude;\n      return new Vector(x, y);\n   }\n\n   static randomUnitVector(): PolarVector {\n      const theta = randFloat(0, 360);\n      // const theta = Math.random() * 2 * Math.PI;\n      return new PolarVector(1, theta);\n      // return new Vector(Math.cos(theta), Math.sin(theta));\n   }\n}\n\nexport function getElem(id: string): HTMLElement {\n   const elem = document.getElementById(id);\n   if (!elem) throw new Error(`ungaming: tried to find element with an id of '${id}' but could not find any.'`);\n   return elem;\n}\n\nexport function getSuffix(num: number): string {\n   return num === 1 ? \"\" : \"s\";\n}\n\n/**\n * Returns a random integer between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randInt(min: number, max: number, isInclusive?: boolean): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.floor(Math.random() * (max - min + (isInclusive ? 1 : 0))) + min;\n}\n\n/**\n * Returns a random float between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randFloat(min: number, max: number): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.random() * (max - min) + min;\n}\n\nexport function randItem(arr: Array<unknown>): unknown {\n   const randIndex = randInt(0, arr.length);\n   return arr[randIndex];\n}\n\nexport function lerp(start: number, target: number, amount: number): number {\n   return (1 - amount) * start + amount * target;\n}\n\nexport function randomGaussianBell(): number {\n   // Box Muller method from https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n   let u = 0, v = 0;\n   while(u === 0) u = Math.random(); //Converting [0,1) to (0,1)\n   while(v === 0) v = Math.random();\n   let num = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );\n   num = num / 10.0 + 0.5; // Translate to 0 -> 1\n   if (num > 1 || num < 0) return randomGaussianBell() // resample between 0 and 1\n   return num;\n }\n\nexport function createHoverBox(text: string, position: Vector, parent: HTMLElement): HTMLElement {\n   const hoverBox = document.createElement(\"div\");\n   hoverBox.className = \"hover-box\";\n   hoverBox.style.left = position.x + \"px\";\n   hoverBox.style.top = position.y + \"px\";\n   hoverBox.innerHTML = text;\n   parent.appendChild(hoverBox);\n\n   return hoverBox;\n}\n\nexport function roundNum(num: number, dpp: number): number {\n   const power = Math.pow(10, dpp)\n   return Math.round((num + Number.EPSILON) * power) / power;\n}\n\nexport function drawRay(start: Vector, end: Vector) {\n   const dist = start.distanceFrom(end);\n   const ang = start.angleBetween(end);\n\n   const ray = document.createElement(\"div\");\n   getElem(\"board\").appendChild(ray);\n   ray.className = \"ray\";\n   ray.style.transform = `rotate(${ang}rad)`;\n   ray.style.width = dist + \"px\";\n   ray.style.left = start.x + \"px\";\n   ray.style.top = start.y + \"px\";\n}\n\nexport function standardDeviation(data: ReadonlyArray<number>): number {\n   const n = data.length;\n   const mean = data.reduce((a, b) => a + b) / n;\n   const sqrDeviations = data.map(val => Math.pow(val - mean, 2));\n   const variance = sqrDeviations.reduce((a, b) => a + b) / n;\n   return Math.sqrt(variance);\n}\n\nexport class Colour {\n   private _hex!: string;\n   public get hex(): string {\n      return \"#\" + this._hex;\n   }\n\n   private _rgb: [number, number, number];\n   public get rgb(): string {\n      const [ r, g, b ] = this._rgb;\n      return `rgb(${r}, ${g}, ${b})`;\n   }\n\n   constructor(colour: string | [number, number, number] ) {\n      if (typeof colour === \"string\") {\n         this._hex = colour.toLowerCase();\n         if (this._hex.length === 7) {\n            this._hex = this._hex.substring(1, 7);\n         }\n   \n         this._rgb = this.getRGB();\n      } else {\n         this._rgb = colour;\n\n         this._hex = Colour.getHex(this._rgb);\n      }\n   }\n\n   private getRGB(): [number, number, number] {\n      const hexDigits = \"0123456789abcdef\".split(\"\");\n\n      const rgb: [number, number, number] = [0, 0, 0];\n      for (let i = 0; i < 3; i++) {\n         const digit1 = hexDigits.indexOf(this._hex[i * 2]);\n         const digit2 = hexDigits.indexOf(this._hex[i * 2 + 1]);\n         rgb[i] = digit1 * 16 + digit2;\n      }\n      return rgb;\n   }\n   private static getHex(rgb: [number, number, number]): string {\n      const hexDigits = \"0123456789abcdef\".split(\"\");\n\n      let hex = \"\";\n      for (let i = 0; i < 3; i++) {\n         const col = rgb[i];\n         const digit2 = col % 16;\n         const digit1 = (col-digit2) / 16;\n         hex += hexDigits[digit1] + hexDigits[digit2];\n      }\n      return hex;\n   }\n\n   darken(amount: number): Colour {\n      // 1 = fully darkened, 0.5 = half darkened\n      // Rounds down\n      const rgb = this._rgb.map(colour => Math.round(colour * (1 - amount))) as [number, number, number];\n      return new Colour(rgb);\n   }\n\n   // https://stackoverflow.com/questions/13348129/using-native-javascript-to-desaturate-a-colour/13355255\n   desaturate(amount: number): Colour {\n      const col = this._rgb.slice();\n      const gray = col[0] * 0.3086 + col[1] * 0.6094 + col[2] * 0.0820;\n\n      col[0] = Math.round(lerp(col[0], gray, amount));\n      col[1] = Math.round(lerp(col[1], gray, amount));\n      col[2] = Math.round(lerp(col[2], gray, amount));\n\n      return new Colour([col[0], col[1], col[2]]);\n   }\n\n   static grayscale(val: number): string {\n      const b16 = Math.floor(val * 255);\n\n      const hex = Colour.getHex([b16, b16, b16]);\n      return hex;\n   }\n}\n\nexport async function sleep(ms: number): Promise<void> {\n   return new Promise(resolve => {\n      setTimeout(resolve, ms);\n   });\n}\n\nexport function clamp(num: number, lowerBound: number, upperBound: number): number {\n   return Math.max(Math.min(num, upperBound), lowerBound);\n}","import Game from \"../Game\";\nimport { getElem, Vector } from \"../utils\";\n\nexport interface EntityGenes {\n   [key: string]: number | string | Vector | undefined;\n   lifespan: number;\n   readonly size: number;\n}\n\nabstract class Entity {\n   [key: string]: any;\n\n   position: Vector;\n   velocity: Vector;\n\n   age: number;\n   lifespan!: number;\n\n   element: HTMLElement;\n\n   constructor(position: Vector, genes: EntityGenes) {\n      this.position = position;\n      // By default all entities has no velocity.\n      this.velocity = new Vector(0, 0);\n      \n      this.age = 0;\n\n      // Set all attributes\n      for (const [geneName, gene] of Object.entries(genes)) {\n         this[geneName] = gene;\n      }\n\n      this.element = this.instantiate();\n      this.createEntity();\n\n      this.updatePosition();\n\n      // Add the entity to the cells array\n      Game.board.createEntity(this);\n   };\n\n   // Used in derived classes to create the actual visual thing\n   abstract instantiate(): HTMLElement;\n\n   static count(entityType: any): number {\n      let count = 0;\n      const entities = new Array<Entity>();\n      for (let y = 0; y < Game.board.height; y++) {\n         for (let x = 0; x < Game.board.width; x++) {\n            const cell = Game.board.cells[y][x];\n            for (const entity of cell) {\n               if (entityType.prototype.isPrototypeOf(entity) && !entities.includes(entity)) {\n                  entities.push(entity);\n                  count++;\n               }\n            }\n         }\n      }\n      return count;\n   }\n\n   private createEntity(): HTMLElement {\n      getElem(\"board\").appendChild(this.element);\n\n      let width: number, height: number;\n\n      if (typeof this.size === \"number\") {\n         // Number\n         width = this.size;\n         height = this.size;\n      } else {\n         // Vector\n         width = this.size.x;\n         height = this.size.y;\n      }\n\n      this.element.style.width = width + \"px\";\n      this.element.style.height = height + \"px\";\n\n      return this.element;\n   };\n\n   tick(ageAmount: number = 1): void {\n      this.age += ageAmount;\n      if (this.age >= this.lifespan) {\n         this.die();\n         return;\n      }\n\n      // Move\n      this.position = this.position.add(this.velocity);\n\n      Game.board.updateEntity(this);\n      this.updatePosition();\n   };\n   protected updatePosition(): void {\n      this.element.style.left = `${this.position.x}px`;\n      this.element.style.top = `${this.position.y}px`;\n   };\n   die(): void {\n      Game.board.deleteEntity(this);\n      \n      this.element.remove();\n   };\n\n   isCollidingWithEntity(entity: Entity): boolean {\n      const distance = this.position.distanceFrom(entity.position);\n\n      if (typeof this.size === \"number\") {\n         return distance - this.size/2 <= 0;\n      } else {\n         if (typeof entity.size === \"number\") {\n            return distance - this.size.x/2 - entity.size/2 <= 0;\n         } else {\n            return distance - this.size.x/2 - entity.size.x/2 <= 0;\n         }\n      }\n   }\n}\n\nexport default Entity;","import Game from \"../Game\";\nimport { Vector } from \"../utils\";\nimport Entity, { EntityGenes } from \"./Entity\";\n\nexport function createFruit(cellNumber?: number): void {\n   const attributes: EntityGenes = {\n      lifespan: 10 * Game.tps,\n      size: 8\n   };\n\n   let position: Vector;\n   if (cellNumber) {\n      position = Game.board.randomPositionInCell(cellNumber);\n   } else {\n      position = Game.board.randomPosition();\n   }\n\n   const colour = Game.board.getFruitColour(position);\n\n   if (colour !== null) {   \n      new Fruit(position, attributes, colour);\n   }\n}\n\nclass Fruit extends Entity {\n   constructor(position: Vector, attributes: EntityGenes, colour: string) {\n      super(position, attributes);\n\n      this.element.style.backgroundColor = colour;\n   }\n\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"fruit\";\n\n      // const FRUIT_COLOURS: ReadonlyArray<string> = [\"red\", \"green\", \"pink\"];\n\n      // const colour = randItem(FRUIT_COLOURS as unknown[]) as string;\n      // element.style.backgroundColor = colour;\n\n      return element;\n   }\n}\n\nexport default Fruit;","import Creature from './classes/Creature';\r\n\r\nexport let inspectorIsOpen: boolean = false;\r\nexport let inspectorCreature: Creature | null = null;\r\n\r\nexport let updateInspector: Function;\r\nexport function setUpdateFunction(func: (creature: Creature | null) => void): void {\r\n    updateInspector = func;\r\n}\r\n\r\nexport let rerenderInspector: Function;\r\nexport function setInspectorRerenderFunction(func: () => void): void {\r\n    rerenderInspector = func;\r\n}\r\n\r\nexport function openInspector(creature: Creature): void {\r\n    inspectorIsOpen = true;\r\n    inspectorCreature = creature;\r\n    updateInspector(creature);\r\n}\r\n\r\nexport function closeInspector(): void {\r\n    inspectorIsOpen = false;\r\n    inspectorCreature = null;\r\n    updateInspector(null);\r\n}","import { getElem, Vector} from '../utils';\r\n\r\nexport const gameImages: Array<GameImage> = new Array<GameImage>();\r\n\r\nclass GameImage {\r\n    name: string;\r\n    position: Vector;\r\n\r\n    element!: HTMLElement;\r\n    width: number;\r\n    height: number;\r\n\r\n    numFrames: number;\r\n    frame: number = 0;\r\n    ticksPerFrame: number;\r\n\r\n    constructor(name: string, numFrames: number, ticksPerFrame: number, width: number, height: number, position: Vector) {\r\n        this.name = name;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.numFrames = numFrames;\r\n        this.ticksPerFrame = ticksPerFrame;\r\n        this.position = position;\r\n\r\n        this.init();\r\n        this.updateBackgroundImage();\r\n\r\n        gameImages.push(this);\r\n    }\r\n    init(): void {\r\n        this.element = document.createElement(\"div\");\r\n        this.element.className = \"game-image\";\r\n        this.element.style.width = this.width + \"px\";\r\n        this.element.style.height = this.height + \"px\";\r\n        getElem(\"board\").appendChild(this.element);\r\n\r\n        this.element.style.backgroundSize = `${this.width}px ${this.height}px`;\r\n        this.element.style.top = this.position.y + \"px\";\r\n        this.element.style.left = this.position.x + \"px\";\r\n    }\r\n\r\n    updateBackgroundImage() {\r\n        const frame = Math.floor(this.frame);\r\n        const src = require(`../images/${this.name}/${this.name}-${frame}.png`).default;\r\n        this.element.style.backgroundImage = `url(${src})`;\r\n    }\r\n\r\n    tick(): void {\r\n        this.frame += 1 / this.ticksPerFrame;\r\n        if (this.frame >= this.numFrames) {\r\n            this.die();\r\n            return;\r\n        }\r\n        this.updateBackgroundImage();\r\n    }\r\n\r\n    die(): void {\r\n        this.element.remove();\r\n\r\n        gameImages.splice(gameImages.indexOf(this), 1);\r\n    }\r\n}\r\n\r\nexport default GameImage;","import Game from \"../Game\";\r\nimport GameImage from \"./GameImage\";\r\nimport { Vector } from \"../utils\";\r\nimport Creature, { CreatureGenes } from \"./Creature\";\r\nimport Entity, { EntityGenes } from \"./Entity\";\r\n\r\nclass Egg extends Entity {\r\n   generation: number;\r\n\r\n   constructor(position: Vector, attributes: EntityGenes, creatureAttributes: CreatureGenes, generation: number) {\r\n      super(position, attributes);\r\n\r\n      this.generation = generation;\r\n      this.creatureAttributes = creatureAttributes;\r\n   }\r\n\r\n   instantiate(): HTMLElement {\r\n      const ticksPerFrame = Math.floor(this.lifespan / 5);\r\n      const element = new GameImage(\"egg\", 5, ticksPerFrame, this.size, this.size, this.position).element;\r\n\r\n      return element;\r\n   }\r\n\r\n   tick(): void {\r\n      super.tick();\r\n\r\n      const shakeAmount = Math.sin(Game.ticks * Game.tps) * 1.25;\r\n      this.element.style.transform = `translate(-50%, -50%) rotate(${shakeAmount}deg)`;\r\n   }\r\n\r\n   die(): void {\r\n      super.die();\r\n\r\n      const creature = new Creature(this.position.copy(), this.creatureAttributes);\r\n      creature.stats.generation = this.generation;\r\n   }\r\n}\r\n\r\nexport default Egg;","import Game from \"../Game\";\nimport { drawRay, PolarVector, randFloat, randInt, randItem, Vector } from \"../utils\";\nimport Entity, { EntityGenes } from \"./Entity\";\nimport Fruit from \"./Fruit\";\nimport Egg from './Egg';\nimport GameImage from \"./GameImage\";\nimport { closeInspector, inspectorCreature } from \"../creature-inspector\";\nimport { TileType } from \"./BoardGenerator\";\n\nexport interface CreatureGenes extends EntityGenes {\n   speed: number;\n   vision: number;\n   reproductiveRate: number;\n}\n\ninterface GeneInfo {\n   display: string;\n   colour: string;\n   min: number;\n   max: number;\n   /*** How strongly an attribute is factored into deciding a creature's lifespan  */\n   weight: number;\n   positivelyAffectsLifespan?: boolean;\n}\n\nexport const creatureGeneInfo: { [key: string]: GeneInfo } = {\n   speed: {\n      display: \"speed\",\n      colour: \"#eeff00\",\n      min: 3,\n      max: 10,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // Size of the creature in px\n   size: {\n      display: \"size\",\n      colour: \"#ff8f00\",\n      min: 10,\n      max: 30,\n      weight: 1,\n      positivelyAffectsLifespan: true\n   },\n   // Vision of the creature in px\n   vision: {\n      display: \"vision\",\n      colour: \"#5400ff\",\n      min: 25,\n      max: 75,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // How quickly the creature gains reproductive urge\n   reproductiveRate: {\n      display: \"reproductive rate\",\n      colour: \"#ff00e0\",\n      min: 0.5,\n      max: 2,\n      weight: 1\n   }\n};\n\nconst calculateLifespan = (attributes: CreatureGenes): number => {\n   // Base number of seconds that a creature will live.\n   const BASE_LIFESPAN: number = 10;\n\n   let lifespan: number = BASE_LIFESPAN * Game.tps;\n\n   for (const attributeInfo of Object.entries(creatureGeneInfo)) {\n      if (!attributeInfo[1].positivelyAffectsLifespan) continue;\n\n      const attributeVal = attributes[attributeInfo[0]] as number;\n\n      if (attributeInfo[1].positivelyAffectsLifespan) {\n         lifespan *= Math.pow(attributeVal / ((attributeInfo[1].min + attributeInfo[1].max) / 2), attributeInfo[1].weight);\n      } else {\n         lifespan *= Math.pow(((attributeInfo[1].min + attributeInfo[1].max) / 2) / attributeVal, attributeInfo[1].weight);\n      }\n   }\n\n   // Creatures which have less offspring give their offspring a higher lifespan\n   lifespan /= Math.pow(attributes.reproductiveRate, 0.7);\n\n   return lifespan;\n}\n\n// Generate a random gene in a specified range.\nconst generateGene = (attributeName: keyof CreatureGenes): number => {\n   const attribute: GeneInfo = creatureGeneInfo[attributeName];\n   return randFloat(attribute.min, attribute.max);\n}\n\nexport function createCreature(): void {\n   const attributes: CreatureGenes = {\n      size: generateGene(\"size\"),\n      speed: generateGene(\"speed\"),\n      vision: generateGene(\"vision\"),\n      reproductiveRate: generateGene(\"reproductiveRate\"),\n      lifespan: 0\n   };\n   attributes.lifespan = calculateLifespan(attributes);\n\n   const position = Game.board.randomPosition();\n   new Creature(position, attributes);\n}\n\nconst REPRODUCTION_TIME = 2000;\nconst ABSTINENCE_TIME = 4000;\n\ninterface CreatureStats {\n   fruitEaten: number;\n   generation: number;\n}\n\nclass Creature extends Entity {\n   readonly speed: number;\n   readonly moveSpeed: number;\n   readonly vision: number;\n   readonly reproductiveRate: number;\n   readonly name: string;\n\n   private readonly birthTileType: TileType;\n   readonly birthTime: number;\n   /** A random number from -100 to 100, used for randomness */\n   readonly seed = randInt(-100, 100, true);\n\n   private isMoving: boolean;\n   private targetPosition: Vector | null = null;\n   protected reproductiveUrge: number = 0;\n   protected partner: Creature | null = null;\n   reproductionStage: number = 0;\n   lastReproductionTime: number = -REPRODUCTION_TIME - Game.settings.eggIncubationTime - ABSTINENCE_TIME;\n\n   stats: CreatureStats = {\n      fruitEaten: 0,\n      generation: 1\n   }\n\n   constructor(position: Vector, attributes: CreatureGenes) {\n      super(position, attributes);\n\n      this.speed = attributes.speed;\n      this.vision = attributes.vision;\n      this.reproductiveRate = attributes.reproductiveRate;\n\n      this.birthTileType = Game.board.getTileType(position);\n      this.birthTime = Game.ticks;\n      this.isMoving = false;\n\n      this.moveSpeed = this.calculateMoveSpeed();\n\n      this.name = this.getName();\n   }\n\n   private getName(): string {\n      const firstNames = [\"Glorb\", \"James\", \"Obama\", \"Gnark\", \"Norbert\"];\n      const adjectives = [\"Feeble\", \"Crippled\", \"Schizophrenic\", \"Weak\"];\n      const nouns = [\"Amoeba\"];\n   \n      let chosenAdjectives = [];\n      let potentialAdjectives = adjectives.slice();\n      while (true) {\n         if (potentialAdjectives.length === 0) break;\n         if (Math.random() <= 0.5) {\n            const idx = randInt(0, potentialAdjectives.length);\n            chosenAdjectives.push(potentialAdjectives[idx]);\n            potentialAdjectives.splice(idx, 1);\n         }\n         else break;\n      }\n      const adjectiveList = chosenAdjectives.reduce((previousValue, currentValue, i) => {\n         let newVal = previousValue;\n         if (i > 0 && chosenAdjectives.length - i > 1) newVal += \", \";\n         else if (chosenAdjectives.length > 1 && chosenAdjectives.length - i === 1) newVal += \" and \";\n         return newVal + currentValue;\n      }, \"\");\n   \n      const hasNoun = Math.random() <= 0.3;\n   \n      let name = randItem(firstNames);\n      if (hasNoun && chosenAdjectives.length > 0) {\n         name += \" the \" + adjectiveList + \" \" + randItem(nouns);\n      } else if (chosenAdjectives.length > 0) {\n         name += \" the \" + adjectiveList;\n      } else if (hasNoun) {\n         name += \" the \" + randItem(nouns);\n      }\n   \n      return name as string;\n   }\n\n   private calculateMoveSpeed(): number {\n      const SPEED_REDUCTION_MULTIPLIER = 1.1;\n      const MAX_REDUCTION = 3;\n      const reduction = creatureGeneInfo.size.max / creatureGeneInfo.size.min / MAX_REDUCTION;\n      return this.speed /  Math.pow(this.size / creatureGeneInfo.size.min / reduction, SPEED_REDUCTION_MULTIPLIER);\n   }\n\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"creature\";\n\n      if (Game.settings.creatureColour === \"regular\") {\n         element.style.backgroundColor = \"green\";\n      } else if (Game.settings.creatureColour === \"gene-based\") {\n         const r = (this.speed - creatureGeneInfo.speed.min) * 255 / (creatureGeneInfo.speed.max / creatureGeneInfo.speed.min);\n         const g = (this.size - creatureGeneInfo.size.min) * 255 / (creatureGeneInfo.size.max / creatureGeneInfo.size.min);\n         const b = (this.reproductiveRate - creatureGeneInfo.reproductiveRate.min) * 255 / (creatureGeneInfo.reproductiveRate.max / creatureGeneInfo.reproductiveRate.min);\n         element.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;\n      } else if (Game.settings.creatureColour === \"rgb\") {\n         element.classList.add(\"rgb\");\n         const delay = randInt(0, 2000, true);\n         element.style.animationDelay = delay + \"ms\";\n      }\n\n      element.innerHTML = `\n      <div class=\"shadow\"></div>\n\n      <div class=\"life\">\n         <div class=\"life-bar\"></div>\n\n         </div>\n      <div class=\"reproduction\">\n         <div class=\"reproduction-bar\"></div>\n      </div>\n      `;\n      \n      element.style.setProperty(\"--vision-size\", `${this.vision}px`);\n      element.style.setProperty(\"--creature-size\", `${this.size}px`);\n\n      return element;\n   };\n\n   get life(): number {\n      return (this.lifespan - this.age) / this.lifespan * 100;\n   }\n\n   private updateLifebar(): void {\n      const lifebar = this.element.querySelector(\".life-bar\") as HTMLElement;\n      \n      lifebar.style.width = `${this.life}%`;\n      // Colour the lifebar a shade of red corresponding to how much life the creature has left\n      const color = 155 + this.life;\n      lifebar.style.backgroundColor = `rgb(${color}, 0, 0)`;\n   };\n\n   private updateReproductionBar(): void {\n      const reproductionBar = this.element.querySelector(\".reproduction-bar\") as HTMLElement;\n      \n      reproductionBar.style.width = `${this.reproductiveUrge}%`;\n   };\n\n   get wantsToReproduce(): boolean {\n      return this.reproductiveUrge > this.life && this.reproductionStage < 2;\n   }\n\n   tick(): void {\n      const currentTile = Game.board.getTileType(this.position);\n      \n      let ageAmount = 1;\n      if (currentTile.effects?.metabolismMultiplier) ageAmount *= currentTile.effects.metabolismMultiplier;\n      super.tick(ageAmount);\n\n      // Base amount of reproductive urge gained per second\n      if (this.reproductionStage === 0 && (Game.ticks - this.lastReproductionTime) * 1000 / Game.tps > REPRODUCTION_TIME + Game.settings.eggIncubationTime + ABSTINENCE_TIME) {\n         this.element.classList.remove(\"abstaining\");\n         const BASE_REPRODUCTIVE_RATE = 2;\n         this.reproductiveUrge += BASE_REPRODUCTIVE_RATE * this.reproductiveRate / Game.tps;\n         this.reproductiveUrge = Math.min(100, this.reproductiveUrge);\n      } else if (this.reproductionStage >= 2) {\n         // Stop aging if the creature is reproducing\n         this.age -= 1;\n      }\n\n      this.updateLifebar();\n      this.updateReproductionBar();\n\n      // If the creature has a target position, move to it\n      if (this.targetPosition !== null) {\n         if (this.hasReachedTargetPosition()) {\n            // If it has reached its target, stop moving\n            this.reachTargetPosition();\n         } else {\n            // Otherwise continue moving\n            this.moveToTargetPosition(currentTile);\n         }\n      }\n\n      switch (this.reproductionStage) {\n         case 1: {\n            /*** Average amount of particles which spawn each second */\n            const particleAmount = 3;\n            if (Math.random() <= particleAmount / Game.tps) {\n               const imagePos = this.position.randomOffset(30);\n               new GameImage(\"heart\", 4, 2, 16, 16, imagePos);\n            }\n            break;\n         }\n         case 2: {\n            if (Math.random() <= 3 / Game.tps) {\n               const particleAttempts = randInt(4, 11);\n               const chance = 0.7;\n               for (let i = 0; i < particleAttempts; i++) {\n                  if (Math.random() <= chance) {\n                     const imagePos = this.position.randomOffset(40);\n                     const size = randInt(12, 24);\n                     new GameImage(\"heart\", 4, 3, size, size, imagePos);\n                  }\n               }\n            }\n            if (Math.random() < 6 / Game.tps) {\n               const imagePos = this.position.randomOffset(20);\n               const size = randInt(12, 18);\n               new GameImage(\"heart\", 4, 3, size, size, imagePos);\n            }\n            break;\n         }\n      }\n\n      let entitiesInVision = Game.board.getNearby(this.position, this.vision);\n      while (true) {\n         const selfIdx = entitiesInVision.indexOf(this);\n         if (selfIdx !== -1) entitiesInVision.splice(selfIdx, 1);\n         else break;\n      }\n\n      // Search through all nearby entities for any that are of use\n      let closestFruit: Fruit | null = null;\n      let distanceToNearestFruit = Number.MAX_SAFE_INTEGER;\n      let closestPartner: Creature | null = null;\n      let distanceToClosestPartner = Number.MAX_SAFE_INTEGER;\n      for (const entity of entitiesInVision) {\n         const entityIsCreature: boolean = entity instanceof Creature;\n         const entityIsFruit: boolean = entity instanceof Fruit;\n\n         if (entityIsCreature && this.wantsToReproduce && entity.wantsToReproduce && (entity.partner === null || entity.partner === this)) {\n            // If it wants to, look for any available partners\n            const distanceToCreature = this.position.distanceFrom(entity.position);\n            if (distanceToCreature < distanceToClosestPartner) {\n               closestPartner = entity as Creature;\n               distanceToClosestPartner = distanceToCreature;\n            }\n         }\n         else if (entityIsFruit) {\n            const fruitTileType = Game.board.getTileType(entity.position);\n            if (!(fruitTileType !== this.birthTileType && Math.random() >= Game.settings.tilePreference)) {\n               const distanceToFruit = this.position.distanceFrom(entity.position);\n               if (distanceToFruit < distanceToNearestFruit) {\n                  closestFruit = entity;\n                  distanceToNearestFruit = distanceToFruit;\n               }\n            }\n         }\n\n         if (super.isCollidingWithEntity(entity)) {\n            if (entity === this.partner && this.wantsToReproduce) {\n               this.handleReproduction();\n            } else if (entityIsFruit) {\n               this.eatFruit(entity);\n            }\n         }\n      }\n\n      // If there are any available partners, move to them\n      if (closestPartner !== null && this.reproductionStage < 2) {\n         this.targetPosition = closestPartner.position;\n         this.partner = closestPartner;\n         this.reproductionStage = 1;\n         return;\n      } else if (this.reproductionStage === 1) {\n         this.reproductionStage = 0;\n      } else if (this.reproductionStage >= 2) return;\n\n      // Otherwise if there is a nearby fruit, go to it\n      if (closestFruit !== null) {\n         this.targetPosition = closestFruit.position;\n         return;\n      }\n\n      // Otherwise, try to move to a random surrounding position\n      if (!this.isMoving) {\n         // Chance for the creature to move each second\n         const MOVE_CHANCE = 0.95;\n         if (Math.random() < MOVE_CHANCE / Game.tps) {\n            const randomPosition = Game.board.randomNearbyPosition(this.position, this.vision, this.birthTileType);\n            this.targetPosition = randomPosition;\n         }\n      }\n   };\n\n   private eatFruit(fruit: Fruit): void {\n      this.stats.fruitEaten++;\n\n      // Number of seconds of life it gives\n      const FEED_AMOUNT = 10;\n      this.age -= FEED_AMOUNT * Game.tps;\n      // Stop the creature's age from going below 0\n      this.age = Math.max(this.age, 0);\n\n      fruit.die();\n   };\n\n   damage(amount: number): void {\n      this.age += amount;\n   }\n\n   private moveToTargetPosition(currentTile: TileType): void {\n      this.isMoving = true;\n\n      if (this === inspectorCreature) {\n         drawRay(this.position, this.targetPosition as Vector);\n      }\n\n      let moveSpeed = this.moveSpeed;\n\n      if (currentTile.effects?.speedMultiplier) moveSpeed *= currentTile.effects.speedMultiplier;\n\n      // Convert from cartesian to polar coordinates\n      const angleToTarget = this.position.angleBetween(this.targetPosition!);\n      const nextPosition = new PolarVector(moveSpeed, angleToTarget);\n\n      this.velocity = nextPosition.convertToCartesian();\n   };\n\n   private hasReachedTargetPosition(): boolean {\n      // Use black magic to figure out if the creature is facing towards the target position\n\n      const relativeTargetVec = new Vector(this.position.x - this.targetPosition!.x, this.position.y - this.targetPosition!.y);\n\n      const dotProduct = this.velocity.dot(relativeTargetVec);\n      return dotProduct > 0;\n   };\n\n   private reachTargetPosition(): void {\n      this.isMoving = false;\n\n      this.velocity = new Vector(0, 0);\n\n      this.targetPosition = null;\n   };\n\n   handleReproduction(): void {\n      this.reproduce()\n      .then(() => this.layEgg());\n   };\n\n   reproduce(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 2;\n         this.targetPosition = null;\n         this.velocity = new Vector(0, 0);\n         this.isMoving = false;\n         this.reproductiveUrge = 0;\n         this.element.classList.add(\"abstaining\");\n         this.lastReproductionTime = Game.ticks;\n         \n         setTimeout(() => {\n            resolve();\n         }, REPRODUCTION_TIME);\n      });\n   }\n\n   layEgg(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 0;\n         // Ensure that only 1 egg is created\n         if ((this.partner as Creature).reproductionStage !== 0) {\n            const childAttributes = this.generateChildGenes(this.partner as Creature);\n\n            const eggAttributes = {\n               size: 20,\n               lifespan: Game.settings.eggIncubationTime * Game.tps\n            };\n            const eggPos = this.position.randomOffset(10);\n            new Egg(eggPos, eggAttributes, childAttributes, this.stats.generation + 1);\n         }\n\n         this.partner = null;\n\n         setTimeout(() => {\n            resolve();\n         }, Game.settings.eggIncubationTime * 1000);\n      });\n   }\n\n   generateChildGenes(partner: Creature): CreatureGenes {\n      let attributes: { [key: string]: number } = {};\n\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         // Pick a random allele\n         let gene = Math.random() <= 0.5 ? this[geneName] : partner[geneName];\n         attributes[geneName] = gene;\n\n         // Chance to mutate the gene\n         if (Math.random() <= 0.3) {\n            gene = this.mutateGene(geneName, gene);\n         }\n      }\n\n      attributes.lifespan = calculateLifespan(attributes as CreatureGenes);\n\n      return attributes as CreatureGenes;\n   }\n\n   private mutateGene(name: string, initialGeneVal: number): number {\n      const gene = creatureGeneInfo[name];\n\n      // min mutate amount * math.random() (maybe go higher )\n      let mutateAmount = (gene.min + gene.max) / 300;\n\n      mutateAmount *= randFloat(0.1, 1) * Game.settings.creatureMutationRate;\n\n      const dir = Math.sign(Math.random() - 0.5);\n      mutateAmount *= dir;\n\n      mutateAmount *= Game.settings.creatureMutationRate;\n\n      return initialGeneVal + mutateAmount;\n   }\n\n   die(): void {\n      if (this === inspectorCreature) {\n         closeInspector();\n      }\n\n      super.die();\n   }\n}\n\nexport default Creature;","import React, { useEffect } from 'react';\nimport Creature, { createCreature } from '../classes/Creature';\nimport Entity from '../classes/Entity';\nimport Fruit, { createFruit } from '../classes/Fruit';\nimport \"../css/control-panel.css\";\nimport Game from '../Game';\nimport { getElem, roundNum } from '../utils';\nimport InputCheckbox from './InputCheckbox';\nimport InputRange from './InputRange';\n\nexport let updateControlPanel: Function;\n\nconst createCreatures = (amount: number): void => {\n   for (let i = 0; i < amount; i++) createCreature();\n}\nconst createFruits = (amount: number): void => {\n   for (let i = 0; i < amount; i++) {\n      createFruit();\n   }\n}\n\nconst changeDarkMode = (newVal: boolean): void => {\n   if (newVal) {\n      document.body.classList.add(\"dark-mode\");\n   } else {\n      document.body.classList.remove(\"dark-mode\");\n   }\n}\n\nconst changeTimewarp = (newVal: number) => {\n   Game.timewarp = newVal;\n}\n\nconst changeDebugOutputMode = (newVal: boolean) => {\n   Game.settings.showDebugOutput = newVal;\n}\n\nconst expandControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.remove(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.add(\"hidden\");\n}\nconst collapseControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.add(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.remove(\"hidden\");\n}\n\nconst snap = () => {\n   let creatureSnapCount = 0;\n   let fruitSnapCount = 0;\n   for (let y = 0; y < Game.boardSize.height; y++) {\n      for (let x = 0; x < Game.boardSize.width; x++) {\n         const cell = Game.board.cells[y][x];\n         for (const entity of cell) {\n            if (entity instanceof Creature) {\n               if (creatureSnapCount++ % 2 === 0) {\n                  entity.die();\n               }\n            } else if (entity instanceof Fruit) {\n               if (fruitSnapCount++ % 2 === 0) {\n                  entity.die();\n               }\n            }\n         }\n      }\n   }\n\n   document.body.classList.remove(\"flash\");\n   setTimeout(() => {\n      document.body.classList.add(\"flash\");\n   }, 5);\n}\n\nconst ControlPanel = () => {\n   const [, updateState] = React.useState({});\n   const forceUpdate = React.useCallback(() => updateState({}), []);\n\n   useEffect(() => {\n      updateControlPanel = forceUpdate;\n   }, [forceUpdate]);\n\n   return (\n      <>\n         <div id=\"expand-icon\" className=\"hidden\" onClick={expandControlPanel}>\n            <div className=\"formatter\">\n               <div className=\"vertical-bar\"></div>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n            <div className=\"text\">Control Panel</div>\n         </div>\n         <div id=\"control-panel\" className=\"menu\">\n            <div className=\"collapse-icon\" onClick={collapseControlPanel}>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n\n            <h1 className=\"heading\">Control Panel</h1>\n\n            <h2 className=\"subheading\">Settings</h2>\n\n            <InputCheckbox name=\"dark-mode\" text=\"Dark Mode\" defaultValue={true} func={(newVal: boolean) => changeDarkMode(newVal)} />\n            <InputCheckbox name=\"show-debug-output\" text=\"Show Debug Output\" defaultValue={false} func={newVal => changeDebugOutputMode(newVal)} />\n\n            { Game.hasStarted ? ( <>\n               <button id=\"open-graph-viewer-button\">View Graphs</button>\n\n               <h2 className=\"subheading\">Overview</h2>\n\n               <p>Creatures: {Entity.count(Creature)}</p> \n               <p>Fruit: {Entity.count(Fruit)}</p>\n               <p>Time elapsed: {roundNum(Game.ticks / 20, 1)} seconds <i>({Game.ticks} ticks)</i></p>\n               \n               <h2 className=\"subheading\">Population Control</h2>\n               \n               <InputRange button=\"Create\" text=\"Create creatures\" min={1} max={10} defaultValue={1} step={1} func={createCreatures} />\n               <InputRange button=\"Create\" text=\"Create fruit\" min={5} max={100} defaultValue={5} step={5} func={createFruits} />\n\n               <button onClick={snap}>Snap</button>\n\n               <h2 className=\"subheading\">World</h2>\n               \n               <InputRange text=\"Timewarp\" min={1} max={10} defaultValue={1} step={1} func={changeTimewarp} hasExtremeMode={true} />\n            </> ) : \"\"}\n         </div>\n      </>\n   );\n}\n\nexport default ControlPanel;\n","import { useRef, useState } from 'react';\r\n\r\ninterface InputCheckboxProps {\r\n   name: string;\r\n   text: string;\r\n   defaultValue: boolean;\r\n   func?: (inputVal: boolean, elem?: HTMLElement) => void;\r\n}\r\n\r\nconst InputCheckbox = ({ name, text, defaultValue, func }: InputCheckboxProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = !!Number((inputRef.current! as HTMLInputElement).checked);\r\n\r\n      if (func) func(inputVal, inputRef.current!);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const htmlName = \"_INPUT_\" + name;\r\n\r\n   const className = `input-checkbox ${val ? \"selected\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <input ref={inputRef} onChange={onInputChange} type=\"checkbox\" id={htmlName} defaultChecked={defaultValue} />\r\n         <label htmlFor={htmlName}>{text}</label>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputCheckbox;\r\n","import React, { useRef, useState } from 'react';\r\n\r\ninterface InputRangeProps {\r\n   text: string;\r\n   min: number;\r\n   max: number;\r\n   defaultValue: number;\r\n   step: number;\r\n   func?: (inputVal: number) => unknown;\r\n   button?: string;\r\n   /*** If present, using the max value will enable \"extreme mode\" (purely visual) */\r\n   hasExtremeMode?: boolean;\r\n   prefix?: string;\r\n   description?: string;\r\n}\r\n\r\nconst InputRange = ({ text, min, max, defaultValue, step, func, button, hasExtremeMode, prefix, description }: InputRangeProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = Number((inputRef.current! as HTMLInputElement).value);\r\n\r\n      if (func && button === undefined) func(inputVal);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const extremeModeIsEnabled = hasExtremeMode ? val >= max : false;\r\n   const className = `input-range  ${extremeModeIsEnabled ? \"extreme\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <div className=\"formatter\">\r\n            <div className=\"text\">{text}</div>\r\n\r\n            <div>\r\n               <div className=\"value\">{val}{prefix}</div>\r\n               <div className=\"bar-container\">\r\n                  <div className=\"min\">{min}</div>\r\n                  <input ref={inputRef} onInput={onInputChange} type=\"range\" min={min} max={max} step={step} defaultValue={defaultValue} />\r\n                  <div className=\"max\">{max}</div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n\r\n         {description ?\r\n            <div className=\"description\">{description}</div>\r\n         : \"\"}\r\n\r\n         {button ?\r\n            <button onClick={() => {if (func) func(val)}}>{button}</button>\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputRange;\r\n","import Game, { GeneSampleEntry } from '../Game';\r\nimport { GraphOptions } from '../graph-viewer';\r\nimport { Colour, lerp, roundNum, Vector } from \"../utils\";\r\n\r\ntype timeUnits = \"seconds\" | \"minutes\";\r\n\r\nexport interface GraphSettings {\r\n   readonly shouldExtrapolate: boolean;\r\n}\r\n\r\nexport type GraphData = Array<GeneSampleEntry | null> | Array<number | null>;\r\nexport type GraphType = \"simple\" | \"detailed\";\r\nclass Graph {\r\n   private readonly data: GraphData;\r\n\r\n   readonly element: HTMLElement;\r\n   private readonly width: number;\r\n   private readonly height: number;\r\n   private readonly time = Game.ticks;\r\n   private readonly settings: GraphSettings;\r\n   private readonly options: GraphOptions;\r\n\r\n   private readonly minY: number;\r\n   private readonly maxY: number;\r\n   \r\n   private readonly xAxisMeasurements = 10;\r\n   private readonly timeUnit: timeUnits = this.calculateTimeUnit(this.time);\r\n\r\n   constructor(width: number, height: number, data: GraphData, settings: GraphSettings, options: GraphOptions) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.data = data;\r\n      this.settings = settings;\r\n      this.options = options;\r\n\r\n      this.minY = this.calculateMinY();\r\n      this.maxY = this.calculateMaxY();\r\n\r\n      this.element = this.instantiate();\r\n      \r\n      this.createTitle();\r\n      this.plotData();\r\n      this.createAxes();\r\n      this.createLabels();\r\n   }\r\n   instantiate(): HTMLElement {\r\n      const element = document.createElement(\"div\");\r\n      element.className = \"graph\";\r\n\r\n      element.style.width = this.width + \"px\";\r\n      element.style.height = this.height + \"px\";\r\n\r\n      return element;\r\n   }\r\n\r\n   private calculateMinY(): number {\r\n      if (this.options.min) return this.options.min;\r\n      return 0;\r\n   }\r\n   private calculateMaxY(): number {\r\n      if (this.options.max) return this.options.max;\r\n\r\n      let maxY = 0;\r\n      if (this.options.type === \"simple\") {\r\n         for (const dataPoint of (this.data as Array<number | null>)) {\r\n            if (dataPoint !== null && dataPoint > maxY) maxY = dataPoint;\r\n         }\r\n      } else if (this.options.type === \"detailed\") {\r\n         for (const dataPoint of (this.data as Array<GeneSampleEntry | null>)) {\r\n            if (dataPoint !== null && dataPoint.max > maxY) maxY = dataPoint.max;\r\n         }\r\n      }\r\n      return maxY;\r\n   }\r\n\r\n   private calculateTimeUnit(time: number): timeUnits {\r\n      const seconds = time / 20;\r\n      if (seconds / this.xAxisMeasurements > 60) {\r\n         return \"minutes\";\r\n      } else {\r\n         return \"seconds\";\r\n      }\r\n   }\r\n\r\n   private drawPoint(pos: Vector, colour: string): void {\r\n      const point = document.createElement(\"div\");\r\n      point.className = \"point\";\r\n      point.style.backgroundColor = colour;\r\n      this.element.appendChild(point);\r\n      \r\n      point.style.left = pos.x + \"px\";\r\n      point.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   private drawLine(previousPos: Vector, pos: Vector, colour: string): void {\r\n      const line = document.createElement(\"div\");\r\n      line.className = \"line\";\r\n      this.element.appendChild(line);\r\n      \r\n      line.style.left = previousPos.x + \"px\";\r\n      line.style.bottom = previousPos.y + \"px\";\r\n      line.style.backgroundColor = colour;\r\n      \r\n      const dist = previousPos.distanceFrom(pos);\r\n      const ang = -previousPos.angleBetween(pos);\r\n      line.style.width = dist + \"px\";\r\n      line.style.transform = `rotate(${ang}rad)`;\r\n   }\r\n\r\n   private drawRect(pos: Vector, width: number, height: number, colour: string): void {\r\n      const rect = document.createElement(\"div\");\r\n      rect.className = \"rect\";\r\n      this.element.appendChild(rect);\r\n\r\n      rect.style.width = width + \"px\";\r\n      rect.style.height = height + \"px\";\r\n      rect.style.backgroundColor = colour;\r\n\r\n      rect.style.left = pos.x + \"px\";\r\n      rect.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   private drawTrangle(pos: Vector, width: number, height: number, colour: string, type: \"top-left\" | \"top-right\" | \"bottom-right\" | \"bottom-left\"): void {\r\n      const triangle = document.createElement(\"div\");\r\n      triangle.className = `triangle ${type}`;\r\n      this.element.appendChild(triangle);\r\n\r\n      triangle.style.setProperty(\"--width\", height / 2 + \"px\");\r\n      triangle.style.setProperty(\"--height\", width / 2 + \"px\");\r\n      triangle.style.setProperty(\"--colour\", colour);\r\n\r\n      triangle.style.left = pos.x + \"px\";\r\n      triangle.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   getData(): GraphData {\r\n      const EXTRAPOLATION_AMOUNT = 75;\r\n      if (!this.settings.shouldExtrapolate || this.data.length <= EXTRAPOLATION_AMOUNT) {\r\n         return this.data;\r\n      }\r\n\r\n      let data!: GraphData;\r\n      if (this.options.type === \"simple\") {\r\n         data = new Array<number | null>();\r\n      } else if (this.options.type === \"detailed\") {\r\n         data = new Array<GeneSampleEntry | null>();\r\n      }\r\n\r\n      for (let i = 0; i < EXTRAPOLATION_AMOUNT; i++) {\r\n         const relativeIndex = this.data.length * i/EXTRAPOLATION_AMOUNT;\r\n\r\n         if (this.options.type === \"simple\") {\r\n            let dataPoint: number | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as number | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as number | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as number | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = lerp(floorVal as number, ceilVal as number, remainder);\r\n               }\r\n            }\r\n            (data as Array<number | null>).push(dataPoint);\r\n         } else if (this.options.type === \"detailed\") {\r\n            let dataPoint: GeneSampleEntry | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as GeneSampleEntry | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as GeneSampleEntry | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as GeneSampleEntry | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = {\r\n                     average: lerp(floorVal!.average, ceilVal!.average, remainder),\r\n                     min: lerp(floorVal!.min, ceilVal!.min, remainder),\r\n                     max: lerp(floorVal!.max, ceilVal!.max, remainder),\r\n                     standardDeviation: lerp(floorVal!.standardDeviation, ceilVal!.standardDeviation, remainder)\r\n                  }\r\n               }\r\n            }\r\n            (data as Array<GeneSampleEntry | null>).push(dataPoint);\r\n         }\r\n      }\r\n      return data;\r\n   }\r\n\r\n   plotData(): void {\r\n      const data = this.getData();\r\n\r\n      if (this.options.type === \"simple\") {\r\n         this.plotSimpleData(data as Array<number | null>);\r\n      } else if (this.options.type === \"detailed\") {\r\n         this.plotDetailedData(data as Array<GeneSampleEntry | null>);\r\n      }\r\n   }\r\n\r\n   plotSimpleData(data: Array<number | null>): void {\r\n      let previousPos: Vector | null = null;\r\n      for (let i = 0; i < data.length; i++) {\r\n         const dataPoint = data[i];\r\n         if (dataPoint === null) {\r\n            previousPos = null;\r\n            continue;\r\n         }\r\n         const stepSize = this.width / (data.length-1);\r\n         \r\n         const pos = new Vector(\r\n            stepSize * i,\r\n            this.height * (dataPoint - this.minY)/(this.maxY - this.minY)\r\n         );\r\n\r\n         this.drawPoint(pos, this.options.colour);\r\n         if (i > 0 && previousPos !== null) {\r\n            this.drawLine(previousPos, pos, this.options.colour);\r\n         }\r\n\r\n         previousPos = pos;\r\n      }\r\n   }\r\n\r\n   draw(colour: string, stepSize: number, i: number, value: number, previousPos: Vector | null, shouldDrawPoint: boolean): Vector | null {\r\n      const pos = new Vector(\r\n         stepSize * i,\r\n         this.height * (value - this.minY)/(this.maxY - this.minY)\r\n      );\r\n\r\n      if (shouldDrawPoint) this.drawPoint(pos, colour);\r\n      if (i > 0 && previousPos !== null) {\r\n         this.drawLine(previousPos, pos, colour);\r\n      }\r\n      return pos;\r\n   }\r\n\r\n   plotDetailedData(data: Array<GeneSampleEntry | null>): void {\r\n      const averageColour = new Colour(this.options.colour);\r\n\r\n      let stdevColour = averageColour.desaturate(0.3);\r\n      stdevColour = stdevColour.darken(0.2);\r\n\r\n      let outerColour = averageColour.desaturate(0.7);\r\n      outerColour = outerColour.darken(0.2);\r\n\r\n      const n = data.length;\r\n\r\n      let previousAveragePos: Vector | null = null;\r\n      let previousMinPos: Vector | null = null;\r\n      let previousMaxPos: Vector | null = null;\r\n      let previousStdevMinPos: Vector | null = null;\r\n      let previousStdevMaxPos: Vector | null = null;\r\n      for (let i = 0; i < n; i++) {\r\n         const entry = data[i];\r\n         if (entry === null) {\r\n            continue;\r\n         }\r\n\r\n         const stepSize = this.width / (n-1);\r\n\r\n         previousAveragePos = this.draw(this.options.colour, stepSize, i, entry.average, previousAveragePos, true);\r\n\r\n         previousMinPos = this.draw(outerColour.hex, stepSize, i, entry.min, previousMinPos, false);\r\n         previousMaxPos = this.draw(outerColour.hex, stepSize, i, entry.max, previousMaxPos, false);\r\n\r\n         const stdevMinPos = this.draw(stdevColour.hex, stepSize, i, entry.average - entry.standardDeviation, previousStdevMinPos, false);\r\n         const stdevMaxPos = this.draw(stdevColour.hex, stepSize, i, entry.average + entry.standardDeviation, previousStdevMaxPos, false);\r\n         if (i > 0 && stdevMinPos !== null && stdevMaxPos !== null && previousStdevMinPos !== null && previousStdevMaxPos !== null) {\r\n            const rectWidth = stdevMinPos.x - previousStdevMinPos.x;\r\n            const height = Math.min(previousStdevMaxPos.y, stdevMaxPos.y) - Math.max(previousStdevMinPos.y, stdevMinPos.y);\r\n            const rectPos = new Vector(\r\n               previousStdevMinPos.x,\r\n               Math.max(previousStdevMinPos.y, stdevMinPos.y)\r\n            );\r\n            this.drawRect(rectPos, rectWidth, height, stdevColour.hex);\r\n\r\n            const topTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMaxPos.y, previousStdevMaxPos.y));\r\n            if (previousStdevMaxPos.y > stdevMaxPos.y) {\r\n               this.drawTrangle(topTrianglePos, rectWidth, previousStdevMaxPos.y - stdevMaxPos.y, stdevColour.hex, \"bottom-left\");\r\n            } else {\r\n               this.drawTrangle(topTrianglePos, rectWidth, stdevMaxPos.y - previousStdevMaxPos.y, stdevColour.hex, \"bottom-right\");\r\n            }\r\n            \r\n            const bottomTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMinPos.y, previousStdevMinPos.y));\r\n            if (previousStdevMinPos.y > stdevMinPos.y) {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, previousStdevMinPos.y - stdevMinPos.y, stdevColour.hex, \"top-right\");\r\n            } else {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, stdevMinPos.y - previousStdevMinPos.y, stdevColour.hex, \"top-left\");\r\n            }\r\n         }\r\n         \r\n         previousStdevMaxPos = stdevMaxPos;\r\n         previousStdevMinPos = stdevMinPos;\r\n      }\r\n   }\r\n\r\n   createAxisMeasurement(val: number): HTMLElement {\r\n      const measurement = document.createElement(\"div\");\r\n      measurement.className = \"measurement\";\r\n      this.element.appendChild(measurement);\r\n      const dpp = 1;\r\n      measurement.innerHTML = roundNum(val, dpp).toString();\r\n\r\n      return measurement;\r\n   }\r\n\r\n   private createAxes(): void {\r\n      // Time\r\n      for (let i = 0; i < this.xAxisMeasurements; i++) {\r\n         let val = this.time / this.xAxisMeasurements * i / Game.tps;\r\n         if (this.timeUnit === \"minutes\") val /= 60;\r\n         \r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"x\");\r\n         measurement.style.left = this.width / this.xAxisMeasurements * i * (this.xAxisMeasurements+1)/this.xAxisMeasurements + \"px\";\r\n      }\r\n      \r\n      const Y_AXIS_MEASUREMENTS = 7;\r\n      for (let i = 0; i < Y_AXIS_MEASUREMENTS; i++) {\r\n         const val = this.minY + i * (this.maxY - this.minY)/(Y_AXIS_MEASUREMENTS-1);\r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"y\");\r\n         measurement.style.bottom = this.height / (Y_AXIS_MEASUREMENTS-1) * i + \"px\";\r\n      }\r\n   }\r\n\r\n   private createLabels(): void {\r\n      const xLabel = document.createElement(\"div\");\r\n      xLabel.className = \"label x-label\";\r\n      this.element.appendChild(xLabel);\r\n      if (this.timeUnit === \"seconds\") {\r\n         xLabel.innerHTML = \"Seconds\";\r\n      } else if (this.timeUnit === \"minutes\") {\r\n         xLabel.innerHTML = \"Minutes\";\r\n      }\r\n\r\n      const yLabel = document.createElement(\"div\");\r\n      yLabel.className = \"label y-label\";\r\n      this.element.appendChild(yLabel);\r\n      const val = this.options.dependentVariable;\r\n      yLabel.innerHTML = val;\r\n   }\r\n\r\n   private createTitle(): void {\r\n      const title = document.createElement(\"div\");\r\n      title.className = \"title\";\r\n      this.element.appendChild(title);\r\n\r\n      const text = `${this.options.dependentVariable} over time`;\r\n      title.innerHTML = text;\r\n   }\r\n}\r\n\r\nexport default Graph;","import ReactDOM from 'react-dom';\r\nimport { creatureGeneInfo } from './classes/Creature';\r\nimport Graph, { GraphData, GraphSettings, GraphType } from './classes/Graph';\r\nimport InputCheckbox from './components/InputCheckbox';\r\nimport InputRange from './components/InputRange';\r\nimport { geneSamples } from './Game';\r\nimport { hideMask, showMask } from './index';\r\nimport { getElem } from './utils';\r\n\r\nexport let graphViewerIsVisible: boolean = false;\r\n\r\ntype settingType = \"checkbox\" | \"range\";\r\ninterface Setting {\r\n   text: string;\r\n   type: settingType;\r\n   description?: string;\r\n   isChecked?: boolean;\r\n   value?: number;\r\n   min?: number;\r\n   max?: number;\r\n   step?: number;\r\n   defaultValue: boolean | number;\r\n   requirement?: string;\r\n   elem?: JSX.Element;\r\n}\r\nexport const graphSettingData: ReadonlyArray<Setting> = [\r\n   {\r\n      text: \"Extrapolate values\",\r\n      type: \"checkbox\",\r\n      description: \"Reduces the amount of nodes rendered, will significantly reduce lag in extreme scenarios.\",\r\n      defaultValue: false\r\n   },\r\n   // {\r\n   //    text: \"Max number of points\",\r\n   //    type: \"range\",\r\n   //    description: \"The highest number of points, after which values will be extrapolated.\",\r\n   //    defaultValue: 50,\r\n   //    min: 50,\r\n   //    max: 100,\r\n   //    step: 5,\r\n   //    requirement: \"Extrapolate values\"\r\n   // },\r\n   {\r\n      text: \"Automatically update\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show points\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show lines\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   }\r\n];\r\n\r\nconst createSettings = (): void => {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const settingsContainer = graphViewer.querySelector(\".settings-container\");\r\n\r\n   const elems: Array<JSX.Element> = graphSettingData.map((setting, i) => {\r\n      const baseClickEvent = (): void => {\r\n         // Check for any settings which require this one\r\n         for (const settingCheck of graphSettingData) {\r\n            if (settingCheck.requirement === setting.text) {\r\n\r\n            }\r\n         }\r\n\r\n         drawGraphs();\r\n      }\r\n\r\n      let elem: JSX.Element;\r\n      const name = `graph-setting-${i}`;\r\n      switch (setting.type) {\r\n         case \"checkbox\": {\r\n            const clickEvent = (isSelected: boolean): void => {\r\n               setting.isChecked = isSelected;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputCheckbox key={i} name={name} text={setting.text} defaultValue={setting.defaultValue as boolean} func={clickEvent} />\r\n            break;   \r\n         }\r\n         case \"range\": {\r\n            const clickEvent = (newVal: number): void => {\r\n               setting.value = newVal;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputRange key={i} text={setting.text} defaultValue={setting.defaultValue as number} min={setting.min!} max={setting.max!} step={setting.step!} func={clickEvent} />\r\n            break;\r\n         }\r\n      }\r\n      setting.elem = elem;\r\n      return elem!;\r\n   });\r\n\r\n   ReactDOM.render(elems, settingsContainer);\r\n}\r\n\r\nconst setupSettings = (): void => {\r\n   for (const setting of graphSettingData) {\r\n      if (setting.type === \"checkbox\") {\r\n         setting.isChecked = setting.defaultValue as boolean;\r\n      }\r\n   }\r\n}\r\n\r\nexport interface GraphOptions {\r\n   display: string;\r\n   id: string;\r\n   colour: string;\r\n   dependentVariable: string;\r\n   type: GraphType;\r\n   min?: number;\r\n   max?: number;\r\n   isSelected?: boolean;\r\n}\r\nlet graphOptions: Array<GraphOptions> = [\r\n   {\r\n      display: \"Number of creatures\",\r\n      id: \"creatures\",\r\n      colour: \"#26ff1f\",\r\n      dependentVariable: \"Creatures\",\r\n      type: \"simple\"\r\n   },\r\n   {\r\n      display: \"Number of fruit\",\r\n      id: \"fruit\",\r\n      colour: \"#19c6ff\",\r\n      dependentVariable: \"Fruit\",\r\n      type: \"simple\"\r\n   },\r\n   {\r\n      display: \"Fruit multiplier\",\r\n      id: \"fruitMultiplier\",\r\n      colour: \"#31ff2e\",\r\n      dependentVariable: \"Multiplier\",\r\n      type: \"simple\"\r\n   }\r\n];\r\nconst createGraphOptions = (): void => {\r\n   for (const [ geneName, gene ] of Object.entries(creatureGeneInfo)) {\r\n      graphOptions.push({\r\n         display: `Creature ${gene.display}`,\r\n         id: geneName,\r\n         colour: gene.colour,\r\n         dependentVariable: gene.display,\r\n         min: gene.min,\r\n         max: gene.max,\r\n         type: \"detailed\"\r\n      });\r\n   }\r\n}\r\n\r\nlet selectedGraphOptions: Array<GraphOptions> = new Array<GraphOptions>();\r\nexport function setupGraphs(): void {\r\n   createGraphOptions();\r\n   createSettings();\r\n   setupSettings();\r\n\r\n   const graphViewer = getElem(\"graph-viewer\");\r\n   const optionsContainer = graphViewer.querySelector(\".options-container\");\r\n\r\n   const optionElems = <>{\r\n      graphOptions.map((option, i) => {\r\n         const clickEvent = (isSelected: boolean) => {\r\n            option.isSelected = isSelected;\r\n            if (isSelected) {\r\n               let hasInserted = false;\r\n               for (let j = 0; j < selectedGraphOptions.length; j++) {\r\n                  const n = graphOptions.indexOf(selectedGraphOptions[j]);\r\n                  if (n > i) {\r\n                     selectedGraphOptions.splice(j, 0, option)\r\n                     hasInserted = true;\r\n                     break;\r\n                  }\r\n               }\r\n               if (!hasInserted) {\r\n                  selectedGraphOptions.push(option);\r\n               }\r\n            } else {\r\n               const idx = selectedGraphOptions.indexOf(option);\r\n               selectedGraphOptions.splice(idx, 1);\r\n            }\r\n\r\n            drawGraphs();\r\n         };\r\n\r\n         return <InputCheckbox key={i} name={option.id} text={option.display} defaultValue={false} func={clickEvent} />\r\n      })\r\n   }</>;\r\n\r\n   ReactDOM.render(optionElems, optionsContainer);\r\n}\r\n\r\nexport function closeGraphViewer(): void {\r\n   hideMask();\r\n   getElem(\"graph-viewer\").classList.add(\"hidden\");\r\n   graphViewerIsVisible = false;\r\n}\r\n\r\nexport function openGraphViewer(): void {\r\n   showMask();\r\n   getElem(\"graph-viewer\").classList.remove(\"hidden\");\r\n   graphViewerIsVisible = true;\r\n}\r\n\r\nexport function drawGraphs(): void {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const graphContainer = graphViewer.querySelector(\".graph-container\") as HTMLElement;\r\n\r\n   // If no options are selected, display text and leave\r\n   if (selectedGraphOptions.length === 0) {\r\n      graphContainer.innerHTML = \"<p>Your graph will appear here once you choose an option.</p>\";\r\n      return;\r\n   }\r\n\r\n   // Remove any previous graphs\r\n   graphContainer.innerHTML = \"\";\r\n   \r\n   const graphSettings: GraphSettings = {\r\n      shouldExtrapolate: graphSettingData[0].isChecked!\r\n   };\r\n\r\n   for (const graphOptions of selectedGraphOptions) {\r\n      let dataPoints: GraphData;\r\n      if (graphOptions.type === \"simple\") {\r\n         dataPoints = geneSamples.map(sample => sample[graphOptions.id]);\r\n      } else if (graphOptions.type === \"detailed\") {\r\n         dataPoints = geneSamples.map(sample => sample.genePool !== null ? sample.genePool[graphOptions.id] : null);\r\n      }\r\n\r\n      const aspectRatio = 5/3;\r\n      const width = 350;\r\n\r\n      const graph = new Graph(width, width/aspectRatio, dataPoints!, graphSettings, graphOptions);\r\n      graphContainer.appendChild(graph.element);\r\n   }\r\n}","import Game from \"./Game\";\r\nimport { getElem } from \"./utils\";\r\n\r\nconst boardIsVisible = (): boolean => {\r\n   return !getElem(\"board\")!.classList.contains(\"hidden\");\r\n}\r\n\r\nexport function updateTransform(): void {\r\n   const board = getElem(\"board\");\r\n\r\n   board.style.top = `calc(50% + ${Game.transform.translate.y}%)`;\r\n   board.style.left = `calc(50% + ${Game.transform.translate.x}%)`;\r\n   board.style.transform = `translate(-50%, -50%) scale(${Game.transform.zoom}, ${Game.transform.zoom})`;\r\n}\r\n\r\ntype translateDirection = \"up\" | \"right\" | \"down\" | \"left\";\r\nconst translateBoard = (dir: translateDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n\r\n   const TRANSLATE_AMOUNT = 5;\r\n\r\n   const translate = Game.transform.translate;\r\n   switch (dir) {\r\n      case \"up\": {\r\n         translate.y += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"right\": {\r\n         translate.x -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"down\": {\r\n         translate.y -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"left\": {\r\n         translate.x += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\ntype zoomDirection = \"in\" | \"out\";\r\nconst zoomBoard = (dir: zoomDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n   \r\n   const ZOOM_AMOUNT = 0.15;\r\n\r\n   switch (dir) {\r\n      case \"in\": {\r\n         Game.transform.zoom *= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n      case \"out\": {\r\n         Game.transform.zoom /= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\nconst pauseGame = (): void => {\r\n   Game.isPaused = true;\r\n   getElem(\"pause-screen\").classList.remove(\"hidden\");\r\n}\r\nconst unpauseGame = (): void => {\r\n   Game.isPaused = false;\r\n   getElem(\"pause-screen\").classList.add(\"hidden\");\r\n}\r\n\r\nexport function keyPress(): void {\r\n   const e = window.event as KeyboardEvent;\r\n   const key = e.key;\r\n\r\n   // Don't do anything if there is an element in focus\r\n   if (document.activeElement !== document.body) return;\r\n\r\n   switch (key) {\r\n      case \"ArrowUp\": {\r\n         translateBoard(\"up\");\r\n         break;\r\n      }\r\n      case \"ArrowRight\": {\r\n         translateBoard(\"right\");\r\n         break;\r\n      }\r\n      case \"ArrowDown\": {\r\n         translateBoard(\"down\");\r\n         break;\r\n      }\r\n      case \"ArrowLeft\": {\r\n         translateBoard(\"left\");\r\n         break;\r\n      }\r\n      case \"-\":\r\n      case \"_\": {\r\n         zoomBoard(\"out\");\r\n         break;\r\n      }\r\n      case \"+\":\r\n      case \"=\": {\r\n         zoomBoard(\"in\");\r\n         break;\r\n      }\r\n      case \" \": {\r\n         Game.isPaused ? unpauseGame() : pauseGame();\r\n      }\r\n   }\r\n}","import { lerp, PolarVector, Vector } from './utils';\r\n\r\nconst interpolate = (dot0: number, dot1: number, dot2: number, dot3: number, localX: number, localY: number): number => {\r\n   const a = lerp(dot0, dot1, localX);\r\n   const b = lerp(dot2, dot3, localX);\r\n   return lerp(a, b, localY);\r\n}\r\n\r\nconst fade = (t: number): number => {\r\n   return t * t * t * (t * (t * 6 - 15) + 10);\r\n}\r\n\r\nexport function getPerlinNoise(width: number, height: number, scale: number): Array<Array<number>> {\r\n   const grid = new Array<Array<PolarVector>>();\r\n\r\n   for (let i = 0; i <= height / scale + 1; i++) {\r\n      const row = new Array<PolarVector>();\r\n      for (let j = 0; j <= width / scale + 1; j++) {\r\n         row.push(PolarVector.randomUnitVector());\r\n      }\r\n      grid.push(row);\r\n   }\r\n\r\n   const noise = new Array<Array<number>>();\r\n   for (let y = 0; y < height; y++) {\r\n      const row = new Array<number>();\r\n      for (let x = 0; x < width; x++) {\r\n         const sampleX = x / scale;\r\n         const sampleY = y / scale;\r\n         const samplePoint = new Vector(sampleX, sampleY);\r\n\r\n         const x0 = Math.floor(sampleX);\r\n         const x1 = x0 + 1;\r\n         const y0 = Math.floor(sampleY);\r\n         const y1 = y0 + 1;\r\n\r\n         const cornerCoords: ReadonlyArray<[number, number]> = [[y0, x0], [y0, x1], [y1, x0], [y1, x1]];\r\n\r\n         const dotProducts = new Array<number>();\r\n         for (let i = 0; i < 4; i++) {\r\n            const coords = cornerCoords[i];\r\n\r\n            const corner = grid[coords[0]][coords[1]];\r\n            const cornerPos = new Vector(coords[1], coords[0]);\r\n            const offsetVector = samplePoint.convertToPolar(cornerPos);\r\n            const dot = corner.convertToCartesian().dot(offsetVector.convertToCartesian());\r\n            dotProducts.push(dot);\r\n         }\r\n\r\n         const u = fade(sampleX % 1);\r\n         const v = fade(sampleY % 1);\r\n         let val = interpolate(dotProducts[0], dotProducts[1], dotProducts[2], dotProducts[3], u, v);\r\n         val = Math.min(Math.max(val, -0.5), 0.5);\r\n         row.push(val + 0.5);\r\n      }\r\n      noise.push(row);\r\n   }\r\n   return noise;\r\n}\r\n\r\n/**\r\n * \r\n * @param octaves The number of perlin noise layers to use\r\n * @param lacunarity Controls the increase in scale between octaves (1+)\r\n * @param persistance Controls the decrease in weight between octaves (0-1)\r\n */\r\nexport function getOctavePerlinNoise(width: number, height: number, startingScale: number, octaves: number, lacunarity: number, persistance: number): Array<Array<number>> {\r\n   let totalNoise = new Array<Array<number>>();\r\n   for (let i = 0; i < octaves; i++) {\r\n      const scale = 1 / Math.pow(lacunarity, i) * startingScale;\r\n      const weightMultiplier = Math.pow(persistance, i);\r\n\r\n      const noise = getPerlinNoise(width, height, scale);\r\n      if (i === 0) {\r\n         totalNoise = noise;\r\n      } else {\r\n         for (let y = 0; y < height; y++) {\r\n            for (let x = 0; x < width; x++) {\r\n               totalNoise[y][x] += noise[y][x] * weightMultiplier;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   let maxWeight = 1;\r\n   for (const row of totalNoise) {\r\n      for (const weight of row) {\r\n         if (weight > maxWeight) maxWeight = weight;\r\n      }\r\n   }\r\n   if (maxWeight > 1) {\r\n      // Adjust weights\r\n      for (let y = 0; y < height; y++) {\r\n         for (let x = 0; x < width; x++) {\r\n            totalNoise[y][x] /= maxWeight;\r\n         }\r\n      }\r\n   }\r\n\r\n   return totalNoise;\r\n}\r\n","import Game from \"../Game\";\r\nimport GameImage from \"./GameImage\";\r\nimport { getOctavePerlinNoise, getPerlinNoise } from \"../perlin-noise\";\r\nimport { Colour, getElem, randFloat, randInt, randItem, Vector } from \"../utils\";\r\nimport Creature from \"./Creature\";\r\n\r\n// Generate a height map and a temperature map\r\n\r\ntype NoiseType = \"height\" | \"temperature\";\r\n\r\nexport interface TileType {\r\n   name: string;\r\n   // A list of potential colours for the tile\r\n   colour: Array<string>;\r\n   fruitColour?: Array<string>;\r\n   isLiquid: boolean;\r\n   thumbnailFunc?: (thumbnail: HTMLCanvasElement, width: number, height: number, renderFunc: Function) => void;\r\n   tickFunc?: (x: number, y: number) => void;\r\n   walkFunc?: (creature: Creature) => void;\r\n   effects?: {\r\n      speedMultiplier?: number;\r\n      fruitSpawnMultiplier?: number;\r\n      /** Effects how quickly a creature's life decreases while on the tile */\r\n      metabolismMultiplier?: number;\r\n   }\r\n}\r\nexport interface TerrainLayer {\r\n   height?: number | [number, number];\r\n   temperature?: number | [number, number];\r\n   type: string;\r\n}\r\nexport interface Terrain {\r\n   name: string;\r\n   noise: Array<NoiseType>;\r\n   terrainLayers: Array<TerrainLayer>;\r\n}\r\ninterface TerrainInfo {\r\n   presets: ReadonlyArray<Terrain>;\r\n   tiles: { [key: string]: TileType }\r\n}\r\nexport const terrainInfo: TerrainInfo = {\r\n   /**\r\n    * Countryside: only plains biome\r\n    * Biomes: no water\r\n    * Archipelago: islands seperated by water\r\n    * Hell: magma + mountain peaks, with lava instead of water\r\n    * Russia: tundra, medium amount of water\r\n    */\r\n   presets: [\r\n      {\r\n         name: \"Countryside\",\r\n         noise: [\"height\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 1,\r\n               type: \"grass\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Biomes\",\r\n         noise: [\"height\", \"temperature\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.2,\r\n               type: \"bog\"\r\n            },\r\n            {\r\n               height: [0.8, 1],\r\n               type: \"mountain\"\r\n            },\r\n            {\r\n               temperature: 0.3,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               temperature: 0.7,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               temperature: 1,\r\n               type: \"desert\"\r\n            },\r\n         ]\r\n      },\r\n      {\r\n         name: \"Archipelago\",\r\n         noise: [\"height\", \"temperature\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.1,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 0.3,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               temperature: 0.3,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               temperature: 0.7,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               temperature: 1,\r\n               type: \"desert\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Hell\",\r\n         noise: [\"height\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.35,\r\n               type: \"lava\"\r\n            },\r\n            {\r\n               height: 0.8,\r\n               type: \"magma\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"mountain\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Russia\",\r\n         noise: [\"height\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.1,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 0.3,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               height: 0.7,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"mountain\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Swamp\",\r\n         noise: [\"height\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.3,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 0.4,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"bog\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Vomit\",\r\n         noise: [\"height\"],\r\n         terrainLayers: [\r\n            {\r\n               height: 0.2,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               height: 0.3,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               height: 0.4,\r\n               type: \"mountain\"\r\n            },\r\n            {\r\n               height: 0.5,\r\n               type: \"desert\"\r\n            },\r\n            {\r\n               height: 0.6,\r\n               type: \"magma\"\r\n            },\r\n            {\r\n               height: 0.7,\r\n               type: \"bog\"\r\n            },\r\n            {\r\n               height: 0.8,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               height: 0.9,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"lava\"\r\n            },\r\n         ]\r\n      }\r\n   ],\r\n   tiles: {\r\n      grass: {\r\n         name: \"Grass\",\r\n         colour: [\"#23ee2d\"],\r\n         fruitColour: [\"#009124\"],\r\n         isLiquid: false\r\n      },\r\n      tundra: {\r\n         name: \"Tundra\",\r\n         colour: [\"#b8c6db\"],\r\n         fruitColour: [\"#0066ff\"],\r\n         isLiquid: false,\r\n         effects: {\r\n            speedMultiplier: 0.7,\r\n            metabolismMultiplier: 0.6\r\n         }\r\n      },\r\n      mountain: {\r\n         name: \"Mountain\",\r\n         colour: [\"#fff\"],\r\n         fruitColour: [\"#cf13bf\"],\r\n         isLiquid: false\r\n      },\r\n      desert: {\r\n         name: \"Desert\",\r\n         colour: [\"yellow\"],\r\n         fruitColour: [\"#666\"],\r\n         isLiquid: false,\r\n         effects: {\r\n            speedMultiplier: 1.4,\r\n            metabolismMultiplier: 1.3\r\n         }\r\n      },\r\n      magma: {\r\n         name: \"Magma\",\r\n         colour: [\"orange\"],\r\n         fruitColour: [\"red\"],\r\n         isLiquid: false\r\n      },\r\n      bog: {\r\n         name: \"Bog\",\r\n         colour: [\"#46911a\", \"#509121\", \"#457819\"],\r\n         fruitColour: [\"#2d3d20\", \"#000\"],\r\n         isLiquid: false,\r\n         effects: {\r\n            speedMultiplier: 0.4,\r\n            metabolismMultiplier: 0.3\r\n         }\r\n      },\r\n      water: {\r\n         name: \"Water\",\r\n         colour: [\"blue\"],\r\n         isLiquid: true\r\n      },\r\n      deepWater: {\r\n         name: \"Deep water\",\r\n         colour: [\"darkblue\"],\r\n         isLiquid: true\r\n      },\r\n      lava: {\r\n         name: \"Lava\",\r\n         colour: [\"red\"],\r\n         isLiquid: true,\r\n         thumbnailFunc: (thumbnail: HTMLCanvasElement, width: number, height: number, renderFunc: Function): void => {\r\n            if (thumbnail.offsetParent === null || !thumbnail.classList.contains(\"lava\")) {\r\n               Game.removeRenderListener(renderFunc);\r\n               return;\r\n            }\r\n\r\n            const thumbnailPos = thumbnail.getBoundingClientRect();\r\n            const thumbnailX = thumbnailPos.x;\r\n            const thumbnailY = thumbnailPos.y;\r\n\r\n            const createSmoke = () => {\r\n               const size = randInt(10, 20, true);\r\n               const x = thumbnailX + size/2 + randFloat(0, width - size/2);\r\n               const y = thumbnailY + size/2 + randFloat(0, height - size/2);\r\n               const pos = new Vector(x, y);\r\n\r\n               const smoke = new GameImage(\"smoke\", 5, 3, size, size, pos).element;\r\n               smoke.style.zIndex = \"4\";\r\n               document.body.appendChild(smoke);\r\n               \r\n               const brightness = randFloat(0.6, 1);\r\n               smoke.style.filter = `brightness(${brightness})`;\r\n            }\r\n\r\n            if (Math.random() < 0.05) {\r\n               const smokeAmount = randInt(1, 5, true);\r\n               for (let i = 0; i < smokeAmount; i++) {\r\n                  createSmoke();\r\n               }\r\n            } else if (Math.random() < 0.2) {\r\n               createSmoke();\r\n            }\r\n         },\r\n         tickFunc: (x: number, y: number) => {\r\n            const createSmoke = (size: number, brightness: number): void => {\r\n               const pos = new Vector(x * Game.cellSize + randFloat(0, Game.cellSize), y * Game.cellSize + randFloat(0, Game.cellSize));\r\n               const smoke = new GameImage(\"smoke\", 5, 2, size, size, pos).element;\r\n   \r\n               smoke.style.filter = `brightness(${brightness})`;\r\n            }\r\n\r\n            // small smoke\r\n            createSmoke(randInt(16, 25, true), randFloat(0.5, 1));\r\n\r\n            // Big smoke\r\n            if (Math.random() < 0.02) {\r\n               const amount = randInt(3, 5);\r\n               for (let i = 0; i < amount; i++) {\r\n                  const size = randInt(25, 40, true);\r\n                  createSmoke(size, 1);\r\n               }\r\n            }\r\n         },\r\n         walkFunc: (creature: Creature) => {\r\n            // Harm creature once a second\r\n            if ((Game.ticks + creature.seed) % Game.tps === 0) {\r\n               // Remove 10% of health\r\n               creature.damage(creature.lifespan / 10);\r\n\r\n               // Create smoke\r\n               const smokeAmount = randInt(2, 5, true);\r\n               const o = 30;\r\n               for (let i = 0; i < smokeAmount; i++) {\r\n                  const size = randInt(20, 35, true);\r\n                  const pos = creature.position.randomOffset(o);\r\n                  const ticksPerFrame = randInt(3, 5, true);\r\n                  const smoke = new GameImage(\"smoke\", 5, ticksPerFrame, size, size, pos);\r\n\r\n                  const brightness = randInt(5, 10, true) / 10;\r\n                  smoke.element.style.filter = `brightness(${brightness})`;\r\n               }\r\n            }\r\n         }\r\n      }\r\n   }\r\n}\r\n\r\nexport class BoardGenerator {\r\n   private width: number;\r\n   private height: number;\r\n   private readonly tileSize: number;\r\n   private readonly canvas: HTMLCanvasElement;\r\n   tiles!: Array<Array<TileType>>;\r\n\r\n   constructor(width: number, height: number, tileSize: number) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.tileSize = tileSize;\r\n      this.canvas = this.instantiate();\r\n   }\r\n\r\n   private instantiate(): HTMLCanvasElement {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.setAttribute(\"width\", this.width * this.tileSize + \"px\");\r\n      canvas.setAttribute(\"height\", this.height * this.tileSize + \"px\");\r\n      \r\n      getElem(\"board-preview-container\").appendChild(canvas);\r\n\r\n      return canvas;\r\n   }\r\n\r\n   changeSize(newWidth: number, newHeight: number, showChanges: boolean) {\r\n      this.width = newWidth;\r\n      this.height = newHeight;\r\n\r\n      if (showChanges) {\r\n         this.canvas.setAttribute(\"width\", this.width * this.tileSize + \"px\");\r\n         this.canvas.setAttribute(\"height\", this.height * this.tileSize + \"px\");\r\n      }\r\n   }\r\n\r\n   getTiles(): Array<Array<TileType>> {\r\n      return this.tiles;\r\n   }\r\n\r\n   private getTileType(terrain: Terrain, height: number | null, temperature: number | null): TileType {\r\n      const testLevel = (type: \"height\" | \"temperature\", val: number, terrainType: TerrainLayer): boolean => {\r\n         if (typeof terrainType[type] === \"number\") {\r\n            // number\r\n            if (val > terrainType[type]!) return false;\r\n         } else if (Array.isArray(terrainType[type])) {\r\n            const limitArr = terrainType[type] as [number, number];\r\n            // [number, number]\r\n            if (val < limitArr[0] || val > limitArr[1]) return false;\r\n         }\r\n         return true;\r\n      }\r\n\r\n      for (const terrainType of terrain.terrainLayers) {\r\n         const heightCheck = height !== null ? testLevel(\"height\", height, terrainType) : true;\r\n         const temperatureCheck = temperature !== null ? testLevel(\"temperature\", temperature, terrainType) : true;\r\n         \r\n         if (heightCheck && temperatureCheck) return terrainInfo.tiles[terrainType.type];\r\n      }\r\n\r\n      console.log(\"No tile type found, showing info\");\r\n      console.log(\"Height:\", height, \"Temperature:\", temperature);\r\n      console.log(\"Terrain layers:\", terrain.terrainLayers);\r\n      throw new Error(`Unable to find an appropriate tile type!`);\r\n   }\r\n\r\n   generateNoise(terrain: Terrain, scale: number, showChanges: boolean, octaves: number = 1, lacunarity: number = 1, persistance: number = 1): void {\r\n      // Reset tiles\r\n      this.tiles = new Array<Array<TileType>>();\r\n      for (let y = 0; y < this.height; y++) {\r\n         this.tiles[y] = new Array<TileType>(this.width);\r\n      }\r\n\r\n      const noise: { [key: string]: Array<Array<number>> } = {};\r\n      for (const noiseType of terrain.noise) {\r\n         if (noiseType === \"height\") {\r\n            noise.height = getOctavePerlinNoise(this.width, this.height, scale, octaves, lacunarity, persistance);\r\n         } else if (noiseType === \"temperature\") {\r\n            noise.temperature = getOctavePerlinNoise(this.width, this.height, scale, octaves, lacunarity, persistance);\r\n         }\r\n      }\r\n\r\n      if (showChanges) {\r\n         this.clearCanvas();\r\n\r\n         const ctx = this.canvas.getContext(\"2d\")!;\r\n         for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n               const height = noise.height ? noise.height[y][x] : null;\r\n               const temperature = noise.temperature ? noise.temperature[y][x] : null;\r\n               const tileType = this.getTileType(terrain, height, temperature);\r\n               this.tiles[y][x] = tileType;\r\n   \r\n               const colour = randItem(tileType.colour) as string;\r\n               \r\n               ctx.beginPath();\r\n               ctx.fillStyle = colour;\r\n               ctx.rect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);\r\n               ctx.fill();\r\n            }\r\n         }\r\n   \r\n         this.drawGridLines();\r\n      } else {\r\n         for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n               const height = noise.height ? noise.height[y][x] + 0.5 : null;\r\n               const temperature = noise.temperature ? noise.temperature[y][x] + 0.5 : null;\r\n               const tileType = this.getTileType(terrain, height, temperature);\r\n               this.tiles[y][x] = tileType;\r\n            }\r\n         }\r\n      }  \r\n   }\r\n\r\n   generateTestOctaveNoise(scale: number, octaves: number, lacunarity: number, persistance: number): void {\r\n      const noise = getOctavePerlinNoise(this.width, this.height, scale, octaves, lacunarity, persistance);\r\n      this.drawTestNoise(noise);\r\n   }\r\n\r\n   generateTestNoise(scale: number): void {\r\n      const noise = getPerlinNoise(this.width, this.height, scale);\r\n      this.drawTestNoise(noise);\r\n   }\r\n\r\n   private drawTestNoise(noise: Array<Array<number>>): void {\r\n      this.clearCanvas();\r\n\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n      for (let y = 0; y < this.height; y++) {\r\n         for (let x = 0; x < this.width; x++) {\r\n            const weight = noise[y][x];\r\n            \r\n            ctx.beginPath();\r\n            const colour = \"#\" + Colour.grayscale(weight + 0.5);\r\n            ctx.fillStyle = colour;\r\n            ctx.rect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);\r\n            ctx.fill();\r\n         }\r\n      }\r\n   }\r\n\r\n   private drawGridLines(): void {\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n\r\n      for (let y = 1; y < this.height; y++) {\r\n         ctx.moveTo(0, y * this.tileSize);\r\n         ctx.lineTo(this.width * this.tileSize, y * this.tileSize);\r\n      }\r\n\r\n      for (let x = 1; x < this.width; x++) {\r\n         ctx.moveTo(x * this.tileSize, 0);\r\n         ctx.lineTo(x * this.tileSize, this.height * this.tileSize);\r\n      }\r\n\r\n      ctx.strokeStyle = \"#000\";\r\n      ctx.stroke();\r\n   }\r\n\r\n   private clearCanvas(): void {\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n   }\r\n}","import React, { useEffect, useRef, useState } from 'react';\r\nimport { terrainInfo, BoardGenerator, Terrain, TileType, TerrainLayer } from '../classes/BoardGenerator';\r\nimport InputCheckbox from './InputCheckbox';\r\nimport InputSelect from './InputSelect';\r\nimport InputText from './InputText';\r\nimport InputTextRange from './InputTextRange';\r\nimport '../css/terrain-generator.css';\r\nimport Game from '../Game';\r\nimport { randItem } from '../utils';\r\nimport InputRange from './InputRange';\r\n\r\nlet boardGenerator: BoardGenerator;\r\nlet currentTerrain: Terrain = terrainInfo.presets[0];\r\nlet scale: number = 5;\r\nlet octaves: number = 1;\r\nlet lacunarity: number = 1;\r\nlet persistance: number = 0.5;\r\n// octaves The number of perlin noise layers to use\r\n//  * @param lacunarity Controls the increase in frequency between octaves (1+)\r\n//  * @param persistance\r\n\r\nconst generatePreview = (): void => {\r\n   boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height, true);\r\n   boardGenerator.generateNoise(currentTerrain, scale, true);\r\n}\r\n\r\nexport function getTiles(): Array<Array<TileType>> {\r\n   return boardGenerator.getTiles();\r\n}\r\n\r\nconst changeBoardSize = (dimension: \"width\" | \"height\", newVal: number, showChanges: boolean = false): void => {\r\n   Game.boardSize[dimension] = newVal;\r\n\r\n   boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height, showChanges);\r\n   boardGenerator.generateNoise(currentTerrain, scale, showChanges);\r\n}\r\n\r\ninterface SizeProps {\r\n   text: string;\r\n   obj?: SizeProps;\r\n   size: [number, number] | \"custom\";\r\n   isSelected?: boolean;\r\n   clickEvent?: (size: SizeProps) => void;\r\n}\r\nconst Size = ({ text, obj, size, isSelected, clickEvent }: SizeProps): JSX.Element => {\r\n   const onClick = () => {\r\n      if (clickEvent && obj) clickEvent(obj);\r\n\r\n      if (Array.isArray(size)) {\r\n         changeBoardSize(\"width\", size[0], true);\r\n         changeBoardSize(\"height\", size[1], true);\r\n      }\r\n   }\r\n\r\n   let className = \"size\";\r\n   if (isSelected) className += \" selected\";\r\n   return <div onClick={onClick} className={className}>{text}</div>\r\n}\r\n\r\nconst SizeSelect = (): JSX.Element => {\r\n   const defaultSizes: ReadonlyArray<SizeProps> = [\r\n      {\r\n         text: \"Small\",\r\n         size: [15, 15],\r\n         isSelected: true\r\n      },\r\n      {\r\n         text: \"Medium\",\r\n         size: [30, 30]\r\n      },\r\n      {\r\n         text: \"Large\",\r\n         size: [50, 50]\r\n      },\r\n      {\r\n         text: \"Custom\",\r\n         size: \"custom\"\r\n      },\r\n   ];\r\n   const [sizes, setSize] = useState(defaultSizes);\r\n   \r\n   let selectedSize!: [number, number] | \"custom\";\r\n   for (const size of sizes) {\r\n      if (size.isSelected) {\r\n         selectedSize = size.size;\r\n      }\r\n   }\r\n\r\n   const clickEvent = (size: SizeProps): void => {\r\n      const newSizesArray = sizes.slice();\r\n      for (const currentSize of newSizesArray) {\r\n         if (currentSize === size) {\r\n            currentSize.isSelected = true;\r\n         } else if (currentSize.isSelected) {\r\n            currentSize.isSelected = false;\r\n         }\r\n      }\r\n      setSize(newSizesArray);\r\n   }\r\n\r\n   const width = Array.isArray(selectedSize) ? selectedSize[0] : 15;\r\n   const height = Array.isArray(selectedSize) ? selectedSize[1] : 15;\r\n\r\n   let containerClassName = \"size-container\";\r\n   if (selectedSize === \"custom\") containerClassName += \" custom\";\r\n   return <div className={containerClassName}>\r\n      <div className=\"formatter\">\r\n         {sizes.map((size, i) => <Size key={i} obj={size} text={size.text} size={size.size} isSelected={size.isSelected} clickEvent={clickEvent} />)}\r\n      </div>\r\n\r\n      <InputText func={newVal => changeBoardSize(\"width\", newVal)} text=\"Width\" defaultValue={width} maxVal={100} />\r\n      <InputText func={newVal => changeBoardSize(\"height\", newVal)} text=\"Height\" defaultValue={height} maxVal={100} />\r\n   </div>\r\n}\r\n\r\ninterface LayerThumbnailProps {\r\n   width: number;\r\n   height: number;\r\n   tile: TileType;\r\n   tileName: string;\r\n}\r\nconst LayerThumbnail = ({ width, height, tile, tileName }: LayerThumbnailProps): JSX.Element => {\r\n   const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n   useEffect(() => {\r\n      const canvas = canvasRef.current!;\r\n      canvas.style.width = width + \"px\";\r\n      canvas.style.height = height + \"px\";\r\n\r\n      if (tile.thumbnailFunc) {\r\n         const createRenderListener = (): void => {\r\n            tile.thumbnailFunc!(canvas, width, height, createRenderListener);\r\n         }\r\n\r\n         Game.createRenderListener(createRenderListener);\r\n      }\r\n\r\n      const ctx = canvas.getContext(\"2d\")!;\r\n      const colours = tile.colour;\r\n      if (colours.length === 1) {\r\n         ctx.fillStyle = tile.colour[0];\r\n         ctx.rect(0, 0, width, height);\r\n         ctx.fill();\r\n      } else {\r\n         const resolution = 8;\r\n         const w = width / resolution;\r\n         const h = height / resolution;\r\n         for (let y = 0; y < resolution; y++) {\r\n            for (let x = 0; x < resolution; x++) {\r\n               const colour = randItem(tile.colour) as string;\r\n               ctx.beginPath();\r\n               ctx.fillStyle = colour;\r\n               ctx.rect(x * w, y * h, w, h);\r\n               ctx.fill();\r\n            }\r\n         }\r\n      }\r\n   }, [height, tile, tile.colour, width]);\r\n\r\n   return <canvas width={width} height={height} className={`thumbnail ${tileName}`} ref={canvasRef}></canvas>;\r\n}\r\n\r\ninterface LayerNoiseTypeProps {\r\n   layer: TerrainLayer;\r\n   type: \"height\" | \"temperature\";\r\n   changeLevelFunc: (layer: TerrainLayer, type: \"height\" | \"temperature\", newVal: [number, number] | null) => void;\r\n   toggleLevelFunc: (type: \"height\" | \"temperature\", newEnabled: boolean) => void;\r\n}\r\nconst LayerNoiseType = ({ layer, type, changeLevelFunc, toggleLevelFunc }: LayerNoiseTypeProps): JSX.Element => {\r\n   const [enabled, setEnabled] = useState(typeof layer[type] !== \"undefined\");\r\n   let defaultVal: [string, string];\r\n   if (typeof layer[type] === \"undefined\") {\r\n      // not enabled\r\n      defaultVal = [\"0\", \"1\"];\r\n   } else if (Array.isArray(layer[type])) {\r\n      // [number, number]\r\n      const layerArr = layer[type] as [number, number];\r\n      defaultVal = [layerArr[0].toString(), layerArr[1].toString()];\r\n   } else {\r\n      // number\r\n      defaultVal = [\"0\", layer[type]!.toString()];\r\n   }\r\n   const [val, setVal] = useState<[string, string]>(defaultVal);\r\n   \r\n   let text;\r\n   if (type === \"height\") {\r\n      text = \"Height: \";\r\n   } else {\r\n      text = \"Temperature: \";\r\n   }\r\n\r\n   const toggleEnable = (): void => {\r\n      const otherType = type === \"height\" ? \"temperature\" : \"height\";\r\n      if (!layer.hasOwnProperty(otherType)) {\r\n         const e = window.event;\r\n         e?.preventDefault();\r\n         return;\r\n      }\r\n\r\n      const newVal = !enabled;\r\n      toggleLayerLevel(type, newVal);\r\n      setEnabled(newVal);\r\n\r\n      if (!newVal) {\r\n         setVal([\"0\", \"1\"]);\r\n      }\r\n   }\r\n\r\n   const changeLayerLevel = (type: \"height\" | \"temperature\", newVal: [minVal: string, maxVal: string]): void => {\r\n      const minVal = parseFloat(newVal[0]);\r\n      const maxVal = parseFloat(newVal[1]);\r\n      if (!isNaN(minVal) && !isNaN(maxVal)) {\r\n         changeLevelFunc(layer, type, enabled ? [minVal, maxVal] : null);\r\n      }\r\n\r\n      setVal(newVal);\r\n   }\r\n\r\n   const toggleLayerLevel = (type: \"height\" | \"temperature\", newEnabled: boolean): void => {\r\n      toggleLevelFunc(type, newEnabled);\r\n   }\r\n\r\n   let className = \"layer-noise-type\";\r\n   if (enabled) {\r\n      className += \" enabled\";\r\n   }\r\n   return <div className={className}>\r\n      <input type=\"checkbox\" checked={enabled} onChange={toggleEnable} />\r\n      <InputTextRange func={([minVal, maxVal]) => changeLayerLevel(type, [minVal, maxVal])} text={text} minValLimit={0} maxValLimit={1} minVal={val[0]} maxVal={val[1]} />\r\n   </div>\r\n}\r\n\r\ninterface LayerProps {\r\n   layer: TerrainLayer;\r\n   id: number;\r\n   changeTypeFunc: (layer: TerrainLayer, layerID: string) => void;\r\n   changeLevelFunc: (layer: TerrainLayer, type: \"height\" | \"temperature\", newVal: [number, number] | null) => void;\r\n   toggleLevelFunc: (layer: TerrainLayer, type: \"height\" | \"temperature\", newEnabled: boolean) => void;\r\n   removeFunc: (id: number) => void;\r\n   hasRemoveButton: boolean;\r\n}\r\nconst Layer = ({ layer, id, changeTypeFunc: changeFunc, changeLevelFunc, toggleLevelFunc, removeFunc, hasRemoveButton: hasRemoveFunction }: LayerProps): JSX.Element => {\r\n   const tile = terrainInfo.tiles[layer.type];\r\n   const layerName = tile.name;\r\n\r\n   const changeLayerType = (event: any): void => {\r\n      const newVal = event.target.value;\r\n      \r\n      // Find the layer id\r\n      for (const [layerID, layerInfo] of Object.entries(terrainInfo.tiles)) {\r\n         if (layerInfo.name === newVal) {\r\n            layer.type = layerID;\r\n            changeFunc(layer, layerID);\r\n         }\r\n      }\r\n   }\r\n\r\n   const toggleLayerLevel = (type: \"height\" | \"temperature\", newEnabled: boolean): void => {\r\n      toggleLevelFunc(layer, type, newEnabled);\r\n   }\r\n   \r\n   const tileNames = Object.values(terrainInfo.tiles).map(tile => tile.name);\r\n   const thumbnailSize = 64;\r\n   return <div className=\"terrain-layer\">\r\n      <div className=\"formatter\"></div>\r\n      <LayerThumbnail width={thumbnailSize} height={thumbnailSize} tile={tile} tileName={layer.type} />\r\n\r\n      <div>\r\n         <p>Type:\r\n            <select value={layerName} onChange={changeLayerType}>\r\n               {tileNames.map((name, i) => {\r\n                  return <option key={i}>{name}</option>\r\n               })}\r\n            </select>\r\n         </p>\r\n\r\n         <LayerNoiseType layer={layer} type=\"height\" changeLevelFunc={changeLevelFunc} toggleLevelFunc={toggleLayerLevel} />\r\n         <LayerNoiseType layer={layer} type=\"temperature\" changeLevelFunc={changeLevelFunc} toggleLevelFunc={toggleLayerLevel} />\r\n      </div>\r\n\r\n      {hasRemoveFunction ? \r\n      <div onClick={() => removeFunc(id)} className=\"remove-button\">x</div>\r\n      : \"\"}\r\n   </div>;\r\n}\r\n\r\nconst defaultTerrainLayer: TerrainLayer = {\r\n   type: \"grass\",\r\n   height: [0, 1]\r\n};\r\n\r\nconst newTerrainLayer = (): TerrainLayer => {\r\n   return Object.assign({}, defaultTerrainLayer);\r\n}\r\n\r\nlet updateCurrentTerrain: () => void;\r\n\r\ninterface AdvancedTerrainGeneratorProps {\r\n   terrain: Array<TerrainLayer>;\r\n}\r\nconst AdvancedTerrainGenerator = (props: AdvancedTerrainGeneratorProps) => {\r\n   const [layers, setLayers] = useState<Array<TerrainLayer>>(props.terrain);\r\n\r\n   updateCurrentTerrain = (): void => {\r\n      const newTerrain: Terrain = {\r\n         name: \"\",\r\n         noise: [\"height\", \"temperature\"],\r\n         terrainLayers: layers\r\n      };\r\n      currentTerrain = Object.assign({}, newTerrain);\r\n\r\n      boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height, true);\r\n      boardGenerator.generateNoise(currentTerrain, scale, true, octaves, lacunarity, persistance);\r\n   }\r\n\r\n   const createNewLayer = (): void => {\r\n      const newLayer = newTerrainLayer();\r\n\r\n      const newLayersArray = layers.concat([newLayer]);\r\n      setLayers(newLayersArray);\r\n   }\r\n   \r\n   const changeLayerType = (layer: TerrainLayer, newType: string): void => {\r\n      const newLayerArray = layers.slice();\r\n      for (const currentLayer of newLayerArray) {\r\n         if (currentLayer === layer) {\r\n            currentLayer.type = newType;\r\n         }\r\n      }\r\n      setLayers(newLayerArray);\r\n   }\r\n\r\n   const changeLayerLevel = (layer: TerrainLayer, type: \"height\" | \"temperature\", newVal: [number, number] | null): void => {\r\n      const newLayerArray = layers.slice();\r\n      for (const currentLayer of newLayerArray) {\r\n         if (currentLayer !== layer) continue;\r\n\r\n         if (newVal !== null) {\r\n            currentLayer[type] = newVal;\r\n         } else {\r\n            delete currentLayer[type];\r\n         }\r\n      }\r\n      setLayers(newLayerArray);\r\n   }\r\n\r\n   const toggleLayerLevel = (layer: TerrainLayer, type: \"height\" | \"temperature\", isEnabled: boolean, newVal?: [minVal: number, maxVal: number]): void => {\r\n      const newLayerArray = layers.slice();\r\n      for (const currentLayer of newLayerArray) {\r\n         if (currentLayer !== layer) continue;\r\n\r\n         if (isEnabled) {\r\n            currentLayer[type] = [0, 1];\r\n         } else {\r\n            delete currentLayer[type];\r\n         }\r\n      }\r\n      setLayers(newLayerArray);\r\n   }\r\n\r\n   const removeLayer = (id: number): void => {\r\n      let newArr = new Array<TerrainLayer>();\r\n      for (let i = 0; i < layers.length; i++) {\r\n         if (i !== id) newArr.push(layers[i]);\r\n      }\r\n      setLayers(newArr);\r\n   }\r\n\r\n   return <div id=\"advanced-terrain-generator\">\r\n      <button onClick={createNewLayer}>Create new layer</button>\r\n\r\n      {layers.map((layer, i) => <Layer layer={layer} key={i} id={i} changeTypeFunc={changeLayerType} changeLevelFunc={changeLayerLevel} toggleLevelFunc={toggleLayerLevel} removeFunc={removeLayer} hasRemoveButton={layers.length > 1} />)}\r\n   </div>;\r\n};\r\n\r\nconst TerrainGenerator = () => {\r\n   const [visible, setVisible] = useState(false);\r\n\r\n   const toggleTerrainGeneratorVisibility = (isVisible: boolean) => {\r\n      setVisible(isVisible);\r\n   }\r\n\r\n   useEffect(() => {\r\n      boardGenerator = new BoardGenerator(Game.boardSize.width, Game.boardSize.height, 16);\r\n      boardGenerator.generateNoise(terrainInfo.presets[0], scale, true);\r\n   }, []);\r\n\r\n   const presetNames = terrainInfo.presets.map(preset => preset.name);\r\n\r\n   const onPresetChange = (newPresetName: string) => {\r\n      for (const currentPreset of terrainInfo.presets) {\r\n         if (currentPreset.name === newPresetName) {\r\n            currentTerrain = currentPreset;\r\n            boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height, true);\r\n            boardGenerator.generateNoise(currentPreset, scale, true);\r\n            break;\r\n         }\r\n      }\r\n   }\r\n\r\n   const terrain = currentTerrain.terrainLayers;\r\n   return <div id=\"terrain-generator\">\r\n      <h2 className=\"subheading\">World Size</h2>\r\n\r\n      <SizeSelect />\r\n\r\n      <h2 className=\"subheading\">Terrain Generation</h2>\r\n\r\n      <InputCheckbox func={toggleTerrainGeneratorVisibility} name=\"show-terrain-generator-checkbox\" text=\"Advanced terrain generation\" defaultValue={false} />\r\n\r\n      {!visible ? <>\r\n         <InputSelect options={presetNames} name=\"terrain-preset-options\" text=\"Presets:\" defaultValue={terrainInfo.presets[0].name} func={onPresetChange} />\r\n         \r\n         <button onClick={generatePreview}>Regenerate</button>\r\n      </> : \r\n      <>\r\n         <InputText func={newVal => scale = newVal} text=\"Scale\" defaultValue={5} minVal={2} maxVal={20} />\r\n         <InputRange func={newVal => octaves = newVal} text=\"Octaves\" defaultValue={1} min={1} max={5} step={1} description=\"The number of perlin noise layers.\" />\r\n         <InputRange func={newVal => lacunarity = newVal} text=\"Lacunarity\" defaultValue={1.5} min={1} max={5} step={0.5} description=\"How quickly scale increases between layers.\" />\r\n         <InputRange func={newVal => persistance = newVal} text=\"Persistance\" defaultValue={0.5} min={0} max={1} step={0.05} description=\"How quickly weight diminishes across layers.\" />\r\n\r\n         <AdvancedTerrainGenerator terrain={terrain} />\r\n         \r\n         <button onClick={() => updateCurrentTerrain()}>Regenerate</button>\r\n      </>}\r\n\r\n      <div id=\"board-preview-container\"></div>\r\n   </div>;\r\n};\r\n\r\nexport default TerrainGenerator;","import React, { useRef, useState } from 'react';\r\n\r\ninterface InputSelectProps {\r\n   options: ReadonlyArray<string>;\r\n   name: string;\r\n   text: string;\r\n   defaultValue: string;\r\n   func?: Function;\r\n}\r\n\r\nconst InputSelect = ({ options, name, text, defaultValue, func }: InputSelectProps) => {\r\n   const selectElemRef = useRef<HTMLSelectElement | null>(null);\r\n   const [val, setVal] = useState<string>(defaultValue);\r\n\r\n   const htmlName = \"_INPUT_\" + name;\r\n\r\n   const handleChange = (event: any) => {\r\n      const newVal = event.target.value;\r\n      setVal(newVal);\r\n\r\n      if (func) func(newVal);\r\n   }\r\n\r\n   return <div className=\"input-select\">\r\n      <label htmlFor={htmlName}>{text}</label>\r\n\r\n      <select ref={selectElemRef} value={val} onChange={handleChange}>\r\n         {options.map((option, idx) => {\r\n            return <option key={idx}>{option}</option>;\r\n         })}\r\n      </select>\r\n   </div>;\r\n};\r\n\r\nexport default InputSelect;\r\n","import React from 'react';\r\n\r\ninterface WarningProps {\r\n   text: string;\r\n}\r\n\r\nconst Warning = ({ text }: WarningProps) => {\r\n   return (\r\n      <div className=\"warning\">\r\n         <h3>Warning</h3>\r\n         <p>{text}</p>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default Warning;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport Warning from './Warning';\r\n\r\ninterface InputTextProps {\r\n   text?: string;\r\n   defaultValue: number;\r\n   minVal?: number;\r\n   maxVal?: number;\r\n   func?: (newVal: number) => void;\r\n   allowDecimals?: boolean;\r\n}\r\n\r\nconst InputText = ({ text, defaultValue, func, minVal, maxVal, allowDecimals }: InputTextProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState<string>(defaultValue.toString());\r\n\r\n   const onInputChange = () => {\r\n      const inputText = (inputRef.current! as HTMLInputElement).value;\r\n      const inputVal = Number(inputText);\r\n\r\n      if (func) func(inputVal);\r\n      setVal(inputText);\r\n   }\r\n\r\n   useEffect(() => {\r\n      setVal(defaultValue.toString());\r\n   }, [defaultValue]);\r\n\r\n   let warningMessage = null;\r\n   const numVal = Number(val);\r\n   if (isNaN(numVal)) {\r\n      warningMessage = \"The input must be a valid number.\";\r\n   } else if (numVal % 1 !== 0 && !allowDecimals) {\r\n      warningMessage = \"The input must be an integer.\";\r\n   } else if (minVal && numVal < minVal) {\r\n      warningMessage = `The input cannot be less than ${minVal}.`;\r\n   } else if (maxVal && numVal > maxVal) {\r\n      warningMessage = `The input cannot be greater than ${maxVal}.`;\r\n   }\r\n   \r\n   return (\r\n      <div className=\"input-text\">\r\n         {text ? <span className=\"text\">{text}:</span> : \"\"}\r\n         <input ref={inputRef} onInput={onInputChange} type=\"text\" value={val} />\r\n\r\n         {warningMessage !== null ? \r\n            <Warning text={warningMessage} />\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputText;\r\n","import React, { useRef } from 'react';\r\nimport Warning from './Warning';\r\n\r\ninterface InputTextRangeProps {\r\n   text: string;\r\n   minValLimit: number;\r\n   maxValLimit: number;\r\n   minVal: any;\r\n   maxVal: any;\r\n   func?: (newVal: [minVal: string, maxVal: string]) => void;\r\n}\r\nconst InputTextRange = ({ text, minValLimit, maxValLimit, minVal, maxVal, func }: InputTextRangeProps) => {\r\n   const minValRef = useRef<HTMLInputElement>(null);\r\n   const maxValRef = useRef<HTMLInputElement>(null);\r\n\r\n   const minValNum = parseFloat(minVal), maxValNum = parseFloat(maxVal);\r\n   let warningMessage: string | null = null;\r\n   if (isNaN(minValNum) || isNaN(maxValNum)) {\r\n      warningMessage = \"The input must be a valid number.\";\r\n   } else if (minValNum < minValLimit) {\r\n      warningMessage = `The minimum value cannot be less than ${minValLimit}.`;\r\n   } else if (minValNum > maxValLimit) {\r\n      warningMessage = `The maximum value cannot be greater than ${maxValLimit}.`;\r\n   } else if (minValNum >= maxValNum) {\r\n      warningMessage = \"The minimum value must be less than maximum.\";\r\n   }\r\n\r\n   const onMinChange = () => {\r\n      const newVal = minValRef.current!.value;\r\n      if (func) func([newVal, maxVal]);\r\n   }\r\n   const onMaxChange = () => {\r\n      const newVal = maxValRef.current!.value;\r\n      if (func) func([minVal, newVal]);\r\n   }\r\n\r\n   return <div className=\"input-text-range\">\r\n      <div className=\"text\">{text}</div>\r\n      <div className=\"input-container\">\r\n         <input onChange={onMinChange} ref={minValRef} type=\"text\" value={minVal} />\r\n      </div>\r\n      to\r\n      <div className=\"input-container\">\r\n         <input onChange={onMaxChange} ref={maxValRef} type=\"text\" value={maxVal} />\r\n      </div>\r\n\r\n      {warningMessage !== null ? \r\n      <Warning text={warningMessage} />\r\n   : \"\"}\r\n   </div>;\r\n};\r\n\r\nexport default InputTextRange;\r\n","import { getTiles } from \"../components/TerrainGenerator\";\r\nimport Game from \"../Game\";\r\nimport { clamp, getElem, randFloat, randInt, randItem, Vector } from \"../utils\";\r\nimport { TileType } from \"./BoardGenerator\";\r\nimport Creature from \"./Creature\";\r\nimport Entity from \"./Entity\";\r\nimport Fruit from \"./Fruit\";\r\n\r\ninterface BoardCensus {\r\n   creatures: Array<Creature>;\r\n   fruit: Array<Fruit>;\r\n}\r\n\r\nexport class Board {\r\n   readonly width: number;\r\n   readonly height: number;\r\n   readonly cellSize: number;\r\n   readonly cells: Array<Array<Array<Entity>>>;\r\n   landTileIndexes = new Array<number>();\r\n   private tiles: Array<Array<TileType>>;\r\n\r\n   constructor(width: number, height: number, cellSize: number) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.cellSize = cellSize;\r\n\r\n      this.cells = new Array<Array<Array<Entity>>>();\r\n      for (let i = 0; i < height; i++) {\r\n         this.cells.push(new Array<Array<Entity>>());\r\n         for (let j = 0; j < width; j++) {\r\n            this.cells[i].push(new Array<Entity>());\r\n         }\r\n      }\r\n\r\n      this.tiles = this.generateTiles();\r\n   }\r\n\r\n   private createCell(): HTMLElement {\r\n      const cellObj = document.createElement(\"div\");\r\n      cellObj.className = \"cell\";\r\n      return cellObj;\r\n   }\r\n   private createCellRow(): HTMLElement {\r\n      const cellRow = document.createElement(\"div\");\r\n      cellRow.style.height = `${this.cellSize}px`;\r\n      cellRow.className = \"cell-row\";\r\n      return cellRow;\r\n   }\r\n   private generateTiles(): Array<Array<TileType>> {\r\n      const tileTypes = getTiles();\r\n\r\n      const board = getElem(\"board\");\r\n      board.classList.remove(\"hidden\");\r\n\r\n      const CELL_BORDER_SIZE = 2;\r\n      board.style.setProperty(\"--cell-size\", `${this.cellSize}px`);\r\n      board.style.setProperty(\"--cell-border-size\", `${CELL_BORDER_SIZE}px`);\r\n\r\n      const boardWidth = this.width * this.cellSize;\r\n      board.style.width = `${boardWidth}px`;\r\n      const boardHeight = this.height * this.cellSize;\r\n      board.style.height = `${boardHeight}px`;\r\n\r\n      const cellRows = new Array<HTMLElement>();\r\n      for (let i = 0; i < this.height; i++) {\r\n         const cellRow = this.createCellRow();\r\n         board.appendChild(cellRow);\r\n         cellRows.push(cellRow);\r\n         for (let j = 0; j < this.width; j++) {\r\n            const tileType = tileTypes[i][j];\r\n            if (!tileType.isLiquid) {\r\n               this.landTileIndexes.push(i * this.width + j);\r\n            }\r\n\r\n            const cellObj = this.createCell();\r\n            const colour = randItem(tileType.colour) as string;\r\n            cellObj.style.backgroundColor = colour;\r\n            cellRow.appendChild(cellObj);\r\n         }\r\n      }\r\n\r\n      return tileTypes;\r\n   }\r\n\r\n   createEntity(entity: Entity): void {\r\n      const cellNumbers = this.getCells(entity.position, entity.size/2);\r\n      this.insertEntity(entity, cellNumbers);\r\n   }\r\n\r\n   deleteEntity(entity: Entity): void {\r\n      const cells = this.getEntityReferences(entity);\r\n      this.removeEntity(entity, cells);\r\n   }\r\n\r\n   updateEntity(entity: Entity) {\r\n      const previousCellNumbers = this.getEntityReferences(entity);\r\n      const cellNumbers = this.getCells(entity.position, entity.size/2);\r\n\r\n      if (cellNumbers !== previousCellNumbers) {\r\n         if (previousCellNumbers.length !== 0) this.removeEntity(entity, previousCellNumbers);\r\n         this.insertEntity(entity, cellNumbers);\r\n      }\r\n\r\n      if (entity instanceof Creature) {\r\n         this.runWalkFunc(entity);\r\n      }\r\n   }\r\n\r\n   getNearby(position: Vector, radius: number): Array<Entity> {\r\n      const minX = Math.max(Math.floor((position.x - radius) / this.cellSize), 0);\r\n      const maxX = Math.min(Math.floor((position.x + radius) / this.cellSize), this.width - 1);\r\n      const minY = Math.max(Math.floor((position.y - radius) / this.cellSize), 0);\r\n      const maxY = Math.min(Math.floor((position.y + radius) / this.cellSize), this.height - 1);\r\n\r\n      let nearbyEntities = new Array<Entity>();\r\n      for (let y = minY; y <= maxY; y++) {\r\n         for (let x = minX; x <= maxX; x++) {\r\n            for (const entity of this.cells[y][x]) {\r\n               const distanceFromEntity = position.distanceFrom(entity.position);\r\n               if (!nearbyEntities.includes(entity) && distanceFromEntity - entity.size/2 <= radius) {\r\n                  nearbyEntities.push(entity);\r\n               }\r\n            }\r\n         }\r\n      }\r\n      return nearbyEntities;\r\n   }\r\n\r\n   randomPosition(): Vector {\r\n      if (this.landTileIndexes.length === 0) {\r\n         const x = randFloat(0, this.width * this.cellSize);\r\n         const y = randFloat(0, this.height * this.cellSize);\r\n         return new Vector(x, y);\r\n      }\r\n      const tileIndex = randItem(this.landTileIndexes) as number;\r\n      const x = tileIndex % this.width;\r\n      const y = Math.floor(tileIndex / this.width);\r\n\r\n      const xo = randFloat(0, this.cellSize);\r\n      const yo = randFloat(0, this.cellSize);\r\n\r\n      return new Vector(x * this.cellSize + xo, y * this.cellSize + yo);\r\n   }\r\n\r\n   getFruitColour(position: Vector): string | null {\r\n      if (this.landTileIndexes.length === 0) return null;\r\n\r\n      const x = Math.floor(position.x / this.cellSize);\r\n      const y = Math.floor(position.y / this.cellSize);\r\n\r\n      const tileType = this.tiles[y][x];\r\n      if (tileType.isLiquid) {\r\n         console.warn(\"Tried to find the fruit colour of a liquid!\");\r\n      }\r\n      return randItem(tileType.fruitColour!) as string;\r\n   }\r\n\r\n   getTileType(position: Vector): TileType {\r\n      const x = clamp(Math.floor(position.x / this.cellSize), 0, this.width - 1);\r\n      const y = clamp(Math.floor(position.y / this.cellSize), 0, this.height - 1);\r\n\r\n      return this.tiles[y][x];\r\n   }\r\n\r\n   randomPositionInCell(cellNumber: number): Vector {\r\n      const cellX = cellNumber % this.width;\r\n      const cellY = Math.floor(cellNumber / this.width);\r\n\r\n      const x = randFloat(0, this.cellSize);\r\n      const y = randFloat(0, this.cellSize);\r\n\r\n      return new Vector(cellX * this.cellSize + x, cellY * this.cellSize + y);\r\n   }\r\n\r\n   randomNearbyPosition(position: Vector, radius: number, tilePreference?: TileType): Vector {\r\n      let nearbyPosition: Vector | null = null;\r\n      while (nearbyPosition === null) {\r\n         const pos = position.randomOffset(radius);\r\n         if (this.positionIsInBoard(pos)) {\r\n            const tileType = this.getTileType(pos);\r\n            if (tileType !== tilePreference && Math.random() >= Game.settings.tilePreference) continue;\r\n\r\n            nearbyPosition = pos;\r\n         }\r\n      }\r\n      return nearbyPosition;\r\n   }\r\n\r\n   census(): Promise<BoardCensus> {\r\n      return new Promise(resolve => {\r\n         let creatures: Array<Creature> = new Array<Creature>();\r\n         let fruit: Array<Fruit> = new Array<Fruit>();\r\n      \r\n         for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n               const cell = this.cells[y][x];\r\n               for (const entity of cell) {\r\n                  if (entity instanceof Creature && !creatures.includes(entity)) creatures.push(entity);\r\n                  else if (entity instanceof Fruit && !fruit.includes(entity)) fruit.push(entity);\r\n               }\r\n            }\r\n         }\r\n   \r\n         const entities = {\r\n            creatures: creatures,\r\n            fruit: fruit\r\n         };\r\n         resolve(entities);\r\n      });\r\n   }\r\n\r\n   /** Tick a random couple of tiles each tick. */\r\n   tick() {\r\n      const tickedEntities = new Array<Entity>();\r\n      for (let y = 0; y < this.height; y++) {\r\n         for (let x = 0; x < this.width; x++) {\r\n            const cell = this.cells[y][x];\r\n            for (const entity of cell) {\r\n               if (!tickedEntities.includes(entity)) {\r\n                  entity.tick();\r\n                  tickedEntities.push(entity);\r\n               }\r\n            }\r\n         }\r\n      }\r\n\r\n      const tileTickAmount = this.width * this.height / 100;\r\n      for (let i = 0; i < tileTickAmount; i++) {\r\n         const x = randInt(0, this.width);\r\n         const y = randInt(0, this.height);\r\n         \r\n         const tileType = this.tiles[y][x];\r\n         if (tileType.tickFunc) tileType.tickFunc(x, y);\r\n      }\r\n   }\r\n\r\n   private runWalkFunc(creature: Creature): void {\r\n      const x = clamp(Math.floor(creature.position.x / this.cellSize), 0, this.width - 1);\r\n      const y = clamp(Math.floor(creature.position.y / this.cellSize), 0, this.height - 1);\r\n\r\n      const tileType = this.tiles[y][x];\r\n      if (tileType.walkFunc) tileType.walkFunc(creature);\r\n   }\r\n\r\n   private insertEntity(entity: Entity, cells: Array<Array<Entity>>) {\r\n      for (const cell of cells) {\r\n         cell.push(entity);\r\n      }\r\n   }\r\n\r\n   private removeEntity(entity: Entity, cells: Array<Array<Entity>>) {\r\n      for (const cell of cells) {\r\n         while (true) {\r\n            const idx = cell.indexOf(entity);\r\n            if (idx !== -1) {\r\n               cell.splice(idx, 1);\r\n            } else {\r\n               break;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   private getEntityReferences(entity: Entity): Array<Array<Entity>> {\r\n      const xCell = clamp(Math.floor(entity.position.x / this.cellSize), 0, this.width - 1);\r\n      const yCell = clamp(Math.floor(entity.position.y / this.cellSize), 0, this.height - 1);\r\n\r\n      const minX = Math.max(xCell - 2, 0);\r\n      const maxX = Math.min(xCell + 2, this.width - 1);\r\n      const minY = Math.max(yCell - 2, 0);\r\n      const maxY = Math.min(yCell + 2, this.height - 1);\r\n\r\n      let cellNumbs = [];\r\n      let cells = new Array<Array<Entity>>();\r\n      for (let y = minY; y <= maxY; y++) {\r\n         for (let x = minX; x <= maxX; x++) {\r\n            const cell = this.cells[y][x];\r\n            if (cell.includes(entity)) {\r\n               cellNumbs.push([x, y]);\r\n               cells.push(cell);\r\n            }\r\n         }\r\n      }\r\n\r\n      return cells;\r\n   }\r\n\r\n   private getCells(position: Vector, radius: number): Array<Array<Entity>> {\r\n      const x = Math.floor(position.x / this.cellSize);\r\n      const y = Math.floor(position.y / this.cellSize);\r\n\r\n      // The (position.x + this.cellSize) part is necessary because sometimes is negative\r\n      const cellX = (position.x + this.cellSize) % this.cellSize;\r\n      const cellY = (position.y + this.cellSize) % this.cellSize;\r\n\r\n      const baseCellNumber: [number, number] = [x, y];\r\n\r\n      let cellNumbers: Array<[number, number]> = [baseCellNumber];\r\n\r\n      // Top\r\n      if (cellX - radius < 0) cellNumbers.push([x - 1, y]);\r\n      // Bottom\r\n      if (cellX + radius > this.cellSize) cellNumbers.push([x + 1, y]);\r\n      // Left\r\n      if (cellY - radius < 0) cellNumbers.push([x, y - 1]);\r\n      // Right\r\n      if (cellY + radius > this.cellSize) cellNumbers.push([x, y + 1]);\r\n      // Top left\r\n      if (cellX - radius < 0 && cellY - radius < 0) cellNumbers.push([x - 1, y - 1]);\r\n      // Top right\r\n      if (cellX + radius > this.cellSize && cellY - radius < 0) cellNumbers.push([x - 1, y - 1]);\r\n      // Bottom left\r\n      if (cellX - radius < 0 && cellY + radius < this.cellSize) cellNumbers.push([x - 1, y - 1]);\r\n      // Bottom right\r\n      if (cellX + radius > this.cellSize && cellY + radius < this.cellSize) cellNumbers.push([x - 1, y - 1]);\r\n\r\n      for (let i = cellNumbers.length - 1; i >= 0; i--) {\r\n         const cellNumber = cellNumbers[i];\r\n         if (cellNumber[0] < 0 || cellNumber[0] >= this.width || cellNumber[1] < 0 || cellNumber[1] >= this.height) {\r\n            cellNumbers.splice(i, 1);\r\n         }\r\n      }\r\n\r\n      const cells = new Array<Array<Entity>>();\r\n      for (const cellNumber of cellNumbers) {\r\n         cells.push(this.cells[cellNumber[1]][cellNumber[0]]);\r\n      }\r\n\r\n      return cells;\r\n   }\r\n\r\n   private positionIsInBoard(position: Vector): boolean {\r\n      return position.x >= 0 && position.x <= this.width * this.cellSize && position.y >= 0 && position.y <= this.height * this.cellSize;\r\n   }\r\n}","import Fruit, { createFruit } from \"./classes/Fruit\";\nimport { gameImages } from \"./classes/GameImage\";\nimport { inspectorIsOpen, rerenderInspector } from \"./creature-inspector\";\nimport { updateControlPanel } from \"./components/ControlPanel\";\nimport Creature, { createCreature, creatureGeneInfo } from \"./classes/Creature\";\nimport { getElem, roundNum, standardDeviation, Vector } from \"./utils\";\nimport { drawGraphs, graphSettingData } from \"./graph-viewer\";\nimport { updateTransform } from \"./keyboard\";\nimport Entity from \"./classes/Entity\";\nimport { Board } from \"./classes/Board\";\n\nconst renderListeners: Array<Function> = [];\n\nexport const geneSamples: Array<GeneSample> = new Array<GeneSample>();\n\nexport interface GeneSampleEntry {\n   average: number;\n   min: number;\n   max: number;\n   standardDeviation: number;\n}\ninterface GenePool {\n   [key: keyof typeof creatureGeneInfo]: GeneSampleEntry;\n}\ninterface GeneSample {\n   [key: string]: any;\n   creatures: number | null;\n   fruit: number | null;\n   fruitMultiplier: number;\n   genePool: GenePool | null;\n}\n\nconst sampleGenes = (creatures: ReadonlyArray<Creature>, fruit: ReadonlyArray<Fruit>) => {\n   let genePool: GenePool | null = {};\n   if (creatures.length === 0) {\n      genePool = null;\n   } else {\n      let allGenes: { [ key: keyof typeof creatureGeneInfo ]: Array<number> } = {};\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         allGenes[geneName] = new Array<number>();\n      }\n      \n      for (const creature of creatures) {\n         for (const geneName of Object.keys(allGenes)) {\n            allGenes[geneName].push(creature[geneName]);\n         }\n      }\n      \n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         const geneVals = allGenes[geneName];\n         \n         const n = geneVals.length;\n         let minVal = Number.MAX_SAFE_INTEGER;\n         let maxVal = 0;\n         let average = 0;\n         for (let i = 0; i < n; i++) {\n            const val = geneVals[i];\n            if (val < minVal) minVal = val;\n            if (val > maxVal) maxVal = val;\n            average += val;\n         }\n         average /= n;\n         \n         genePool[geneName] = {\n            average: average,\n            min: minVal,\n            max: maxVal,\n            standardDeviation: standardDeviation(geneVals)\n         };\n      }\n   }\n\n   let creatureCount: number | null = Entity.count(Creature);\n   // let creatureCount: number | null = creatures.length;\n   if (creatureCount === 0) creatureCount = null;\n   const fruitCount: number | null = Entity.count(Fruit);\n   // const fruitCount: number | null = fruit.length;\n   geneSamples.push({\n      creatures: creatureCount,\n      fruit: fruitCount,\n      fruitMultiplier: Game.fruitMultiplier,\n      genePool: genePool\n   });\n\n   if (graphSettingData[1].isChecked) {\n      drawGraphs();\n   }\n};\n\ninterface GameType {\n   hasStarted: boolean;\n   isPaused: boolean;\n   ticks: number;\n   readonly tps: number;\n   timewarp: number;\n   fruitMultiplier: number;\n   previousTime: number;\n   previousTicks: number;\n   runTick: Function;\n   start: Function;\n   createRenderListener: Function;\n   removeRenderListener: Function;\n   hasRenderListener: Function;\n   boardSize: {\n      width: number;\n      height: number;\n   },\n   transform: {\n      zoom: number;\n      translate: Vector;\n   },\n   readonly cellSize: number;\n   settings: GameSettings;\n   board: Board;\n}\nexport interface GameSettings {\n   fruitSpawnRate: number;\n   creatureMutationRate: number;\n   eggIncubationTime: number;\n   initialCreatures: number;\n   initialFruit: number;\n   equilibrium: number;\n   tilePreference: number;\n   creatureColour: string;\n   showDebugOutput: boolean;\n}\nexport const defaultGameSettings: GameSettings = {\n   fruitSpawnRate: 1,\n   creatureMutationRate: 1,\n   eggIncubationTime: 5,\n   initialCreatures: 10,\n   initialFruit: 50,\n   equilibrium: 20,\n   tilePreference: 0.2,\n   creatureColour: \"regular\",\n   showDebugOutput: false\n}\n\nconst Game: GameType = {\n   hasStarted: false,\n   isPaused: false,\n   // The number of ticks that have elapsed since the load of the web page\n   ticks: 0,\n   // Effectively changes the number of rerenders each second. Affects everything from confetti to creatures.\n   tps: 20,\n   timewarp: 1,\n   fruitMultiplier: 1,\n   previousTime: Date.now(),\n   previousTicks: 0,\n   // Runs every {tps} seconds.\n   runTick: async function(): Promise<void> {\n      if (this.isPaused) {\n         setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n         return;\n      }\n\n      this.previousTicks++;\n\n      // Call all external render listeners\n      for (const func of renderListeners) func();\n\n      for (const gameImage of gameImages) gameImage.tick();\n\n      // Game.board.tick();\n      \n      if (this.hasStarted) {\n         this.ticks++;\n\n         this.board.tick();\n\n         // Remove all rays\n         document.querySelectorAll(\".ray\").forEach(ray => ray.remove());\n\n         /** Seconds between samples of the population + genes */\n         const SAMPLE_INTERVAL = 5;\n         if (this.ticks % (SAMPLE_INTERVAL * this.tps) === 0) {\n            const entities = await Game.board.census();\n\n            const creatureCount = entities.creatures.length;\n            if (creatureCount === 0) {\n               this.fruitMultiplier = 1;\n            } else {\n               this.fruitMultiplier = this.settings.equilibrium / creatureCount;\n            }\n\n            const fruitDensity = entities.fruit.length / this.board.landTileIndexes.length;\n            const MAX_FRUIT_DENSITY = 10;\n            if (fruitDensity > MAX_FRUIT_DENSITY) {\n               console.log(\"MAX!\");\n            }\n\n            sampleGenes(entities.creatures, entities.fruit);\n         }\n\n         // Number of fruits which spawn in a cell each second\n         const FRUIT_SPAWN_RATE = 0.05 * this.settings.fruitSpawnRate * this.fruitMultiplier;\n         for (let i = 0; i < this.board.landTileIndexes.length; i++) {\n            const cellNumber = this.board.landTileIndexes[i];\n            const rand = Math.random();\n            for (let i = 0; rand <= FRUIT_SPAWN_RATE / this.tps - i; i++) {\n               createFruit(cellNumber);\n            }\n         }\n   \n         updateControlPanel();\n   \n         if (inspectorIsOpen) rerenderInspector();\n      }\n\n      const time = Date.now();\n      const dt = time - this.previousTime;\n      if (time - this.previousTime >= 1000) {\n         if (this.settings.showDebugOutput) console.log(this.previousTicks + \" ticks (\" + roundNum(this.previousTicks / this.tps, 1) + \" seconds(s)) in \" + dt + \"ms\");\n         this.previousTicks = 0;\n         this.previousTime = time;\n      }\n\n      setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n   },\n   start(): void {\n      getElem(\"title-options-container\").classList.add(\"hidden\");\n\n      // Create the board object\n      this.board = new Board(this.boardSize.width, this.boardSize.height, this.cellSize);\n\n      this.hasStarted = true;\n\n      this.transform.zoom = 25 / Math.pow(this.boardSize.width + this.boardSize.height, 1.1);\n      updateTransform();\n   \n      for (let i = 0; i < this.settings.initialCreatures; i++) {\n         createCreature();\n      }\n      for (let i = 0; i < this.settings.initialFruit; i++) {\n         createFruit();\n      }\n   },\n   createRenderListener(func: Function): void {\n      renderListeners.push(func);\n   },\n   removeRenderListener(func: Function): void {\n      const functionIndex = renderListeners.indexOf(func);\n      if (functionIndex === -1) throw new Error(`No matching function could be found! Name: ${func.name}`);\n      renderListeners.splice(functionIndex, 1);\n   },\n   hasRenderListener(func: Function): boolean {\n      const functionIndex = renderListeners.indexOf(func);\n      return functionIndex >= 0;\n   },\n   boardSize: {\n      width: 15,\n      height: 15\n   },\n   transform: {\n      zoom: 1,\n      translate: new Vector(0, 0)\n   },\n   // Width and height of cells in px\n   cellSize: 60,\n   settings: defaultGameSettings,\n   board: null as unknown as Board\n};\n\nexport default Game;","import Game from \"./Game\";\nimport { randFloat, randItem, Vector } from \"./utils\";\n\nconst confettis: Array<Confetti> = [];\n\nclass Confetti {\n   element: HTMLElement;\n   position: Vector;\n   velocity: Vector;\n\n   constructor() {\n      this.element = this.createInstance();\n      this.position = this.getRandomPosition();\n      this.velocity = this.getRandomVelocity();\n   };\n   getRandomPosition(): Vector {\n      // Between 100 and 0, percentage of the screen that the x position could start at\n      const X_RANGE = 90;\n      // Between 100 and 0, percentage of the screen that the y position could start at\n      const Y_RANGE = 90;\n      // Shifts the potential y positions up and down. Negative is a shift down\n      const Y_OFFSET = -10;\n\n      const x = randFloat(0, X_RANGE) + (100 - X_RANGE) / 2;\n      const y = randFloat(0, Y_RANGE) + (100 - Y_RANGE) / 2 - Y_OFFSET;\n      return new Vector(x, y);\n   };\n   getRandomVelocity(): Vector {\n      const xVel = randFloat(-2, 2);\n      const yVel = randFloat(-12, -5);\n      return new Vector(xVel, yVel);\n   };\n   createInstance(): HTMLElement {\n      const confetti = document.createElement(\"div\");\n      confetti.className = \"confetti\";\n      document.body.appendChild(confetti);\n\n      // Give it a random size\n      const WIDTH_RANGE = [3, 7];\n      const HEIGHT_RANGE = [5, 12];\n      const width = randFloat(WIDTH_RANGE[0], WIDTH_RANGE[1]);\n      const height = randFloat(HEIGHT_RANGE[0], HEIGHT_RANGE[1]);\n      confetti.style.width = `${width}px`;\n      confetti.style.height = `${height}px`;\n      \n      // Apply a random rotation\n      const rotation = Math.random() * 180;\n      confetti.style.transform = `rotate(${rotation}deg)`;\n\n      const potentialColours: Array<string> = [\"red\", \"pink\", \"orange\", \"green\", \"blue\"];\n      const colour: string = randItem(potentialColours) as string;\n      confetti.style.backgroundColor = colour;\n\n      return confetti;\n   };\n   updatePosition(): void {\n      this.element.style.left = `${this.position.x}%`;\n      this.element.style.top = `${this.position.y}%`;\n   };\n   tick() {\n      for (let i = 0; i < 7; i++) {\n         // Apply velocity\n         this.position = this.position.lerp(this.position.add(this.velocity), 1 / Game.tps);\n         // Gravityyyyy\n         this.velocity.y += 0.05;\n      }\n\n      // If the confetti is out of bounds, stab it\n      if (this.position.y > 100 || this.position.x < 0 || this.position.x > 100) {\n         this.die();\n      }\n\n      this.updatePosition();\n   };\n   die() {\n      this.element.remove();\n\n      const confettiIndex = confettis.indexOf(this);\n      confettis.splice(confettiIndex, 1);\n   }\n}\n\nconst handleConfettis = () => {\n   for (const confetti of confettis) confetti.tick();\n}\n\nexport function createConfettis(n: number) {\n   for (let i = 0; i < n; i++) {\n      confettis.push(new Confetti());\n   }\n\n   if (!Game.hasRenderListener(handleConfettis)) Game.createRenderListener(handleConfettis);\n}","import '../css/start-menu.css';\r\nimport { getElem } from '../utils';\r\nimport InputRange from './InputRange';\r\nimport Game, { defaultGameSettings, GameSettings } from '../Game';\r\nimport TerrainGenerator from './TerrainGenerator';\r\nimport { useState } from 'react';\r\n\r\nexport function openStartMenu(): void {\r\n   getElem(\"start-menu\").classList.remove(\"hidden\");\r\n}\r\n\r\nconst closeStartMenu = (): void => {\r\n   getElem(\"start-menu\").remove();\r\n\r\n   Game.start();\r\n}\r\n\r\nlet newGameSettings: GameSettings = JSON.parse(JSON.stringify(defaultGameSettings));\r\n\r\nconst startClickEvent = () => {\r\n   Game.settings = newGameSettings;\r\n   closeStartMenu();\r\n};\r\n\r\ninterface ColourOption {\r\n   text: string;\r\n   className: string;\r\n   isSelected?: boolean;\r\n}\r\nconst CreatureColourSelect = (): JSX.Element => {\r\n   const colourOptions: Array<ColourOption> = [\r\n      {\r\n         text: \"Regular\",\r\n         className: \"regular\",\r\n         isSelected: true\r\n      },\r\n      {\r\n         text: \"Gene-based\",\r\n         className: \"gene-based\"\r\n      },\r\n      {\r\n         text: \"RGB\",\r\n         className: \"rgb\"\r\n      }\r\n   ];\r\n   const [options, setOptions] = useState<Array<ColourOption>>(colourOptions);\r\n\r\n   const clickEvent = (option: ColourOption): void => {\r\n      newGameSettings.creatureColour = option.className;\r\n      const newOptionsArray = options.slice();\r\n      for (const currentOption of newOptionsArray) {\r\n         if (currentOption.text === option.text) {\r\n            currentOption.isSelected = true;\r\n         } else if (currentOption.isSelected) {\r\n            currentOption.isSelected = false;\r\n         }\r\n      }\r\n      setOptions(newOptionsArray);\r\n   }\r\n\r\n   let selectedOption!: ColourOption;\r\n   for (const option of options) {\r\n      if (option.isSelected) {\r\n         selectedOption = option;\r\n         break;\r\n      }\r\n   }\r\n\r\n   return <div className=\"colour-options\">\r\n      <div className=\"formatter\">\r\n         {options.map((option, i) => {\r\n            const className = `option${option.isSelected ? \" selected\" : \"\"}`;\r\n            return <div onClick={() => clickEvent(option)} key={i} className={className}>{option.text}</div>\r\n         })}\r\n      </div>\r\n\r\n      <div className=\"preview-caption\">Preview</div>\r\n      <div className=\"creature-preview-container\">\r\n         <div className={\"creature-preview \" + selectedOption.className}></div>\r\n      </div>\r\n   </div>;\r\n}\r\n\r\nenum Stages {\r\n   TerrainGeneration = 1,\r\n   Options = 2,\r\n   StartGame = 3\r\n}\r\nconst StartMenu = () => {\r\n   const [stage, setStage] = useState(1);\r\n\r\n   const advanceStage = (): void => {\r\n      const nextStage = stage + 1;\r\n\r\n      if (nextStage === Stages.StartGame) {\r\n         startClickEvent();\r\n      } else {\r\n         setStage(nextStage);\r\n      }\r\n   }\r\n\r\n   return (\r\n      <div id=\"start-menu\" className=\"menu hidden\">\r\n         <div className=\"content\">\r\n            <h1 className=\"heading\">Settings</h1>\r\n\r\n            {stage === Stages.TerrainGeneration ?\r\n            <TerrainGenerator />\r\n            : \"\"}\r\n            {stage === Stages.Options ?\r\n            <>\r\n               <h2 className=\"subheading\">Initial Population</h2>\r\n               <InputRange func={newVal => newGameSettings.initialCreatures = newVal} text=\"Creatures\" min={0} max={250} step={5} defaultValue={10} />\r\n               <InputRange func={newVal => newGameSettings.initialFruit = newVal} text=\"Fruit\" min={0} max={500} step={5} defaultValue={50} />\r\n\r\n               <h2 className=\"subheading\">Creature Colour</h2>\r\n               <CreatureColourSelect />\r\n\r\n               <h2 className=\"subheading\">Modifiers</h2>\r\n               <InputRange func={newVal => newGameSettings.fruitSpawnRate = newVal} text=\"Fruit spawn rate\" min={0.5} max={5} step={0.5} defaultValue={1} hasExtremeMode={true} prefix=\"x\" />\r\n               <InputRange func={newVal => newGameSettings.creatureMutationRate = newVal} text=\"Creature mutation rate\" min={0.5} max={3} step={0.1} defaultValue={1} hasExtremeMode={true} prefix=\"x\" />\r\n               <InputRange func={newVal => newGameSettings.eggIncubationTime = newVal} text=\"Egg incubation time\" min={0} max={15} step={1} defaultValue={5} hasExtremeMode={true} prefix=\" seconds\" />\r\n\r\n               <h2 className=\"subheading\">Other Stuff</h2>\r\n               <InputRange func={newVal => newGameSettings.equilibrium = newVal} text=\"Desired equilibrium\" min={0} max={250} step={5} defaultValue={20} prefix=\" creatures\" description=\"How many creatures you want to have.\" />\r\n               <InputRange text=\"Tile preference\" min={0} defaultValue={defaultGameSettings.tilePreference} max={1} step={0.1} description=\"How strongly creatures should prefer the biome they were born in.\" />\r\n            </>\r\n            : \"\"}\r\n\r\n            <button className=\"next-button\" onClick={advanceStage}>&gt; Next &lt;</button>\r\n         </div>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default StartMenu;\r\n","import React from \"react\";\nimport { createConfettis } from \"../confetti\";\nimport \"../css/titlescreen.css\";\nimport { openStartMenu } from \"./StartMenu\";\n\nconst openSourceCode = () => {\n   const githubURL = \"https://github.com/eggpoison/creature-simulator\";\n   window.open(githubURL, '_blank')?.focus();\n}\n\nconst Titlescreen = () => {\n   return (\n      <div id=\"titlescreen\">\n         <h1>Creature Simulator</h1>\n         <div id=\"title-options-container\">\n            <button onClick={openStartMenu}>Start</button>\n            <button onClick={() => createConfettis(50)}>Confetti!</button>\n            <button>About</button>\n            <button onClick={openSourceCode} id=\"source-code-button\">Source Code</button>\n         </div>\n      </div>\n   );\n}\n\nexport default Titlescreen;","const Board = () => {\n   return (\n      <div id=\"board\" className=\"hidden\"></div>\n   );\n}\n\nexport default Board;","import React, { useEffect, useState } from 'react'\r\nimport Creature, { creatureGeneInfo } from '../classes/Creature';\r\nimport { setInspectorRerenderFunction, setUpdateFunction } from '../creature-inspector';\r\nimport '../css/creature-inspector.css';\r\nimport Game from '../Game';\r\nimport { roundNum } from '../utils';\r\n\r\nconst CreatureInspector = () => {\r\n    const [creature, setCreature] = useState<Creature | null>(null);\r\n\r\n    const [, updateState] = React.useState({});\r\n    const forceUpdate = React.useCallback(() => updateState({}), []);\r\n\r\n    useEffect(() => {\r\n        setUpdateFunction((newCreature: Creature | null) => {\r\n            setCreature(newCreature);\r\n        });\r\n        setInspectorRerenderFunction(() => forceUpdate());\r\n    }, [forceUpdate]);\r\n\r\n    const geneInfo: JSX.Element = creature === null ? <></> : <> {\r\n        Object.entries(creatureGeneInfo).map((geneInfo, i) => {\r\n            const gene = geneInfo[1], geneName = geneInfo[0];\r\n            const val = creature[geneName];\r\n            const fillWidth = (val - gene.min) / (gene.max - gene.min) * 100;\r\n            const fillOpacity = 0.5 + (val - gene.min) / (gene.max - gene.min) / 2;\r\n            \r\n            return <div key={i} className=\"gene\">\r\n                <div className=\"label\">{gene.display}</div>\r\n                <div className=\"slider\">\r\n                    <div style={{ width: fillWidth + \"%\", opacity: fillOpacity, backgroundColor: gene.colour }} className=\"slider-fill\"></div>\r\n                    <div className=\"min\">{gene.min}</div>\r\n                    <div className=\"val\">{val}</div>\r\n                    <div className=\"max\">{gene.max}</div>\r\n                </div>\r\n            </div>\r\n        })\r\n    } </>;\r\n\r\n    return creature === null ? <></> : (\r\n        <div id=\"creature-inspector\">\r\n            <h1>Creature Inspector</h1>\r\n\r\n            <h2>General</h2>\r\n            <div className=\"panel\">\r\n                <p>Name: {creature.name}</p>\r\n                <p>Age: {Game.ticks - creature.birthTime} ticks ({roundNum((Game.ticks - creature.birthTime) / Game.tps, 1)} seconds)</p>\r\n            </div>\r\n\r\n            <h2>Stats</h2>\r\n            <div className=\"panel\">\r\n                <p>Generation: {creature.stats.generation}</p>\r\n                <p>Fruit eaten: {creature.stats.fruitEaten}</p>\r\n            </div>\r\n\r\n            <h2>Genes</h2>\r\n            <div className=\"panel\">\r\n                {geneInfo}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CreatureInspector;\r\n","import Creature from \"./classes/Creature\";\r\nimport { createHoverBox, getElem, Vector } from \"./utils\";\r\nimport { closeInspector, openInspector } from \"./creature-inspector\";\r\nimport { closeGraphViewer, graphViewerIsVisible, openGraphViewer } from \"./graph-viewer\";\r\nimport Game from \"./Game\";\r\n\r\nconst MIN_HOVER_DISTANCE = 50;\r\nlet hoverBox: HTMLElement | null = null;\r\nlet closestCreature: Creature | null = null;\r\n\r\nconst highlight = (creature: Creature): void => {\r\n   creature.element.classList.add(\"highlighted\");\r\n}\r\n\r\nconst removePreviousHighlight = (): void => {\r\n   document.querySelector(\".creature.highlighted\")?.classList.remove(\"highlighted\");\r\n}\r\n\r\nexport function handleMouse(event: MouseEvent): void {\r\n   const board = getElem(\"board\");\r\n   if (event.composedPath().includes(board)) {\r\n      const boardBounds = board.getBoundingClientRect();\r\n      updateMouse(event.clientX - boardBounds.x, event.clientY - boardBounds.y);\r\n   }\r\n\r\n}\r\n\r\nexport function updateMouse(mouseX: number, mouseY: number): void {\r\n   const mult = 900 / 534;\r\n   const mousePos = new Vector(mouseX * mult, mouseY * mult);\r\n\r\n   closestCreature = null;\r\n   let distanceToClosestCreature = MIN_HOVER_DISTANCE;\r\n   for (const cell of Game.board.cells) {\r\n      for (const entity of cell) {\r\n         if (entity instanceof Creature) {\r\n            const dist = mousePos.distanceFrom(entity.position);\r\n            if (dist < distanceToClosestCreature) {\r\n               closestCreature = entity;\r\n               distanceToClosestCreature = dist;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   removePreviousHighlight();\r\n\r\n   const board = getElem(\"board\");\r\n   if (closestCreature !== null) {\r\n      highlight(closestCreature);\r\n      const newHoverBox = createHoverBox(closestCreature.name, new Vector(closestCreature.position.x, closestCreature.position.y + 20 + closestCreature.size/2), board);\r\n      // Remove previous hover box if possible\r\n      if (hoverBox !== null && hoverBox !== newHoverBox) {\r\n         hoverBox.remove();\r\n      }\r\n      hoverBox = newHoverBox;\r\n\r\n      board.classList.add(\"highlight\");\r\n   } else {\r\n      board.classList.remove(\"highlight\");\r\n      hoverBox?.remove();\r\n      hoverBox = null;\r\n   }\r\n}\r\n\r\nexport function mouseClick(): void {\r\n   const e = window.event;\r\n   const targetElem = e?.target as HTMLElement;\r\n\r\n   if (targetElem.id === \"open-graph-viewer-button\") {\r\n      openGraphViewer();\r\n   } else if (graphViewerIsVisible) {\r\n      if (e?.composedPath().includes(getElem(\"graph-viewer\"))) return;\r\n      \r\n      closeGraphViewer();\r\n   } else {\r\n      if (closestCreature !== null) {\r\n         openInspector(closestCreature);\r\n      } else {\r\n         closeInspector();\r\n      }\r\n   }\r\n}","import React from 'react';\r\nimport '../css/graph-viewer.css';\r\nimport '../css/graphs.css';\r\n\r\nconst GraphViewer = () => {\r\n   return (\r\n      <div id=\"graph-viewer\" className=\"menu hidden\">\r\n         <h1 className=\"heading\">View Graphs</h1>\r\n\r\n         <div className=\"formatter\">\r\n            <div className=\"options\">\r\n               <h2 className=\"subheading\">Graph Options</h2>\r\n               <p>Select which graphs should be shown.</p>\r\n\r\n               <div className=\"options-container\"></div>\r\n            </div>\r\n            <div className=\"settings\">\r\n               <h2 className=\"subheading\">Settings</h2>\r\n               <p>Control how the graphs look.</p>\r\n\r\n               <div className=\"settings-container\"></div>\r\n            </div>\r\n         </div>\r\n         <div className=\"graph-container\">\r\n            <p>Your graph will appear here once you choose an option.</p>\r\n         </div>\r\n      </div>\r\n   );\r\n}\r\n\r\nexport default GraphViewer;\r\n","const PauseScreen = () => {\r\n   return (\r\n      <div id=\"pause-screen\" className=\"hidden\">\r\n         <hgroup>\r\n            <h1>Paused!</h1>\r\n            <h2>Press <span>&lt;space&gt;</span> to unpause.</h2>\r\n         </hgroup>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default PauseScreen;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Titlescreen from './components/Titlescreen';\nimport Game from './Game';\nimport './css/index.css';\nimport './css/menus.css';\nimport './css/board.css';\nimport Board from './components/Board';\nimport ControlPanel from './components/ControlPanel';\nimport CreatureInspector from './components/CreatureInspector';\nimport { handleMouse, mouseClick } from './mouse';\nimport GraphViewer from './components/GraphViewer';\nimport PauseScreen from './components/PauseScreen';\nimport StartMenu from './components/StartMenu';\nimport { getElem } from './utils';\nimport { setupGraphs } from './graph-viewer';\nimport { keyPress } from './keyboard';\nimport './css/pause-screen.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Titlescreen />\n    <ControlPanel />\n    <Board />\n    <CreatureInspector />\n    <GraphViewer />\n    <PauseScreen />\n    <StartMenu />\n    <div id=\"mask\" className=\"hidden\"></div>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\nexport function hideMask(): void {\n  getElem(\"mask\").classList.add(\"hidden\");\n}\n\nexport function showMask(): void {\n  getElem(\"mask\").classList.remove(\"hidden\");\n}\n\nconst setup = (): void => {\n  setupGraphs();\n\n  // Start the game loop\n  Game.runTick();\n};\n\nwindow.onload = setup;\n\ndocument.onmousemove = handleMouse;\ndocument.onclick = mouseClick;\ndocument.onkeydown = keyPress;"],"sourceRoot":""}