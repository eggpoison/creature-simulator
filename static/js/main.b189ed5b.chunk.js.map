{"version":3,"sources":["images sync /^/.//.*/.png$","images/egg/egg-0.png","images/egg/egg-1.png","images/egg/egg-2.png","images/egg/egg-3.png","images/egg/egg-4.png","images/heart/heart-0.png","images/heart/heart-1.png","images/heart/heart-2.png","images/heart/heart-3.png","images/smoke/smoke-0.png","images/smoke/smoke-1.png","images/smoke/smoke-2.png","images/smoke/smoke-3.png","images/smoke/smoke-4.png","utils.ts","classes/Entity.ts","classes/Fruit.ts","creature-inspector.ts","GameImage.ts","classes/Egg.ts","classes/Creature.ts","components/ControlPanel.tsx","components/InputCheckbox.tsx","components/InputRange.tsx","classes/Graph.ts","graph-viewer.tsx","keyboard.tsx","perlin-noise.ts","classes/BoardGenerator.ts","components/TerrainGenerator.tsx","components/InputSelect.tsx","components/Warning.tsx","components/InputText.tsx","classes/Board.ts","Game.tsx","confetti.tsx","components/StartMenu.tsx","components/Titlescreen.tsx","components/Board.tsx","components/CreatureInspector.tsx","mouse.ts","components/GraphViewer.tsx","components/PauseScreen.tsx","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","Vector","x","y","this","vec2","targetVec","amount","lerp","Math","sqrt","pow","atan2","targetVector","distance","distanceFrom","angle","angleBetween","PolarVector","radius","dist","randFloat","ang","offset","add","convertToCartesian","theta","random","PI","cos","sin","magnitude","direction","getElem","elem","document","getElementById","randInt","min","max","floor","randItem","arr","length","start","target","roundNum","num","dpp","power","round","Number","EPSILON","standardDeviation","data","n","mean","reduce","a","b","variance","val","Colour","colour","_hex","_rgb","toLowerCase","substring","getRGB","getHex","r","g","hexDigits","split","rgb","i","digit1","indexOf","digit2","col","slice","gray","hex","b16","Entity","position","attributes","velocity","age","lifespan","element","entries","attribute","instantiate","createEntity","updatePosition","Game","board","width","height","appendChild","size","style","die","updateEntity","left","top","remove","deleteEntity","entity","entityType","count","cells","cell","prototype","isPrototypeOf","createFruit","cellNumber","tps","randomPositionInCell","randomPosition","getFruitColour","Fruit","updateInspector","rerenderInspector","backgroundColor","createElement","className","gameImages","Array","GameImage","name","numFrames","ticksPerFrame","frame","init","updateBackgroundImage","push","backgroundSize","src","require","default","backgroundImage","splice","inspectorIsOpen","inspectorCreature","closeInspector","Egg","creatureAttributes","generation","shakeAmount","ticks","transform","Creature","copy","stats","creatureGeneInfo","speed","display","weight","positivelyAffectsLifespan","vision","reproductiveRate","calculateLifespan","attributeInfo","attributeVal","generateGene","attributeName","getRandomName","nouns","chosenAdjectives","potentialAdjectives","idx","adjectiveList","previousValue","currentValue","newVal","hasNoun","createCreature","boardSize","cellSize","updateControlPanel","REPRODUCTION_TIME","moveSpeed","birthTime","isMoving","targetPosition","reproductiveUrge","partner","reproductionStage","lastReproductionTime","settings","eggIncubationTime","fruitEaten","calculateMoveSpeed","reduction","innerHTML","setProperty","lifebar","querySelector","life","color","classList","updateLifebar","updateReproductionBar","hasReachedTargetPosition","reachTargetPosition","moveToTargetPosition","imagePos","randomOffset","particleAttempts","entitiesInVision","getNearby","selfIdx","closestFruit","distanceToNearestFruit","MAX_SAFE_INTEGER","closestPartner","distanceToClosestPartner","entityIsFruit","wantsToReproduce","distanceToCreature","distanceToFruit","handleReproduction","eatFruit","randomNearbyPosition","fruit","entitiesToCheck","filter","canSeeEntity","end","ray","drawRay","angleToTarget","nextPosition","relativeTargetVec","dot","reproduce","then","layEgg","Promise","setTimeout","childAttributes","generateChildGenes","eggAttributes","eggPos","geneName","gene","mutateGene","initialGeneVal","mutateAmount","creatureMutationRate","sign","InputCheckbox","text","defaultValue","func","inputRef","useRef","useState","setVal","htmlName","ref","onChange","inputVal","current","checked","type","defaultChecked","htmlFor","InputRange","step","button","hasExtremeMode","onInput","value","undefined","onClick","createCreatures","createFruits","changeTimewarp","timewarp","expandControlPanel","collapseControlPanel","ControlPanel","React","updateState","forceUpdate","useCallback","useEffect","body","changeDarkMode","showDebugOutput","changeDebugOutputMode","hasStarted","Graph","options","time","minY","maxY","xAxisMeasurements","timeUnit","calculateTimeUnit","calculateMinY","calculateMaxY","plotData","createAxes","createLabels","dataPoint","pos","point","bottom","previousPos","line","rect","triangle","shouldExtrapolate","relativeIndex","remainder","floorVal","ceilVal","ceil","average","getData","plotSimpleData","plotDetailedData","stepSize","drawPoint","drawLine","shouldDrawPoint","averageColour","stdevColour","desaturate","darken","outerColour","previousAveragePos","previousMinPos","previousMaxPos","previousStdevMinPos","previousStdevMaxPos","entry","draw","stdevMinPos","stdevMaxPos","rectWidth","rectPos","drawRect","topTrianglePos","drawTrangle","bottomTrianglePos","measurement","toString","createAxisMeasurement","xLabel","yLabel","dependentVariable","graphViewerIsVisible","graphSettingData","description","graphOptions","selectedGraphOptions","setupGraphs","createGraphOptions","settingsContainer","elems","setting","baseClickEvent","requirement","drawGraphs","isSelected","isChecked","ReactDOM","render","createSettings","setupSettings","optionsContainer","optionElems","option","hasInserted","j","graphContainer","graphSettings","dataPoints","geneSamples","sample","genePool","graph","boardIsVisible","contains","updateTransform","translate","zoom","translateBoard","dir","zoomBoard","interpolate","dot0","dot1","dot2","dot3","localX","localY","fade","t","getPerlinNoise","scale","grid","row","randomUnitVector","noise","sampleX","sampleY","samplePoint","x0","x1","y0","y1","cornerCoords","dotProducts","coords","corner","cornerPos","offsetVector","convertToPolar","u","v","boardGenerator","terrainInfo","presets","terrainTypes","temperature","tiles","grass","fruitColour","isLiquid","tundra","mountain","desert","magma","water","deepWater","lava","BoardGenerator","tileSize","canvas","setAttribute","newWidth","newHeight","terrain","terrainType","isArray","noiseType","clearCanvas","ctx","getContext","tileType","getTileType","beginPath","fillStyle","fill","drawGridLines","octaves","lacunarity","persistance","startingScale","totalNoise","weightMultiplier","getOctavePerlinNoise","drawTestNoise","grayscale","moveTo","lineTo","strokeStyle","stroke","clearRect","InputSelect","selectElemRef","event","Warning","InputText","limit","warningMessage","isNaN","currentTerrain","generatePreview","changeSize","generateNoise","TerrainGenerator","visible","setVisible","presetNames","preset","isVisible","newPresetName","currentPreset","Board","landTileIndexes","generateTiles","cellObj","cellRow","tileTypes","getTiles","boardWidth","boardHeight","cellRows","createCellRow","createCell","cellNumbers","getCellNumbers","insertEntity","removeEntity","previousCellNumbers","getEntityReferences","minX","maxX","nearbyEntities","distanceFromEntity","includes","tileIndex","xo","yo","console","warn","cellX","cellY","nearbyPosition","positionIsInBoard","creatures","tick","positionInCell","baseCellNumber","maxCellNumber","renderListeners","sampleGenes","allGenes","creature","geneVals","minVal","maxVal","creatureCount","fruitCount","fruitMultiplier","defaultGameSettings","fruitSpawnRate","initialCreatures","initialFruit","equilibrium","isPaused","previousTime","Date","now","previousTicks","runTick","querySelectorAll","forEach","census","entities","FRUIT_SPAWN_RATE","rand","dt","log","createRenderListener","removeRenderListener","hasRenderListener","confettis","Confetti","createInstance","getRandomPosition","getRandomVelocity","xVel","yVel","confetti","WIDTH_RANGE","HEIGHT_RANGE","rotation","confettiIndex","handleConfettis","openStartMenu","newGameSettings","JSON","parse","stringify","startClickEvent","StartMenu","openSourceCode","window","open","focus","Titlescreen","createConfettis","CreatureInspector","setCreature","newCreature","setInspectorRerenderFunction","geneInfo","fillWidth","fillOpacity","opacity","hoverBox","closestCreature","GraphViewer","PauseScreen","hideMask","showMask","StrictMode","onload","onmousemove","composedPath","boardBounds","getBoundingClientRect","mouseX","mouseY","mult","mousePos","distanceToClosestCreature","removePreviousHighlight","newHoverBox","parent","createHoverBox","updateMouse","clientX","clientY","onclick","onkeydown","key","activeElement"],"mappings":"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","file":"static/js/main.b189ed5b.chunk.js","sourcesContent":["var map = {\n\t\"./egg/egg-0.png\": 21,\n\t\"./egg/egg-1.png\": 22,\n\t\"./egg/egg-2.png\": 23,\n\t\"./egg/egg-3.png\": 24,\n\t\"./egg/egg-4.png\": 25,\n\t\"./heart/heart-0.png\": 26,\n\t\"./heart/heart-1.png\": 27,\n\t\"./heart/heart-2.png\": 28,\n\t\"./heart/heart-3.png\": 29,\n\t\"./smoke/smoke-0.png\": 30,\n\t\"./smoke/smoke-1.png\": 31,\n\t\"./smoke/smoke-2.png\": 32,\n\t\"./smoke/smoke-3.png\": 33,\n\t\"./smoke/smoke-4.png\": 34\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 20;","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAEBJREFUKFOFT1sKACAIm/c/9MJyphTlh+heoqEXYzXBOQAguXizCe9WyXSGSAnpvgkOsoo84Stww/OEEvVi+3AAKPcaB3YCGM0AAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE1JREFUKFNtj0sSACAIQvHa7j03jRX2bdGU4EMN5+H8msr1AEBy6Ga9vK5drM5pEoHujoioQFHSUOhrnh71NaSQ88iQjQ9ljxBZKx4bNv3HHQfqLQCjAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAE5JREFUKFNdj9EWACAEQ+e7PftuHTJRD53Y3Eawj1cpbPcDgLtfXSTb75piT5aJhBwlYVLC0GhVhZl1qvhqGSY+aDQU/QYkhUHXFt/KqR3dtSMH1GudvAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFBJREFUKFNdT0kSACAIwnd71m/baGFZhyYhFgXzxBmFcD8ARMTmRQq+10u28nyiQ0npoKpw9232W38xlVPZqTKz7pBYdumIV0mSEezFFceGC34GKQfwUlcMAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAFFJREFUKFNtT0EOACAI0m/rWb9ti6Jyq4MrIBCVfmo/lfC5iEhVLV4V8B0k3V0ioonogK90mMLMXGYfawh3DHKQPYF3B2In4iXNrEWwESu2hgOIACwH4GvOyAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADxJREFUKFOFTlsKACAI2+5/6GLWYJGg+CF7SgxD8asWIMC8CzPQBckwC7IiU+S+tQfOKpOPwKIkP0H36AZOTA4J8eyzugAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADhJREFUKFNjZCAAGIlWcJiB4b8tAwMjjIZpBJsAEkQ3CaQYJAa3AlkRTBJFAcwkZEkMBdgcTNAXALJPCgmBiBW0AAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACpJREFUKFNjZCAAGKmroJeB4X8xAwOKqXAOSBJmHbIiFNV4TcDlWIK+AADFugYJ3JGn6wAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGOmsIISB4f8aBgYUa+ngBgDt+AIJegq8GAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADRJREFUKFNjZCAAGNHl/////5+RkREuDmagCyJrQjEBm0K4AmRJZDaGG2DGwxQRbwUu3wIAPA4cCXVv7EcAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACxJREFUKFNjZCAAGIlW8P////+MjIwYGjAEYAphNIoCbKYQ7waYY9FNIWgCAPvjFAmHkFgYAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACZJREFUKFNjZCAAGKmr4P////9BJjIyMsJNJs8KkEkwU8gzAdlnAJGpCAmOYY4DAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACRJREFUKFNjZCAAGKmv4P////8ZGRnhJqNYgS4Jsp4GbkD3FQAlyAgJTFh8HgAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAABtJREFUKFNjZCAAGAdAwf////8zMjLCraaDGwDLqwQJfZ00UQAAAABJRU5ErkJggg==\"","/**\n * Represents a generic object with an x and y value.\n * @constructor\n * @param {number} x - The x component of the object.\n * @param {number} y - The y component of the object.\n */\nexport class Vector {\n   x: number;\n   y: number;\n\n   constructor(x: number, y: number) {\n      this.x = x;\n      this.y = y;\n   };\n\n   static randomUnitVector(): Vector {\n      const theta = Math.random() * 2 * Math.PI;\n      return new Vector(Math.cos(theta), Math.sin(theta));\n   }\n\n   add(vec2: Vector): Vector {\n      return new Vector(\n         this.x + vec2.x,\n         this.y + vec2.y\n      );\n   };\n\n   dot(vec2: Vector): number {\n      return this.x * vec2.x + this.y * vec2.y;\n   }\n\n   lerp(targetVec: Vector, amount: number): Vector {\n      return new Vector(\n         lerp(this.x, targetVec.x, amount),\n         lerp(this.y, targetVec.y, amount)\n      );\n   };\n\n   distanceFrom(vec2: Vector): number {\n      const distance = Math.sqrt(Math.pow(this.x - vec2.x, 2) + Math.pow(this.y - vec2.y, 2));\n      return distance;\n   };\n\n   angleBetween(vec2: Vector): number {\n      const angle = Math.atan2(vec2.y - this.y, vec2.x - this.x);\n      return angle;\n   }\n\n   convertToPolar(vec2?: Vector): PolarVector {\n      const targetVector = vec2 || new Vector(0, 0);\n\n      const distance = this.distanceFrom(targetVector);\n      const angle = this.angleBetween(targetVector);\n      return new PolarVector(distance, angle);\n   }\n\n   randomOffset(radius: number): Vector {\n      const dist = randFloat(0, radius);\n      const ang = randFloat(0, 360);\n      const offset = new PolarVector(dist, ang);\n      return this.add(offset.convertToCartesian());\n   }\n\n   copy(): Vector {\n      return new Vector(this.x, this.y);\n   }\n}\n\nexport class PolarVector {\n   magnitude: number;\n   direction: number;\n\n   constructor(magnitude: number, direction: number) {\n      this.magnitude = magnitude;\n      this.direction = direction;\n   }\n\n   convertToCartesian(): Vector {\n      const x = Math.cos(this.direction) * this.magnitude;\n      const y = Math.sin(this.direction) * this.magnitude;\n      return new Vector(x, y);\n   }\n\n   static randomUnitVector(): PolarVector {\n      const theta = randFloat(0, 360);\n      // const theta = Math.random() * 2 * Math.PI;\n      return new PolarVector(1, theta);\n      // return new Vector(Math.cos(theta), Math.sin(theta));\n   }\n}\n\nexport function getElem(id: string): HTMLElement {\n   const elem = document.getElementById(id);\n   if (!elem) throw new Error(`ungaming: tried to find element with an id of '${id}' but could not find any.'`);\n   return elem;\n}\n\nexport function getSuffix(num: number): string {\n   return num === 1 ? \"\" : \"s\";\n}\n\n/**\n * Returns a random integer between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randInt(min: number, max: number): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.floor(Math.random() * (max - min)) + min;\n}\n\n/**\n * Returns a random float between the specified minimum and maximum values.\n * @param min The lowest possible number.\n * @param max The highest possible number.\n */\nexport function randFloat(min: number, max: number): number {\n   if (min >= max) throw new Error(`Min of '${min}' is greater than max of '${max}'`);\n   return Math.random() * (max - min) + min;\n}\n\nexport function randItem(arr: Array<unknown>): unknown {\n   const randIndex = randInt(0, arr.length);\n   return arr[randIndex];\n}\n\nexport function lerp(start: number, target: number, amount: number): number {\n   return (1 - amount) * start + amount * target;\n}\n\nexport function randomGaussianBell(): number {\n   // Box Muller method from https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n   let u = 0, v = 0;\n   while(u === 0) u = Math.random(); //Converting [0,1) to (0,1)\n   while(v === 0) v = Math.random();\n   let num = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );\n   num = num / 10.0 + 0.5; // Translate to 0 -> 1\n   if (num > 1 || num < 0) return randomGaussianBell() // resample between 0 and 1\n   return num;\n }\n\nexport function createHoverBox(text: string, position: Vector, parent: HTMLElement): HTMLElement {\n   const hoverBox = document.createElement(\"div\");\n   hoverBox.className = \"hover-box\";\n   hoverBox.style.left = position.x + \"px\";\n   hoverBox.style.top = position.y + \"px\";\n   hoverBox.innerHTML = text;\n   parent.appendChild(hoverBox);\n\n   return hoverBox;\n}\n\nexport function roundNum(num: number, dpp: number): number {\n   const power = Math.pow(10, dpp)\n   return Math.round((num + Number.EPSILON) * power) / power;\n}\n\nexport function drawRay(start: Vector, end: Vector) {\n   const dist = start.distanceFrom(end);\n   const ang = start.angleBetween(end);\n\n   const ray = document.createElement(\"div\");\n   getElem(\"board\").appendChild(ray);\n   ray.className = \"ray\";\n   ray.style.transform = `rotate(${ang}rad)`;\n   ray.style.width = dist + \"px\";\n   ray.style.left = start.x + \"px\";\n   ray.style.top = start.y + \"px\";\n}\n\nexport function standardDeviation(data: ReadonlyArray<number>): number {\n   const n = data.length;\n   const mean = data.reduce((a, b) => a + b) / n;\n   const sqrDeviations = data.map(val => Math.pow(val - mean, 2));\n   const variance = sqrDeviations.reduce((a, b) => a + b) / n;\n   return Math.sqrt(variance);\n}\n\nexport class Colour {\n   private _hex!: string;\n   public get hex(): string {\n      return \"#\" + this._hex;\n   }\n\n   private _rgb: [number, number, number];\n   public get rgb(): string {\n      const [ r, g, b ] = this._rgb;\n      return `rgb(${r}, ${g}, ${b})`;\n   }\n\n   constructor(colour: string | [number, number, number] ) {\n      if (typeof colour === \"string\") {\n         this._hex = colour.toLowerCase();\n         if (this._hex.length === 7) {\n            this._hex = this._hex.substring(1, 7);\n         }\n   \n         this._rgb = this.getRGB();\n      } else {\n         this._rgb = colour;\n\n         this._hex = Colour.getHex(this._rgb);\n      }\n   }\n\n   private getRGB(): [number, number, number] {\n      const hexDigits = \"0123456789abcdef\".split(\"\");\n\n      const rgb: [number, number, number] = [0, 0, 0];\n      for (let i = 0; i < 3; i++) {\n         const digit1 = hexDigits.indexOf(this._hex[i * 2]);\n         const digit2 = hexDigits.indexOf(this._hex[i * 2 + 1]);\n         rgb[i] = digit1 * 16 + digit2;\n      }\n      return rgb;\n   }\n   private static getHex(rgb: [number, number, number]): string {\n      const hexDigits = \"0123456789abcdef\".split(\"\");\n\n      let hex = \"\";\n      for (let i = 0; i < 3; i++) {\n         const col = rgb[i];\n         const digit2 = col % 16;\n         const digit1 = (col-digit2) / 16;\n         hex += hexDigits[digit1] + hexDigits[digit2];\n      }\n      return hex;\n   }\n\n   darken(amount: number): Colour {\n      // 1 = fully darkened, 0.5 = half darkened\n      // Rounds down\n      const rgb = this._rgb.map(colour => Math.round(colour * (1 - amount))) as [number, number, number];\n      return new Colour(rgb);\n   }\n\n   // https://stackoverflow.com/questions/13348129/using-native-javascript-to-desaturate-a-colour/13355255\n   desaturate(amount: number): Colour {\n      const col = this._rgb.slice();\n      const gray = col[0] * 0.3086 + col[1] * 0.6094 + col[2] * 0.0820;\n\n      col[0] = Math.round(lerp(col[0], gray, amount));\n      col[1] = Math.round(lerp(col[1], gray, amount));\n      col[2] = Math.round(lerp(col[2], gray, amount));\n\n      return new Colour([col[0], col[1], col[2]]);\n   }\n\n   static grayscale(val: number): string {\n      const b16 = Math.floor(val * 255);\n\n      const hex = Colour.getHex([b16, b16, b16]);\n      return hex;\n   }\n}\n\nexport async function sleep(ms: number): Promise<void> {\n   return new Promise(resolve => {\n      setTimeout(resolve, ms);\n   });\n}\n\n","import Game from \"../Game\";\nimport { getElem, Vector } from \"../utils\";\n\nexport interface EntityAttributes {\n   [key: string]: number | string | Vector | undefined;\n   lifespan: number;\n   readonly size: number;\n}\n\nabstract class Entity {\n   [key: string]: any;\n\n   position: Vector;\n   velocity: Vector;\n\n   age: number;\n   lifespan!: number;\n\n   element: HTMLElement;\n\n   constructor(position: Vector, attributes: EntityAttributes) {\n      this.position = position;\n      // By default all entities has no velocity.\n      this.velocity = new Vector(0, 0);\n      \n      this.age = 0;\n\n      // Set all attributes\n      for (const attribute of Object.entries(attributes)) {\n         this[attribute[0]] = attribute[1];\n      }\n\n      this.element = this.instantiate();\n      this.createEntity();\n\n      this.updatePosition();\n\n      // Add the entity to the cells array\n      Game.board.createEntity(this);\n      // this.cellNumber = this.calculateCell();\n   };\n\n   // Used in derived classes to create the actual visual thing\n   abstract instantiate(): HTMLElement;\n\n   static count(entityType: any): number {\n      let count = 0;\n      for (const cell of Game.board.cells) {\n         for (const entity of cell) {\n            if (entityType.prototype.isPrototypeOf(entity)) count++;\n         }\n      }\n      return count;\n   }\n\n   createEntity(): HTMLElement {\n      getElem(\"board\").appendChild(this.element);\n\n      let width: number, height: number;\n\n      if (typeof this.size === \"number\") {\n         // Number\n         width = this.size;\n         height = this.size;\n      } else {\n         // Vector\n         width = this.size.x;\n         height = this.size.y;\n      }\n\n      this.element.style.width = width + \"px\";\n      this.element.style.height = height + \"px\";\n\n      return this.element;\n   };\n\n   tick(): void {\n      if (this.age++ >= this.lifespan) {\n         this.die();\n         return;\n      }\n\n      // Move\n      this.position = this.position.add(this.velocity);\n\n      Game.board.updateEntity(this);\n      this.updatePosition();\n   };\n   updatePosition(): void {\n      this.element.style.left = `${this.position.x}px`;\n      this.element.style.top = `${this.position.y}px`;\n   };\n   die(): void {\n      this.element.remove();\n\n      Game.board.deleteEntity(this);\n   };\n\n   isCollidingWithEntity(entity: Entity): boolean {\n      const distance = this.position.distanceFrom(entity.position);\n\n      if (typeof this.size === \"number\") {\n         return distance - this.size/2 <= 0;\n      } else {\n         // TODO: Inaccurate for entites with a different width and height, problem for future self\n         if (typeof entity.size === \"number\") {\n            return distance - this.size.x/2 - entity.size/2 <= 0;\n         } else {\n            return distance - this.size.x/2 - entity.size.x/2 <= 0;\n         }\n      }\n   }\n}\n\nexport default Entity;","import Game from \"../Game\";\nimport { Vector } from \"../utils\";\nimport Entity, { EntityAttributes } from \"./Entity\";\n\nexport function createFruit(cellNumber?: number): void {\n   const attributes: EntityAttributes = {\n      lifespan: 10 * Game.tps,\n      size: 8\n   };\n\n   let position: Vector;\n   if (cellNumber) {\n      position = Game.board.randomPositionInCell(cellNumber);\n   } else {\n      position = Game.board.randomPosition();\n   }\n\n   const colour = Game.board.getFruitColour(position);\n\n   new Fruit(position, attributes, colour);\n}\n\nclass Fruit extends Entity {\n   constructor(position: Vector, attributes: EntityAttributes, colour: string) {\n      super(position, attributes);\n\n      this.element.style.backgroundColor = colour;\n   }\n\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"fruit\";\n\n      // const FRUIT_COLOURS: ReadonlyArray<string> = [\"red\", \"green\", \"pink\"];\n\n      // const colour = randItem(FRUIT_COLOURS as unknown[]) as string;\n      // element.style.backgroundColor = colour;\n\n      return element;\n   }\n}\n\nexport default Fruit;","import Creature from './classes/Creature';\r\n\r\nexport let inspectorIsOpen: boolean = false;\r\nexport let inspectorCreature: Creature | null = null;\r\n\r\nexport let updateInspector: Function;\r\nexport function setUpdateFunction(func: (creature: Creature | null) => void): void {\r\n    updateInspector = func;\r\n}\r\n\r\nexport let rerenderInspector: Function;\r\nexport function setInspectorRerenderFunction(func: () => void): void {\r\n    rerenderInspector = func;\r\n}\r\n\r\nexport function openInspector(creature: Creature): void {\r\n    inspectorIsOpen = true;\r\n    inspectorCreature = creature;\r\n    updateInspector(creature);\r\n}\r\n\r\nexport function closeInspector(): void {\r\n    inspectorIsOpen = false;\r\n    inspectorCreature = null;\r\n    updateInspector(null);\r\n}","import { getElem, Vector} from './utils';\r\n\r\nexport const gameImages: Array<GameImage> = new Array<GameImage>();\r\n\r\nclass GameImage {\r\n    name: string;\r\n    position: Vector;\r\n\r\n    element!: HTMLElement;\r\n    width: number;\r\n    height: number;\r\n\r\n    numFrames: number;\r\n    frame: number = 0;\r\n    ticksPerFrame: number;\r\n\r\n    constructor(name: string, numFrames: number, ticksPerFrame: number, width: number, height: number, position: Vector) {\r\n        this.name = name;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.numFrames = numFrames;\r\n        this.ticksPerFrame = ticksPerFrame;\r\n        this.position = position;\r\n\r\n        this.init();\r\n        this.updateBackgroundImage();\r\n\r\n        gameImages.push(this);\r\n    }\r\n    init(): void {\r\n        this.element = document.createElement(\"div\");\r\n        this.element.className = \"game-image\";\r\n        this.element.style.width = this.width + \"px\";\r\n        this.element.style.height = this.height + \"px\";\r\n        getElem(\"board\").appendChild(this.element);\r\n\r\n        this.element.style.backgroundSize = `${this.width}px ${this.height}px`;\r\n        this.element.style.top = this.position.y + \"px\";\r\n        this.element.style.left = this.position.x + \"px\";\r\n    }\r\n\r\n    updateBackgroundImage() {\r\n        const frame = Math.floor(this.frame);\r\n        const src = require(`./images/${this.name}/${this.name}-${frame}.png`).default;\r\n        this.element.style.backgroundImage = `url(${src})`;\r\n    }\r\n\r\n    tick(): void {\r\n        this.frame += 1 / this.ticksPerFrame;\r\n        if (this.frame >= this.numFrames) {\r\n            this.die();\r\n            return;\r\n        }\r\n        this.updateBackgroundImage();\r\n    }\r\n\r\n    die(): void {\r\n        this.element.remove();\r\n\r\n        gameImages.splice(gameImages.indexOf(this), 1);\r\n    }\r\n}\r\n\r\nexport default GameImage;","import Game from \"../Game\";\r\nimport GameImage from \"../GameImage\";\r\nimport { Vector } from \"../utils\";\r\nimport Creature, { CreatureAttributes } from \"./Creature\";\r\nimport Entity, { EntityAttributes } from \"./Entity\";\r\n\r\nclass Egg extends Entity {\r\n   generation: number;\r\n\r\n   constructor(position: Vector, attributes: EntityAttributes, creatureAttributes: CreatureAttributes, generation: number) {\r\n      super(position, attributes);\r\n\r\n      this.generation = generation;\r\n      this.creatureAttributes = creatureAttributes;\r\n   }\r\n\r\n   instantiate(): HTMLElement {\r\n      const ticksPerFrame = Math.floor(this.lifespan / 5);\r\n      const element = new GameImage(\"egg\", 5, ticksPerFrame, this.size, this.size, this.position).element;\r\n\r\n      return element;\r\n   }\r\n\r\n   tick(): void {\r\n      super.tick();\r\n\r\n      const shakeAmount = Math.sin(Game.ticks * Game.tps) * 1.25;\r\n      this.element.style.transform = `translate(-50%, -50%) rotate(${shakeAmount}deg)`;\r\n   }\r\n\r\n   die(): void {\r\n      super.die();\r\n\r\n      const creature = new Creature(this.position.copy(), this.creatureAttributes);\r\n      creature.stats.generation = this.generation;   \r\n   }\r\n}\r\n\r\nexport default Egg;","import Game from \"../Game\";\nimport { drawRay, PolarVector, randFloat, randInt, randItem, Vector } from \"../utils\";\nimport Entity, { EntityAttributes } from \"./Entity\";\nimport Fruit from \"./Fruit\";\nimport Egg from './Egg';\nimport GameImage from \"../GameImage\";\nimport { closeInspector, inspectorCreature } from \"../creature-inspector\";\n\nexport interface CreatureAttributes extends EntityAttributes {\n   name: string;\n   speed: number;\n   vision: number;\n   reproductiveRate: number;\n}\n\ninterface GeneInfo {\n   display: string;\n   colour: string;\n   min: number;\n   max: number;\n   /*** How strongly an attribute is factored into deciding a creature's lifespan  */\n   weight: number;\n   positivelyAffectsLifespan?: boolean;\n}\n\nexport const creatureGeneInfo: { [key: string]: GeneInfo } = {\n   speed: {\n      display: \"speed\",\n      colour: \"#eeff00\",\n      min: 3,\n      max: 10,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // Size of the creature in px\n   size: {\n      display: \"size\",\n      colour: \"#ff8f00\",\n      min: 10,\n      max: 30,\n      weight: 1,\n      positivelyAffectsLifespan: true\n   },\n   // Vision of the creature in px\n   vision: {\n      display: \"vision\",\n      colour: \"#5400ff\",\n      min: 25,\n      max: 75,\n      weight: 1,\n      positivelyAffectsLifespan: false\n   },\n   // How quickly the creature gains reproductive urge\n   reproductiveRate: {\n      display: \"reproductive rate\",\n      colour: \"#ff00e0\",\n      min: 0.5,\n      max: 2,\n      weight: 1\n   }\n};\n\nconst calculateLifespan = (attributes: CreatureAttributes): number => {\n   // Base number of seconds that a creature will live.\n   const BASE_LIFESPAN: number = 10;\n\n   let lifespan: number = BASE_LIFESPAN * Game.tps;\n\n   for (const attributeInfo of Object.entries(creatureGeneInfo)) {\n      if (!attributeInfo[1].positivelyAffectsLifespan) continue;\n\n      const attributeVal = attributes[attributeInfo[0]] as number;\n\n      if (attributeInfo[1].positivelyAffectsLifespan) {\n         lifespan *= Math.pow(attributeVal / ((attributeInfo[1].min + attributeInfo[1].max) / 2), attributeInfo[1].weight);\n      } else {\n         lifespan *= Math.pow(((attributeInfo[1].min + attributeInfo[1].max) / 2) / attributeVal, attributeInfo[1].weight);\n      }\n   }\n\n   return lifespan;\n}\n\n// Generate a random gene in a specified range.\nconst generateGene = (attributeName: keyof CreatureAttributes): number => {\n   const attribute: GeneInfo = creatureGeneInfo[attributeName];\n   return randFloat(attribute.min, attribute.max);\n}\n\nconst getRandomName = (): string => {\n   const firstNames = [\"Glorb\", \"James\", \"Obama\", \"Gnark\"];\n   const adjectives = [\"Feeble\", \"Crippled\", \"Schizophrenic\"];\n   const nouns = [\"Amoeba\"];\n\n   let chosenAdjectives = [];\n   let potentialAdjectives = adjectives.slice();\n   while (true) {\n      if (potentialAdjectives.length === 0) break;\n      if (Math.random() <= 0.4) {\n         const idx = randInt(0, potentialAdjectives.length);\n         chosenAdjectives.push(potentialAdjectives[idx]);\n         potentialAdjectives.splice(idx, 1);\n      }\n      else break;\n   }\n   const adjectiveList = chosenAdjectives.reduce((previousValue, currentValue, i) => {\n      let newVal = previousValue;\n      if (i > 0 && chosenAdjectives.length - i > 1) newVal += \", \";\n      else if (chosenAdjectives.length > 1 && chosenAdjectives.length - i === 1) newVal += \" and \";\n      return newVal + currentValue;\n   }, \"\");\n\n   const hasNoun = Math.random() <= 0.3;\n\n   let name = randItem(firstNames);\n   if (hasNoun && chosenAdjectives.length > 0) {\n      name += \" the \" + adjectiveList + \" \" + randItem(nouns);\n   } else if (chosenAdjectives.length > 0) {\n      name += \" the \" + adjectiveList;\n   } else if (hasNoun) {\n      name += \" the \" + randItem(nouns);\n   }\n\n   return name as string;\n}\n\nexport function createCreature(): void {\n   const attributes: CreatureAttributes = {\n      name: getRandomName(),\n      size: generateGene(\"size\"),\n      speed: generateGene(\"speed\"),\n      vision: generateGene(\"vision\"),\n      reproductiveRate: generateGene(\"reproductiveRate\"),\n      lifespan: 0\n   };\n   attributes.lifespan = calculateLifespan(attributes);\n\n   // Get a random position for the creature\n   const x = randFloat(0, Game.boardSize.width * Game.cellSize);\n   const y = randFloat(0, Game.boardSize.height * Game.cellSize);\n   const position = new Vector(x, y);\n\n   new Creature(position, attributes);\n}\n\nconst REPRODUCTION_TIME = 2000;\nconst ABSTINENCE_TIME = 4000;\n\ninterface CreatureStats {\n   fruitEaten: number;\n   generation: number;\n}\n\nclass Creature extends Entity {\n   speed: number;\n   moveSpeed: number;\n   vision: number;\n   reproductiveRate: number;\n\n   birthTime: number;\n\n   isMoving: boolean;\n   targetPosition: Vector | null = null;\n   reproductiveUrge: number = 0;\n   partner: Creature | null = null;\n   reproductionStage: number = 0;\n   lastReproductionTime: number = -REPRODUCTION_TIME - Game.settings.eggIncubationTime - ABSTINENCE_TIME;\n\n   stats: CreatureStats = {\n      fruitEaten: 0,\n      generation: 1\n   }\n\n   constructor(position: Vector, attributes: CreatureAttributes) {\n      super(position, attributes);\n\n      this.speed = attributes.speed;\n      this.vision = attributes.vision;\n      this.reproductiveRate = attributes.reproductiveRate;\n\n      this.isMoving = false;\n      this.birthTime = Game.ticks;\n\n      this.moveSpeed = this.calculateMoveSpeed();\n   }\n\n   calculateMoveSpeed(): number {\n      const SPEED_REDUCTION_MULTIPLIER = 1.1;\n      const MAX_REDUCTION = 3;\n      const reduction = creatureGeneInfo.size.max / creatureGeneInfo.size.min / MAX_REDUCTION;\n      return this.speed /  Math.pow(this.size / creatureGeneInfo.size.min / reduction, SPEED_REDUCTION_MULTIPLIER);\n   }\n\n   instantiate(): HTMLElement {\n      const element = document.createElement(\"div\");\n      element.className = \"creature\";\n\n      element.innerHTML = `\n      <div class=\"shadow\"></div>\n\n      <div class=\"life\">\n         <div class=\"life-bar\"></div>\n\n         </div>\n      <div class=\"reproduction\">\n         <div class=\"reproduction-bar\"></div>\n      </div>\n      `;\n      \n      element.style.setProperty(\"--vision-size\", `${this.vision}px`);\n      element.style.setProperty(\"--creature-size\", `${this.size}px`);\n\n      return element;\n   };\n\n   get life(): number {\n      return (this.lifespan - this.age) / this.lifespan * 100;\n   }\n\n   updateLifebar(): void {\n      const lifebar = this.element.querySelector(\".life-bar\") as HTMLElement;\n      \n      lifebar.style.width = `${this.life}%`;\n      // Colour the lifebar a shade of red corresponding to how much life the creature has left\n      const color = 155 + this.life;\n      lifebar.style.backgroundColor = `rgb(${color}, 0, 0)`;\n   };\n\n   updateReproductionBar(): void {\n      const reproductionBar = this.element.querySelector(\".reproduction-bar\") as HTMLElement;\n      \n      reproductionBar.style.width = `${this.reproductiveUrge}%`;\n   };\n\n   get wantsToReproduce(): boolean {\n      return this.reproductiveUrge > this.life && this.reproductionStage < 2;\n   }\n\n   tick(): void {\n      super.tick();\n\n      // Base amount of reproductive urge gained per second\n      if (this.reproductionStage === 0 && (Game.ticks - this.lastReproductionTime) * 1000 / Game.tps > REPRODUCTION_TIME + Game.settings.eggIncubationTime + ABSTINENCE_TIME) {\n         this.element.classList.remove(\"abstaining\");\n         const BASE_REPRODUCTIVE_RATE = 2;\n         this.reproductiveUrge += BASE_REPRODUCTIVE_RATE * this.reproductiveRate / Game.tps;\n         this.reproductiveUrge = Math.min(100, this.reproductiveUrge);\n      } else if (this.reproductionStage >= 2) {\n         // Stop aging if the creature is reproducing\n         this.age -= 1;\n      }\n\n      this.updateLifebar();\n      this.updateReproductionBar();\n\n      // If the creature has a target position, move to it\n      if (this.targetPosition !== null) {\n         if (this.hasReachedTargetPosition()) {\n            // If it has reached its target, stop moving\n            this.reachTargetPosition();\n         } else {\n            // Otherwise continue moving\n            this.moveToTargetPosition();\n         }\n      }\n\n      switch (this.reproductionStage) {\n         case 1: {\n            /*** Average amount of particles which spawn each second */\n            const particleAmount = 3;\n            if (Math.random() <= particleAmount / Game.tps) {\n               const imagePos = this.position.randomOffset(30);\n               new GameImage(\"heart\", 4, 2, 16, 16, imagePos);\n            }\n            break;\n         }\n         case 2: {\n            if (Math.random() <= 3 / Game.tps) {\n               const particleAttempts = randInt(4, 11);\n               const chance = 0.7;\n               for (let i = 0; i < particleAttempts; i++) {\n                  if (Math.random() <= chance) {\n                     const imagePos = this.position.randomOffset(40);\n                     const size = randInt(12, 24);\n                     new GameImage(\"heart\", 4, 3, size, size, imagePos);\n                  }\n               }\n            }\n            if (Math.random() < 6 / Game.tps) {\n               const imagePos = this.position.randomOffset(20);\n               const size = randInt(12, 18);\n               new GameImage(\"heart\", 4, 3, size, size, imagePos);\n            }\n            break;\n         }\n      }\n\n      const entitiesInVision = Game.board.getNearby(this.position, this.vision);\n      const selfIdx = entitiesInVision.indexOf(this);\n      if (selfIdx !== -1) entitiesInVision.splice(selfIdx, 1);\n\n      // Search through all nearby entities for any that are of use\n      let closestFruit: Fruit | null = null;\n      let distanceToNearestFruit = Number.MAX_SAFE_INTEGER;\n      let closestPartner: Creature | null = null;\n      let distanceToClosestPartner = Number.MAX_SAFE_INTEGER;\n      for (const entity of entitiesInVision) {\n         const entityIsCreature: boolean = entity instanceof Creature;\n         const entityIsFruit: boolean = entity instanceof Fruit;\n\n         if (entityIsCreature && this.wantsToReproduce && entity.wantsToReproduce && (entity.partner === null || entity.partner === this)) {\n            // If it wants to, look for any available partners\n            const distanceToCreature = this.position.distanceFrom(entity.position);\n            if (distanceToCreature < distanceToClosestPartner) {\n               closestPartner = entity as Creature;\n               distanceToClosestPartner = distanceToCreature;\n            }\n         }\n         else if (entityIsFruit) {\n            const distanceToFruit = this.position.distanceFrom(entity.position);\n            if (distanceToFruit < distanceToNearestFruit) {\n               closestFruit = entity;\n               distanceToNearestFruit = distanceToFruit;\n            }\n         }\n\n         if (super.isCollidingWithEntity(entity)) {\n            if (entity === this.partner && this.wantsToReproduce) {\n               this.handleReproduction();\n            } else if (entityIsFruit) {\n               this.eatFruit(entity);\n            }\n         }\n      }\n\n      // If there are any available partners, move to them\n      if (closestPartner !== null && this.reproductionStage < 2) {\n         this.targetPosition = closestPartner.position;\n         this.partner = closestPartner;\n         this.reproductionStage = 1;\n         return;\n      } else if (this.reproductionStage === 1) {\n         this.reproductionStage = 0;\n      } else if (this.reproductionStage >= 2) return;\n\n      // Otherwise if there is a nearby fruit, go to it\n      if (closestFruit !== null) {\n         this.targetPosition = closestFruit.position;\n         return;\n      }\n\n      // Otherwise, try to move to a random surrounding position\n      if (!this.isMoving) {\n         // Chance for the creature to move each second\n         const MOVE_CHANCE = 0.95;\n         if (Math.random() < MOVE_CHANCE / Game.tps) {\n            const randomPosition = Game.board.randomNearbyPosition(this.position, this.vision);\n            this.targetPosition = randomPosition;\n         }\n      }\n   };\n\n   eatFruit(fruit: Fruit): void {\n      this.stats.fruitEaten++;\n\n      // Number of seconds of life it gives\n      const FEED_AMOUNT = 10;\n      this.age -= FEED_AMOUNT * Game.tps;\n      // Stop the creature's age from going below 0\n      this.age = Math.max(this.age, 0);\n\n      fruit.die();\n   };\n\n   getEntitiesInVision(entitiesToCheck: ReadonlyArray<Entity>): ReadonlyArray<Entity> {\n      return entitiesToCheck.filter(entity => this.canSeeEntity(entity));\n   };\n\n   canSeeEntity(entity: Entity): boolean {\n      return this.position.distanceFrom(entity.position) <= this.vision + (this.size as number)/2;\n   };\n\n   moveToTargetPosition(): void {\n      this.isMoving = true;\n\n      if (this === inspectorCreature) {\n         drawRay(this.position, this.targetPosition as Vector);\n      }\n\n      // Convert from cartesian to polar coordinates\n      const angleToTarget = this.position.angleBetween(this.targetPosition!);\n      const nextPosition = new PolarVector(this.moveSpeed, angleToTarget);\n\n      this.velocity = nextPosition.convertToCartesian();\n   };\n\n   hasReachedTargetPosition(): boolean {\n      // Use black magic to figure out if the creature is facing towards the target position\n\n      const relativeTargetVec = new Vector(this.position.x - this.targetPosition!.x, this.position.y - this.targetPosition!.y);\n\n      const dotProduct = this.velocity.dot(relativeTargetVec);\n      return dotProduct > 0;\n   };\n\n   reachTargetPosition(): void {\n      this.isMoving = false;\n\n      this.velocity = new Vector(0, 0);\n\n      this.targetPosition = null;\n   };\n\n   handleReproduction(): void {\n      this.reproduce()\n      .then(() => this.layEgg());\n   };\n\n   reproduce(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 2;\n         this.targetPosition = null;\n         this.velocity = new Vector(0, 0);\n         this.isMoving = false;\n         this.reproductiveUrge = 0;\n         this.element.classList.add(\"abstaining\");\n         this.lastReproductionTime = Game.ticks;\n         \n         setTimeout(() => {\n            resolve();\n         }, REPRODUCTION_TIME);\n      });\n   }\n\n   layEgg(): Promise<void> {\n      return new Promise(resolve => {\n         this.reproductionStage = 0;\n         // Ensure that only 1 egg is created\n         if ((this.partner as Creature).reproductionStage !== 0) {\n\n            const childAttributes = this.generateChildGenes(this.partner as Creature);\n   \n            const eggAttributes = {\n               size: 20,\n               lifespan: Game.settings.eggIncubationTime / 1000 * Game.tps\n            };\n            const eggPos = this.position.randomOffset(10);\n            new Egg(eggPos, eggAttributes, childAttributes, this.stats.generation + 1);\n         }\n\n         this.partner = null;\n\n         setTimeout(() => {\n            resolve();\n         }, Game.settings.eggIncubationTime);\n      });\n   }\n\n   generateChildGenes(partner: Creature): CreatureAttributes {\n      let attributes: { [key: string]: number | string } = {\n         name: getRandomName()\n      };\n\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         // Pick a random allele\n         let gene = Math.random() <= 0.5 ? this[geneName] : partner[geneName];\n         attributes[geneName] = gene;\n\n         // Chance to mutate the gene\n         if (Math.random() <= 0.3) {\n            gene = this.mutateGene(geneName, gene);\n         }\n      }\n\n      attributes.lifespan = calculateLifespan(attributes as CreatureAttributes);\n\n      return attributes as CreatureAttributes;\n   }\n\n   mutateGene(name: string, initialGeneVal: number): number {\n      const gene = creatureGeneInfo[name];\n\n      // const minMutateAmount = (gene.min + gene.max) / 150;\n\n      // min mutate amount * math.random() (maybe go higher )\n      let mutateAmount = (gene.min + gene.max) / 300;\n\n      mutateAmount *= randFloat(0.1, 1) * Game.settings.creatureMutationRate;\n      \n      // let mutateAmount = minMutateAmount;\n      // if (dir === 1) {\n      //    const lerpAmount = randFloat(0.01, 0.05);\n      //    mutateAmount += lerp(initialGeneVal, gene.max, lerpAmount) - initialGeneVal;\n      // } else {\n      //    mutateAmount *= -1;\n      //    const lerpAmount = randFloat(0.01, 0.05);\n      //    mutateAmount -= initialGeneVal - lerp(initialGeneVal, gene.min, lerpAmount);\n      // }\n\n      const dir = Math.sign(Math.random() - 0.5);\n      mutateAmount *= dir;\n\n      mutateAmount *= Game.settings.creatureMutationRate;\n\n      return initialGeneVal + mutateAmount;\n   }\n\n   die(): void {\n      if (this === inspectorCreature) {\n         closeInspector();\n      }\n\n      super.die();\n   }\n}\n\nexport default Creature;","import React, { useEffect } from 'react';\nimport Creature, { createCreature } from '../classes/Creature';\nimport Entity from '../classes/Entity';\nimport Fruit, { createFruit } from '../classes/Fruit';\nimport \"../css/control-panel.css\";\nimport Game from '../Game';\nimport { getElem, roundNum } from '../utils';\nimport InputCheckbox from './InputCheckbox';\nimport InputRange from './InputRange';\n\nexport let updateControlPanel: Function;\n\nconst createCreatures = (amount: number): void => {\n   for (let i = 0; i < amount; i++) createCreature();\n}\nconst createFruits = (amount: number): void => {\n   for (let i = 0; i < amount; i++) {\n      createFruit();\n   }\n}\n\nconst changeDarkMode = (newVal: boolean): void => {\n   if (newVal) {\n      document.body.classList.add(\"dark-mode\");\n   } else {\n      document.body.classList.remove(\"dark-mode\");\n   }\n}\n\nconst changeTimewarp = (newVal: number) => {\n   Game.timewarp = newVal;\n}\n\nconst changeDebugOutputMode = (newVal: boolean) => {\n   Game.settings.showDebugOutput = newVal;\n}\n\nconst expandControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.remove(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.add(\"hidden\");\n}\nconst collapseControlPanel = (): void => {\n   const controlPanel = getElem(\"control-panel\") as HTMLElement;\n   controlPanel.classList.add(\"hidden\");\n   const expandIcon = getElem(\"expand-icon\") as HTMLElement;\n   expandIcon.classList.remove(\"hidden\");\n}\n\nconst ControlPanel = () => {\n   const [, updateState] = React.useState({});\n   const forceUpdate = React.useCallback(() => updateState({}), []);\n\n   useEffect(() => {\n      updateControlPanel = forceUpdate;\n   }, [forceUpdate]);\n\n   return (\n      <>\n         <div id=\"expand-icon\" className=\"hidden\" onClick={expandControlPanel}>\n            <div className=\"formatter\">\n               <div className=\"vertical-bar\"></div>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n            <div className=\"text\">Control Panel</div>\n         </div>\n         <div id=\"control-panel\" className=\"menu\">\n            <div className=\"collapse-icon\" onClick={collapseControlPanel}>\n               <div className=\"horizontal-bar\"></div>\n            </div>\n\n            <h1 className=\"heading\">Control Panel</h1>\n\n            <h2 className=\"subheading\">Settings</h2>\n\n            <InputCheckbox name=\"dark-mode\" text=\"Dark Mode\" defaultValue={true} func={(newVal: boolean) => changeDarkMode(newVal)} />\n            <InputCheckbox name=\"show-debug-output\" text=\"Show Debug Output\" defaultValue={false} func={newVal => changeDebugOutputMode(newVal)} />\n\n            { Game.hasStarted ? ( <>\n               <button id=\"open-graph-viewer-button\">View Graphs</button>\n\n               <h2 className=\"subheading\">Overview</h2>\n\n               <p>Creatures: {Entity.count(Creature)}</p> \n               <p>Fruit: {Entity.count(Fruit)}</p>\n               <p>Time elapsed: {roundNum(Game.ticks / 20, 1)} seconds <i>({Game.ticks} ticks)</i></p>\n               \n               <h2 className=\"subheading\">Creatures</h2>\n               \n               <InputRange button=\"Create\" text=\"Create creatures\" min={1} max={10} defaultValue={1} step={1} func={createCreatures} />\n               <InputRange button=\"Create\" text=\"Create fruit\" min={5} max={100} defaultValue={5} step={5} func={createFruits} />\n\n               <h2 className=\"subheading\">World</h2>\n               \n               <InputRange text=\"Timewarp\" min={1} max={10} defaultValue={1} step={1} func={changeTimewarp} hasExtremeMode={true} />\n            </> ) : \"\"}\n         </div>\n      </>\n   );\n}\n\nexport default ControlPanel;\n","import { useRef, useState } from 'react';\r\n\r\ninterface InputCheckboxProps {\r\n   name: string;\r\n   text: string;\r\n   defaultValue: boolean;\r\n   func?: (inputVal: boolean, elem?: HTMLElement) => void;\r\n}\r\n\r\nconst InputCheckbox = ({ name, text, defaultValue, func }: InputCheckboxProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = !!Number((inputRef.current! as HTMLInputElement).checked);\r\n\r\n      if (func) func(inputVal, inputRef.current!);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const htmlName = \"_INPUT_\" + name;\r\n\r\n   const className = `input-checkbox ${val ? \"selected\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <input ref={inputRef} onChange={onInputChange} type=\"checkbox\" id={htmlName} defaultChecked={defaultValue} />\r\n         <label htmlFor={htmlName}>{text}</label>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputCheckbox;\r\n","import React, { useRef, useState } from 'react';\r\n\r\ninterface InputRangeProps {\r\n   text: string;\r\n   min: number;\r\n   max: number;\r\n   defaultValue: number;\r\n   step: number;\r\n   func?: (inputVal: number) => unknown;\r\n   button?: string;\r\n   /*** If present, any values above or equal to its value will enable \"extreme mode\" (purely visual) */\r\n   hasExtremeMode?: boolean;\r\n}\r\n\r\nconst InputRange = ({ text, min, max, defaultValue, step, func, button, hasExtremeMode }: InputRangeProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = Number((inputRef.current! as HTMLInputElement).value);\r\n\r\n      if (func && button === undefined) func(inputVal);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   const extremeModeIsEnabled = hasExtremeMode ? val >= max : false;\r\n   const className = `input-range  ${extremeModeIsEnabled ? \"extreme\" : \"\"}`;\r\n   return (\r\n      <div className={className}>\r\n         <div className=\"formatter\">\r\n            <div className=\"text\">{text}</div>\r\n\r\n            <div>\r\n               <div className=\"value\">{val}</div>\r\n               <div className=\"bar-container\">\r\n                  <div className=\"min\">{min}</div>\r\n                  <input ref={inputRef} onInput={onInputChange} type=\"range\" min={min} max={max} step={step} defaultValue={defaultValue} />\r\n                  <div className=\"max\">{max}</div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n\r\n         {button ?\r\n         <button onClick={() => {if (func) func(val)}}>{button}</button>\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputRange;\r\n","import Game, { GeneSampleEntry } from '../Game';\r\nimport { GraphOptions } from '../graph-viewer';\r\nimport { Colour, lerp, roundNum, Vector } from \"../utils\";\r\n\r\ntype timeUnits = \"seconds\" | \"minutes\";\r\n\r\nexport interface GraphSettings {\r\n   readonly shouldExtrapolate: boolean;\r\n}\r\n\r\nexport type GraphData = Array<GeneSampleEntry | null> | Array<number | null>;\r\nexport type GraphType = \"simple\" | \"detailed\";\r\nclass Graph {\r\n   data: GraphData;\r\n\r\n   element: HTMLElement;\r\n   width: number;\r\n   height: number;\r\n   time = Game.ticks;\r\n   settings: GraphSettings;\r\n   options: GraphOptions;\r\n\r\n   minY: number;\r\n   maxY: number;\r\n   \r\n   xAxisMeasurements = 10;\r\n   timeUnit: timeUnits = this.calculateTimeUnit(this.time);\r\n\r\n   constructor(width: number, height: number, data: GraphData, settings: GraphSettings, options: GraphOptions) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.data = data;\r\n      this.settings = settings;\r\n      this.options = options;\r\n\r\n      this.minY = this.calculateMinY();\r\n      this.maxY = this.calculateMaxY();\r\n\r\n      this.element = this.instantiate();\r\n      \r\n      this.plotData();\r\n      this.createAxes();\r\n      this.createLabels();\r\n   }\r\n   instantiate(): HTMLElement {\r\n      const element = document.createElement(\"div\");\r\n      element.className = \"graph\";\r\n\r\n      element.style.width = this.width + \"px\";\r\n      element.style.height = this.height + \"px\";\r\n\r\n      return element;\r\n   }\r\n\r\n   calculateMinY(): number {\r\n      if (this.options.min) return this.options.min;\r\n      return 0;\r\n   }\r\n   calculateMaxY(): number {\r\n      if (this.options.max) return this.options.max;\r\n\r\n      let maxY = 0;\r\n      if (this.options.type === \"simple\") {\r\n         for (const dataPoint of (this.data as Array<number | null>)) {\r\n            if (dataPoint !== null && dataPoint > maxY) maxY = dataPoint;\r\n         }\r\n      } else if (this.options.type === \"detailed\") {\r\n         for (const dataPoint of (this.data as Array<GeneSampleEntry | null>)) {\r\n            if (dataPoint !== null && dataPoint.max > maxY) maxY = dataPoint.max;\r\n         }\r\n      }\r\n      return maxY;\r\n   }\r\n\r\n   calculateTimeUnit(time: number): timeUnits {\r\n      const seconds = time / 20;\r\n      if (seconds / this.xAxisMeasurements > 60) {\r\n         return \"minutes\";\r\n      } else {\r\n         return \"seconds\";\r\n      }\r\n   }\r\n\r\n   drawPoint(pos: Vector, colour: string): void {\r\n      const point = document.createElement(\"div\");\r\n      point.className = \"point\";\r\n      point.style.backgroundColor = colour;\r\n      this.element.appendChild(point);\r\n      \r\n      point.style.left = pos.x + \"px\";\r\n      point.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   drawLine(previousPos: Vector, pos: Vector, colour: string): void {\r\n      const line = document.createElement(\"div\");\r\n      line.className = \"line\";\r\n      this.element.appendChild(line);\r\n      \r\n      line.style.left = previousPos.x + \"px\";\r\n      line.style.bottom = previousPos.y + \"px\";\r\n      line.style.backgroundColor = colour;\r\n      \r\n      const dist = previousPos.distanceFrom(pos);\r\n      const ang = -previousPos.angleBetween(pos);\r\n      line.style.width = dist + \"px\";\r\n      line.style.transform = `rotate(${ang}rad)`;\r\n   }\r\n\r\n   drawRect(pos: Vector, width: number, height: number, colour: string): void {\r\n      const rect = document.createElement(\"div\");\r\n      rect.className = \"rect\";\r\n      this.element.appendChild(rect);\r\n\r\n      rect.style.width = width + \"px\";\r\n      rect.style.height = height + \"px\";\r\n      rect.style.backgroundColor = colour;\r\n\r\n      rect.style.left = pos.x + \"px\";\r\n      rect.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   drawTrangle(pos: Vector, width: number, height: number, colour: string, type: \"top-left\" | \"top-right\" | \"bottom-right\" | \"bottom-left\"): void {\r\n      const triangle = document.createElement(\"div\");\r\n      triangle.className = `triangle ${type}`;\r\n      this.element.appendChild(triangle);\r\n\r\n      // triangle.style.width = width + \"px\";\r\n      // triangle.style.height = height + \"px\";\r\n      triangle.style.setProperty(\"--width\", height / 2 + \"px\");\r\n      triangle.style.setProperty(\"--height\", width / 2 + \"px\");\r\n      triangle.style.setProperty(\"--colour\", colour);\r\n      // triangle.style.backgroundColor = colour;\r\n\r\n      triangle.style.left = pos.x + \"px\";\r\n      triangle.style.bottom = pos.y + \"px\";\r\n   }\r\n\r\n   getData(): GraphData {\r\n      const EXTRAPOLATION_AMOUNT = 75;\r\n      if (!this.settings.shouldExtrapolate || this.data.length <= EXTRAPOLATION_AMOUNT) {\r\n         return this.data;\r\n      }\r\n\r\n      let data!: GraphData;\r\n      if (this.options.type === \"simple\") {\r\n         data = new Array<number | null>();\r\n      } else if (this.options.type === \"detailed\") {\r\n         data = new Array<GeneSampleEntry | null>();\r\n      }\r\n\r\n      for (let i = 0; i < EXTRAPOLATION_AMOUNT; i++) {\r\n         const relativeIndex = this.data.length * i/EXTRAPOLATION_AMOUNT;\r\n\r\n         if (this.options.type === \"simple\") {\r\n            let dataPoint: number | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as number | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as number | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as number | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = lerp(floorVal as number, ceilVal as number, remainder);\r\n               }\r\n            }\r\n            (data as Array<number | null>).push(dataPoint);\r\n         } else if (this.options.type === \"detailed\") {\r\n            let dataPoint: GeneSampleEntry | null;\r\n\r\n            const remainder = relativeIndex % 1;\r\n            if (remainder === 0) {\r\n               // If data point already exists, use existing value\r\n               dataPoint = this.data[relativeIndex] as GeneSampleEntry | null;\r\n            } else {\r\n               // Otherwise extrapolate\r\n               const floorVal = this.data[Math.floor(relativeIndex)] as GeneSampleEntry | null;\r\n               const ceilVal = this.data[Math.ceil(relativeIndex)] as GeneSampleEntry | null;\r\n\r\n               if (floorVal === null && ceilVal === null) {\r\n                  dataPoint = null;\r\n               } else if (floorVal === null && ceilVal !== null) {\r\n                  dataPoint = ceilVal;\r\n               } else if (floorVal !== null && ceilVal === null) {\r\n                  dataPoint = floorVal;\r\n               } else {\r\n                  dataPoint = {\r\n                     average: lerp(floorVal!.average, ceilVal!.average, remainder),\r\n                     min: lerp(floorVal!.min, ceilVal!.min, remainder),\r\n                     max: lerp(floorVal!.max, ceilVal!.max, remainder),\r\n                     standardDeviation: lerp(floorVal!.standardDeviation, ceilVal!.standardDeviation, remainder)\r\n                  }\r\n               }\r\n            }\r\n            (data as Array<GeneSampleEntry | null>).push(dataPoint);\r\n         }\r\n      }\r\n      return data;\r\n   }\r\n\r\n   plotData(): void {\r\n      const data = this.getData();\r\n\r\n      if (this.options.type === \"simple\") {\r\n         this.plotSimpleData(data as Array<number | null>);\r\n      } else if (this.options.type === \"detailed\") {\r\n         this.plotDetailedData(data as Array<GeneSampleEntry | null>);\r\n      }\r\n   }\r\n\r\n   plotSimpleData(data: Array<number | null>): void {\r\n      let previousPos: Vector | null = null;\r\n      for (let i = 0; i < data.length; i++) {\r\n         const dataPoint = data[i];\r\n         if (dataPoint === null) {\r\n            previousPos = null;\r\n            continue;\r\n         }\r\n         const stepSize = this.width / (data.length-1);\r\n         \r\n         const pos = new Vector(\r\n            stepSize * i,\r\n            this.height * (dataPoint - this.minY)/(this.maxY - this.minY)\r\n         );\r\n\r\n         this.drawPoint(pos, this.options.colour);\r\n         if (i > 0 && previousPos !== null) {\r\n            this.drawLine(previousPos, pos, this.options.colour);\r\n         }\r\n\r\n         previousPos = pos;\r\n      }\r\n   }\r\n\r\n   draw(colour: string, stepSize: number, i: number, value: number, previousPos: Vector | null, shouldDrawPoint: boolean): Vector | null {\r\n      const pos = new Vector(\r\n         stepSize * i,\r\n         this.height * (value - this.minY)/(this.maxY - this.minY)\r\n      );\r\n\r\n      if (shouldDrawPoint) this.drawPoint(pos, colour);\r\n      if (i > 0 && previousPos !== null) {\r\n         this.drawLine(previousPos, pos, colour);\r\n      }\r\n      return pos;\r\n   }\r\n\r\n   plotDetailedData(data: Array<GeneSampleEntry | null>): void {\r\n      const averageColour = new Colour(this.options.colour);\r\n\r\n      let stdevColour = averageColour.desaturate(0.3);\r\n      stdevColour = stdevColour.darken(0.2);\r\n\r\n      let outerColour = averageColour.desaturate(0.7);\r\n      outerColour = outerColour.darken(0.2);\r\n\r\n      const n = data.length;\r\n\r\n      let previousAveragePos: Vector | null = null;\r\n      let previousMinPos: Vector | null = null;\r\n      let previousMaxPos: Vector | null = null;\r\n      let previousStdevMinPos: Vector | null = null;\r\n      let previousStdevMaxPos: Vector | null = null;\r\n      for (let i = 0; i < n; i++) {\r\n         const entry = data[i];\r\n         if (entry === null) {\r\n            continue;\r\n         }\r\n\r\n         const stepSize = this.width / (n-1);\r\n\r\n         previousAveragePos = this.draw(this.options.colour, stepSize, i, entry.average, previousAveragePos, true);\r\n\r\n         previousMinPos = this.draw(outerColour.hex, stepSize, i, entry.min, previousMinPos, false);\r\n         previousMaxPos = this.draw(outerColour.hex, stepSize, i, entry.max, previousMaxPos, false);\r\n\r\n         const stdevMinPos = this.draw(stdevColour.hex, stepSize, i, entry.average - entry.standardDeviation, previousStdevMinPos, false);\r\n         const stdevMaxPos = this.draw(stdevColour.hex, stepSize, i, entry.average + entry.standardDeviation, previousStdevMaxPos, false);\r\n         if (i > 0 && stdevMinPos !== null && stdevMaxPos !== null && previousStdevMinPos !== null && previousStdevMaxPos !== null) {\r\n            const rectWidth = stdevMinPos.x - previousStdevMinPos.x;\r\n            const height = Math.min(previousStdevMaxPos.y, stdevMaxPos.y) - Math.max(previousStdevMinPos.y, stdevMinPos.y);\r\n            const rectPos = new Vector(\r\n               previousStdevMinPos.x,\r\n               Math.max(previousStdevMinPos.y, stdevMinPos.y)\r\n            );\r\n            this.drawRect(rectPos, rectWidth, height, stdevColour.hex);\r\n\r\n            const topTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMaxPos.y, previousStdevMaxPos.y));\r\n            if (previousStdevMaxPos.y > stdevMaxPos.y) {\r\n               this.drawTrangle(topTrianglePos, rectWidth, previousStdevMaxPos.y - stdevMaxPos.y, stdevColour.hex, \"bottom-left\");\r\n            } else {\r\n               this.drawTrangle(topTrianglePos, rectWidth, stdevMaxPos.y - previousStdevMaxPos.y, stdevColour.hex, \"bottom-right\");\r\n            }\r\n            \r\n            const bottomTrianglePos = new Vector(previousStdevMaxPos.x, Math.min(stdevMinPos.y, previousStdevMinPos.y));\r\n            if (previousStdevMinPos.y > stdevMinPos.y) {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, previousStdevMinPos.y - stdevMinPos.y, stdevColour.hex, \"top-right\");\r\n            } else {\r\n               this.drawTrangle(bottomTrianglePos, rectWidth, stdevMinPos.y - previousStdevMinPos.y, stdevColour.hex, \"top-left\");\r\n            }\r\n         }\r\n         \r\n         previousStdevMaxPos = stdevMaxPos;\r\n         previousStdevMinPos = stdevMinPos;\r\n      }\r\n   }\r\n\r\n   createAxisMeasurement(val: number): HTMLElement {\r\n      const measurement = document.createElement(\"div\");\r\n      measurement.className = \"measurement\";\r\n      this.element.appendChild(measurement);\r\n      const dpp = 1;\r\n      measurement.innerHTML = roundNum(val, dpp).toString();\r\n\r\n      return measurement;\r\n   }\r\n\r\n   createAxes(): void {\r\n      \r\n      // Time\r\n      for (let i = 0; i < this.xAxisMeasurements; i++) {\r\n         let val = this.time / this.xAxisMeasurements * i / Game.tps;\r\n         if (this.timeUnit === \"minutes\") val /= 60;\r\n         \r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"x\");\r\n         measurement.style.left = this.width / this.xAxisMeasurements * i * (this.xAxisMeasurements+1)/this.xAxisMeasurements + \"px\";\r\n      }\r\n      \r\n      const Y_AXIS_MEASUREMENTS = 7;\r\n      for (let i = 0; i < Y_AXIS_MEASUREMENTS; i++) {\r\n         const val = this.minY + i * (this.maxY - this.minY)/(Y_AXIS_MEASUREMENTS-1);\r\n         const measurement = this.createAxisMeasurement(val);\r\n         measurement.classList.add(\"y\");\r\n         measurement.style.bottom = this.height / (Y_AXIS_MEASUREMENTS-1) * i + \"px\";\r\n      }\r\n   }\r\n\r\n   createLabels(): void {\r\n      const xLabel = document.createElement(\"div\");\r\n      xLabel.className = \"label x-label\";\r\n      this.element.appendChild(xLabel);\r\n      if (this.timeUnit === \"seconds\") {\r\n         xLabel.innerHTML = \"Seconds\";\r\n      } else if (this.timeUnit === \"minutes\") {\r\n         xLabel.innerHTML = \"Minutes\";\r\n      }\r\n\r\n      const yLabel = document.createElement(\"div\");\r\n      yLabel.className = \"label y-label\";\r\n      this.element.appendChild(yLabel);\r\n      const val = this.options.dependentVariable;\r\n      yLabel.innerHTML = val;\r\n   }\r\n}\r\n\r\nexport default Graph;","import ReactDOM from 'react-dom';\r\nimport { creatureGeneInfo } from './classes/Creature';\r\nimport Graph, { GraphData, GraphSettings, GraphType } from './classes/Graph';\r\nimport InputCheckbox from './components/InputCheckbox';\r\nimport InputRange from './components/InputRange';\r\nimport { geneSamples } from './Game';\r\nimport { hideMask, showMask } from './index';\r\nimport { getElem } from './utils';\r\n\r\nexport let graphViewerIsVisible: boolean = false;\r\n\r\ntype settingType = \"checkbox\" | \"range\";\r\ninterface Setting {\r\n   text: string;\r\n   type: settingType;\r\n   description?: string;\r\n   isChecked?: boolean;\r\n   value?: number;\r\n   min?: number;\r\n   max?: number;\r\n   step?: number;\r\n   defaultValue: boolean | number;\r\n   requirement?: string;\r\n   elem?: JSX.Element;\r\n}\r\nexport const graphSettingData: ReadonlyArray<Setting> = [\r\n   {\r\n      text: \"Extrapolate values\",\r\n      type: \"checkbox\",\r\n      description: \"Reduces the amount of nodes rendered, will significantly reduce lag in extreme scenarios.\",\r\n      defaultValue: false\r\n   },\r\n   // {\r\n   //    text: \"Max number of points\",\r\n   //    type: \"range\",\r\n   //    description: \"The highest number of points, after which values will be extrapolated.\",\r\n   //    defaultValue: 50,\r\n   //    min: 50,\r\n   //    max: 100,\r\n   //    step: 5,\r\n   //    requirement: \"Extrapolate values\"\r\n   // },\r\n   {\r\n      text: \"Automatically update\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show points\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   },\r\n   {\r\n      text: \"Show lines\",\r\n      type: \"checkbox\",\r\n      defaultValue: true\r\n   }\r\n];\r\n\r\nconst createSettings = (): void => {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const settingsContainer = graphViewer.querySelector(\".settings-container\");\r\n\r\n   const elems: Array<JSX.Element> = graphSettingData.map((setting, i) => {\r\n      const baseClickEvent = (): void => {\r\n         // Check for any settings which require this one\r\n         for (const settingCheck of graphSettingData) {\r\n            if (settingCheck.requirement === setting.text) {\r\n\r\n            }\r\n         }\r\n\r\n         drawGraphs();\r\n      }\r\n\r\n      let elem: JSX.Element;\r\n      const name = `graph-setting-${i}`;\r\n      switch (setting.type) {\r\n         case \"checkbox\": {\r\n            const clickEvent = (isSelected: boolean): void => {\r\n               setting.isChecked = isSelected;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputCheckbox key={i} name={name} text={setting.text} defaultValue={setting.defaultValue as boolean} func={clickEvent} />\r\n            break;   \r\n         }\r\n         case \"range\": {\r\n            const clickEvent = (newVal: number): void => {\r\n               setting.value = newVal;\r\n               baseClickEvent();\r\n            }\r\n\r\n            elem = <InputRange key={i} text={setting.text} defaultValue={setting.defaultValue as number} min={setting.min!} max={setting.max!} step={setting.step!} func={clickEvent} />\r\n            break;\r\n         }\r\n      }\r\n      setting.elem = elem;\r\n      return elem!;\r\n   });\r\n\r\n   ReactDOM.render(elems, settingsContainer);\r\n}\r\n\r\nconst setupSettings = (): void => {\r\n   for (const setting of graphSettingData) {\r\n      if (setting.type === \"checkbox\") {\r\n         setting.isChecked = setting.defaultValue as boolean;\r\n      }\r\n   }\r\n}\r\n\r\nexport interface GraphOptions {\r\n   display: string;\r\n   id: string;\r\n   colour: string;\r\n   dependentVariable: string;\r\n   type: GraphType;\r\n   min?: number;\r\n   max?: number;\r\n   isSelected?: boolean;\r\n}\r\nlet graphOptions: Array<GraphOptions> = [\r\n   {\r\n      display: \"Number of creatures\",\r\n      id: \"creatures\",\r\n      colour: \"#26ff1f\",\r\n      dependentVariable: \"Creatures\",\r\n      type: \"simple\"\r\n   },\r\n   {\r\n      display: \"Number of fruit\",\r\n      id: \"fruit\",\r\n      colour: \"#19c6ff\",\r\n      dependentVariable: \"Fruit\",\r\n      type: \"simple\"\r\n   },\r\n   {\r\n      display: \"Fruit multiplier\",\r\n      id: \"fruit-multiplier\",\r\n      colour: \"#31ff2e\",\r\n      dependentVariable: \"Multiplier\",\r\n      type: \"simple\"\r\n   }\r\n];\r\nconst createGraphOptions = (): void => {\r\n   for (const [ geneName, gene ] of Object.entries(creatureGeneInfo)) {\r\n      graphOptions.push({\r\n         display: `Creature ${gene.display}`,\r\n         id: geneName,\r\n         colour: gene.colour,\r\n         dependentVariable: gene.display,\r\n         min: gene.min,\r\n         max: gene.max,\r\n         type: \"detailed\"\r\n      });\r\n   }\r\n}\r\n\r\nlet selectedGraphOptions: Array<GraphOptions> = new Array<GraphOptions>();\r\nexport function setupGraphs(): void {\r\n   createGraphOptions();\r\n   createSettings();\r\n   setupSettings();\r\n\r\n   const graphViewer = getElem(\"graph-viewer\");\r\n   const optionsContainer = graphViewer.querySelector(\".options-container\");\r\n\r\n   const optionElems = <>{\r\n      graphOptions.map((option, i) => {\r\n         const clickEvent = (isSelected: boolean) => {\r\n            option.isSelected = isSelected;\r\n            if (isSelected) {\r\n               let hasInserted = false;\r\n               for (let j = 0; j < selectedGraphOptions.length; j++) {\r\n                  const n = graphOptions.indexOf(selectedGraphOptions[j]);\r\n                  if (n > i) {\r\n                     selectedGraphOptions.splice(j, 0, option)\r\n                     hasInserted = true;\r\n                     break;\r\n                  }\r\n               }\r\n               if (!hasInserted) {\r\n                  selectedGraphOptions.push(option);\r\n               }\r\n            } else {\r\n               const idx = selectedGraphOptions.indexOf(option);\r\n               selectedGraphOptions.splice(idx, 1);\r\n            }\r\n\r\n            drawGraphs();\r\n         };\r\n\r\n         return <InputCheckbox key={i} name={option.id} text={option.display} defaultValue={false} func={clickEvent} />\r\n      })\r\n   }</>;\r\n\r\n   ReactDOM.render(optionElems, optionsContainer);\r\n}\r\n\r\nexport function closeGraphViewer(): void {\r\n   hideMask();\r\n   getElem(\"graph-viewer\").classList.add(\"hidden\");\r\n   graphViewerIsVisible = false;\r\n}\r\n\r\nexport function openGraphViewer(): void {\r\n   showMask();\r\n   getElem(\"graph-viewer\").classList.remove(\"hidden\");\r\n   graphViewerIsVisible = true;\r\n}\r\n\r\nexport function drawGraphs(): void {\r\n   const graphViewer = getElem(\"graph-viewer\") as HTMLElement;\r\n   const graphContainer = graphViewer.querySelector(\".graph-container\") as HTMLElement;\r\n\r\n   // If no options are selected, display text and leave\r\n   if (selectedGraphOptions.length === 0) {\r\n      graphContainer.innerHTML = \"<p>Your graph will appear here once you choose an option.</p>\";\r\n      return;\r\n   }\r\n\r\n   // Remove any previous graphs\r\n   graphContainer.innerHTML = \"\";\r\n   \r\n   const graphSettings: GraphSettings = {\r\n      shouldExtrapolate: graphSettingData[0].isChecked!\r\n   };\r\n\r\n   for (const graphOptions of selectedGraphOptions) {\r\n      let dataPoints: GraphData;\r\n      if (graphOptions.type === \"simple\") {\r\n         dataPoints = geneSamples.map(sample => sample[graphOptions.id]);\r\n      } else if (graphOptions.type === \"detailed\") {\r\n         dataPoints = geneSamples.map(sample => sample.genePool !== null ? sample.genePool[graphOptions.id] : null);\r\n      }\r\n\r\n      const aspectRatio = 5/3;\r\n      const width = 350;\r\n\r\n      const graph = new Graph(width, width/aspectRatio, dataPoints!, graphSettings, graphOptions);\r\n      graphContainer.appendChild(graph.element);\r\n   }\r\n}","import Game from \"./Game\";\r\nimport { getElem } from \"./utils\";\r\n\r\nconst boardIsVisible = (): boolean => {\r\n   return !getElem(\"board\")!.classList.contains(\"hidden\");\r\n}\r\n\r\nexport function updateTransform(): void {\r\n   const board = getElem(\"board\");\r\n\r\n   board.style.top = `calc(50% + ${Game.transform.translate.y}%)`;\r\n   board.style.left = `calc(50% + ${Game.transform.translate.x}%)`;\r\n   board.style.transform = `translate(-50%, -50%) scale(${Game.transform.zoom}, ${Game.transform.zoom})`;\r\n}\r\n\r\ntype translateDirection = \"up\" | \"right\" | \"down\" | \"left\";\r\nconst translateBoard = (dir: translateDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n\r\n   const TRANSLATE_AMOUNT = 5;\r\n\r\n   const translate = Game.transform.translate;\r\n   switch (dir) {\r\n      case \"up\": {\r\n         translate.y += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"right\": {\r\n         translate.x -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"down\": {\r\n         translate.y -= TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n      case \"left\": {\r\n         translate.x += TRANSLATE_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\ntype zoomDirection = \"in\" | \"out\";\r\nconst zoomBoard = (dir: zoomDirection): void => {\r\n   if (!boardIsVisible()) return;\r\n   \r\n   const ZOOM_AMOUNT = 0.15;\r\n\r\n   switch (dir) {\r\n      case \"in\": {\r\n         Game.transform.zoom *= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n      case \"out\": {\r\n         Game.transform.zoom /= 1 + ZOOM_AMOUNT;\r\n         break;\r\n      }\r\n   }\r\n\r\n   updateTransform();\r\n}\r\n\r\nconst pauseGame = (): void => {\r\n   Game.isPaused = true;\r\n   getElem(\"pause-screen\").classList.remove(\"hidden\");\r\n}\r\nconst unpauseGame = (): void => {\r\n   Game.isPaused = false;\r\n   getElem(\"pause-screen\").classList.add(\"hidden\");\r\n}\r\n\r\nexport function keyPress(): void {\r\n   const e = window.event as KeyboardEvent;\r\n   const key = e.key;\r\n\r\n   // Don't do anything if there is an element in focus\r\n   if (document.activeElement !== document.body) return;\r\n\r\n   switch (key) {\r\n      case \"ArrowUp\": {\r\n         translateBoard(\"up\");\r\n         break;\r\n      }\r\n      case \"ArrowRight\": {\r\n         translateBoard(\"right\");\r\n         break;\r\n      }\r\n      case \"ArrowDown\": {\r\n         translateBoard(\"down\");\r\n         break;\r\n      }\r\n      case \"ArrowLeft\": {\r\n         translateBoard(\"left\");\r\n         break;\r\n      }\r\n      case \"-\":\r\n      case \"_\": {\r\n         zoomBoard(\"out\");\r\n         break;\r\n      }\r\n      case \"+\":\r\n      case \"=\": {\r\n         zoomBoard(\"in\");\r\n         break;\r\n      }\r\n      case \" \": {\r\n         Game.isPaused ? unpauseGame() : pauseGame();\r\n      }\r\n   }\r\n}","import { lerp, PolarVector, Vector } from './utils';\r\n\r\nconst interpolate = (dot0: number, dot1: number, dot2: number, dot3: number, localX: number, localY: number): number => {\r\n   const a = lerp(dot0, dot1, localX);\r\n   const b = lerp(dot2, dot3, localX);\r\n   return lerp(a, b, localY);\r\n}\r\n\r\nconst fade = (t: number): number => {\r\n   return t * t * t * (t * (t * 6 - 15) + 10);\r\n}\r\n\r\nexport function getPerlinNoise(width: number, height: number, scale: number): Array<Array<number>> {\r\n   const grid = new Array<Array<PolarVector>>();\r\n\r\n   for (let i = 0; i < height; i++) {\r\n      const row = new Array<PolarVector>();\r\n      for (let j = 0; j < width; j++) {\r\n         row.push(PolarVector.randomUnitVector());\r\n      }\r\n      grid.push(row);\r\n   }\r\n\r\n   const noise = new Array<Array<number>>();\r\n   for (let y = 0; y < height; y++) {\r\n      const row = new Array<number>();\r\n      for (let x = 0; x < width; x++) {\r\n         const sampleX = x / scale;\r\n         const sampleY = y / scale;\r\n         const samplePoint = new Vector(sampleX, sampleY);\r\n\r\n         const x0 = Math.floor(sampleX);\r\n         const x1 = x0 + 1;\r\n         const y0 = Math.floor(sampleY);\r\n         const y1 = y0 + 1;\r\n\r\n         const cornerCoords = [[y0, x0], [y0, x1], [y1, x0], [y1, x1]]\r\n\r\n         const dotProducts = new Array<number>();\r\n         for (let i = 0; i < 4; i++) {\r\n            const coords = cornerCoords[i];\r\n\r\n            const corner = grid[coords[0]][coords[1]];\r\n            const cornerPos = new Vector(coords[1], coords[0]);\r\n            const offsetVector = samplePoint.convertToPolar(cornerPos);\r\n            const dot = corner.convertToCartesian().dot(offsetVector.convertToCartesian());\r\n            dotProducts.push(dot);\r\n         }\r\n\r\n         const u = fade(sampleX % 1);\r\n         const v = fade(sampleY % 1);\r\n         let val = interpolate(dotProducts[0], dotProducts[1], dotProducts[2], dotProducts[3], u, v);\r\n         val = Math.min(Math.max(val, -0.5), 0.5);\r\n         row.push(val);\r\n      }\r\n      noise.push(row);\r\n   }\r\n   return noise;\r\n}\r\n\r\n/**\r\n * \r\n * @param octaves The number of perlin noise layers to use\r\n * @param lacunarity Controls the increase in frequency between octaves (1+)\r\n * @param persistance Controls the decrease in weight between octaves (0-1)\r\n */\r\nexport function getOctavePerlinNoise(width: number, height: number, startingScale: number, octaves: number, lacunarity: number, persistance: number): Array<Array<number>> {\r\n   let totalNoise = new Array<Array<number>>();\r\n   for (let i = 0; i < octaves; i++) {\r\n      const scale = 1 / Math.pow(lacunarity, i) * startingScale;\r\n      const weightMultiplier = Math.pow(persistance, i);\r\n\r\n      const noise = getPerlinNoise(width, height, scale);\r\n      if (i === 0) {\r\n         totalNoise = noise;\r\n      } else {\r\n         for (let y = 0; y < height; y++) {\r\n            for (let x = 0; x < width; x++) {\r\n               totalNoise[y][x] += noise[y][x] * weightMultiplier;\r\n            }\r\n         }\r\n      }\r\n   }\r\n   return totalNoise;\r\n}\r\n","import { getOctavePerlinNoise, getPerlinNoise } from \"../perlin-noise\";\r\nimport { Colour, getElem } from \"../utils\";\r\n\r\n// Generate a height map and a temperature map\r\n\r\ntype NoiseType = \"height\" | \"temperature\";\r\n\r\nexport interface TileType {\r\n   name: string;\r\n   colour: string;\r\n   fruitColour?: string;\r\n   isLiquid: boolean;\r\n}\r\ninterface TerrainType {\r\n   height?: number | [number, number];\r\n   temperature?: number | [number, number];\r\n   type: string;\r\n}\r\nexport interface Terrain {\r\n   name: string;\r\n   noise: Array<NoiseType>;\r\n   terrainTypes: ReadonlyArray<TerrainType>;\r\n}\r\ninterface TerrainInfo {\r\n   presets: ReadonlyArray<Terrain>;\r\n   tiles: { [key: string]: TileType }\r\n}\r\nexport const terrainInfo: TerrainInfo = {\r\n   /**\r\n    * Countryside: only plains biome\r\n    * Biomes: no water\r\n    * Archipelago: islands seperated by water\r\n    * Hell: magma + mountain peaks, with lava instead of water\r\n    * Russia: tundra, medium amount of water\r\n    */\r\n   presets: [\r\n      {\r\n         name: \"Countryside\",\r\n         noise: [\"height\"],\r\n         terrainTypes: [\r\n            {\r\n               height: 1,\r\n               type: \"grass\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Biomes\",\r\n         noise: [\"height\", \"temperature\"],\r\n         terrainTypes: [\r\n            {\r\n               height: [0.8, 1],\r\n               type: \"mountain\"\r\n            },\r\n            {\r\n               temperature: 0.3,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               temperature: 0.7,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               temperature: 1,\r\n               type: \"desert\"\r\n            },\r\n         ]\r\n      },\r\n      {\r\n         name: \"Archipelago\",\r\n         noise: [\"height\", \"temperature\"],\r\n         terrainTypes: [\r\n            {\r\n               height: 0.1,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 0.3,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               temperature: 0.3,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               temperature: 0.7,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               temperature: 1,\r\n               type: \"desert\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Hell\",\r\n         noise: [\"height\"],\r\n         terrainTypes: [\r\n            {\r\n               height: 0.35,\r\n               type: \"lava\"\r\n            },\r\n            {\r\n               height: 0.8,\r\n               type: \"magma\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"mountain\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"Russia\",\r\n         noise: [\"height\"],\r\n         terrainTypes: [\r\n            {\r\n               height: 0.1,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 0.3,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               height: 0.7,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"mountain\"\r\n            }\r\n         ]\r\n      },\r\n      {\r\n         name: \"???\",\r\n         noise: [\"height\"],\r\n         terrainTypes: [\r\n            {\r\n               height: 0.3,\r\n               type: \"grass\"\r\n            },\r\n            {\r\n               height: 0.4,\r\n               type: \"tundra\"\r\n            },\r\n            {\r\n               height: 0.5,\r\n               type: \"mountain\"\r\n            },\r\n            {\r\n               height: 0.6,\r\n               type: \"desert\"\r\n            },\r\n            {\r\n               height: 0.7,\r\n               type: \"magma\"\r\n            },\r\n            {\r\n               height: 0.8,\r\n               type: \"water\"\r\n            },\r\n            {\r\n               height: 0.9,\r\n               type: \"deepWater\"\r\n            },\r\n            {\r\n               height: 1,\r\n               type: \"lava\"\r\n            },\r\n         ]\r\n      }\r\n   ],\r\n   tiles: {\r\n      grass: {\r\n         name: \"Grass\",\r\n         colour: \"#23ee2d\",\r\n         fruitColour: \"#009124\",\r\n         isLiquid: false\r\n      },\r\n      tundra: {\r\n         name: \"Tundra\",\r\n         colour: \"#b8c6db\",\r\n         fruitColour: \"#0066ff\",\r\n         isLiquid: false\r\n      },\r\n      mountain: {\r\n         name: \"Mountain\",\r\n         colour: \"#fff\",\r\n         fruitColour: \"#cf13bf\",\r\n         isLiquid: false\r\n      },\r\n      desert: {\r\n         name: \"Desert\",\r\n         colour: \"yellow\",\r\n         fruitColour: \"#666\",\r\n         isLiquid: false\r\n      },\r\n      magma: {\r\n         name: \"Magma\",\r\n         colour: \"orange\",\r\n         fruitColour: \"red\",\r\n         isLiquid: false\r\n      },\r\n      water: {\r\n         name: \"Water\",\r\n         colour: \"blue\",\r\n         isLiquid: true\r\n      },\r\n      deepWater: {\r\n         name: \"Deep water\",\r\n         colour: \"darkblue\",\r\n         isLiquid: true\r\n      },\r\n      lava: {\r\n         name: \"Lava\",\r\n         colour: \"red\",\r\n         isLiquid: true\r\n      }\r\n   }\r\n}\r\n\r\nexport class BoardGenerator {\r\n   private width: number;\r\n   private height: number;\r\n   private readonly tileSize: number;\r\n   private readonly canvas: HTMLCanvasElement;\r\n   tiles!: Array<Array<TileType>>;\r\n\r\n   constructor(width: number, height: number, tileSize: number) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.tileSize = tileSize;\r\n      this.canvas = this.instantiate();\r\n   }\r\n\r\n   private instantiate(): HTMLCanvasElement {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.setAttribute(\"width\", this.width * this.tileSize + \"px\");\r\n      canvas.setAttribute(\"height\", this.height * this.tileSize + \"px\");\r\n      \r\n      getElem(\"board-preview-container\").appendChild(canvas);\r\n\r\n      return canvas;\r\n   }\r\n\r\n   changeSize(newWidth: number, newHeight: number) {\r\n      this.width = newWidth;\r\n      this.height = newHeight;\r\n\r\n      this.canvas.setAttribute(\"width\", this.width * this.tileSize + \"px\");\r\n      this.canvas.setAttribute(\"height\", this.height * this.tileSize + \"px\");\r\n   }\r\n\r\n   getTiles(): Array<Array<TileType>> {\r\n      return this.tiles;\r\n   }\r\n\r\n   private getTileType(terrain: Terrain, height: number | null, temperature: number | null): TileType {\r\n      let tileType: TileType;\r\n      for (const terrainType of terrain.terrainTypes) {\r\n         if (terrainType.height) {\r\n            if (typeof terrainType.height === \"number\") {\r\n               if (height! <= terrainType.height) return terrainInfo.tiles[terrainType.type];\r\n            } else if (Array.isArray(terrainType.height)) {\r\n               if (height! >= terrainType.height[0] && height! <= terrainType.height[1]) return terrainInfo.tiles[terrainType.type];\r\n            }\r\n         } else if (terrainType.temperature) {\r\n            if (typeof terrainType.temperature === \"number\") {\r\n               if (temperature! <= terrainType.temperature) return terrainInfo.tiles[terrainType.type];\r\n            } else if (Array.isArray(terrainType.height)) {\r\n               if (temperature! >= terrainType.temperature[0] && temperature! <= terrainType.temperature[1]) return terrainInfo.tiles[terrainType.type];\r\n            }\r\n         }\r\n      }\r\n      return tileType!;\r\n   }\r\n\r\n   generateNoise(terrain: Terrain): void {\r\n      // Reset tiles\r\n      this.tiles = new Array<Array<TileType>>();\r\n      for (let y = 0; y < this.height; y++) {\r\n         this.tiles[y] = new Array<TileType>(this.width);\r\n      }\r\n\r\n      const scale = 5;\r\n\r\n      const noise: { [key: string]: Array<Array<number>> } = {};\r\n      for (const noiseType of terrain.noise) {\r\n         if (noiseType === \"height\") {\r\n            noise.height = getPerlinNoise(this.width, this.height, scale);\r\n         } else if (noiseType === \"temperature\") {\r\n            noise.temperature = getPerlinNoise(this.width, this.height, scale);\r\n         }\r\n      }\r\n\r\n      this.clearCanvas();\r\n\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n      for (let y = 0; y < this.height; y++) {\r\n         for (let x = 0; x < this.width; x++) {\r\n            const height = noise.height ? noise.height[y][x] + 0.5 : null;\r\n            const temperature = noise.temperature ? noise.temperature[y][x] + 0.5 : null;\r\n            const tileType = this.getTileType(terrain, height, temperature);\r\n            this.tiles[y][x] = tileType;\r\n\r\n            // console.log(terrain, height, temperature);\r\n            const colour = tileType.colour;\r\n            \r\n            ctx.beginPath();\r\n            ctx.fillStyle = colour;\r\n            ctx.rect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);\r\n            ctx.fill();\r\n         }\r\n      }\r\n\r\n      this.drawGridLines();\r\n   }\r\n\r\n   generateTestOctaveNoise(scale: number, octaves: number, lacunarity: number, persistance: number): void {\r\n      const noise = getOctavePerlinNoise(this.width, this.height, scale, octaves, lacunarity, persistance);\r\n      this.drawTestNoise(noise);\r\n   }\r\n\r\n   generateTestNoise(scale: number): void {\r\n      const noise = getPerlinNoise(this.width, this.height, scale);\r\n      this.drawTestNoise(noise);\r\n   }\r\n\r\n   private drawTestNoise(noise: Array<Array<number>>): void {\r\n      this.clearCanvas();\r\n\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n      for (let y = 0; y < this.height; y++) {\r\n         for (let x = 0; x < this.width; x++) {\r\n            const weight = noise[y][x];\r\n            \r\n            ctx.beginPath();\r\n            const colour = \"#\" + Colour.grayscale(weight + 0.5);\r\n            ctx.fillStyle = colour;\r\n            ctx.rect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);\r\n            ctx.fill();\r\n         }\r\n      }\r\n   }\r\n\r\n   private drawGridLines(): void {\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n\r\n      for (let y = 1; y < this.height; y++) {\r\n         ctx.moveTo(0, y * this.tileSize);\r\n         ctx.lineTo(this.width * this.tileSize, y * this.tileSize);\r\n      }\r\n\r\n      for (let x = 1; x < this.width; x++) {\r\n         ctx.moveTo(x * this.tileSize, 0);\r\n         ctx.lineTo(x * this.tileSize, this.height * this.tileSize);\r\n      }\r\n\r\n      ctx.strokeStyle = \"#000\";\r\n      ctx.stroke();\r\n   }\r\n\r\n   private clearCanvas(): void {\r\n      const ctx = this.canvas.getContext(\"2d\")!;\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n   }\r\n}","import React, { useEffect, useState } from 'react';\r\nimport { terrainInfo, BoardGenerator, Terrain, TileType } from '../classes/BoardGenerator';\r\nimport InputCheckbox from './InputCheckbox';\r\nimport InputSelect from './InputSelect';\r\nimport '../css/terrain-generator.css';\r\nimport InputText from './InputText';\r\nimport Game from '../Game';\r\n\r\nlet boardGenerator: BoardGenerator;\r\nlet currentTerrain: Terrain = terrainInfo.presets[0];\r\n\r\nconst generatePreview = (): void => {\r\n   boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height);\r\n   boardGenerator.generateNoise(currentTerrain);\r\n}\r\n\r\nexport function getTiles(): Array<Array<TileType>> {\r\n   return boardGenerator.getTiles();\r\n}\r\n\r\nconst TerrainGenerator = () => {\r\n   const [visible, setVisible] = useState(false);\r\n\r\n   const toggleTerrainGeneratorVisibility = (isVisible: boolean) => {\r\n      setVisible(isVisible);\r\n   }\r\n\r\n   useEffect(() => {\r\n      boardGenerator = new BoardGenerator(Game.boardSize.width, Game.boardSize.height, 16);\r\n      boardGenerator.generateNoise(terrainInfo.presets[0]);\r\n   }, []);\r\n\r\n   const presetNames = terrainInfo.presets.map(preset => preset.name);\r\n\r\n   const onPresetChange = (newPresetName: string) => {\r\n      for (const currentPreset of terrainInfo.presets) {\r\n         if (currentPreset.name === newPresetName) {\r\n            currentTerrain = currentPreset;\r\n            boardGenerator.changeSize(Game.boardSize.width, Game.boardSize.height);\r\n            boardGenerator.generateNoise(currentPreset);\r\n            break;\r\n         }\r\n      }\r\n   }\r\n\r\n   return <div id=\"terrain-generator\">\r\n      <h2 className=\"subheading\">Terrain Generation</h2>\r\n\r\n      <InputCheckbox name=\"show-terrain-generator-checkbox\" text=\"Advanced terrain generation\" defaultValue={false} func={toggleTerrainGeneratorVisibility} />\r\n\r\n      <InputText func={newVal => Game.boardSize.width = newVal} text=\"Width\" defaultValue={15} limit={100} />\r\n      <InputText func={newVal => Game.boardSize.height = newVal} text=\"Height\" defaultValue={15} limit={100} />\r\n\r\n      {!visible ? <>\r\n         <InputSelect options={presetNames} name=\"terrain-preset-options\" text=\"Presets:\" defaultValue={terrainInfo.presets[0].name} func={onPresetChange} />\r\n      </> : \r\n      <>\r\n\r\n      </>}\r\n\r\n      <button onClick={generatePreview}>Generate</button>\r\n      <div id=\"board-preview-container\"></div>\r\n   </div>;\r\n};\r\n\r\nexport default TerrainGenerator;","import React, { useRef, useState } from 'react';\r\n\r\ninterface InputSelectProps {\r\n   options: ReadonlyArray<string>;\r\n   name: string;\r\n   text: string;\r\n   defaultValue: string;\r\n   func?: Function;\r\n}\r\n\r\nconst InputSelect = ({ options, name, text, defaultValue, func }: InputSelectProps) => {\r\n   const selectElemRef = useRef<HTMLSelectElement | null>(null);\r\n   const [val, setVal] = useState<string>(defaultValue);\r\n\r\n   const htmlName = \"_INPUT_\" + name;\r\n\r\n   const handleChange = (event: any) => {\r\n      const newVal = event.target.value;\r\n      // console.log(event.target.value);\r\n      setVal(newVal);\r\n\r\n      if (func) func(newVal);\r\n   }\r\n\r\n   return <div className=\"input-select\">\r\n      <label htmlFor={htmlName}>{text}</label>\r\n\r\n      {/* <select ref={selectElemRef} value={val} onChange={() => handleChange(selectElemRef.current!.value)}> */}\r\n      <select ref={selectElemRef} value={val} onChange={handleChange}>\r\n         {options.map((option, idx) => {\r\n            return <option key={idx}>{option}</option>;\r\n         })}\r\n      </select>\r\n   </div>;\r\n};\r\n\r\nexport default InputSelect;\r\n","import React from 'react';\r\n\r\ninterface WarningProps {\r\n   text: string;\r\n}\r\n\r\nconst Warning = ({ text }: WarningProps) => {\r\n   return (\r\n      <div className=\"warning\">\r\n         <h3>Warning</h3>\r\n         <p>{text}</p>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default Warning;\r\n","import React, { useRef, useState } from 'react';\r\nimport Warning from './Warning';\r\n\r\ninterface InputTextProps {\r\n   text: string;\r\n   defaultValue: number;\r\n   limit?: number;\r\n   func?: (newVal: number) => void;\r\n}\r\n\r\nconst InputText = ({ text, defaultValue, func, limit }: InputTextProps) => {\r\n   const inputRef = useRef(null);\r\n   const [val, setVal] = useState<any>(defaultValue);\r\n\r\n   const onInputChange = () => {\r\n      const inputVal = Number((inputRef.current! as HTMLInputElement).value);\r\n\r\n      if (func) func(inputVal);\r\n      setVal(inputVal);\r\n   }\r\n\r\n   let warningMessage = null;\r\n   if (isNaN(val)) {\r\n      warningMessage = \"The input must be a valid number.\";\r\n   } else if (val === 0) {\r\n      warningMessage = \"You must have an input value.\";\r\n   } else if (val % 1 !== 0) {\r\n      warningMessage = \"The input must be an integer.\";\r\n   } else if (limit && val > limit) {\r\n      warningMessage = `The input cannot be greater than ${limit}.`;\r\n   }\r\n   \r\n   return (\r\n      <div className=\"input-text\">\r\n         <span className=\"text\">{text}:</span>\r\n         <input ref={inputRef} onInput={onInputChange} type=\"text\" defaultValue={defaultValue} />\r\n\r\n         {warningMessage !== null ? \r\n            <Warning text={warningMessage} />\r\n         : \"\"}\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default InputText;\r\n","import { getTiles } from \"../components/TerrainGenerator\";\r\nimport { getElem, randFloat, randItem, Vector } from \"../utils\";\r\nimport { TileType } from \"./BoardGenerator\";\r\nimport Creature from \"./Creature\";\r\nimport Entity from \"./Entity\";\r\nimport Fruit from \"./Fruit\";\r\n\r\ninterface BoardCensus {\r\n   creatures: Array<Creature>;\r\n   fruit: Array<Fruit>;\r\n}\r\n\r\nexport class Board {\r\n   private width: number;\r\n   private height: number;\r\n   private cellSize: number;\r\n   cells: Array<Array<Entity>>;\r\n   landTileIndexes = new Array<number>();\r\n   private tiles: Array<Array<TileType>>;\r\n\r\n   constructor(width: number, height: number, cellSize: number) {\r\n      this.width = width;\r\n      this.height = height;\r\n      this.cellSize = cellSize;\r\n\r\n      this.cells = new Array<Array<Entity>>(width * height);\r\n      for (let i = 0; i < width * height; i++) {\r\n         this.cells[i] = [];\r\n      }\r\n\r\n      this.tiles = this.generateTiles();\r\n   }\r\n\r\n   private createCell(): HTMLElement {\r\n      const cellObj = document.createElement(\"div\");\r\n      cellObj.className = \"cell\";\r\n      return cellObj;\r\n   }\r\n   private createCellRow(): HTMLElement {\r\n      const cellRow = document.createElement(\"div\");\r\n      cellRow.style.height = `${this.cellSize}px`;\r\n      cellRow.className = \"cell-row\";\r\n      return cellRow;\r\n   }\r\n   private generateTiles(): Array<Array<TileType>> {\r\n      const tileTypes = getTiles();\r\n\r\n      const board = getElem(\"board\");\r\n      board.classList.remove(\"hidden\");\r\n\r\n      const CELL_BORDER_SIZE = 2;\r\n      board.style.setProperty(\"--cell-size\", `${this.cellSize}px`);\r\n      board.style.setProperty(\"--cell-border-size\", `${CELL_BORDER_SIZE}px`);\r\n\r\n      const boardWidth = this.width * this.cellSize;\r\n      board.style.width = `${boardWidth}px`;\r\n      const boardHeight = this.height * this.cellSize;\r\n      board.style.height = `${boardHeight}px`;\r\n\r\n      const cellRows = new Array<HTMLElement>();\r\n      for (let i = 0; i < this.height; i++) {\r\n         const cellRow = this.createCellRow();\r\n         board.appendChild(cellRow);\r\n         cellRows.push(cellRow);\r\n         for (let j = 0; j < this.width; j++) {\r\n            const tileType = tileTypes[i][j];\r\n\r\n            if (!tileType.isLiquid) {\r\n               this.landTileIndexes.push(i * this.width + j);\r\n            }\r\n\r\n            const cellObj = this.createCell();\r\n            cellObj.style.backgroundColor = tileType.colour;\r\n            cellRow.appendChild(cellObj);\r\n         }\r\n      }\r\n\r\n      return tileTypes;\r\n   }\r\n\r\n   createEntity(entity: Entity): void {\r\n      const cellNumbers = this.getCellNumbers(entity.position, entity.size/2);\r\n      this.insertEntity(entity, cellNumbers);\r\n   }\r\n\r\n   deleteEntity(entity: Entity): void {\r\n      const cellNumbers = this.getCellNumbers(entity.position, entity.size/2);\r\n      this.removeEntity(entity, cellNumbers);\r\n   }\r\n\r\n   updateEntity(entity: Entity) {\r\n      const previousCellNumbers = this.getEntityReferences(entity);\r\n      const cellNumbers = this.getCellNumbers(entity.position, entity.size/2);\r\n\r\n      if (cellNumbers !== previousCellNumbers) {\r\n         this.removeEntity(entity, previousCellNumbers);\r\n         this.insertEntity(entity, cellNumbers);\r\n      }\r\n   }\r\n\r\n   getNearby(position: Vector, radius: number): Array<Entity> {\r\n      const minX = Math.max(Math.floor((position.x - radius) / this.cellSize), 0);\r\n      const maxX = Math.min(Math.floor((position.x + radius) / this.cellSize), this.width - 1);\r\n      const minY = Math.max(Math.floor((position.y - radius) / this.cellSize), 0);\r\n      const maxY = Math.min(Math.floor((position.y + radius) / this.cellSize), this.height - 1);\r\n\r\n      let nearbyEntities = new Array<Entity>();\r\n      for (let y = minY; y <= maxY; y++) {\r\n         for (let x = minX; x <= maxX; x++) {\r\n            const cellNumber = y * this.width + x;\r\n            for (const entity of this.cells[cellNumber]) {\r\n               const distanceFromEntity = position.distanceFrom(entity.position);\r\n               if (!nearbyEntities.includes(entity) && distanceFromEntity - entity.size/2 <= radius) {\r\n                  nearbyEntities.push(entity);\r\n               }\r\n            }\r\n         }\r\n      }\r\n      return nearbyEntities;\r\n   }\r\n\r\n   randomPosition(): Vector {\r\n      const tileIndex = randItem(this.landTileIndexes) as number;\r\n      const x = tileIndex % this.width;\r\n      const y = Math.floor(tileIndex / this.width);\r\n\r\n      const xo = randFloat(0, this.cellSize);\r\n      const yo = randFloat(0, this.cellSize);\r\n\r\n      return new Vector(x * this.cellSize + xo, y * this.cellSize + yo);\r\n   }\r\n\r\n   getFruitColour(position: Vector): string {\r\n      const x = Math.floor(position.x / this.cellSize);\r\n      const y = Math.floor(position.y / this.cellSize);\r\n\r\n      const tileType = this.tiles[y][x];\r\n      if (tileType.isLiquid) {\r\n         console.warn(\"Tried to find the fruit colour of a liquid!\");\r\n      }\r\n      return tileType.fruitColour!;\r\n   }\r\n\r\n   randomPositionInCell(cellNumber: number): Vector {\r\n      const cellX = cellNumber % this.width;\r\n      const cellY = Math.floor(cellNumber / this.width);\r\n\r\n      const x = randFloat(0, this.cellSize);\r\n      const y = randFloat(0, this.cellSize);\r\n\r\n      return new Vector(cellX * this.cellSize + x, cellY * this.cellSize + y);\r\n   }\r\n\r\n   randomNearbyPosition(position: Vector, radius: number): Vector {\r\n      let nearbyPosition: Vector | null = null;\r\n      while (nearbyPosition === null) {\r\n         const pos = position.randomOffset(radius);\r\n         if (this.positionIsInBoard(pos)) {\r\n            nearbyPosition = pos;\r\n         }\r\n      }\r\n      return nearbyPosition;\r\n   }\r\n\r\n   census(): Promise<BoardCensus> {\r\n      return new Promise(resolve => {\r\n         let creatures: Array<Creature> = new Array<Creature>();\r\n         let fruit: Array<Fruit> = new Array<Fruit>();\r\n      \r\n         for (const cell of this.cells) {\r\n            for (const entity of cell) {\r\n               if (entity instanceof Creature && !creatures.includes(entity)) creatures.push(entity);\r\n               else if (entity instanceof Fruit && !fruit.includes(entity)) fruit.push(entity);\r\n               entity.tick();\r\n            }\r\n         }\r\n   \r\n         const entities = {\r\n            creatures: creatures,\r\n            fruit: fruit\r\n         };\r\n         resolve(entities);\r\n      });\r\n   }\r\n\r\n   private insertEntity(entity: Entity, cellNumbers: Array<number>) {\r\n      for (const cellNumber of cellNumbers) {\r\n         this.cells[cellNumber].push(entity);\r\n      }\r\n   }\r\n\r\n   private removeEntity(entity: Entity, cellNumbers: Array<number>) {\r\n      for (const cellNumber of cellNumbers) {\r\n         const idx = this.cells[cellNumber].indexOf(entity);\r\n         this.cells[cellNumber].splice(idx, 1);\r\n      }\r\n   }\r\n\r\n   private getEntityReferences(entity: Entity): Array<number> {\r\n      let cells = new Array<number>();\r\n      for (let i = 0; i < this.cells.length; i++) {\r\n         if (this.cells[i].includes(entity)) cells.push(i);\r\n      }\r\n      return cells;\r\n   }\r\n\r\n   private getCellNumbers(position: Vector, radius: number): Array<number> {\r\n      // The (position.x + this.cellSize) part is necessary because sometimes is negative\r\n      const cellX = (position.x + this.cellSize) % this.cellSize;\r\n      const cellY = (position.y + this.cellSize) % this.cellSize;\r\n      \r\n      const x = Math.floor(position.x / this.cellSize);\r\n      const y = Math.floor(position.y / this.cellSize);\r\n\r\n      const positionInCell = new Vector(cellX, cellY);\r\n      \r\n      const baseCellNumber = y * this.width + x;\r\n      let cellNumbers = [baseCellNumber];\r\n      if (positionInCell.x - radius < 0) cellNumbers.push(baseCellNumber - 1);\r\n      if (positionInCell.x + radius > this.cellSize) cellNumbers.push(baseCellNumber + 1);\r\n      if (positionInCell.y - radius < 0) cellNumbers.push(baseCellNumber - this.width);\r\n      if (positionInCell.y + radius > this.cellSize) cellNumbers.push(baseCellNumber + this.width);\r\n      if (positionInCell.x - radius < 0 && positionInCell.y - radius < 0) cellNumbers.push(baseCellNumber - this.width - 1);\r\n      if (positionInCell.x - radius < 0 && positionInCell.y + radius > this.cellSize) cellNumbers.push(baseCellNumber + this.width - 1);\r\n      if (positionInCell.x - radius > this.cellSize && positionInCell.y - radius < 0) cellNumbers.push(baseCellNumber - this.width + 1);\r\n      if (positionInCell.x - radius > this.cellSize && positionInCell.y + radius > this.cellSize) cellNumbers.push(baseCellNumber + this.width + 1);\r\n      // TODO: Do corners\r\n\r\n      const maxCellNumber = this.width * this.height - 1;\r\n      for (let i = cellNumbers.length - 1; i >= 0; i--) {\r\n         const cellNumber = cellNumbers[i];\r\n         if (cellNumber < 0 || cellNumber > maxCellNumber) {\r\n            cellNumbers.splice(i, 1);\r\n         }\r\n      }\r\n\r\n      return cellNumbers;\r\n   }\r\n\r\n   private positionIsInBoard(position: Vector): boolean {\r\n      return position.x >= 0 && position.x <= this.width * this.cellSize && position.y >= 0 && position.y <= this.height * this.cellSize;\r\n   }\r\n}","import Fruit, { createFruit } from \"./classes/Fruit\";\nimport { gameImages } from \"./GameImage\";\nimport { updateMouse } from \"./mouse\";\nimport { inspectorIsOpen, rerenderInspector } from \"./creature-inspector\";\nimport { updateControlPanel } from \"./components/ControlPanel\";\nimport Creature, { createCreature, creatureGeneInfo } from \"./classes/Creature\";\nimport { getElem, standardDeviation, Vector } from \"./utils\";\nimport { drawGraphs, graphSettingData } from \"./graph-viewer\";\nimport { updateTransform } from \"./keyboard\";\nimport Entity from \"./classes/Entity\";\nimport { Board } from \"./classes/Board\";\n\nconst renderListeners: Array<Function> = [];\n\nexport const geneSamples: Array<GeneSample> = new Array<GeneSample>();\n\nexport interface GeneSampleEntry {\n   average: number;\n   min: number;\n   max: number;\n   standardDeviation: number;\n}\ninterface GenePool {\n   [key: keyof typeof creatureGeneInfo]: GeneSampleEntry;\n}\ninterface GeneSample {\n   [key: string]: any;\n   creatures: number | null;\n   fruit: number | null;\n   genePool: GenePool | null;\n   fruitMultiplier: number;\n}\n\nconst sampleGenes = (creatures: ReadonlyArray<Creature>, fruit: ReadonlyArray<Fruit>) => {\n   let genePool: GenePool | null = {};\n   if (creatures.length === 0) {\n      genePool = null;\n   } else {\n      let allGenes: { [ key: keyof typeof creatureGeneInfo ]: Array<number> } = {};\n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         allGenes[geneName] = new Array<number>();\n      }\n      \n      for (const creature of creatures) {\n         for (const geneName of Object.keys(allGenes)) {\n            allGenes[geneName].push(creature[geneName]);\n         }\n      }\n      \n      for (const geneName of Object.keys(creatureGeneInfo)) {\n         const geneVals = allGenes[geneName];\n         \n         const n = geneVals.length;\n         let minVal = Number.MAX_SAFE_INTEGER;\n         let maxVal = 0;\n         let average = 0;\n         for (let i = 0; i < n; i++) {\n            const val = geneVals[i];\n            if (val < minVal) minVal = val;\n            if (val > maxVal) maxVal = val;\n            average += val;\n         }\n         average /= n;\n         \n         genePool[geneName] = {\n            average: average,\n            min: minVal,\n            max: maxVal,\n            standardDeviation: standardDeviation(geneVals)\n         };\n      }\n   }\n\n   let creatureCount: number | null = Entity.count(Creature);\n   // let creatureCount: number | null = creatures.length;\n   if (creatureCount === 0) creatureCount = null;\n   const fruitCount: number | null = Entity.count(Fruit);\n   // const fruitCount: number | null = fruit.length;\n   geneSamples.push({\n      creatures: creatureCount,\n      fruit: fruitCount,\n      genePool: genePool,\n      fruitMultiplier: Game.fruitMultiplier\n   });\n\n   if (graphSettingData[1].isChecked) {\n      drawGraphs();\n   }\n};\n\ninterface GameType {\n   hasStarted: boolean;\n   isPaused: boolean;\n   ticks: number;\n   readonly tps: number;\n   timewarp: number;\n   fruitMultiplier: number;\n   previousTime: number;\n   previousTicks: number;\n   runTick: Function;\n   start: Function;\n   createRenderListener: Function;\n   removeRenderListener: Function;\n   hasRenderListener: Function;\n   boardSize: {\n      width: number;\n      height: number;\n   },\n   transform: {\n      zoom: number;\n      translate: Vector;\n   },\n   readonly cellSize: number;\n   settings: GameSettings;\n   board: Board;\n}\nexport interface GameSettings {\n   fruitSpawnRate: number;\n   creatureMutationRate: number;\n   eggIncubationTime: number;\n   initialCreatures: number;\n   initialFruit: number;\n   equilibrium: number;\n   showDebugOutput: boolean;\n}\nexport const defaultGameSettings: GameSettings = {\n   fruitSpawnRate: 1,\n   creatureMutationRate: 1,\n   eggIncubationTime: 5,\n   initialCreatures: 10,\n   initialFruit: 50,\n   equilibrium: 20,\n   showDebugOutput: false\n}\n\nconst Game: GameType = {\n   hasStarted: false,\n   isPaused: false,\n   // The number of ticks that have elapsed since the load of the web page\n   ticks: 0,\n   // Effectively changes the number of rerenders each second. Affects everything from confetti to creatures.\n   tps: 20,\n   timewarp: 1,\n   fruitMultiplier: 1,\n   previousTime: Date.now(),\n   previousTicks: 0,\n   // Runs every {tps} seconds.\n   runTick: async function(): Promise<void> {\n      if (this.isPaused) {\n         setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n         return;\n      }\n\n      this.previousTicks++;\n\n      // Call all external render listeners\n      for (const func of renderListeners) func();\n\n      for (const gameImage of gameImages) gameImage.tick();\n      \n      if (this.hasStarted) {\n         this.ticks++;\n\n         // Remove all rays\n         document.querySelectorAll(\".ray\").forEach(ray => ray.remove());\n\n         // const entities = await updateEntities();\n         const entities = await Game.board.census();\n\n         const creatureCount = entities.creatures.length;\n         if (creatureCount === 0) {\n            this.fruitMultiplier = 1;\n         } else {\n            this.fruitMultiplier = this.settings.equilibrium / creatureCount;\n         }\n   \n         // Number of fruits which spawn in a cell each second\n         const FRUIT_SPAWN_RATE = 0.05 * this.settings.fruitSpawnRate * this.fruitMultiplier;\n         for (let i = 0; i < this.board.landTileIndexes.length; i++) {\n            const cellNumber = this.board.landTileIndexes[i];\n            const rand = Math.random();\n            for (let i = 0; rand <= FRUIT_SPAWN_RATE / this.tps - i; i++) {\n               createFruit(cellNumber);\n            }\n         }\n   \n         updateControlPanel();\n   \n         if (inspectorIsOpen) rerenderInspector();\n\n         // Seconds between gene samples\n         const GENE_SAMPLE_INTERVAL = 10;\n         if (this.ticks / this.tps % GENE_SAMPLE_INTERVAL === 0) {\n            sampleGenes(entities.creatures, entities.fruit);\n         }\n      }\n\n      const time = Date.now();\n      const dt = time - this.previousTime;\n      if (time - this.previousTime >= 1000) {\n         if (this.settings.showDebugOutput) console.log(this.previousTicks + \" ticks in \" + dt + \"ms\");\n         this.previousTicks = 0;\n         this.previousTime = time;\n      }\n\n      setTimeout(() => this.runTick(), 1000 / this.tps / this.timewarp);\n   },\n   start(): void {\n      getElem(\"title-options-container\").classList.add(\"hidden\");\n\n      // Create the board object\n      this.board = new Board(this.boardSize.width, this.boardSize.height, this.cellSize);\n\n      this.hasStarted = true;\n\n      this.transform.zoom = 25 / Math.pow(this.boardSize.width + this.boardSize.height, 1.1);\n      updateTransform();\n   \n      for (let i = 0; i < this.settings.initialCreatures; i++) {\n         createCreature();\n      }\n      for (let i = 0; i < this.settings.initialFruit; i++) {\n         createFruit();\n      }\n   },\n   createRenderListener(func: Function): void {\n      renderListeners.push(func);\n   },\n   removeRenderListener(func: Function): void {\n      const functionIndex = renderListeners.indexOf(func);\n      if (functionIndex === -1) throw new Error(`No matching function could be found! Name: ${func.name}`);\n      renderListeners.push(func);\n   },\n   hasRenderListener(func: Function): boolean {\n      const functionIndex = renderListeners.indexOf(func);\n      return functionIndex >= 0;\n   },\n   boardSize: {\n      width: 15,\n      height: 15\n   },\n   transform: {\n      zoom: 1,\n      translate: new Vector(0, 0)\n   },\n   // Width and height of cells in px\n   cellSize: 60,\n   settings: defaultGameSettings,\n   board: null as unknown as Board\n};\n\nexport default Game;","import Game from \"./Game\";\nimport { randFloat, randItem, Vector } from \"./utils\";\n\nconst confettis: Array<Confetti> = [];\n\nclass Confetti {\n   element: HTMLElement;\n   position: Vector;\n   velocity: Vector;\n\n   constructor() {\n      this.element = this.createInstance();\n      this.position = this.getRandomPosition();\n      this.velocity = this.getRandomVelocity();\n   };\n   getRandomPosition(): Vector {\n      // Between 100 and 0, percentage of the screen that the x position could start at\n      const X_RANGE = 90;\n      // Between 100 and 0, percentage of the screen that the y position could start at\n      const Y_RANGE = 90;\n      // Shifts the potential y positions up and down. Negative is a shift down\n      const Y_OFFSET = -10;\n\n      const x = randFloat(0, X_RANGE) + (100 - X_RANGE) / 2;\n      const y = randFloat(0, Y_RANGE) + (100 - Y_RANGE) / 2 - Y_OFFSET;\n      return new Vector(x, y);\n   };\n   getRandomVelocity(): Vector {\n      const xVel = randFloat(-2, 2);\n      const yVel = randFloat(-12, -5);\n      return new Vector(xVel, yVel);\n   };\n   createInstance(): HTMLElement {\n      const confetti = document.createElement(\"div\");\n      confetti.className = \"confetti\";\n      document.body.appendChild(confetti);\n\n      // Give it a random size\n      const WIDTH_RANGE = [3, 7];\n      const HEIGHT_RANGE = [5, 12];\n      const width = randFloat(WIDTH_RANGE[0], WIDTH_RANGE[1]);\n      const height = randFloat(HEIGHT_RANGE[0], HEIGHT_RANGE[1]);\n      confetti.style.width = `${width}px`;\n      confetti.style.height = `${height}px`;\n      \n      // Apply a random rotation\n      const rotation = Math.random() * 180;\n      confetti.style.transform = `rotate(${rotation}deg)`;\n\n      const potentialColours: Array<string> = [\"red\", \"pink\", \"orange\", \"green\", \"blue\"];\n      const colour: string = randItem(potentialColours) as string;\n      confetti.style.backgroundColor = colour;\n\n      return confetti;\n   };\n   updatePosition(): void {\n      this.element.style.left = `${this.position.x}%`;\n      this.element.style.top = `${this.position.y}%`;\n   };\n   tick() {\n      for (let i = 0; i < 7; i++) {\n         // Apply velocity\n         this.position = this.position.lerp(this.position.add(this.velocity), 1 / Game.tps);\n         // Gravityyyyy\n         this.velocity.y += 0.05;\n      }\n\n      // If the confetti is out of bounds, stab it\n      if (this.position.y > 100 || this.position.x < 0 || this.position.x > 100) {\n         this.die();\n      }\n\n      this.updatePosition();\n   };\n   die() {\n      this.element.remove();\n\n      const confettiIndex = confettis.indexOf(this);\n      confettis.splice(confettiIndex, 1);\n   }\n}\n\nconst handleConfettis = () => {\n   for (const confetti of confettis) confetti.tick();\n}\n\nexport function createConfettis(n: number) {\n   for (let i = 0; i < n; i++) {\n      confettis.push(new Confetti());\n   }\n\n   if (!Game.hasRenderListener(handleConfettis)) Game.createRenderListener(handleConfettis);\n}","import '../css/start-menu.css';\r\nimport { getElem } from '../utils';\r\nimport InputRange from './InputRange';\r\nimport Game, { defaultGameSettings, GameSettings } from '../Game';\r\nimport TerrainGenerator from './TerrainGenerator';\r\n\r\nexport function openStartMenu(): void {\r\n   getElem(\"start-menu\").classList.remove(\"hidden\");\r\n}\r\n\r\nconst closeStartMenu = (): void => {\r\n   getElem(\"start-menu\").remove();\r\n\r\n   Game.start();\r\n}\r\n\r\nlet newGameSettings: GameSettings = JSON.parse(JSON.stringify(defaultGameSettings));\r\n\r\nconst startClickEvent = () => {\r\n   Game.settings = newGameSettings;\r\n   closeStartMenu();\r\n};\r\n\r\nconst StartMenu = () => {\r\n   return (\r\n      <div id=\"start-menu\" className=\"menu hidden\">\r\n         <div className=\"content\">\r\n            <h1 className=\"heading\">Settings</h1>\r\n\r\n            <TerrainGenerator />\r\n\r\n            <h2 className=\"subheading\">Initial Population</h2>\r\n            <InputRange func={newVal => newGameSettings.initialCreatures = newVal} text=\"Creatures\" min={0} max={100} step={1} defaultValue={10} />\r\n            <InputRange func={newVal => newGameSettings.initialFruit = newVal} text=\"Fruit\" min={0} max={500} step={5} defaultValue={50} />\r\n\r\n            <h2 className=\"subheading\">Modifiers</h2>\r\n            <InputRange func={newVal => newGameSettings.fruitSpawnRate = newVal} text=\"Fruit spawn rate\" min={0.5} max={5} step={0.5} defaultValue={1} hasExtremeMode={true} />\r\n            <InputRange func={newVal => newGameSettings.creatureMutationRate = newVal} text=\"Creature mutation rate\" min={0.5} max={3} step={0.1} defaultValue={1} hasExtremeMode={true} />\r\n            <InputRange func={newVal => newGameSettings.eggIncubationTime = newVal} text=\"Egg incubation time\" min={0} max={15} step={1} defaultValue={5} hasExtremeMode={true} />\r\n\r\n            <h2 className=\"subheading\">Other Stuff</h2>\r\n            <p>I couldn't figure out where to put these so now this is here.</p>\r\n            <InputRange func={newVal => newGameSettings.equilibrium = newVal} text=\"Desired equilibrium\" min={0} max={100} step={5} defaultValue={20} />\r\n\r\n            <button onClick={startClickEvent}>Start</button>\r\n         </div>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default StartMenu;\r\n","import React from \"react\";\nimport { createConfettis } from \"../confetti\";\nimport \"../css/titlescreen.css\";\nimport { openStartMenu } from \"./StartMenu\";\n\nconst openSourceCode = () => {\n   const githubURL = \"https://github.com/eggpoison/creature-simulator\";\n   window.open(githubURL, '_blank')?.focus();\n}\n\nconst Titlescreen = () => {\n   return (\n      <div id=\"titlescreen\">\n         <h1>Creature Simulator</h1>\n         <div id=\"title-options-container\">\n            <button onClick={openStartMenu}>Start</button>\n            <button onClick={() => createConfettis(50)}>Confetti!</button>\n            <button>About</button>\n            <button onClick={openSourceCode} id=\"source-code-button\">Source Code</button>\n         </div>\n      </div>\n   );\n}\n\nexport default Titlescreen;","const Board = () => {\n   return (\n      <div id=\"board\" className=\"hidden\"></div>\n   );\n}\n\nexport default Board;","import React, { useEffect, useState } from 'react'\r\nimport Creature, { creatureGeneInfo } from '../classes/Creature';\r\nimport { setInspectorRerenderFunction, setUpdateFunction } from '../creature-inspector';\r\nimport '../css/creature-inspector.css';\r\nimport Game from '../Game';\r\nimport { roundNum } from '../utils';\r\n\r\nconst CreatureInspector = () => {\r\n    const [creature, setCreature] = useState<Creature | null>(null);\r\n\r\n    const [, updateState] = React.useState({});\r\n    const forceUpdate = React.useCallback(() => updateState({}), []);\r\n\r\n    useEffect(() => {\r\n        setUpdateFunction((newCreature: Creature | null) => {\r\n            setCreature(newCreature);\r\n        });\r\n        setInspectorRerenderFunction(() => forceUpdate());\r\n    }, [forceUpdate]);\r\n\r\n    const geneInfo: JSX.Element = creature === null ? <></> : <> {\r\n        Object.entries(creatureGeneInfo).map((geneInfo, i) => {\r\n            const gene = geneInfo[1], geneName = geneInfo[0];\r\n            const val = creature[geneName];\r\n            const fillWidth = (val - gene.min) / (gene.max - gene.min) * 100;\r\n            const fillOpacity = 0.5 + (val - gene.min) / (gene.max - gene.min) / 2;\r\n            \r\n            return <div key={i} className=\"gene\">\r\n                <div className=\"label\">{gene.display}</div>\r\n                <div className=\"slider\">\r\n                    <div style={{ width: fillWidth + \"%\", opacity: fillOpacity, backgroundColor: gene.colour }} className=\"slider-fill\"></div>\r\n                    <div className=\"min\">{gene.min}</div>\r\n                    <div className=\"val\">{val}</div>\r\n                    <div className=\"max\">{gene.max}</div>\r\n                </div>\r\n            </div>\r\n        })\r\n    } </>\r\n\r\n    return creature === null ? <></> : (\r\n        <div id=\"creature-inspector\">\r\n            <h1>Creature Inspector</h1>\r\n\r\n            <h2>General</h2>\r\n            <div className=\"panel\">\r\n                <p>Name: {creature.name}</p>\r\n                <p>Age: {Game.ticks - creature.birthTime} ticks ({roundNum((Game.ticks - creature.birthTime) / Game.tps, 1)} seconds)</p>\r\n            </div>\r\n\r\n            <h2>Stats</h2>\r\n            <div className=\"panel\">\r\n                <p>Generation: {creature.stats.generation}</p>\r\n                <p>Fruit eaten: {creature.stats.fruitEaten}</p>\r\n            </div>\r\n\r\n            <h2>Genes</h2>\r\n            <div className=\"panel\">\r\n                {geneInfo}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CreatureInspector;\r\n","import Creature from \"./classes/Creature\";\r\nimport { createHoverBox, getElem, Vector } from \"./utils\";\r\nimport { closeInspector, openInspector } from \"./creature-inspector\";\r\nimport { closeGraphViewer, graphViewerIsVisible, openGraphViewer } from \"./graph-viewer\";\r\nimport Game from \"./Game\";\r\n\r\nconst MIN_HOVER_DISTANCE = 50;\r\nlet hoverBox: HTMLElement | null = null;\r\nlet closestCreature: Creature | null = null;\r\n\r\nconst highlight = (creature: Creature): void => {\r\n   creature.element.classList.add(\"highlighted\");\r\n}\r\n\r\nconst removePreviousHighlight = (): void => {\r\n   document.querySelector(\".creature.highlighted\")?.classList.remove(\"highlighted\");\r\n}\r\n\r\nexport function handleMouse(event: MouseEvent): void {\r\n   const board = getElem(\"board\");\r\n   if (event.composedPath().includes(board)) {\r\n      const boardBounds = board.getBoundingClientRect();\r\n      updateMouse(event.clientX - boardBounds.x, event.clientY - boardBounds.y);\r\n   }\r\n\r\n}\r\n\r\nexport function updateMouse(mouseX: number, mouseY: number): void {\r\n   const mult = 900 / 534;\r\n   const mousePos = new Vector(mouseX * mult, mouseY * mult);\r\n\r\n   closestCreature = null;\r\n   let distanceToClosestCreature = MIN_HOVER_DISTANCE;\r\n   for (const cell of Game.board.cells) {\r\n      for (const entity of cell) {\r\n         if (entity instanceof Creature) {\r\n            const dist = mousePos.distanceFrom(entity.position);\r\n            if (dist < distanceToClosestCreature) {\r\n               closestCreature = entity;\r\n               distanceToClosestCreature = dist;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   removePreviousHighlight();\r\n\r\n   const board = getElem(\"board\");\r\n   if (closestCreature !== null) {\r\n      highlight(closestCreature);\r\n      const newHoverBox = createHoverBox(closestCreature.name, new Vector(closestCreature.position.x, closestCreature.position.y + 20 + closestCreature.size/2), board);\r\n      // Remove previous hover box if possible\r\n      if (hoverBox !== null && hoverBox !== newHoverBox) {\r\n         hoverBox.remove();\r\n      }\r\n      hoverBox = newHoverBox;\r\n\r\n      board.classList.add(\"highlight\");\r\n   } else {\r\n      board.classList.remove(\"highlight\");\r\n      hoverBox?.remove();\r\n      hoverBox = null;\r\n   }\r\n}\r\n\r\nexport function mouseClick(): void {\r\n   const e = window.event;\r\n   const targetElem = e?.target as HTMLElement;\r\n\r\n   if (targetElem.id === \"open-graph-viewer-button\") {\r\n      openGraphViewer();\r\n   } else if (graphViewerIsVisible) {\r\n      if (e?.composedPath().includes(getElem(\"graph-viewer\"))) return;\r\n      \r\n      closeGraphViewer();\r\n   } else {\r\n      if (closestCreature !== null) {\r\n         openInspector(closestCreature);\r\n      } else {\r\n         closeInspector();\r\n      }\r\n   }\r\n}","import React from 'react';\r\nimport '../css/graph-viewer.css';\r\nimport '../css/graphs.css';\r\n\r\nconst GraphViewer = () => {\r\n   return (\r\n      <div id=\"graph-viewer\" className=\"menu hidden\">\r\n         <h1 className=\"heading\">View Graphs</h1>\r\n\r\n         <div className=\"formatter\">\r\n            <div className=\"options\">\r\n               <h2 className=\"subheading\">Graph Options</h2>\r\n               <p>Select which graphs should be shown.</p>\r\n\r\n               <div className=\"options-container\"></div>\r\n            </div>\r\n            <div className=\"settings\">\r\n               <h2 className=\"subheading\">Settings</h2>\r\n               <p>Control how the graphs look.</p>\r\n\r\n               <div className=\"settings-container\"></div>\r\n            </div>\r\n         </div>\r\n         <div className=\"graph-container\">\r\n            <p>Your graph will appear here once you choose an option.</p>\r\n         </div>\r\n      </div>\r\n   );\r\n}\r\n\r\nexport default GraphViewer;\r\n","const PauseScreen = () => {\r\n   return (\r\n      <div id=\"pause-screen\" className=\"hidden\">\r\n         <hgroup>\r\n            <h1>Paused!</h1>\r\n            <h2>Press <span>&lt;space&gt;</span> to unpause.</h2>\r\n         </hgroup>\r\n      </div>\r\n   )\r\n}\r\n\r\nexport default PauseScreen;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Titlescreen from './components/Titlescreen';\nimport Game from './Game';\nimport './css/index.css';\nimport './css/menus.css';\nimport './css/board.css';\nimport Board from './components/Board';\nimport ControlPanel from './components/ControlPanel';\nimport CreatureInspector from './components/CreatureInspector';\nimport { handleMouse, mouseClick } from './mouse';\nimport GraphViewer from './components/GraphViewer';\nimport PauseScreen from './components/PauseScreen';\nimport StartMenu from './components/StartMenu';\nimport { getElem } from './utils';\nimport { setupGraphs } from './graph-viewer';\nimport { keyPress } from './keyboard';\nimport './css/pause-screen.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Titlescreen />\n    <ControlPanel />\n    <Board />\n    <CreatureInspector />\n    <GraphViewer />\n    <PauseScreen />\n    <StartMenu />\n    <div id=\"mask\" className=\"hidden\"></div>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\nexport function hideMask(): void {\n  getElem(\"mask\").classList.add(\"hidden\");\n}\n\nexport function showMask(): void {\n  getElem(\"mask\").classList.remove(\"hidden\");\n}\n\nconst setup = (): void => {\n  setupGraphs();\n\n  // Start the game loop\n  Game.runTick();\n};\n\nwindow.onload = setup;\n\ndocument.onmousemove = handleMouse;\ndocument.onclick = mouseClick;\ndocument.onkeydown = keyPress;"],"sourceRoot":""}